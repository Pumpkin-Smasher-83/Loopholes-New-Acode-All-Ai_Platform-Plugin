(()=>{var G_=Object.create;var kl=Object.defineProperty;var K_=Object.getOwnPropertyDescriptor;var J_=Object.getOwnPropertyNames;var W_=Object.getPrototypeOf,Z_=Object.prototype.hasOwnProperty;var h=(n,e)=>()=>(n&&(e=n(n=0)),e);var T=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),io=(n,e)=>{for(var t in e)kl(n,t,{get:e[t],enumerable:!0})},Y_=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of J_(e))!Z_.call(n,s)&&s!==t&&kl(n,s,{get:()=>e[s],enumerable:!(r=K_(e,s))||r.enumerable});return n};var at=(n,e,t)=>(t=n!=null?G_(W_(n)):{},Y_(e||!n||!n.__esModule?kl(t,"default",{value:n,enumerable:!0}):t,n));var Rp,Cp,kp,uo=h(()=>{Rp=Symbol("Let zodToJsonSchema decide on which parser to use"),Cp={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},kp=n=>typeof n=="string"?{...Cp,name:n}:{...Cp,...n}});var Np,$l=h(()=>{uo();Np=n=>{let e=kp(n),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,flags:{hasReferencedOpenAiAnyType:!1},currentPath:t,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([r,s])=>[s._def,{def:s._def,path:[...e.basePath,e.definitionPath,r],jsonSchema:void 0}]))}}});function jl(n,e,t,r){r?.errorMessages&&t&&(n.errorMessage={...n.errorMessage,[e]:t})}function J(n,e,t,r,s){n[e]=t,jl(n,e,r,s)}var Nr=h(()=>{});var lo,co=h(()=>{lo=(n,e)=>{let t=0;for(;t<n.length&&t<e.length&&n[t]===e[t];t++);return[(n.length-t).toString(),...e.slice(t)].join("/")}});var H,Ml,O,Ft,Ba=h(()=>{(function(n){n.assertEqual=s=>{};function e(s){}n.assertIs=e;function t(s){throw new Error}n.assertNever=t,n.arrayToEnum=s=>{let a={};for(let i of s)a[i]=i;return a},n.getValidEnumValues=s=>{let a=n.objectKeys(s).filter(o=>typeof s[s[o]]!="number"),i={};for(let o of a)i[o]=s[o];return n.objectValues(i)},n.objectValues=s=>n.objectKeys(s).map(function(a){return s[a]}),n.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{let a=[];for(let i in s)Object.prototype.hasOwnProperty.call(s,i)&&a.push(i);return a},n.find=(s,a)=>{for(let i of s)if(a(i))return i},n.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&Number.isFinite(s)&&Math.floor(s)===s;function r(s,a=" | "){return s.map(i=>typeof i=="string"?`'${i}'`:i).join(a)}n.joinValues=r,n.jsonStringifyReplacer=(s,a)=>typeof a=="bigint"?a.toString():a})(H||(H={}));(function(n){n.mergeShapes=(e,t)=>({...e,...t})})(Ml||(Ml={}));O=H.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Ft=n=>{switch(typeof n){case"undefined":return O.undefined;case"string":return O.string;case"number":return Number.isNaN(n)?O.nan:O.number;case"boolean":return O.boolean;case"function":return O.function;case"bigint":return O.bigint;case"symbol":return O.symbol;case"object":return Array.isArray(n)?O.array:n===null?O.null:n.then&&typeof n.then=="function"&&n.catch&&typeof n.catch=="function"?O.promise:typeof Map<"u"&&n instanceof Map?O.map:typeof Set<"u"&&n instanceof Set?O.set:typeof Date<"u"&&n instanceof Date?O.date:O.object;default:return O.unknown}}});var _,Q_,He,fo=h(()=>{Ba();_=H.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),Q_=n=>JSON.stringify(n,null,2).replace(/"([^"]+)":/g,"$1:"),He=class n extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){let t=e||function(a){return a.message},r={_errors:[]},s=a=>{for(let i of a.issues)if(i.code==="invalid_union")i.unionErrors.map(s);else if(i.code==="invalid_return_type")s(i.returnTypeError);else if(i.code==="invalid_arguments")s(i.argumentsError);else if(i.path.length===0)r._errors.push(t(i));else{let o=r,u=0;for(;u<i.path.length;){let l=i.path[u];u===i.path.length-1?(o[l]=o[l]||{_errors:[]},o[l]._errors.push(t(i))):o[l]=o[l]||{_errors:[]},o=o[l],u++}}};return s(this),r}static assert(e){if(!(e instanceof n))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,H.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){let t={},r=[];for(let s of this.issues)if(s.path.length>0){let a=s.path[0];t[a]=t[a]||[],t[a].push(e(s))}else r.push(e(s));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}};He.create=n=>new He(n)});var ew,lr,Ll=h(()=>{fo();Ba();ew=(n,e)=>{let t;switch(n.code){case _.invalid_type:n.received===O.undefined?t="Required":t=`Expected ${n.expected}, received ${n.received}`;break;case _.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(n.expected,H.jsonStringifyReplacer)}`;break;case _.unrecognized_keys:t=`Unrecognized key(s) in object: ${H.joinValues(n.keys,", ")}`;break;case _.invalid_union:t="Invalid input";break;case _.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${H.joinValues(n.options)}`;break;case _.invalid_enum_value:t=`Invalid enum value. Expected ${H.joinValues(n.options)}, received '${n.received}'`;break;case _.invalid_arguments:t="Invalid function arguments";break;case _.invalid_return_type:t="Invalid function return type";break;case _.invalid_date:t="Invalid date";break;case _.invalid_string:typeof n.validation=="object"?"includes"in n.validation?(t=`Invalid input: must include "${n.validation.includes}"`,typeof n.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${n.validation.position}`)):"startsWith"in n.validation?t=`Invalid input: must start with "${n.validation.startsWith}"`:"endsWith"in n.validation?t=`Invalid input: must end with "${n.validation.endsWith}"`:H.assertNever(n.validation):n.validation!=="regex"?t=`Invalid ${n.validation}`:t="Invalid";break;case _.too_small:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at least":"more than"} ${n.minimum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at least":"over"} ${n.minimum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="bigint"?t=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(n.minimum))}`:t="Invalid input";break;case _.too_big:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at most":"less than"} ${n.maximum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at most":"under"} ${n.maximum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="bigint"?t=`BigInt must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly":n.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(n.maximum))}`:t="Invalid input";break;case _.custom:t="Invalid input";break;case _.invalid_intersection_types:t="Intersection results could not be merged";break;case _.not_multiple_of:t=`Number must be a multiple of ${n.multipleOf}`;break;case _.not_finite:t="Number must be finite";break;default:t=e.defaultError,H.assertNever(n)}return{message:t}},lr=ew});function tw(n){$p=n}function ws(){return $p}var $p,po=h(()=>{Ll();$p=lr});function E(n,e){let t=ws(),r=za({issueData:e,data:n.data,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,t,t===lr?void 0:lr].filter(s=>!!s)});n.common.issues.push(r)}var za,rw,Ae,j,pn,Ce,ho,mo,$r,vs,Dl=h(()=>{po();Ll();za=n=>{let{data:e,path:t,errorMaps:r,issueData:s}=n,a=[...t,...s.path||[]],i={...s,path:a};if(s.message!==void 0)return{...s,path:a,message:s.message};let o="",u=r.filter(l=>!!l).slice().reverse();for(let l of u)o=l(i,{data:e,defaultError:o}).message;return{...s,path:a,message:o}},rw=[];Ae=class n{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){let r=[];for(let s of t){if(s.status==="aborted")return j;s.status==="dirty"&&e.dirty(),r.push(s.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){let r=[];for(let s of t){let a=await s.key,i=await s.value;r.push({key:a,value:i})}return n.mergeObjectSync(e,r)}static mergeObjectSync(e,t){let r={};for(let s of t){let{key:a,value:i}=s;if(a.status==="aborted"||i.status==="aborted")return j;a.status==="dirty"&&e.dirty(),i.status==="dirty"&&e.dirty(),a.value!=="__proto__"&&(typeof i.value<"u"||s.alwaysSet)&&(r[a.value]=i.value)}return{status:e.value,value:r}}},j=Object.freeze({status:"aborted"}),pn=n=>({status:"dirty",value:n}),Ce=n=>({status:"valid",value:n}),ho=n=>n.status==="aborted",mo=n=>n.status==="dirty",$r=n=>n.status==="valid",vs=n=>typeof Promise<"u"&&n instanceof Promise});var jp=h(()=>{});var S,Mp=h(()=>{(function(n){n.errToObj=e=>typeof e=="string"?{message:e}:e||{},n.toString=e=>typeof e=="string"?e:e?.message})(S||(S={}))});function U(n){if(!n)return{};let{errorMap:e,invalid_type_error:t,required_error:r,description:s}=n;if(e&&(t||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(i,o)=>{let{message:u}=n;return i.code==="invalid_enum_value"?{message:u??o.defaultError}:typeof o.data>"u"?{message:u??r??o.defaultError}:i.code!=="invalid_type"?{message:o.defaultError}:{message:u??t??o.defaultError}},description:s}}function Up(n){let e="[0-5]\\d";n.precision?e=`${e}\\.\\d{${n.precision}}`:n.precision==null&&(e=`${e}(\\.\\d+)?`);let t=n.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${t}`}function _w(n){return new RegExp(`^${Up(n)}$`)}function Bp(n){let e=`${Fp}T${Up(n)}`,t=[];return t.push(n.local?"Z?":"Z"),n.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function ww(n,e){return!!((e==="v4"||!e)&&fw.test(n)||(e==="v6"||!e)&&hw.test(n))}function vw(n,e){if(!uw.test(n))return!1;try{let[t]=n.split(".");if(!t)return!1;let r=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),s=JSON.parse(atob(r));return!(typeof s!="object"||s===null||"typ"in s&&s?.typ!=="JWT"||!s.alg||e&&s.alg!==e)}catch{return!1}}function xw(n,e){return!!((e==="v4"||!e)&&pw.test(n)||(e==="v6"||!e)&&mw.test(n))}function Aw(n,e){let t=(n.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,s=t>r?t:r,a=Number.parseInt(n.toFixed(s).replace(".","")),i=Number.parseInt(e.toFixed(s).replace(".",""));return a%i/10**s}function xs(n){if(n instanceof Ge){let e={};for(let t in n.shape){let r=n.shape[t];e[t]=it.create(xs(r))}return new Ge({...n._def,shape:()=>e})}else return n instanceof fr?new fr({...n._def,type:xs(n.element)}):n instanceof it?it.create(xs(n.unwrap())):n instanceof Bt?Bt.create(xs(n.unwrap())):n instanceof Ut?Ut.create(n.items.map(e=>xs(e))):n}function Ul(n,e){let t=Ft(n),r=Ft(e);if(n===e)return{valid:!0,data:n};if(t===O.object&&r===O.object){let s=H.objectKeys(e),a=H.objectKeys(n).filter(o=>s.indexOf(o)!==-1),i={...n,...e};for(let o of a){let u=Ul(n[o],e[o]);if(!u.valid)return{valid:!1};i[o]=u.data}return{valid:!0,data:i}}else if(t===O.array&&r===O.array){if(n.length!==e.length)return{valid:!1};let s=[];for(let a=0;a<n.length;a++){let i=n[a],o=e[a],u=Ul(i,o);if(!u.valid)return{valid:!1};s.push(u.data)}return{valid:!0,data:s}}else return t===O.date&&r===O.date&&+n==+e?{valid:!0,data:n}:{valid:!1}}function zp(n,e){return new En({values:n,typeName:v.ZodEnum,...U(e)})}function Dp(n,e){let t=typeof n=="function"?n(e):typeof n=="string"?{message:n}:n;return typeof t=="string"?{message:t}:t}function qp(n,e={},t){return n?Mr.create().superRefine((r,s)=>{let a=n(r);if(a instanceof Promise)return a.then(i=>{if(!i){let o=Dp(e,r),u=o.fatal??t??!0;s.addIssue({code:"custom",...o,fatal:u})}});if(!a){let i=Dp(e,r),o=i.fatal??t??!0;s.addIssue({code:"custom",...i,fatal:o})}}):Mr.create()}var ot,Lp,B,nw,sw,aw,iw,ow,uw,lw,cw,dw,Fl,fw,pw,hw,mw,gw,yw,Fp,bw,jr,hn,mn,gn,yn,As,bn,_n,Mr,dr,vt,Es,fr,Ge,wn,cr,go,vn,Ut,yo,Os,Is,bo,xn,An,En,On,Lr,ut,it,Bt,In,Pn,Ps,Ew,qa,Va,Tn,Ow,v,Iw,Vp,Hp,Pw,Tw,Gp,Sw,Cw,Rw,kw,Nw,$w,jw,Mw,Lw,Dw,Fw,Uw,Bw,zw,qw,Vw,Hw,Gw,Kw,Jw,Ww,Zw,Yw,Xw,Qw,ev,tv,rv,nv,sv,av,iv,ov,uv,Kp=h(()=>{fo();po();Mp();Dl();Ba();ot=class{constructor(e,t,r,s){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=s}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},Lp=(n,e)=>{if($r(e))return{success:!0,data:e.value};if(!n.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new He(n.common.issues);return this._error=t,this._error}}};B=class{get description(){return this._def.description}_getType(e){return Ft(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Ft(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Ae,ctx:{common:e.parent.common,data:e.data,parsedType:Ft(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(vs(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){let t=this._parse(e);return Promise.resolve(t)}parse(e,t){let r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){let r={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ft(e)},s=this._parseSync({data:e,path:r.path,parent:r});return Lp(r,s)}"~validate"(e){let t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ft(e)};if(!this["~standard"].async)try{let r=this._parseSync({data:e,path:[],parent:t});return $r(r)?{value:r.value}:{issues:t.common.issues}}catch(r){r?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(r=>$r(r)?{value:r.value}:{issues:t.common.issues})}async parseAsync(e,t){let r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){let r={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ft(e)},s=this._parse({data:e,path:r.path,parent:r}),a=await(vs(s)?s:Promise.resolve(s));return Lp(r,a)}refine(e,t){let r=s=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(s):t;return this._refinement((s,a)=>{let i=e(s),o=()=>a.addIssue({code:_.custom,...r(s)});return typeof Promise<"u"&&i instanceof Promise?i.then(u=>u?!0:(o(),!1)):i?!0:(o(),!1)})}refinement(e,t){return this._refinement((r,s)=>e(r)?!0:(s.addIssue(typeof t=="function"?t(r,s):t),!1))}_refinement(e){return new ut({schema:this,typeName:v.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return it.create(this,this._def)}nullable(){return Bt.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return fr.create(this)}promise(){return Lr.create(this,this._def)}or(e){return wn.create([this,e],this._def)}and(e){return vn.create(this,e,this._def)}transform(e){return new ut({...U(this._def),schema:this,typeName:v.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let t=typeof e=="function"?e:()=>e;return new In({...U(this._def),innerType:this,defaultValue:t,typeName:v.ZodDefault})}brand(){return new qa({typeName:v.ZodBranded,type:this,...U(this._def)})}catch(e){let t=typeof e=="function"?e:()=>e;return new Pn({...U(this._def),innerType:this,catchValue:t,typeName:v.ZodCatch})}describe(e){let t=this.constructor;return new t({...this._def,description:e})}pipe(e){return Va.create(this,e)}readonly(){return Tn.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},nw=/^c[^\s-]{8,}$/i,sw=/^[0-9a-z]+$/,aw=/^[0-9A-HJKMNP-TV-Z]{26}$/i,iw=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,ow=/^[a-z0-9_-]{21}$/i,uw=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,lw=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,cw=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,dw="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",fw=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,pw=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,hw=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,mw=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,gw=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,yw=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Fp="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",bw=new RegExp(`^${Fp}$`);jr=class n extends B{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==O.string){let a=this._getOrReturnCtx(e);return E(a,{code:_.invalid_type,expected:O.string,received:a.parsedType}),j}let r=new Ae,s;for(let a of this._def.checks)if(a.kind==="min")e.data.length<a.value&&(s=this._getOrReturnCtx(e,s),E(s,{code:_.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),r.dirty());else if(a.kind==="max")e.data.length>a.value&&(s=this._getOrReturnCtx(e,s),E(s,{code:_.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),r.dirty());else if(a.kind==="length"){let i=e.data.length>a.value,o=e.data.length<a.value;(i||o)&&(s=this._getOrReturnCtx(e,s),i?E(s,{code:_.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):o&&E(s,{code:_.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),r.dirty())}else if(a.kind==="email")cw.test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"email",code:_.invalid_string,message:a.message}),r.dirty());else if(a.kind==="emoji")Fl||(Fl=new RegExp(dw,"u")),Fl.test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"emoji",code:_.invalid_string,message:a.message}),r.dirty());else if(a.kind==="uuid")iw.test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"uuid",code:_.invalid_string,message:a.message}),r.dirty());else if(a.kind==="nanoid")ow.test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"nanoid",code:_.invalid_string,message:a.message}),r.dirty());else if(a.kind==="cuid")nw.test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"cuid",code:_.invalid_string,message:a.message}),r.dirty());else if(a.kind==="cuid2")sw.test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"cuid2",code:_.invalid_string,message:a.message}),r.dirty());else if(a.kind==="ulid")aw.test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"ulid",code:_.invalid_string,message:a.message}),r.dirty());else if(a.kind==="url")try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),E(s,{validation:"url",code:_.invalid_string,message:a.message}),r.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"regex",code:_.invalid_string,message:a.message}),r.dirty())):a.kind==="trim"?e.data=e.data.trim():a.kind==="includes"?e.data.includes(a.value,a.position)||(s=this._getOrReturnCtx(e,s),E(s,{code:_.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),r.dirty()):a.kind==="toLowerCase"?e.data=e.data.toLowerCase():a.kind==="toUpperCase"?e.data=e.data.toUpperCase():a.kind==="startsWith"?e.data.startsWith(a.value)||(s=this._getOrReturnCtx(e,s),E(s,{code:_.invalid_string,validation:{startsWith:a.value},message:a.message}),r.dirty()):a.kind==="endsWith"?e.data.endsWith(a.value)||(s=this._getOrReturnCtx(e,s),E(s,{code:_.invalid_string,validation:{endsWith:a.value},message:a.message}),r.dirty()):a.kind==="datetime"?Bp(a).test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{code:_.invalid_string,validation:"datetime",message:a.message}),r.dirty()):a.kind==="date"?bw.test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{code:_.invalid_string,validation:"date",message:a.message}),r.dirty()):a.kind==="time"?_w(a).test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{code:_.invalid_string,validation:"time",message:a.message}),r.dirty()):a.kind==="duration"?lw.test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"duration",code:_.invalid_string,message:a.message}),r.dirty()):a.kind==="ip"?ww(e.data,a.version)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"ip",code:_.invalid_string,message:a.message}),r.dirty()):a.kind==="jwt"?vw(e.data,a.alg)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"jwt",code:_.invalid_string,message:a.message}),r.dirty()):a.kind==="cidr"?xw(e.data,a.version)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"cidr",code:_.invalid_string,message:a.message}),r.dirty()):a.kind==="base64"?gw.test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"base64",code:_.invalid_string,message:a.message}),r.dirty()):a.kind==="base64url"?yw.test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"base64url",code:_.invalid_string,message:a.message}),r.dirty()):H.assertNever(a);return{status:r.value,value:e.data}}_regex(e,t,r){return this.refinement(s=>e.test(s),{validation:t,code:_.invalid_string,...S.errToObj(r)})}_addCheck(e){return new n({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...S.errToObj(e)})}url(e){return this._addCheck({kind:"url",...S.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...S.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...S.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...S.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...S.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...S.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...S.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...S.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...S.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...S.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...S.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...S.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...S.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...S.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...S.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...S.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...S.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...S.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...S.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...S.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...S.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...S.errToObj(t)})}nonempty(e){return this.min(1,S.errToObj(e))}trim(){return new n({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new n({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new n({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};jr.create=n=>new jr({checks:[],typeName:v.ZodString,coerce:n?.coerce??!1,...U(n)});hn=class n extends B{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==O.number){let a=this._getOrReturnCtx(e);return E(a,{code:_.invalid_type,expected:O.number,received:a.parsedType}),j}let r,s=new Ae;for(let a of this._def.checks)a.kind==="int"?H.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),E(r,{code:_.invalid_type,expected:"integer",received:"float",message:a.message}),s.dirty()):a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(r=this._getOrReturnCtx(e,r),E(r,{code:_.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),s.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(r=this._getOrReturnCtx(e,r),E(r,{code:_.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),s.dirty()):a.kind==="multipleOf"?Aw(e.data,a.value)!==0&&(r=this._getOrReturnCtx(e,r),E(r,{code:_.not_multiple_of,multipleOf:a.value,message:a.message}),s.dirty()):a.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),E(r,{code:_.not_finite,message:a.message}),s.dirty()):H.assertNever(a);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,S.toString(t))}gt(e,t){return this.setLimit("min",e,!1,S.toString(t))}lte(e,t){return this.setLimit("max",e,!0,S.toString(t))}lt(e,t){return this.setLimit("max",e,!1,S.toString(t))}setLimit(e,t,r,s){return new n({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:S.toString(s)}]})}_addCheck(e){return new n({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:S.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:S.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:S.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:S.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:S.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:S.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:S.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:S.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:S.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&H.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(t===null||r.value>t)&&(t=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}};hn.create=n=>new hn({checks:[],typeName:v.ZodNumber,coerce:n?.coerce||!1,...U(n)});mn=class n extends B{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==O.bigint)return this._getInvalidInput(e);let r,s=new Ae;for(let a of this._def.checks)a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(r=this._getOrReturnCtx(e,r),E(r,{code:_.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),s.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(r=this._getOrReturnCtx(e,r),E(r,{code:_.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),s.dirty()):a.kind==="multipleOf"?e.data%a.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),E(r,{code:_.not_multiple_of,multipleOf:a.value,message:a.message}),s.dirty()):H.assertNever(a);return{status:s.value,value:e.data}}_getInvalidInput(e){let t=this._getOrReturnCtx(e);return E(t,{code:_.invalid_type,expected:O.bigint,received:t.parsedType}),j}gte(e,t){return this.setLimit("min",e,!0,S.toString(t))}gt(e,t){return this.setLimit("min",e,!1,S.toString(t))}lte(e,t){return this.setLimit("max",e,!0,S.toString(t))}lt(e,t){return this.setLimit("max",e,!1,S.toString(t))}setLimit(e,t,r,s){return new n({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:S.toString(s)}]})}_addCheck(e){return new n({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:S.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:S.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:S.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:S.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:S.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};mn.create=n=>new mn({checks:[],typeName:v.ZodBigInt,coerce:n?.coerce??!1,...U(n)});gn=class extends B{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==O.boolean){let r=this._getOrReturnCtx(e);return E(r,{code:_.invalid_type,expected:O.boolean,received:r.parsedType}),j}return Ce(e.data)}};gn.create=n=>new gn({typeName:v.ZodBoolean,coerce:n?.coerce||!1,...U(n)});yn=class n extends B{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==O.date){let a=this._getOrReturnCtx(e);return E(a,{code:_.invalid_type,expected:O.date,received:a.parsedType}),j}if(Number.isNaN(e.data.getTime())){let a=this._getOrReturnCtx(e);return E(a,{code:_.invalid_date}),j}let r=new Ae,s;for(let a of this._def.checks)a.kind==="min"?e.data.getTime()<a.value&&(s=this._getOrReturnCtx(e,s),E(s,{code:_.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),r.dirty()):a.kind==="max"?e.data.getTime()>a.value&&(s=this._getOrReturnCtx(e,s),E(s,{code:_.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),r.dirty()):H.assertNever(a);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new n({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:S.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:S.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}};yn.create=n=>new yn({checks:[],coerce:n?.coerce||!1,typeName:v.ZodDate,...U(n)});As=class extends B{_parse(e){if(this._getType(e)!==O.symbol){let r=this._getOrReturnCtx(e);return E(r,{code:_.invalid_type,expected:O.symbol,received:r.parsedType}),j}return Ce(e.data)}};As.create=n=>new As({typeName:v.ZodSymbol,...U(n)});bn=class extends B{_parse(e){if(this._getType(e)!==O.undefined){let r=this._getOrReturnCtx(e);return E(r,{code:_.invalid_type,expected:O.undefined,received:r.parsedType}),j}return Ce(e.data)}};bn.create=n=>new bn({typeName:v.ZodUndefined,...U(n)});_n=class extends B{_parse(e){if(this._getType(e)!==O.null){let r=this._getOrReturnCtx(e);return E(r,{code:_.invalid_type,expected:O.null,received:r.parsedType}),j}return Ce(e.data)}};_n.create=n=>new _n({typeName:v.ZodNull,...U(n)});Mr=class extends B{constructor(){super(...arguments),this._any=!0}_parse(e){return Ce(e.data)}};Mr.create=n=>new Mr({typeName:v.ZodAny,...U(n)});dr=class extends B{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Ce(e.data)}};dr.create=n=>new dr({typeName:v.ZodUnknown,...U(n)});vt=class extends B{_parse(e){let t=this._getOrReturnCtx(e);return E(t,{code:_.invalid_type,expected:O.never,received:t.parsedType}),j}};vt.create=n=>new vt({typeName:v.ZodNever,...U(n)});Es=class extends B{_parse(e){if(this._getType(e)!==O.undefined){let r=this._getOrReturnCtx(e);return E(r,{code:_.invalid_type,expected:O.void,received:r.parsedType}),j}return Ce(e.data)}};Es.create=n=>new Es({typeName:v.ZodVoid,...U(n)});fr=class n extends B{_parse(e){let{ctx:t,status:r}=this._processInputParams(e),s=this._def;if(t.parsedType!==O.array)return E(t,{code:_.invalid_type,expected:O.array,received:t.parsedType}),j;if(s.exactLength!==null){let i=t.data.length>s.exactLength.value,o=t.data.length<s.exactLength.value;(i||o)&&(E(t,{code:i?_.too_big:_.too_small,minimum:o?s.exactLength.value:void 0,maximum:i?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),r.dirty())}if(s.minLength!==null&&t.data.length<s.minLength.value&&(E(t,{code:_.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),r.dirty()),s.maxLength!==null&&t.data.length>s.maxLength.value&&(E(t,{code:_.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((i,o)=>s.type._parseAsync(new ot(t,i,t.path,o)))).then(i=>Ae.mergeArray(r,i));let a=[...t.data].map((i,o)=>s.type._parseSync(new ot(t,i,t.path,o)));return Ae.mergeArray(r,a)}get element(){return this._def.type}min(e,t){return new n({...this._def,minLength:{value:e,message:S.toString(t)}})}max(e,t){return new n({...this._def,maxLength:{value:e,message:S.toString(t)}})}length(e,t){return new n({...this._def,exactLength:{value:e,message:S.toString(t)}})}nonempty(e){return this.min(1,e)}};fr.create=(n,e)=>new fr({type:n,minLength:null,maxLength:null,exactLength:null,typeName:v.ZodArray,...U(e)});Ge=class n extends B{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),t=H.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==O.object){let l=this._getOrReturnCtx(e);return E(l,{code:_.invalid_type,expected:O.object,received:l.parsedType}),j}let{status:r,ctx:s}=this._processInputParams(e),{shape:a,keys:i}=this._getCached(),o=[];if(!(this._def.catchall instanceof vt&&this._def.unknownKeys==="strip"))for(let l in s.data)i.includes(l)||o.push(l);let u=[];for(let l of i){let c=a[l],d=s.data[l];u.push({key:{status:"valid",value:l},value:c._parse(new ot(s,d,s.path,l)),alwaysSet:l in s.data})}if(this._def.catchall instanceof vt){let l=this._def.unknownKeys;if(l==="passthrough")for(let c of o)u.push({key:{status:"valid",value:c},value:{status:"valid",value:s.data[c]}});else if(l==="strict")o.length>0&&(E(s,{code:_.unrecognized_keys,keys:o}),r.dirty());else if(l!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let l=this._def.catchall;for(let c of o){let d=s.data[c];u.push({key:{status:"valid",value:c},value:l._parse(new ot(s,d,s.path,c)),alwaysSet:c in s.data})}}return s.common.async?Promise.resolve().then(async()=>{let l=[];for(let c of u){let d=await c.key,f=await c.value;l.push({key:d,value:f,alwaysSet:c.alwaysSet})}return l}).then(l=>Ae.mergeObjectSync(r,l)):Ae.mergeObjectSync(r,u)}get shape(){return this._def.shape()}strict(e){return S.errToObj,new n({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,r)=>{let s=this._def.errorMap?.(t,r).message??r.defaultError;return t.code==="unrecognized_keys"?{message:S.errToObj(e).message??s}:{message:s}}}:{}})}strip(){return new n({...this._def,unknownKeys:"strip"})}passthrough(){return new n({...this._def,unknownKeys:"passthrough"})}extend(e){return new n({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new n({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:v.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new n({...this._def,catchall:e})}pick(e){let t={};for(let r of H.objectKeys(e))e[r]&&this.shape[r]&&(t[r]=this.shape[r]);return new n({...this._def,shape:()=>t})}omit(e){let t={};for(let r of H.objectKeys(this.shape))e[r]||(t[r]=this.shape[r]);return new n({...this._def,shape:()=>t})}deepPartial(){return xs(this)}partial(e){let t={};for(let r of H.objectKeys(this.shape)){let s=this.shape[r];e&&!e[r]?t[r]=s:t[r]=s.optional()}return new n({...this._def,shape:()=>t})}required(e){let t={};for(let r of H.objectKeys(this.shape))if(e&&!e[r])t[r]=this.shape[r];else{let a=this.shape[r];for(;a instanceof it;)a=a._def.innerType;t[r]=a}return new n({...this._def,shape:()=>t})}keyof(){return zp(H.objectKeys(this.shape))}};Ge.create=(n,e)=>new Ge({shape:()=>n,unknownKeys:"strip",catchall:vt.create(),typeName:v.ZodObject,...U(e)});Ge.strictCreate=(n,e)=>new Ge({shape:()=>n,unknownKeys:"strict",catchall:vt.create(),typeName:v.ZodObject,...U(e)});Ge.lazycreate=(n,e)=>new Ge({shape:n,unknownKeys:"strip",catchall:vt.create(),typeName:v.ZodObject,...U(e)});wn=class extends B{_parse(e){let{ctx:t}=this._processInputParams(e),r=this._def.options;function s(a){for(let o of a)if(o.result.status==="valid")return o.result;for(let o of a)if(o.result.status==="dirty")return t.common.issues.push(...o.ctx.common.issues),o.result;let i=a.map(o=>new He(o.ctx.common.issues));return E(t,{code:_.invalid_union,unionErrors:i}),j}if(t.common.async)return Promise.all(r.map(async a=>{let i={...t,common:{...t.common,issues:[]},parent:null};return{result:await a._parseAsync({data:t.data,path:t.path,parent:i}),ctx:i}})).then(s);{let a,i=[];for(let u of r){let l={...t,common:{...t.common,issues:[]},parent:null},c=u._parseSync({data:t.data,path:t.path,parent:l});if(c.status==="valid")return c;c.status==="dirty"&&!a&&(a={result:c,ctx:l}),l.common.issues.length&&i.push(l.common.issues)}if(a)return t.common.issues.push(...a.ctx.common.issues),a.result;let o=i.map(u=>new He(u));return E(t,{code:_.invalid_union,unionErrors:o}),j}}get options(){return this._def.options}};wn.create=(n,e)=>new wn({options:n,typeName:v.ZodUnion,...U(e)});cr=n=>n instanceof xn?cr(n.schema):n instanceof ut?cr(n.innerType()):n instanceof An?[n.value]:n instanceof En?n.options:n instanceof On?H.objectValues(n.enum):n instanceof In?cr(n._def.innerType):n instanceof bn?[void 0]:n instanceof _n?[null]:n instanceof it?[void 0,...cr(n.unwrap())]:n instanceof Bt?[null,...cr(n.unwrap())]:n instanceof qa||n instanceof Tn?cr(n.unwrap()):n instanceof Pn?cr(n._def.innerType):[],go=class n extends B{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==O.object)return E(t,{code:_.invalid_type,expected:O.object,received:t.parsedType}),j;let r=this.discriminator,s=t.data[r],a=this.optionsMap.get(s);return a?t.common.async?a._parseAsync({data:t.data,path:t.path,parent:t}):a._parseSync({data:t.data,path:t.path,parent:t}):(E(t,{code:_.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),j)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){let s=new Map;for(let a of t){let i=cr(a.shape[e]);if(!i.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let o of i){if(s.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);s.set(o,a)}}return new n({typeName:v.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:s,...U(r)})}};vn=class extends B{_parse(e){let{status:t,ctx:r}=this._processInputParams(e),s=(a,i)=>{if(ho(a)||ho(i))return j;let o=Ul(a.value,i.value);return o.valid?((mo(a)||mo(i))&&t.dirty(),{status:t.value,value:o.data}):(E(r,{code:_.invalid_intersection_types}),j)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([a,i])=>s(a,i)):s(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}};vn.create=(n,e,t)=>new vn({left:n,right:e,typeName:v.ZodIntersection,...U(t)});Ut=class n extends B{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==O.array)return E(r,{code:_.invalid_type,expected:O.array,received:r.parsedType}),j;if(r.data.length<this._def.items.length)return E(r,{code:_.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),j;!this._def.rest&&r.data.length>this._def.items.length&&(E(r,{code:_.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let a=[...r.data].map((i,o)=>{let u=this._def.items[o]||this._def.rest;return u?u._parse(new ot(r,i,r.path,o)):null}).filter(i=>!!i);return r.common.async?Promise.all(a).then(i=>Ae.mergeArray(t,i)):Ae.mergeArray(t,a)}get items(){return this._def.items}rest(e){return new n({...this._def,rest:e})}};Ut.create=(n,e)=>{if(!Array.isArray(n))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Ut({items:n,typeName:v.ZodTuple,rest:null,...U(e)})};yo=class n extends B{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==O.object)return E(r,{code:_.invalid_type,expected:O.object,received:r.parsedType}),j;let s=[],a=this._def.keyType,i=this._def.valueType;for(let o in r.data)s.push({key:a._parse(new ot(r,o,r.path,o)),value:i._parse(new ot(r,r.data[o],r.path,o)),alwaysSet:o in r.data});return r.common.async?Ae.mergeObjectAsync(t,s):Ae.mergeObjectSync(t,s)}get element(){return this._def.valueType}static create(e,t,r){return t instanceof B?new n({keyType:e,valueType:t,typeName:v.ZodRecord,...U(r)}):new n({keyType:jr.create(),valueType:e,typeName:v.ZodRecord,...U(t)})}},Os=class extends B{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==O.map)return E(r,{code:_.invalid_type,expected:O.map,received:r.parsedType}),j;let s=this._def.keyType,a=this._def.valueType,i=[...r.data.entries()].map(([o,u],l)=>({key:s._parse(new ot(r,o,r.path,[l,"key"])),value:a._parse(new ot(r,u,r.path,[l,"value"]))}));if(r.common.async){let o=new Map;return Promise.resolve().then(async()=>{for(let u of i){let l=await u.key,c=await u.value;if(l.status==="aborted"||c.status==="aborted")return j;(l.status==="dirty"||c.status==="dirty")&&t.dirty(),o.set(l.value,c.value)}return{status:t.value,value:o}})}else{let o=new Map;for(let u of i){let l=u.key,c=u.value;if(l.status==="aborted"||c.status==="aborted")return j;(l.status==="dirty"||c.status==="dirty")&&t.dirty(),o.set(l.value,c.value)}return{status:t.value,value:o}}}};Os.create=(n,e,t)=>new Os({valueType:e,keyType:n,typeName:v.ZodMap,...U(t)});Is=class n extends B{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==O.set)return E(r,{code:_.invalid_type,expected:O.set,received:r.parsedType}),j;let s=this._def;s.minSize!==null&&r.data.size<s.minSize.value&&(E(r,{code:_.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),t.dirty()),s.maxSize!==null&&r.data.size>s.maxSize.value&&(E(r,{code:_.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),t.dirty());let a=this._def.valueType;function i(u){let l=new Set;for(let c of u){if(c.status==="aborted")return j;c.status==="dirty"&&t.dirty(),l.add(c.value)}return{status:t.value,value:l}}let o=[...r.data.values()].map((u,l)=>a._parse(new ot(r,u,r.path,l)));return r.common.async?Promise.all(o).then(u=>i(u)):i(o)}min(e,t){return new n({...this._def,minSize:{value:e,message:S.toString(t)}})}max(e,t){return new n({...this._def,maxSize:{value:e,message:S.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}};Is.create=(n,e)=>new Is({valueType:n,minSize:null,maxSize:null,typeName:v.ZodSet,...U(e)});bo=class n extends B{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==O.function)return E(t,{code:_.invalid_type,expected:O.function,received:t.parsedType}),j;function r(o,u){return za({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,ws(),lr].filter(l=>!!l),issueData:{code:_.invalid_arguments,argumentsError:u}})}function s(o,u){return za({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,ws(),lr].filter(l=>!!l),issueData:{code:_.invalid_return_type,returnTypeError:u}})}let a={errorMap:t.common.contextualErrorMap},i=t.data;if(this._def.returns instanceof Lr){let o=this;return Ce(async function(...u){let l=new He([]),c=await o._def.args.parseAsync(u,a).catch(p=>{throw l.addIssue(r(u,p)),l}),d=await Reflect.apply(i,this,c);return await o._def.returns._def.type.parseAsync(d,a).catch(p=>{throw l.addIssue(s(d,p)),l})})}else{let o=this;return Ce(function(...u){let l=o._def.args.safeParse(u,a);if(!l.success)throw new He([r(u,l.error)]);let c=Reflect.apply(i,this,l.data),d=o._def.returns.safeParse(c,a);if(!d.success)throw new He([s(c,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new n({...this._def,args:Ut.create(e).rest(dr.create())})}returns(e){return new n({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new n({args:e||Ut.create([]).rest(dr.create()),returns:t||dr.create(),typeName:v.ZodFunction,...U(r)})}},xn=class extends B{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}};xn.create=(n,e)=>new xn({getter:n,typeName:v.ZodLazy,...U(e)});An=class extends B{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return E(t,{received:t.data,code:_.invalid_literal,expected:this._def.value}),j}return{status:"valid",value:e.data}}get value(){return this._def.value}};An.create=(n,e)=>new An({value:n,typeName:v.ZodLiteral,...U(e)});En=class n extends B{_parse(e){if(typeof e.data!="string"){let t=this._getOrReturnCtx(e),r=this._def.values;return E(t,{expected:H.joinValues(r),received:t.parsedType,code:_.invalid_type}),j}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let t=this._getOrReturnCtx(e),r=this._def.values;return E(t,{received:t.data,code:_.invalid_enum_value,options:r}),j}return Ce(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return n.create(e,{...this._def,...t})}exclude(e,t=this._def){return n.create(this.options.filter(r=>!e.includes(r)),{...this._def,...t})}};En.create=zp;On=class extends B{_parse(e){let t=H.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==O.string&&r.parsedType!==O.number){let s=H.objectValues(t);return E(r,{expected:H.joinValues(s),received:r.parsedType,code:_.invalid_type}),j}if(this._cache||(this._cache=new Set(H.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let s=H.objectValues(t);return E(r,{received:r.data,code:_.invalid_enum_value,options:s}),j}return Ce(e.data)}get enum(){return this._def.values}};On.create=(n,e)=>new On({values:n,typeName:v.ZodNativeEnum,...U(e)});Lr=class extends B{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==O.promise&&t.common.async===!1)return E(t,{code:_.invalid_type,expected:O.promise,received:t.parsedType}),j;let r=t.parsedType===O.promise?t.data:Promise.resolve(t.data);return Ce(r.then(s=>this._def.type.parseAsync(s,{path:t.path,errorMap:t.common.contextualErrorMap})))}};Lr.create=(n,e)=>new Lr({type:n,typeName:v.ZodPromise,...U(e)});ut=class extends B{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===v.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:r}=this._processInputParams(e),s=this._def.effect||null,a={addIssue:i=>{E(r,i),i.fatal?t.abort():t.dirty()},get path(){return r.path}};if(a.addIssue=a.addIssue.bind(a),s.type==="preprocess"){let i=s.transform(r.data,a);if(r.common.async)return Promise.resolve(i).then(async o=>{if(t.value==="aborted")return j;let u=await this._def.schema._parseAsync({data:o,path:r.path,parent:r});return u.status==="aborted"?j:u.status==="dirty"?pn(u.value):t.value==="dirty"?pn(u.value):u});{if(t.value==="aborted")return j;let o=this._def.schema._parseSync({data:i,path:r.path,parent:r});return o.status==="aborted"?j:o.status==="dirty"?pn(o.value):t.value==="dirty"?pn(o.value):o}}if(s.type==="refinement"){let i=o=>{let u=s.refinement(o,a);if(r.common.async)return Promise.resolve(u);if(u instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(r.common.async===!1){let o=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return o.status==="aborted"?j:(o.status==="dirty"&&t.dirty(),i(o.value),{status:t.value,value:o.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(o=>o.status==="aborted"?j:(o.status==="dirty"&&t.dirty(),i(o.value).then(()=>({status:t.value,value:o.value}))))}if(s.type==="transform")if(r.common.async===!1){let i=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!$r(i))return j;let o=s.transform(i.value,a);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(i=>$r(i)?Promise.resolve(s.transform(i.value,a)).then(o=>({status:t.value,value:o})):j);H.assertNever(s)}};ut.create=(n,e,t)=>new ut({schema:n,typeName:v.ZodEffects,effect:e,...U(t)});ut.createWithPreprocess=(n,e,t)=>new ut({schema:e,effect:{type:"preprocess",transform:n},typeName:v.ZodEffects,...U(t)});it=class extends B{_parse(e){return this._getType(e)===O.undefined?Ce(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};it.create=(n,e)=>new it({innerType:n,typeName:v.ZodOptional,...U(e)});Bt=class extends B{_parse(e){return this._getType(e)===O.null?Ce(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Bt.create=(n,e)=>new Bt({innerType:n,typeName:v.ZodNullable,...U(e)});In=class extends B{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return t.parsedType===O.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}};In.create=(n,e)=>new In({innerType:n,typeName:v.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...U(e)});Pn=class extends B{_parse(e){let{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},s=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return vs(s)?s.then(a=>({status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new He(r.common.issues)},input:r.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new He(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}};Pn.create=(n,e)=>new Pn({innerType:n,typeName:v.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...U(e)});Ps=class extends B{_parse(e){if(this._getType(e)!==O.nan){let r=this._getOrReturnCtx(e);return E(r,{code:_.invalid_type,expected:O.nan,received:r.parsedType}),j}return{status:"valid",value:e.data}}};Ps.create=n=>new Ps({typeName:v.ZodNaN,...U(n)});Ew=Symbol("zod_brand"),qa=class extends B{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}},Va=class n extends B{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{let a=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return a.status==="aborted"?j:a.status==="dirty"?(t.dirty(),pn(a.value)):this._def.out._parseAsync({data:a.value,path:r.path,parent:r})})();{let s=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?j:s.status==="dirty"?(t.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:r.path,parent:r})}}static create(e,t){return new n({in:e,out:t,typeName:v.ZodPipeline})}},Tn=class extends B{_parse(e){let t=this._def.innerType._parse(e),r=s=>($r(s)&&(s.value=Object.freeze(s.value)),s);return vs(t)?t.then(s=>r(s)):r(t)}unwrap(){return this._def.innerType}};Tn.create=(n,e)=>new Tn({innerType:n,typeName:v.ZodReadonly,...U(e)});Ow={object:Ge.lazycreate};(function(n){n.ZodString="ZodString",n.ZodNumber="ZodNumber",n.ZodNaN="ZodNaN",n.ZodBigInt="ZodBigInt",n.ZodBoolean="ZodBoolean",n.ZodDate="ZodDate",n.ZodSymbol="ZodSymbol",n.ZodUndefined="ZodUndefined",n.ZodNull="ZodNull",n.ZodAny="ZodAny",n.ZodUnknown="ZodUnknown",n.ZodNever="ZodNever",n.ZodVoid="ZodVoid",n.ZodArray="ZodArray",n.ZodObject="ZodObject",n.ZodUnion="ZodUnion",n.ZodDiscriminatedUnion="ZodDiscriminatedUnion",n.ZodIntersection="ZodIntersection",n.ZodTuple="ZodTuple",n.ZodRecord="ZodRecord",n.ZodMap="ZodMap",n.ZodSet="ZodSet",n.ZodFunction="ZodFunction",n.ZodLazy="ZodLazy",n.ZodLiteral="ZodLiteral",n.ZodEnum="ZodEnum",n.ZodEffects="ZodEffects",n.ZodNativeEnum="ZodNativeEnum",n.ZodOptional="ZodOptional",n.ZodNullable="ZodNullable",n.ZodDefault="ZodDefault",n.ZodCatch="ZodCatch",n.ZodPromise="ZodPromise",n.ZodBranded="ZodBranded",n.ZodPipeline="ZodPipeline",n.ZodReadonly="ZodReadonly"})(v||(v={}));Iw=(n,e={message:`Input not instance of ${n.name}`})=>qp(t=>t instanceof n,e),Vp=jr.create,Hp=hn.create,Pw=Ps.create,Tw=mn.create,Gp=gn.create,Sw=yn.create,Cw=As.create,Rw=bn.create,kw=_n.create,Nw=Mr.create,$w=dr.create,jw=vt.create,Mw=Es.create,Lw=fr.create,Dw=Ge.create,Fw=Ge.strictCreate,Uw=wn.create,Bw=go.create,zw=vn.create,qw=Ut.create,Vw=yo.create,Hw=Os.create,Gw=Is.create,Kw=bo.create,Jw=xn.create,Ww=An.create,Zw=En.create,Yw=On.create,Xw=Lr.create,Qw=ut.create,ev=it.create,tv=Bt.create,rv=ut.createWithPreprocess,nv=Va.create,sv=()=>Vp().optional(),av=()=>Hp().optional(),iv=()=>Gp().optional(),ov={string:n=>jr.create({...n,coerce:!0}),number:n=>hn.create({...n,coerce:!0}),boolean:n=>gn.create({...n,coerce:!0}),bigint:n=>mn.create({...n,coerce:!0}),date:n=>yn.create({...n,coerce:!0})},uv=j});var xt={};io(xt,{BRAND:()=>Ew,DIRTY:()=>pn,EMPTY_PATH:()=>rw,INVALID:()=>j,NEVER:()=>uv,OK:()=>Ce,ParseStatus:()=>Ae,Schema:()=>B,ZodAny:()=>Mr,ZodArray:()=>fr,ZodBigInt:()=>mn,ZodBoolean:()=>gn,ZodBranded:()=>qa,ZodCatch:()=>Pn,ZodDate:()=>yn,ZodDefault:()=>In,ZodDiscriminatedUnion:()=>go,ZodEffects:()=>ut,ZodEnum:()=>En,ZodError:()=>He,ZodFirstPartyTypeKind:()=>v,ZodFunction:()=>bo,ZodIntersection:()=>vn,ZodIssueCode:()=>_,ZodLazy:()=>xn,ZodLiteral:()=>An,ZodMap:()=>Os,ZodNaN:()=>Ps,ZodNativeEnum:()=>On,ZodNever:()=>vt,ZodNull:()=>_n,ZodNullable:()=>Bt,ZodNumber:()=>hn,ZodObject:()=>Ge,ZodOptional:()=>it,ZodParsedType:()=>O,ZodPipeline:()=>Va,ZodPromise:()=>Lr,ZodReadonly:()=>Tn,ZodRecord:()=>yo,ZodSchema:()=>B,ZodSet:()=>Is,ZodString:()=>jr,ZodSymbol:()=>As,ZodTransformer:()=>ut,ZodTuple:()=>Ut,ZodType:()=>B,ZodUndefined:()=>bn,ZodUnion:()=>wn,ZodUnknown:()=>dr,ZodVoid:()=>Es,addIssueToContext:()=>E,any:()=>Nw,array:()=>Lw,bigint:()=>Tw,boolean:()=>Gp,coerce:()=>ov,custom:()=>qp,date:()=>Sw,datetimeRegex:()=>Bp,defaultErrorMap:()=>lr,discriminatedUnion:()=>Bw,effect:()=>Qw,enum:()=>Zw,function:()=>Kw,getErrorMap:()=>ws,getParsedType:()=>Ft,instanceof:()=>Iw,intersection:()=>zw,isAborted:()=>ho,isAsync:()=>vs,isDirty:()=>mo,isValid:()=>$r,late:()=>Ow,lazy:()=>Jw,literal:()=>Ww,makeIssue:()=>za,map:()=>Hw,nan:()=>Pw,nativeEnum:()=>Yw,never:()=>jw,null:()=>kw,nullable:()=>tv,number:()=>Hp,object:()=>Dw,objectUtil:()=>Ml,oboolean:()=>iv,onumber:()=>av,optional:()=>ev,ostring:()=>sv,pipeline:()=>nv,preprocess:()=>rv,promise:()=>Xw,quotelessJson:()=>Q_,record:()=>Vw,set:()=>Gw,setErrorMap:()=>tw,strictObject:()=>Fw,string:()=>Vp,symbol:()=>Cw,transformer:()=>Qw,tuple:()=>qw,undefined:()=>Rw,union:()=>Uw,unknown:()=>$w,util:()=>H,void:()=>Mw});var Bl=h(()=>{po();Dl();jp();Ba();Kp();fo()});var Ts=h(()=>{Bl();Bl()});function te(n){if(n.target!=="openAi")return{};let e=[...n.basePath,n.definitionPath,n.openAiAnyTypeName];return n.flags.hasReferencedOpenAiAnyType=!0,{$ref:n.$refStrategy==="relative"?lo(e,n.currentPath):e.join("/")}}var lt=h(()=>{co()});function Jp(n,e){let t={type:"array"};return n.type?._def&&n.type?._def?.typeName!==v.ZodAny&&(t.items=M(n.type._def,{...e,currentPath:[...e.currentPath,"items"]})),n.minLength&&J(t,"minItems",n.minLength.value,n.minLength.message,e),n.maxLength&&J(t,"maxItems",n.maxLength.value,n.maxLength.message,e),n.exactLength&&(J(t,"minItems",n.exactLength.value,n.exactLength.message,e),J(t,"maxItems",n.exactLength.value,n.exactLength.message,e)),t}var zl=h(()=>{Ts();Nr();ue()});function Wp(n,e){let t={type:"integer",format:"int64"};if(!n.checks)return t;for(let r of n.checks)switch(r.kind){case"min":e.target==="jsonSchema7"?r.inclusive?J(t,"minimum",r.value,r.message,e):J(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),J(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?J(t,"maximum",r.value,r.message,e):J(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),J(t,"maximum",r.value,r.message,e));break;case"multipleOf":J(t,"multipleOf",r.value,r.message,e);break}return t}var ql=h(()=>{Nr()});function Zp(){return{type:"boolean"}}var Vl=h(()=>{});function _o(n,e){return M(n.type._def,e)}var wo=h(()=>{ue()});var Yp,Hl=h(()=>{ue();Yp=(n,e)=>M(n.innerType._def,e)});function Gl(n,e,t){let r=t??e.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((s,a)=>Gl(n,e,s))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return lv(n,e)}}var lv,Kl=h(()=>{Nr();lv=(n,e)=>{let t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(let r of n.checks)switch(r.kind){case"min":J(t,"minimum",r.value,r.message,e);break;case"max":J(t,"maximum",r.value,r.message,e);break}return t}});function Xp(n,e){return{...M(n.innerType._def,e),default:n.defaultValue()}}var Jl=h(()=>{ue()});function Qp(n,e){return e.effectStrategy==="input"?M(n.schema._def,e):te(e)}var Wl=h(()=>{ue();lt()});function eh(n){return{type:"string",enum:Array.from(n.values)}}var Zl=h(()=>{});function th(n,e){let t=[M(n.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),M(n.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(a=>!!a),r=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0,s=[];return t.forEach(a=>{if(cv(a))s.push(...a.allOf),a.unevaluatedProperties===void 0&&(r=void 0);else{let i=a;if("additionalProperties"in a&&a.additionalProperties===!1){let{additionalProperties:o,...u}=a;i=u}else r=void 0;s.push(i)}}),s.length?{allOf:s,...r}:void 0}var cv,Yl=h(()=>{ue();cv=n=>"type"in n&&n.type==="string"?!1:"allOf"in n});function rh(n,e){let t=typeof n.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(n.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[n.value]}:{type:t==="bigint"?"integer":t,const:n.value}}var Xl=h(()=>{});function vo(n,e){let t={type:"string"};if(n.checks)for(let r of n.checks)switch(r.kind){case"min":J(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,r.value):r.value,r.message,e);break;case"max":J(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,r.value):r.value,r.message,e);break;case"email":switch(e.emailStrategy){case"format:email":Et(t,"email",r.message,e);break;case"format:idn-email":Et(t,"idn-email",r.message,e);break;case"pattern:zod":De(t,At.email,r.message,e);break}break;case"url":Et(t,"uri",r.message,e);break;case"uuid":Et(t,"uuid",r.message,e);break;case"regex":De(t,r.regex,r.message,e);break;case"cuid":De(t,At.cuid,r.message,e);break;case"cuid2":De(t,At.cuid2,r.message,e);break;case"startsWith":De(t,RegExp(`^${ec(r.value,e)}`),r.message,e);break;case"endsWith":De(t,RegExp(`${ec(r.value,e)}$`),r.message,e);break;case"datetime":Et(t,"date-time",r.message,e);break;case"date":Et(t,"date",r.message,e);break;case"time":Et(t,"time",r.message,e);break;case"duration":Et(t,"duration",r.message,e);break;case"length":J(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,r.value):r.value,r.message,e),J(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,r.value):r.value,r.message,e);break;case"includes":{De(t,RegExp(ec(r.value,e)),r.message,e);break}case"ip":{r.version!=="v6"&&Et(t,"ipv4",r.message,e),r.version!=="v4"&&Et(t,"ipv6",r.message,e);break}case"base64url":De(t,At.base64url,r.message,e);break;case"jwt":De(t,At.jwt,r.message,e);break;case"cidr":{r.version!=="v6"&&De(t,At.ipv4Cidr,r.message,e),r.version!=="v4"&&De(t,At.ipv6Cidr,r.message,e);break}case"emoji":De(t,At.emoji(),r.message,e);break;case"ulid":{De(t,At.ulid,r.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{Et(t,"binary",r.message,e);break}case"contentEncoding:base64":{J(t,"contentEncoding","base64",r.message,e);break}case"pattern:zod":{De(t,At.base64,r.message,e);break}}break}case"nanoid":De(t,At.nanoid,r.message,e);case"toLowerCase":case"toUpperCase":case"trim":break;default:}return t}function ec(n,e){return e.patternStrategy==="escape"?fv(n):n}function fv(n){let e="";for(let t=0;t<n.length;t++)dv.has(n[t])||(e+="\\"),e+=n[t];return e}function Et(n,e,t,r){n.format||n.anyOf?.some(s=>s.format)?(n.anyOf||(n.anyOf=[]),n.format&&(n.anyOf.push({format:n.format,...n.errorMessage&&r.errorMessages&&{errorMessage:{format:n.errorMessage.format}}}),delete n.format,n.errorMessage&&(delete n.errorMessage.format,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.anyOf.push({format:e,...t&&r.errorMessages&&{errorMessage:{format:t}}})):J(n,"format",e,t,r)}function De(n,e,t,r){n.pattern||n.allOf?.some(s=>s.pattern)?(n.allOf||(n.allOf=[]),n.pattern&&(n.allOf.push({pattern:n.pattern,...n.errorMessage&&r.errorMessages&&{errorMessage:{pattern:n.errorMessage.pattern}}}),delete n.pattern,n.errorMessage&&(delete n.errorMessage.pattern,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.allOf.push({pattern:nh(e,r),...t&&r.errorMessages&&{errorMessage:{pattern:t}}})):J(n,"pattern",nh(e,r),t,r)}function nh(n,e){if(!e.applyRegexFlags||!n.flags)return n.source;let t={i:n.flags.includes("i"),m:n.flags.includes("m"),s:n.flags.includes("s")},r=t.i?n.source.toLowerCase():n.source,s="",a=!1,i=!1,o=!1;for(let u=0;u<r.length;u++){if(a){s+=r[u],a=!1;continue}if(t.i){if(i){if(r[u].match(/[a-z]/)){o?(s+=r[u],s+=`${r[u-2]}-${r[u]}`.toUpperCase(),o=!1):r[u+1]==="-"&&r[u+2]?.match(/[a-z]/)?(s+=r[u],o=!0):s+=`${r[u]}${r[u].toUpperCase()}`;continue}}else if(r[u].match(/[a-z]/)){s+=`[${r[u]}${r[u].toUpperCase()}]`;continue}}if(t.m){if(r[u]==="^"){s+=`(^|(?<=[\r
]))`;continue}else if(r[u]==="$"){s+=`($|(?=[\r
]))`;continue}}if(t.s&&r[u]==="."){s+=i?`${r[u]}\r
`:`[${r[u]}\r
]`;continue}s+=r[u],r[u]==="\\"?a=!0:i&&r[u]==="]"?i=!1:!i&&r[u]==="["&&(i=!0)}try{new RegExp(s)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),n.source}return s}var Ql,At,dv,xo=h(()=>{Nr();At={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(Ql===void 0&&(Ql=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Ql),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};dv=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789")});function Ao(n,e){if(e.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),e.target==="openApi3"&&n.keyType?._def.typeName===v.ZodEnum)return{type:"object",required:n.keyType._def.values,properties:n.keyType._def.values.reduce((r,s)=>({...r,[s]:M(n.valueType._def,{...e,currentPath:[...e.currentPath,"properties",s]})??te(e)}),{}),additionalProperties:e.rejectedAdditionalProperties};let t={type:"object",additionalProperties:M(n.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??e.allowedAdditionalProperties};if(e.target==="openApi3")return t;if(n.keyType?._def.typeName===v.ZodString&&n.keyType._def.checks?.length){let{type:r,...s}=vo(n.keyType._def,e);return{...t,propertyNames:s}}else{if(n.keyType?._def.typeName===v.ZodEnum)return{...t,propertyNames:{enum:n.keyType._def.values}};if(n.keyType?._def.typeName===v.ZodBranded&&n.keyType._def.type._def.typeName===v.ZodString&&n.keyType._def.type._def.checks?.length){let{type:r,...s}=_o(n.keyType._def,e);return{...t,propertyNames:s}}}return t}var Eo=h(()=>{Ts();ue();xo();wo();lt()});function sh(n,e){if(e.mapStrategy==="record")return Ao(n,e);let t=M(n.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||te(e),r=M(n.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||te(e);return{type:"array",maxItems:125,items:{type:"array",items:[t,r],minItems:2,maxItems:2}}}var tc=h(()=>{ue();Eo();lt()});function ah(n){let e=n.values,r=Object.keys(n.values).filter(a=>typeof e[e[a]]!="number").map(a=>e[a]),s=Array.from(new Set(r.map(a=>typeof a)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:r}}var rc=h(()=>{});function ih(n){return n.target==="openAi"?void 0:{not:te({...n,currentPath:[...n.currentPath,"not"]})}}var nc=h(()=>{lt()});function oh(n){return n.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}var sc=h(()=>{});function lh(n,e){if(e.target==="openApi3")return uh(n,e);let t=n.options instanceof Map?Array.from(n.options.values()):n.options;if(t.every(r=>r._def.typeName in Ha&&(!r._def.checks||!r._def.checks.length))){let r=t.reduce((s,a)=>{let i=Ha[a._def.typeName];return i&&!s.includes(i)?[...s,i]:s},[]);return{type:r.length>1?r:r[0]}}else if(t.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){let r=t.reduce((s,a)=>{let i=typeof a._def.value;switch(i){case"string":case"number":case"boolean":return[...s,i];case"bigint":return[...s,"integer"];case"object":if(a._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(r.length===t.length){let s=r.filter((a,i,o)=>o.indexOf(a)===i);return{type:s.length>1?s:s[0],enum:t.reduce((a,i)=>a.includes(i._def.value)?a:[...a,i._def.value],[])}}}else if(t.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((r,s)=>[...r,...s._def.values.filter(a=>!r.includes(a))],[])};return uh(n,e)}var Ha,uh,Oo=h(()=>{ue();Ha={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};uh=(n,e)=>{let t=(n.options instanceof Map?Array.from(n.options.values()):n.options).map((r,s)=>M(r._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(r=>!!r&&(!e.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return t.length?{anyOf:t}:void 0}});function ch(n,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(n.innerType._def.typeName)&&(!n.innerType._def.checks||!n.innerType._def.checks.length))return e.target==="openApi3"?{type:Ha[n.innerType._def.typeName],nullable:!0}:{type:[Ha[n.innerType._def.typeName],"null"]};if(e.target==="openApi3"){let r=M(n.innerType._def,{...e,currentPath:[...e.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}let t=M(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}var ac=h(()=>{ue();Oo()});function dh(n,e){let t={type:"number"};if(!n.checks)return t;for(let r of n.checks)switch(r.kind){case"int":t.type="integer",jl(t,"type",r.message,e);break;case"min":e.target==="jsonSchema7"?r.inclusive?J(t,"minimum",r.value,r.message,e):J(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),J(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?J(t,"maximum",r.value,r.message,e):J(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),J(t,"maximum",r.value,r.message,e));break;case"multipleOf":J(t,"multipleOf",r.value,r.message,e);break}return t}var ic=h(()=>{Nr()});function fh(n,e){let t=e.target==="openAi",r={type:"object",properties:{}},s=[],a=n.shape();for(let o in a){let u=a[o];if(u===void 0||u._def===void 0)continue;let l=hv(u);l&&t&&(u._def.typeName==="ZodOptional"&&(u=u._def.innerType),u.isNullable()||(u=u.nullable()),l=!1);let c=M(u._def,{...e,currentPath:[...e.currentPath,"properties",o],propertyPath:[...e.currentPath,"properties",o]});c!==void 0&&(r.properties[o]=c,l||s.push(o))}s.length&&(r.required=s);let i=pv(n,e);return i!==void 0&&(r.additionalProperties=i),r}function pv(n,e){if(n.catchall._def.typeName!=="ZodNever")return M(n.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(n.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function hv(n){try{return n.isOptional()}catch{return!0}}var oc=h(()=>{ue()});var ph,uc=h(()=>{ue();lt();ph=(n,e)=>{if(e.currentPath.toString()===e.propertyPath?.toString())return M(n.innerType._def,e);let t=M(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:te(e)},t]}:te(e)}});var hh,lc=h(()=>{ue();hh=(n,e)=>{if(e.pipeStrategy==="input")return M(n.in._def,e);if(e.pipeStrategy==="output")return M(n.out._def,e);let t=M(n.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),r=M(n.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,r].filter(s=>s!==void 0)}}});function mh(n,e){return M(n.type._def,e)}var cc=h(()=>{ue()});function gh(n,e){let r={type:"array",uniqueItems:!0,items:M(n.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return n.minSize&&J(r,"minItems",n.minSize.value,n.minSize.message,e),n.maxSize&&J(r,"maxItems",n.maxSize.value,n.maxSize.message,e),r}var dc=h(()=>{Nr();ue()});function yh(n,e){return n.rest?{type:"array",minItems:n.items.length,items:n.items.map((t,r)=>M(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[]),additionalItems:M(n.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:n.items.length,maxItems:n.items.length,items:n.items.map((t,r)=>M(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[])}}var fc=h(()=>{ue()});function bh(n){return{not:te(n)}}var pc=h(()=>{lt()});function _h(n){return te(n)}var hc=h(()=>{lt()});var wh,mc=h(()=>{ue();wh=(n,e)=>M(n.innerType._def,e)});var vh,gc=h(()=>{Ts();lt();zl();ql();Vl();wo();Hl();Kl();Jl();Wl();Zl();Yl();Xl();tc();rc();nc();sc();ac();ic();oc();uc();lc();cc();Eo();dc();xo();fc();pc();Oo();hc();mc();vh=(n,e,t)=>{switch(e){case v.ZodString:return vo(n,t);case v.ZodNumber:return dh(n,t);case v.ZodObject:return fh(n,t);case v.ZodBigInt:return Wp(n,t);case v.ZodBoolean:return Zp();case v.ZodDate:return Gl(n,t);case v.ZodUndefined:return bh(t);case v.ZodNull:return oh(t);case v.ZodArray:return Jp(n,t);case v.ZodUnion:case v.ZodDiscriminatedUnion:return lh(n,t);case v.ZodIntersection:return th(n,t);case v.ZodTuple:return yh(n,t);case v.ZodRecord:return Ao(n,t);case v.ZodLiteral:return rh(n,t);case v.ZodEnum:return eh(n);case v.ZodNativeEnum:return ah(n);case v.ZodNullable:return ch(n,t);case v.ZodOptional:return ph(n,t);case v.ZodMap:return sh(n,t);case v.ZodSet:return gh(n,t);case v.ZodLazy:return()=>n.getter()._def;case v.ZodPromise:return mh(n,t);case v.ZodNaN:case v.ZodNever:return ih(t);case v.ZodEffects:return Qp(n,t);case v.ZodAny:return te(t);case v.ZodUnknown:return _h(t);case v.ZodDefault:return Xp(n,t);case v.ZodBranded:return _o(n,t);case v.ZodReadonly:return wh(n,t);case v.ZodCatch:return Yp(n,t);case v.ZodPipeline:return hh(n,t);case v.ZodFunction:case v.ZodVoid:case v.ZodSymbol:return;default:return(r=>{})(e)}}});function M(n,e,t=!1){let r=e.seen.get(n);if(e.override){let o=e.override?.(n,e,r,t);if(o!==Rp)return o}if(r&&!t){let o=mv(r,e);if(o!==void 0)return o}let s={def:n,path:e.currentPath,jsonSchema:void 0};e.seen.set(n,s);let a=vh(n,n.typeName,e),i=typeof a=="function"?M(a(),e):a;if(i&&gv(n,e,i),e.postProcess){let o=e.postProcess(i,n,e);return s.jsonSchema=i,o}return s.jsonSchema=i,i}var mv,gv,ue=h(()=>{uo();gc();co();lt();mv=(n,e)=>{switch(e.$refStrategy){case"root":return{$ref:n.path.join("/")};case"relative":return{$ref:lo(e.currentPath,n.path)};case"none":case"seen":return n.path.length<e.currentPath.length&&n.path.every((t,r)=>e.currentPath[r]===t)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),te(e)):e.$refStrategy==="seen"?te(e):void 0}},gv=(n,e,t)=>(n.description&&(t.description=n.description,e.markdownDescription&&(t.markdownDescription=n.description)),t)});var xh=h(()=>{});var Ot,yc=h(()=>{ue();$l();lt();Ot=(n,e)=>{let t=Np(e),r=typeof e=="object"&&e.definitions?Object.entries(e.definitions).reduce((u,[l,c])=>({...u,[l]:M(c._def,{...t,currentPath:[...t.basePath,t.definitionPath,l]},!0)??te(t)}),{}):void 0,s=typeof e=="string"?e:e?.nameStrategy==="title"?void 0:e?.name,a=M(n._def,s===void 0?t:{...t,currentPath:[...t.basePath,t.definitionPath,s]},!1)??te(t),i=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;i!==void 0&&(a.title=i),t.flags.hasReferencedOpenAiAnyType&&(r||(r={}),r[t.openAiAnyTypeName]||(r[t.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:t.$refStrategy==="relative"?"1":[...t.basePath,t.definitionPath,t.openAiAnyTypeName].join("/")}}));let o=s===void 0?r?{...a,[t.definitionPath]:r}:a:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,s].join("/"),[t.definitionPath]:{...r,[s]:a}};return t.target==="jsonSchema7"?o.$schema="http://json-schema.org/draft-07/schema#":(t.target==="jsonSchema2019-09"||t.target==="openAi")&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),t.target==="openAi"&&("anyOf"in o||"oneOf"in o||"allOf"in o||"type"in o&&Array.isArray(o.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),o}});var pr=h(()=>{uo();$l();Nr();co();ue();xh();lt();zl();ql();Vl();wo();Hl();Kl();Jl();Wl();Zl();Yl();Xl();tc();rc();nc();sc();ac();ic();oc();uc();lc();cc();mc();Eo();dc();xo();fc();pc();Oo();hc();gc();yc();yc()});function Io(n){if(typeof n>"u")return null;try{return JSON.parse(n)}catch{}let e="",t=[],r=!1,s=!1;for(let a of n){if(r)a==='"'&&!s?r=!1:a===`
`&&!s?a="\\n":a==="\\"?s=!s:s=!1;else if(a==='"')r=!0,s=!1;else if(a==="{")t.push("}");else if(a==="[")t.push("]");else if(a==="}"||a==="]")if(t&&t[t.length-1]===a)t.pop();else return null;e+=a}r&&(e+='"');for(let a=t.length-1;a>=0;a-=1)e+=t[a];try{return JSON.parse(e)}catch{return null}}var bc=h(()=>{});var Eh=T((zR,Ah)=>{"use strict";Ah.exports=function(n,e){if(typeof n!="string")throw new TypeError("Expected a string");return e=typeof e>"u"?"_":e,n.replace(/([a-z\d])([A-Z])/g,"$1"+e+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+e+"$2").toLowerCase()}});var Rh=T((qR,_c)=>{"use strict";var yv=/[\p{Lu}]/u,bv=/[\p{Ll}]/u,Oh=/^[\p{Lu}](?![\p{Lu}])/gu,Th=/([\p{Alpha}\p{N}_]|$)/u,Sh=/[_.\- ]+/,_v=new RegExp("^"+Sh.source),Ih=new RegExp(Sh.source+Th.source,"gu"),Ph=new RegExp("\\d+"+Th.source,"gu"),wv=(n,e,t)=>{let r=!1,s=!1,a=!1;for(let i=0;i<n.length;i++){let o=n[i];r&&yv.test(o)?(n=n.slice(0,i)+"-"+n.slice(i),r=!1,a=s,s=!0,i++):s&&a&&bv.test(o)?(n=n.slice(0,i-1)+"-"+n.slice(i-1),a=s,s=!1,r=!0):(r=e(o)===o&&t(o)!==o,a=s,s=t(o)===o&&e(o)!==o)}return n},vv=(n,e)=>(Oh.lastIndex=0,n.replace(Oh,t=>e(t))),xv=(n,e)=>(Ih.lastIndex=0,Ph.lastIndex=0,n.replace(Ih,(t,r)=>e(r)).replace(Ph,t=>e(t))),Ch=(n,e)=>{if(!(typeof n=="string"||Array.isArray(n)))throw new TypeError("Expected the input to be `string | string[]`");if(e={pascalCase:!1,preserveConsecutiveUppercase:!1,...e},Array.isArray(n)?n=n.map(a=>a.trim()).filter(a=>a.length).join("-"):n=n.trim(),n.length===0)return"";let t=e.locale===!1?a=>a.toLowerCase():a=>a.toLocaleLowerCase(e.locale),r=e.locale===!1?a=>a.toUpperCase():a=>a.toLocaleUpperCase(e.locale);return n.length===1?e.pascalCase?r(n):t(n):(n!==t(n)&&(n=wv(n,t,r)),n=n.replace(_v,""),e.preserveConsecutiveUppercase?n=vv(n,t):n=t(n),e.pascalCase&&(n=r(n.charAt(0))+n.slice(1)),xv(n,r))};_c.exports=Ch;_c.exports.default=Ch});function Nh(n,e){return e?.[n]||(0,kh.default)(n)}function $h(n,e,t){let r={};for(let s in n)Object.hasOwn(n,s)&&(r[e(s,t)]=n[s]);return r}var kh,Av,jh=h(()=>{kh=at(Eh(),1),Av=at(Rh(),1)});function Mh(n){return Array.isArray(n)?[...n]:{...n}}function Ev(n,e){let t=Mh(n);for(let[r,s]of Object.entries(e)){let[a,...i]=r.split(".").reverse(),o=t;for(let u of i.reverse()){if(o[u]===void 0)break;o[u]=Mh(o[u]),o=o[u]}o[a]!==void 0&&(o[a]={lc:1,type:"secret",id:[s]})}return t}function wc(n){let e=Object.getPrototypeOf(n);return typeof n.lc_name=="function"&&(typeof e.lc_name!="function"||n.lc_name()!==e.lc_name())?n.lc_name():n.name}var Qe,Ss=h(()=>{jh();Qe=class n{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,wc(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_kwargs=e||{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof n||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();let e={},t={},r=Object.keys(this.lc_kwargs).reduce((s,a)=>(s[a]=a in this?this[a]:this.lc_kwargs[a],s),{});for(let s=Object.getPrototypeOf(this);s;s=Object.getPrototypeOf(s))Object.assign(e,Reflect.get(s,"lc_aliases",this)),Object.assign(t,Reflect.get(s,"lc_secrets",this)),Object.assign(r,Reflect.get(s,"lc_attributes",this));return Object.keys(t).forEach(s=>{let a=this,i=r,[o,...u]=s.split(".").reverse();for(let l of u.reverse()){if(!(l in a)||a[l]===void 0)return;(!(l in i)||i[l]===void 0)&&(typeof a[l]=="object"&&a[l]!=null?i[l]={}:Array.isArray(a[l])&&(i[l]=[])),a=a[l],i=i[l]}o in a&&a[o]!==void 0&&(i[o]=i[o]||a[o])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:$h(Object.keys(t).length?Ev(r,t):r,Nh,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}}});function Sn(n,e){return typeof n=="string"?typeof e=="string"?n+e:[{type:"text",text:n},...e]:Array.isArray(e)?Po(n,e)??[...n,...e]:[...n,{type:"text",text:e}]}function Ov(n,e){function t(r,s){if(typeof r!="object"||r===null||r===void 0)return r;if(s>=e)return Array.isArray(r)?"[Array]":"[Object]";if(Array.isArray(r))return r.map(i=>t(i,s+1));let a={};for(let i of Object.keys(r))a[i]=t(r[i],s+1);return a}return JSON.stringify(t(n,0),null,2)}function zt(n,e){let t={...n};for(let[r,s]of Object.entries(e))if(t[r]==null)t[r]=s;else{if(s==null)continue;if(typeof t[r]!=typeof s||Array.isArray(t[r])!==Array.isArray(s))throw new Error(`field[${r}] already exists in the message chunk, but with a different type.`);if(typeof t[r]=="string"){if(r==="type")continue;t[r]+=s}else if(typeof t[r]=="object"&&!Array.isArray(t[r]))t[r]=zt(t[r],s);else if(Array.isArray(t[r]))t[r]=Po(t[r],s);else{if(t[r]===s)continue;console.warn(`field[${r}] already exists in this message chunk and value has unsupported type.`)}}return t}function Po(n,e){if(!(n===void 0&&e===void 0)){if(n===void 0||e===void 0)return n||e;{let t=[...n];for(let r of e)if(typeof r=="object"&&"index"in r&&typeof r.index=="number"){let s=t.findIndex(a=>a.index===r.index);s!==-1?t[s]=zt(t[s],r):t.push(r)}else{if(typeof r=="object"&&"text"in r&&r.text==="")continue;t.push(r)}return t}}}function Lh(n){return typeof n.role=="string"}function It(n){return typeof n?._getType=="function"}var pe,hr,Pt=h(()=>{Ss();pe=class extends Qe{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return typeof this.content=="string"?this.content:""}constructor(e,t){typeof e=="string"&&(e={content:e,additional_kwargs:t,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata,this.id=e.id}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}static lc_name(){return"BaseMessage"}get _printableFields(){return{id:this.id,content:this.content,name:this.name,additional_kwargs:this.additional_kwargs,response_metadata:this.response_metadata}}_updateId(e){this.id=e,this.lc_kwargs.id=e}get[Symbol.toStringTag](){return this.constructor.lc_name()}[Symbol.for("nodejs.util.inspect.custom")](e){if(e===null)return this;let t=Ov(this._printableFields,Math.max(4,e));return`${this.constructor.lc_name()} ${t}`}};hr=class extends pe{}});function Dh(n){let e=[],t=[];for(let r of n)if(r.function){let s=r.function.name;try{let a=JSON.parse(r.function.arguments),i={name:s||"",args:a||{},id:r.id};e.push(i)}catch{t.push({name:s,args:r.function.arguments,id:r.id,error:"Malformed args."})}}else continue;return[e,t]}var mr,Cs=h(()=>{Pt();mr=class extends pe{static lc_name(){return"ToolMessage"}get lc_aliases(){return{tool_call_id:"tool_call_id"}}constructor(e,t,r){typeof e=="string"&&(e={content:e,name:r,tool_call_id:t}),super(e),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}_getType(){return"tool"}static isInstance(e){return e._getType()==="tool"}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}}});var ae,Re,Cn=h(()=>{bc();Pt();Cs();ae=class extends pe{get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}constructor(e,t){let r;if(typeof e=="string")r={content:e,tool_calls:[],invalid_tool_calls:[],additional_kwargs:t??{}};else{r=e;let s=r.additional_kwargs?.tool_calls,a=r.tool_calls;s!=null&&s.length>0&&(a===void 0||a.length===0)&&console.warn(["New LangChain packages are available that more efficiently handle",`tool calling.

Please upgrade your packages to versions that set`,"message tool calls. e.g., `yarn add @langchain/anthropic`,","yarn add @langchain/openai`, etc."].join(" "));try{if(s!=null&&a===void 0){let[i,o]=Dh(s);r.tool_calls=i??[],r.invalid_tool_calls=o??[]}else r.tool_calls=r.tool_calls??[],r.invalid_tool_calls=r.invalid_tool_calls??[]}catch{r.tool_calls=[],r.invalid_tool_calls=[]}}super(r),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof r!="string"&&(this.tool_calls=r.tool_calls??this.tool_calls,this.invalid_tool_calls=r.invalid_tool_calls??this.invalid_tool_calls),this.usage_metadata=r.usage_metadata}static lc_name(){return"AIMessage"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}},Re=class n extends hr{constructor(e){let t;if(typeof e=="string")t={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(e.tool_call_chunks===void 0)t={...e,tool_calls:e.tool_calls??[],invalid_tool_calls:[],tool_call_chunks:[]};else{let r=[],s=[];for(let a of e.tool_call_chunks){let i={};try{if(i=Io(a.args||"{}"),i===null||typeof i!="object"||Array.isArray(i))throw new Error("Malformed tool call chunk args.");r.push({name:a.name??"",args:i,id:a.id,type:"tool_call"})}catch{s.push({name:a.name,args:a.args,id:a.id,error:"Malformed args.",type:"invalid_tool_call"})}}t={...e,tool_calls:r,invalid_tool_calls:s}}super(t),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_chunks=t.tool_call_chunks??this.tool_call_chunks,this.tool_calls=t.tool_calls??this.tool_calls,this.invalid_tool_calls=t.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=t.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,tool_call_chunks:this.tool_call_chunks,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}concat(e){let t={content:Sn(this.content,e.content),additional_kwargs:zt(this.additional_kwargs,e.additional_kwargs),response_metadata:zt(this.response_metadata,e.response_metadata),tool_call_chunks:[],id:this.id??e.id};if(this.tool_call_chunks!==void 0||e.tool_call_chunks!==void 0){let r=Po(this.tool_call_chunks,e.tool_call_chunks);r!==void 0&&r.length>0&&(t.tool_call_chunks=r)}if(this.usage_metadata!==void 0||e.usage_metadata!==void 0){let r=this.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},s=e.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},a={input_tokens:r.input_tokens+s.input_tokens,output_tokens:r.output_tokens+s.output_tokens,total_tokens:r.total_tokens+s.total_tokens};t.usage_metadata=a}return new n(t)}}});var ct,To=h(()=>{Pt();ct=class n extends pe{static lc_name(){return"ChatMessage"}static _chatMessageClass(){return n}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return e._getType()==="generic"}get _printableFields(){return{...super._printableFields,role:this.role}}}});var So=h(()=>{Pt()});var he,Ga=h(()=>{Pt();he=class extends pe{static lc_name(){return"HumanMessage"}_getType(){return"human"}}});var Rn,Co=h(()=>{Pt();Rn=class extends pe{static lc_name(){return"SystemMessage"}_getType(){return"system"}}});function ks(n){return!!(n&&typeof n=="object"&&"type"in n&&n.type==="tool_call")}var Rs,Ro=h(()=>{Rs=class extends Error{constructor(e,t){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=t}}});function Pv(n){return ks(n)?n:typeof n.id=="string"&&n.type==="function"&&typeof n.function=="object"&&n.function!==null&&"arguments"in n.function&&typeof n.function.arguments=="string"&&"name"in n.function&&typeof n.function.name=="string"?{id:n.id,args:JSON.parse(n.function.arguments),name:n.function.name,type:"tool_call"}:n}function vc(n){let{type:e,...t}=n;if(e==="human"||e==="user")return new he(t);if(e==="ai"||e==="assistant"){let{tool_calls:r,...s}=t;if(!Array.isArray(r))return new ae(t);let a=r.map(Pv);return new ae({...s,tool_calls:a})}else{if(e==="system")return new Rn(t);if(e==="tool"&&"tool_call_id"in t)return new mr({...t,content:t.content,tool_call_id:t.tool_call_id,name:t.name});throw new Error("Unable to coerce message from array: only human, AI, or system message coercion is currently supported.")}}function Tt(n){if(typeof n=="string")return new he(n);if(It(n))return n;if(Array.isArray(n)){let[e,t]=n;return vc({type:e,content:t})}else if(Lh(n)){let{role:e,...t}=n;return vc({...t,type:e})}else return vc(n)}function Ka(n,e="Human",t="AI"){let r=[];for(let s of n){let a;if(s._getType()==="human")a=e;else if(s._getType()==="ai")a=t;else if(s._getType()==="system")a="System";else if(s._getType()==="function")a="Function";else if(s._getType()==="tool")a="Tool";else if(s._getType()==="generic")a=s.role;else throw new Error(`Got unsupported message type: ${s._getType()}`);let i=s.name?`${s.name}, `:"",o=typeof s.content=="string"?s.content:JSON.stringify(s.content,null,2);r.push(`${a}: ${i}${o}`)}return r.join(`
`)}var Dr=h(()=>{Ro();Cn();Pt();To();So();Ga();Co();Cs()});var Bh=T((vk,Uh)=>{function dt(n,e){typeof e=="boolean"&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(n)),this._timeouts=n,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}Uh.exports=dt;dt.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};dt.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};dt.prototype.retry=function(n){if(this._timeout&&clearTimeout(this._timeout),!n)return!1;var e=new Date().getTime();if(n&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(n),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(n);var t=this._timeouts.shift();if(t===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),t=this._cachedTimeouts.slice(-1);else return!1;var r=this;return this._timer=setTimeout(function(){r._attempts++,r._operationTimeoutCb&&(r._timeout=setTimeout(function(){r._operationTimeoutCb(r._attempts)},r._operationTimeout),r._options.unref&&r._timeout.unref()),r._fn(r._attempts)},t),this._options.unref&&this._timer.unref(),!0};dt.prototype.attempt=function(n,e){this._fn=n,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var t=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){t._operationTimeoutCb()},t._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};dt.prototype.try=function(n){console.log("Using RetryOperation.try() is deprecated"),this.attempt(n)};dt.prototype.start=function(n){console.log("Using RetryOperation.start() is deprecated"),this.attempt(n)};dt.prototype.start=dt.prototype.try;dt.prototype.errors=function(){return this._errors};dt.prototype.attempts=function(){return this._attempts};dt.prototype.mainError=function(){if(this._errors.length===0)return null;for(var n={},e=null,t=0,r=0;r<this._errors.length;r++){var s=this._errors[r],a=s.message,i=(n[a]||0)+1;n[a]=i,i>=t&&(e=s,t=i)}return e}});var zh=T(kn=>{var Tv=Bh();kn.operation=function(n){var e=kn.timeouts(n);return new Tv(e,{forever:n&&(n.forever||n.retries===1/0),unref:n&&n.unref,maxRetryTime:n&&n.maxRetryTime})};kn.timeouts=function(n){if(n instanceof Array)return[].concat(n);var e={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var t in n)e[t]=n[t];if(e.minTimeout>e.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var r=[],s=0;s<e.retries;s++)r.push(this.createTimeout(s,e));return n&&n.forever&&!r.length&&r.push(this.createTimeout(s,e)),r.sort(function(a,i){return a-i}),r};kn.createTimeout=function(n,e){var t=e.randomize?Math.random()+1:1,r=Math.round(t*Math.max(e.minTimeout,1)*Math.pow(e.factor,n));return r=Math.min(r,e.maxTimeout),r};kn.wrap=function(n,e,t){if(e instanceof Array&&(t=e,e=null),!t){t=[];for(var r in n)typeof n[r]=="function"&&t.push(r)}for(var s=0;s<t.length;s++){var a=t[s],i=n[a];n[a]=function(u){var l=kn.operation(e),c=Array.prototype.slice.call(arguments,1),d=c.pop();c.push(function(f){l.retry(f)||(f&&(arguments[0]=l.mainError()),d.apply(this,arguments))}),l.attempt(function(){u.apply(n,c)})}.bind(n,i),n[a].options=e}}});var Vh=T((Ak,qh)=>{qh.exports=zh()});var $o=T((Ek,No)=>{"use strict";var Sv=Vh(),Cv=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"],ko=class extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}},Rv=(n,e,t)=>{let r=t.retries-(e-1);return n.attemptNumber=e,n.retriesLeft=r,n},kv=n=>Cv.includes(n),Hh=(n,e)=>new Promise((t,r)=>{e={onFailedAttempt:()=>{},retries:10,...e};let s=Sv.operation(e);s.attempt(async a=>{try{t(await n(a))}catch(i){if(!(i instanceof Error)){r(new TypeError(`Non-error was thrown: "${i}". You should only throw errors.`));return}if(i instanceof ko)s.stop(),r(i.originalError);else if(i instanceof TypeError&&!kv(i.message))s.stop(),r(i);else{Rv(i,a,e);try{await e.onFailedAttempt(i)}catch(o){r(o);return}s.retry(i)||r(s.mainError())}}})});No.exports=Hh;No.exports.default=Hh;No.exports.AbortError=ko});var Gh,Kh=h(()=>{Gh=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i});function Nv(n){return typeof n=="string"&&Gh.test(n)}var Ja,Jh=h(()=>{Kh();Ja=Nv});function Wh(n,e=0){return(Ee[n[e+0]]+Ee[n[e+1]]+Ee[n[e+2]]+Ee[n[e+3]]+"-"+Ee[n[e+4]]+Ee[n[e+5]]+"-"+Ee[n[e+6]]+Ee[n[e+7]]+"-"+Ee[n[e+8]]+Ee[n[e+9]]+"-"+Ee[n[e+10]]+Ee[n[e+11]]+Ee[n[e+12]]+Ee[n[e+13]]+Ee[n[e+14]]+Ee[n[e+15]]).toLowerCase()}var Ee,jo,Zh=h(()=>{Ee=[];for(jo=0;jo<256;++jo)Ee.push((jo+256).toString(16).slice(1))});function Oc(){if(!Mo&&(Mo=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Mo))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Mo($v)}var Mo,$v,Yh=h(()=>{$v=new Uint8Array(16)});var jv,Ic,Xh=h(()=>{jv=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Ic={randomUUID:jv}});function Mv(n,e,t){if(Ic.randomUUID&&!e&&!n)return Ic.randomUUID();n=n||{};var r=n.random||(n.rng||Oc)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(var s=0;s<16;++s)e[t+s]=r[s];return e}return Wh(r)}var Ke,Qh=h(()=>{Xh();Yh();Zh();Ke=Mv});var Wa=h(()=>{Qh();Jh()});var em,tm=h(()=>{em=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i});function Dv(n){return typeof n=="string"&&em.test(n)}var Pc,rm=h(()=>{tm();Pc=Dv});function nm(n,e=0){return(Oe[n[e+0]]+Oe[n[e+1]]+Oe[n[e+2]]+Oe[n[e+3]]+"-"+Oe[n[e+4]]+Oe[n[e+5]]+"-"+Oe[n[e+6]]+Oe[n[e+7]]+"-"+Oe[n[e+8]]+Oe[n[e+9]]+"-"+Oe[n[e+10]]+Oe[n[e+11]]+Oe[n[e+12]]+Oe[n[e+13]]+Oe[n[e+14]]+Oe[n[e+15]]).toLowerCase()}var Oe,Lo,sm=h(()=>{Oe=[];for(Lo=0;Lo<256;++Lo)Oe.push((Lo+256).toString(16).slice(1))});function Tc(){if(!Do&&(Do=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Do))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Do(Fv)}var Do,Fv,am=h(()=>{Fv=new Uint8Array(16)});var Uv,Sc,im=h(()=>{Uv=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Sc={randomUUID:Uv}});function Bv(n,e,t){if(Sc.randomUUID&&!e&&!n)return Sc.randomUUID();n=n||{};var r=n.random||(n.rng||Tc)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(var s=0;s<16;++s)e[t+s]=r[s];return e}return nm(r)}var Nn,om=h(()=>{im();am();sm();Nn=Bv});var Fo=h(()=>{om();rm()});var lm=T((Wk,Rc)=>{"use strict";var zv=Object.prototype.hasOwnProperty,Fe="~";function Za(){}Object.create&&(Za.prototype=Object.create(null),new Za().__proto__||(Fe=!1));function qv(n,e,t){this.fn=n,this.context=e,this.once=t||!1}function um(n,e,t,r,s){if(typeof t!="function")throw new TypeError("The listener must be a function");var a=new qv(t,r||n,s),i=Fe?Fe+e:e;return n._events[i]?n._events[i].fn?n._events[i]=[n._events[i],a]:n._events[i].push(a):(n._events[i]=a,n._eventsCount++),n}function Uo(n,e){--n._eventsCount===0?n._events=new Za:delete n._events[e]}function ke(){this._events=new Za,this._eventsCount=0}ke.prototype.eventNames=function(){var e=[],t,r;if(this._eventsCount===0)return e;for(r in t=this._events)zv.call(t,r)&&e.push(Fe?r.slice(1):r);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e};ke.prototype.listeners=function(e){var t=Fe?Fe+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var s=0,a=r.length,i=new Array(a);s<a;s++)i[s]=r[s].fn;return i};ke.prototype.listenerCount=function(e){var t=Fe?Fe+e:e,r=this._events[t];return r?r.fn?1:r.length:0};ke.prototype.emit=function(e,t,r,s,a,i){var o=Fe?Fe+e:e;if(!this._events[o])return!1;var u=this._events[o],l=arguments.length,c,d;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),l){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,r),!0;case 4:return u.fn.call(u.context,t,r,s),!0;case 5:return u.fn.call(u.context,t,r,s,a),!0;case 6:return u.fn.call(u.context,t,r,s,a,i),!0}for(d=1,c=new Array(l-1);d<l;d++)c[d-1]=arguments[d];u.fn.apply(u.context,c)}else{var f=u.length,p;for(d=0;d<f;d++)switch(u[d].once&&this.removeListener(e,u[d].fn,void 0,!0),l){case 1:u[d].fn.call(u[d].context);break;case 2:u[d].fn.call(u[d].context,t);break;case 3:u[d].fn.call(u[d].context,t,r);break;case 4:u[d].fn.call(u[d].context,t,r,s);break;default:if(!c)for(p=1,c=new Array(l-1);p<l;p++)c[p-1]=arguments[p];u[d].fn.apply(u[d].context,c)}}return!0};ke.prototype.on=function(e,t,r){return um(this,e,t,r,!1)};ke.prototype.once=function(e,t,r){return um(this,e,t,r,!0)};ke.prototype.removeListener=function(e,t,r,s){var a=Fe?Fe+e:e;if(!this._events[a])return this;if(!t)return Uo(this,a),this;var i=this._events[a];if(i.fn)i.fn===t&&(!s||i.once)&&(!r||i.context===r)&&Uo(this,a);else{for(var o=0,u=[],l=i.length;o<l;o++)(i[o].fn!==t||s&&!i[o].once||r&&i[o].context!==r)&&u.push(i[o]);u.length?this._events[a]=u.length===1?u[0]:u:Uo(this,a)}return this};ke.prototype.removeAllListeners=function(e){var t;return e?(t=Fe?Fe+e:e,this._events[t]&&Uo(this,t)):(this._events=new Za,this._eventsCount=0),this};ke.prototype.off=ke.prototype.removeListener;ke.prototype.addListener=ke.prototype.on;ke.prefixed=Fe;ke.EventEmitter=ke;typeof Rc<"u"&&(Rc.exports=ke)});var dm=T((Zk,cm)=>{"use strict";cm.exports=(n,e)=>(e=e||(()=>{}),n.then(t=>new Promise(r=>{r(e())}).then(()=>t),t=>new Promise(r=>{r(e())}).then(()=>{throw t})))});var pm=T((Yk,zo)=>{"use strict";var Vv=dm(),Bo=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},fm=(n,e,t)=>new Promise((r,s)=>{if(typeof e!="number"||e<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(e===1/0){r(n);return}let a=setTimeout(()=>{if(typeof t=="function"){try{r(t())}catch(u){s(u)}return}let i=typeof t=="string"?t:`Promise timed out after ${e} milliseconds`,o=t instanceof Error?t:new Bo(i);typeof n.cancel=="function"&&n.cancel(),s(o)},e);Vv(n.then(r,s),()=>{clearTimeout(a)})});zo.exports=fm;zo.exports.default=fm;zo.exports.TimeoutError=Bo});var hm=T(kc=>{"use strict";Object.defineProperty(kc,"__esModule",{value:!0});function Hv(n,e,t){let r=0,s=n.length;for(;s>0;){let a=s/2|0,i=r+a;t(n[i],e)<=0?(r=++i,s-=a+1):s=a}return r}kc.default=Hv});var mm=T($c=>{"use strict";Object.defineProperty($c,"__esModule",{value:!0});var Gv=hm(),Nc=class{constructor(){this._queue=[]}enqueue(e,t){t=Object.assign({priority:0},t);let r={priority:t.priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority){this._queue.push(r);return}let s=Gv.default(this._queue,r,(a,i)=>i.priority-a.priority);this._queue.splice(s,0,r)}dequeue(){let e=this._queue.shift();return e?.run}filter(e){return this._queue.filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return this._queue.length}};$c.default=Nc});var Vo=T(Mc=>{"use strict";Object.defineProperty(Mc,"__esModule",{value:!0});var Kv=lm(),gm=pm(),Jv=mm(),qo=()=>{},Wv=new gm.TimeoutError,jc=class extends Kv{constructor(e){var t,r,s,a;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=qo,this._resolveIdle=qo,e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:Jv.default},e),!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(r=(t=e.intervalCap)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(a=(s=e.interval)===null||s===void 0?void 0:s.toString())!==null&&a!==void 0?a:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||e.interval===0,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=e.throwOnTimeout===!0,this._isPaused=e.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=qo,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=qo,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){let e=Date.now();if(this._intervalId===void 0){let t=this._intervalEnd-e;if(t<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},t)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){let e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){let t=this._queue.dequeue();return t?(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise((r,s)=>{let a=async()=>{this._pendingCount++,this._intervalCount++;try{let i=this._timeout===void 0&&t.timeout===void 0?e():gm.default(Promise.resolve(e()),t.timeout===void 0?this._timeout:t.timeout,()=>{(t.throwOnTimeout===void 0?this._throwOnTimeout:t.throwOnTimeout)&&s(Wv)});r(await i)}catch(i){s(i)}this._next()};this._queue.enqueue(a,t),this._tryToStartAnother(),this.emit("add")})}async addAll(e,t){return Promise.all(e.map(async r=>this.add(r,t)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(e=>{let t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(e=>{let t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}};Mc.default=jc});var Zv,Yv,$,Ho=h(()=>{Zv=(...n)=>fetch(...n),Yv=Symbol.for("ls:fetch_implementation"),$=()=>globalThis[Yv]??Zv});var ym,Go,Xv,Qv,Ya,bm=h(()=>{ym=at($o(),1),Go=at(Vo(),1);Ho();Xv=[400,401,403,404,405,406,407,408],Qv=[409],Ya=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,"default"in Go.default?this.queue=new Go.default.default({concurrency:this.maxConcurrency}):this.queue=new Go.default({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e?.onFailedResponseHook}call(e,...t){let r=this.onFailedResponseHook;return this.queue.add(()=>(0,ym.default)(()=>e(...t).catch(s=>{throw s instanceof Error?s:new Error(s)}),{async onFailedAttempt(s){if(s.message.startsWith("Cancel")||s.message.startsWith("TimeoutError")||s.message.startsWith("AbortError")||s?.code==="ECONNABORTED")throw s;let a=s?.response,i=a?.status;if(i){if(Xv.includes(+i))throw s;if(Qv.includes(+i))return;r&&await r(a)}},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((s,a)=>{e.signal?.addEventListener("abort",()=>{a(new Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>$()(...e).then(t=>t.ok?t:Promise.reject(t)))}}});function Lc(n){return typeof n?._getType=="function"}function Dc(n){let e={type:n._getType(),data:{content:n.content}};return n?.additional_kwargs&&Object.keys(n.additional_kwargs).length>0&&(e.data.additional_kwargs={...n.additional_kwargs}),e}var _m=h(()=>{});function G(n,e){if(!Pc(n)){let t=e!==void 0?`Invalid UUID for ${e}: ${n}`:`Invalid UUID: ${n}`;throw new Error(t)}return n}var wm=h(()=>{Fo()});function Ko(n){vm[n]||(console.warn(n),vm[n]=!0)}var vm,Fc=h(()=>{vm={}});var Xa=T((oN,xm)=>{"use strict";var e0="2.0.0",t0=Number.MAX_SAFE_INTEGER||9007199254740991,r0=16,n0=250,s0=["major","premajor","minor","preminor","patch","prepatch","prerelease"];xm.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:r0,MAX_SAFE_BUILD_LENGTH:n0,MAX_SAFE_INTEGER:t0,RELEASE_TYPES:s0,SEMVER_SPEC_VERSION:e0,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}});var Qa=T((uN,Am)=>{"use strict";var a0=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...n)=>console.error("SEMVER",...n):()=>{};Am.exports=a0});var Ns=T((qt,Em)=>{"use strict";var{MAX_SAFE_COMPONENT_LENGTH:Uc,MAX_SAFE_BUILD_LENGTH:i0,MAX_LENGTH:o0}=Xa(),u0=Qa();qt=Em.exports={};var l0=qt.re=[],c0=qt.safeRe=[],I=qt.src=[],d0=qt.safeSrc=[],P=qt.t={},f0=0,Bc="[a-zA-Z0-9-]",p0=[["\\s",1],["\\d",o0],[Bc,i0]],h0=n=>{for(let[e,t]of p0)n=n.split(`${e}*`).join(`${e}{0,${t}}`).split(`${e}+`).join(`${e}{1,${t}}`);return n},F=(n,e,t)=>{let r=h0(e),s=f0++;u0(n,s,e),P[n]=s,I[s]=e,d0[s]=r,l0[s]=new RegExp(e,t?"g":void 0),c0[s]=new RegExp(r,t?"g":void 0)};F("NUMERICIDENTIFIER","0|[1-9]\\d*");F("NUMERICIDENTIFIERLOOSE","\\d+");F("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${Bc}*`);F("MAINVERSION",`(${I[P.NUMERICIDENTIFIER]})\\.(${I[P.NUMERICIDENTIFIER]})\\.(${I[P.NUMERICIDENTIFIER]})`);F("MAINVERSIONLOOSE",`(${I[P.NUMERICIDENTIFIERLOOSE]})\\.(${I[P.NUMERICIDENTIFIERLOOSE]})\\.(${I[P.NUMERICIDENTIFIERLOOSE]})`);F("PRERELEASEIDENTIFIER",`(?:${I[P.NONNUMERICIDENTIFIER]}|${I[P.NUMERICIDENTIFIER]})`);F("PRERELEASEIDENTIFIERLOOSE",`(?:${I[P.NONNUMERICIDENTIFIER]}|${I[P.NUMERICIDENTIFIERLOOSE]})`);F("PRERELEASE",`(?:-(${I[P.PRERELEASEIDENTIFIER]}(?:\\.${I[P.PRERELEASEIDENTIFIER]})*))`);F("PRERELEASELOOSE",`(?:-?(${I[P.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${I[P.PRERELEASEIDENTIFIERLOOSE]})*))`);F("BUILDIDENTIFIER",`${Bc}+`);F("BUILD",`(?:\\+(${I[P.BUILDIDENTIFIER]}(?:\\.${I[P.BUILDIDENTIFIER]})*))`);F("FULLPLAIN",`v?${I[P.MAINVERSION]}${I[P.PRERELEASE]}?${I[P.BUILD]}?`);F("FULL",`^${I[P.FULLPLAIN]}$`);F("LOOSEPLAIN",`[v=\\s]*${I[P.MAINVERSIONLOOSE]}${I[P.PRERELEASELOOSE]}?${I[P.BUILD]}?`);F("LOOSE",`^${I[P.LOOSEPLAIN]}$`);F("GTLT","((?:<|>)?=?)");F("XRANGEIDENTIFIERLOOSE",`${I[P.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);F("XRANGEIDENTIFIER",`${I[P.NUMERICIDENTIFIER]}|x|X|\\*`);F("XRANGEPLAIN",`[v=\\s]*(${I[P.XRANGEIDENTIFIER]})(?:\\.(${I[P.XRANGEIDENTIFIER]})(?:\\.(${I[P.XRANGEIDENTIFIER]})(?:${I[P.PRERELEASE]})?${I[P.BUILD]}?)?)?`);F("XRANGEPLAINLOOSE",`[v=\\s]*(${I[P.XRANGEIDENTIFIERLOOSE]})(?:\\.(${I[P.XRANGEIDENTIFIERLOOSE]})(?:\\.(${I[P.XRANGEIDENTIFIERLOOSE]})(?:${I[P.PRERELEASELOOSE]})?${I[P.BUILD]}?)?)?`);F("XRANGE",`^${I[P.GTLT]}\\s*${I[P.XRANGEPLAIN]}$`);F("XRANGELOOSE",`^${I[P.GTLT]}\\s*${I[P.XRANGEPLAINLOOSE]}$`);F("COERCEPLAIN",`(^|[^\\d])(\\d{1,${Uc}})(?:\\.(\\d{1,${Uc}}))?(?:\\.(\\d{1,${Uc}}))?`);F("COERCE",`${I[P.COERCEPLAIN]}(?:$|[^\\d])`);F("COERCEFULL",I[P.COERCEPLAIN]+`(?:${I[P.PRERELEASE]})?(?:${I[P.BUILD]})?(?:$|[^\\d])`);F("COERCERTL",I[P.COERCE],!0);F("COERCERTLFULL",I[P.COERCEFULL],!0);F("LONETILDE","(?:~>?)");F("TILDETRIM",`(\\s*)${I[P.LONETILDE]}\\s+`,!0);qt.tildeTrimReplace="$1~";F("TILDE",`^${I[P.LONETILDE]}${I[P.XRANGEPLAIN]}$`);F("TILDELOOSE",`^${I[P.LONETILDE]}${I[P.XRANGEPLAINLOOSE]}$`);F("LONECARET","(?:\\^)");F("CARETTRIM",`(\\s*)${I[P.LONECARET]}\\s+`,!0);qt.caretTrimReplace="$1^";F("CARET",`^${I[P.LONECARET]}${I[P.XRANGEPLAIN]}$`);F("CARETLOOSE",`^${I[P.LONECARET]}${I[P.XRANGEPLAINLOOSE]}$`);F("COMPARATORLOOSE",`^${I[P.GTLT]}\\s*(${I[P.LOOSEPLAIN]})$|^$`);F("COMPARATOR",`^${I[P.GTLT]}\\s*(${I[P.FULLPLAIN]})$|^$`);F("COMPARATORTRIM",`(\\s*)${I[P.GTLT]}\\s*(${I[P.LOOSEPLAIN]}|${I[P.XRANGEPLAIN]})`,!0);qt.comparatorTrimReplace="$1$2$3";F("HYPHENRANGE",`^\\s*(${I[P.XRANGEPLAIN]})\\s+-\\s+(${I[P.XRANGEPLAIN]})\\s*$`);F("HYPHENRANGELOOSE",`^\\s*(${I[P.XRANGEPLAINLOOSE]})\\s+-\\s+(${I[P.XRANGEPLAINLOOSE]})\\s*$`);F("STAR","(<|>)?=?\\s*\\*");F("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$");F("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});var Jo=T((lN,Om)=>{"use strict";var m0=Object.freeze({loose:!0}),g0=Object.freeze({}),y0=n=>n?typeof n!="object"?m0:n:g0;Om.exports=y0});var zc=T((cN,Tm)=>{"use strict";var Im=/^[0-9]+$/,Pm=(n,e)=>{if(typeof n=="number"&&typeof e=="number")return n===e?0:n<e?-1:1;let t=Im.test(n),r=Im.test(e);return t&&r&&(n=+n,e=+e),n===e?0:t&&!r?-1:r&&!t?1:n<e?-1:1},b0=(n,e)=>Pm(e,n);Tm.exports={compareIdentifiers:Pm,rcompareIdentifiers:b0}});var Ne=T((dN,Cm)=>{"use strict";var Wo=Qa(),{MAX_LENGTH:Sm,MAX_SAFE_INTEGER:Zo}=Xa(),{safeRe:Yo,t:Xo}=Ns(),_0=Jo(),{compareIdentifiers:qc}=zc(),Vc=class n{constructor(e,t){if(t=_0(t),e instanceof n){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>Sm)throw new TypeError(`version is longer than ${Sm} characters`);Wo("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;let r=e.trim().match(t.loose?Yo[Xo.LOOSE]:Yo[Xo.FULL]);if(!r)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>Zo||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Zo||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Zo||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(s=>{if(/^[0-9]+$/.test(s)){let a=+s;if(a>=0&&a<Zo)return a}return s}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(Wo("SemVer.compare",this.version,this.options,e),!(e instanceof n)){if(typeof e=="string"&&e===this.version)return 0;e=new n(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof n||(e=new n(e,this.options)),this.major<e.major?-1:this.major>e.major?1:this.minor<e.minor?-1:this.minor>e.minor?1:this.patch<e.patch?-1:this.patch>e.patch?1:0}comparePre(e){if(e instanceof n||(e=new n(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{let r=this.prerelease[t],s=e.prerelease[t];if(Wo("prerelease compare",t,r,s),r===void 0&&s===void 0)return 0;if(s===void 0)return 1;if(r===void 0)return-1;if(r===s)continue;return qc(r,s)}while(++t)}compareBuild(e){e instanceof n||(e=new n(e,this.options));let t=0;do{let r=this.build[t],s=e.build[t];if(Wo("build compare",t,r,s),r===void 0&&s===void 0)return 0;if(s===void 0)return 1;if(r===void 0)return-1;if(r===s)continue;return qc(r,s)}while(++t)}inc(e,t,r){if(e.startsWith("pre")){if(!t&&r===!1)throw new Error("invalid increment argument: identifier is empty");if(t){let s=`-${t}`.match(this.options.loose?Yo[Xo.PRERELEASELOOSE]:Yo[Xo.PRERELEASE]);if(!s||s[1]!==t)throw new Error(`invalid identifier: ${t}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,r);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,r);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,r),this.inc("pre",t,r);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",t,r),this.inc("pre",t,r);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{let s=Number(r)?1:0;if(this.prerelease.length===0)this.prerelease=[s];else{let a=this.prerelease.length;for(;--a>=0;)typeof this.prerelease[a]=="number"&&(this.prerelease[a]++,a=-2);if(a===-1){if(t===this.prerelease.join(".")&&r===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(s)}}if(t){let a=[t,s];r===!1&&(a=[t]),qc(this.prerelease[0],t)===0?isNaN(this.prerelease[1])&&(this.prerelease=a):this.prerelease=a}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};Cm.exports=Vc});var $n=T((fN,km)=>{"use strict";var Rm=Ne(),w0=(n,e,t=!1)=>{if(n instanceof Rm)return n;try{return new Rm(n,e)}catch(r){if(!t)return null;throw r}};km.exports=w0});var $m=T((pN,Nm)=>{"use strict";var v0=$n(),x0=(n,e)=>{let t=v0(n,e);return t?t.version:null};Nm.exports=x0});var Mm=T((hN,jm)=>{"use strict";var A0=$n(),E0=(n,e)=>{let t=A0(n.trim().replace(/^[=v]+/,""),e);return t?t.version:null};jm.exports=E0});var Fm=T((mN,Dm)=>{"use strict";var Lm=Ne(),O0=(n,e,t,r,s)=>{typeof t=="string"&&(s=r,r=t,t=void 0);try{return new Lm(n instanceof Lm?n.version:n,t).inc(e,r,s).version}catch{return null}};Dm.exports=O0});var zm=T((gN,Bm)=>{"use strict";var Um=$n(),I0=(n,e)=>{let t=Um(n,null,!0),r=Um(e,null,!0),s=t.compare(r);if(s===0)return null;let a=s>0,i=a?t:r,o=a?r:t,u=!!i.prerelease.length;if(!!o.prerelease.length&&!u){if(!o.patch&&!o.minor)return"major";if(o.compareMain(i)===0)return o.minor&&!o.patch?"minor":"patch"}let c=u?"pre":"";return t.major!==r.major?c+"major":t.minor!==r.minor?c+"minor":t.patch!==r.patch?c+"patch":"prerelease"};Bm.exports=I0});var Vm=T((yN,qm)=>{"use strict";var P0=Ne(),T0=(n,e)=>new P0(n,e).major;qm.exports=T0});var Gm=T((bN,Hm)=>{"use strict";var S0=Ne(),C0=(n,e)=>new S0(n,e).minor;Hm.exports=C0});var Jm=T((_N,Km)=>{"use strict";var R0=Ne(),k0=(n,e)=>new R0(n,e).patch;Km.exports=k0});var Zm=T((wN,Wm)=>{"use strict";var N0=$n(),$0=(n,e)=>{let t=N0(n,e);return t&&t.prerelease.length?t.prerelease:null};Wm.exports=$0});var ft=T((vN,Xm)=>{"use strict";var Ym=Ne(),j0=(n,e,t)=>new Ym(n,t).compare(new Ym(e,t));Xm.exports=j0});var eg=T((xN,Qm)=>{"use strict";var M0=ft(),L0=(n,e,t)=>M0(e,n,t);Qm.exports=L0});var rg=T((AN,tg)=>{"use strict";var D0=ft(),F0=(n,e)=>D0(n,e,!0);tg.exports=F0});var Qo=T((EN,sg)=>{"use strict";var ng=Ne(),U0=(n,e,t)=>{let r=new ng(n,t),s=new ng(e,t);return r.compare(s)||r.compareBuild(s)};sg.exports=U0});var ig=T((ON,ag)=>{"use strict";var B0=Qo(),z0=(n,e)=>n.sort((t,r)=>B0(t,r,e));ag.exports=z0});var ug=T((IN,og)=>{"use strict";var q0=Qo(),V0=(n,e)=>n.sort((t,r)=>q0(r,t,e));og.exports=V0});var ei=T((PN,lg)=>{"use strict";var H0=ft(),G0=(n,e,t)=>H0(n,e,t)>0;lg.exports=G0});var eu=T((TN,cg)=>{"use strict";var K0=ft(),J0=(n,e,t)=>K0(n,e,t)<0;cg.exports=J0});var Hc=T((SN,dg)=>{"use strict";var W0=ft(),Z0=(n,e,t)=>W0(n,e,t)===0;dg.exports=Z0});var Gc=T((CN,fg)=>{"use strict";var Y0=ft(),X0=(n,e,t)=>Y0(n,e,t)!==0;fg.exports=X0});var tu=T((RN,pg)=>{"use strict";var Q0=ft(),ex=(n,e,t)=>Q0(n,e,t)>=0;pg.exports=ex});var ru=T((kN,hg)=>{"use strict";var tx=ft(),rx=(n,e,t)=>tx(n,e,t)<=0;hg.exports=rx});var Kc=T((NN,mg)=>{"use strict";var nx=Hc(),sx=Gc(),ax=ei(),ix=tu(),ox=eu(),ux=ru(),lx=(n,e,t,r)=>{switch(e){case"===":return typeof n=="object"&&(n=n.version),typeof t=="object"&&(t=t.version),n===t;case"!==":return typeof n=="object"&&(n=n.version),typeof t=="object"&&(t=t.version),n!==t;case"":case"=":case"==":return nx(n,t,r);case"!=":return sx(n,t,r);case">":return ax(n,t,r);case">=":return ix(n,t,r);case"<":return ox(n,t,r);case"<=":return ux(n,t,r);default:throw new TypeError(`Invalid operator: ${e}`)}};mg.exports=lx});var yg=T(($N,gg)=>{"use strict";var cx=Ne(),dx=$n(),{safeRe:nu,t:su}=Ns(),fx=(n,e)=>{if(n instanceof cx)return n;if(typeof n=="number"&&(n=String(n)),typeof n!="string")return null;e=e||{};let t=null;if(!e.rtl)t=n.match(e.includePrerelease?nu[su.COERCEFULL]:nu[su.COERCE]);else{let u=e.includePrerelease?nu[su.COERCERTLFULL]:nu[su.COERCERTL],l;for(;(l=u.exec(n))&&(!t||t.index+t[0].length!==n.length);)(!t||l.index+l[0].length!==t.index+t[0].length)&&(t=l),u.lastIndex=l.index+l[1].length+l[2].length;u.lastIndex=-1}if(t===null)return null;let r=t[2],s=t[3]||"0",a=t[4]||"0",i=e.includePrerelease&&t[5]?`-${t[5]}`:"",o=e.includePrerelease&&t[6]?`+${t[6]}`:"";return dx(`${r}.${s}.${a}${i}${o}`,e)};gg.exports=fx});var _g=T((jN,bg)=>{"use strict";var Jc=class{constructor(){this.max=1e3,this.map=new Map}get(e){let t=this.map.get(e);if(t!==void 0)return this.map.delete(e),this.map.set(e,t),t}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&t!==void 0){if(this.map.size>=this.max){let s=this.map.keys().next().value;this.delete(s)}this.map.set(e,t)}return this}};bg.exports=Jc});var pt=T((MN,Ag)=>{"use strict";var px=/\s+/g,Wc=class n{constructor(e,t){if(t=mx(t),e instanceof n)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new n(e.raw,t);if(e instanceof Zc)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().replace(px," "),this.set=this.raw.split("||").map(r=>this.parseRange(r.trim())).filter(r=>r.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){let r=this.set[0];if(this.set=this.set.filter(s=>!vg(s[0])),this.set.length===0)this.set=[r];else if(this.set.length>1){for(let s of this.set)if(s.length===1&&xx(s[0])){this.set=[s];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");let t=this.set[e];for(let r=0;r<t.length;r++)r>0&&(this.formatted+=" "),this.formatted+=t[r].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){let r=((this.options.includePrerelease&&wx)|(this.options.loose&&vx))+":"+e,s=wg.get(r);if(s)return s;let a=this.options.loose,i=a?Ue[$e.HYPHENRANGELOOSE]:Ue[$e.HYPHENRANGE];e=e.replace(i,kx(this.options.includePrerelease)),ee("hyphen replace",e),e=e.replace(Ue[$e.COMPARATORTRIM],yx),ee("comparator trim",e),e=e.replace(Ue[$e.TILDETRIM],bx),ee("tilde trim",e),e=e.replace(Ue[$e.CARETTRIM],_x),ee("caret trim",e);let o=e.split(" ").map(d=>Ax(d,this.options)).join(" ").split(/\s+/).map(d=>Rx(d,this.options));a&&(o=o.filter(d=>(ee("loose invalid filter",d,this.options),!!d.match(Ue[$e.COMPARATORLOOSE])))),ee("range list",o);let u=new Map,l=o.map(d=>new Zc(d,this.options));for(let d of l){if(vg(d))return[d];u.set(d.value,d)}u.size>1&&u.has("")&&u.delete("");let c=[...u.values()];return wg.set(r,c),c}intersects(e,t){if(!(e instanceof n))throw new TypeError("a Range is required");return this.set.some(r=>xg(r,t)&&e.set.some(s=>xg(s,t)&&r.every(a=>s.every(i=>a.intersects(i,t)))))}test(e){if(!e)return!1;if(typeof e=="string")try{e=new gx(e,this.options)}catch{return!1}for(let t=0;t<this.set.length;t++)if(Nx(this.set[t],e,this.options))return!0;return!1}};Ag.exports=Wc;var hx=_g(),wg=new hx,mx=Jo(),Zc=ti(),ee=Qa(),gx=Ne(),{safeRe:Ue,t:$e,comparatorTrimReplace:yx,tildeTrimReplace:bx,caretTrimReplace:_x}=Ns(),{FLAG_INCLUDE_PRERELEASE:wx,FLAG_LOOSE:vx}=Xa(),vg=n=>n.value==="<0.0.0-0",xx=n=>n.value==="",xg=(n,e)=>{let t=!0,r=n.slice(),s=r.pop();for(;t&&r.length;)t=r.every(a=>s.intersects(a,e)),s=r.pop();return t},Ax=(n,e)=>(n=n.replace(Ue[$e.BUILD],""),ee("comp",n,e),n=Ix(n,e),ee("caret",n),n=Ex(n,e),ee("tildes",n),n=Tx(n,e),ee("xrange",n),n=Cx(n,e),ee("stars",n),n),Be=n=>!n||n.toLowerCase()==="x"||n==="*",Ex=(n,e)=>n.trim().split(/\s+/).map(t=>Ox(t,e)).join(" "),Ox=(n,e)=>{let t=e.loose?Ue[$e.TILDELOOSE]:Ue[$e.TILDE];return n.replace(t,(r,s,a,i,o)=>{ee("tilde",n,r,s,a,i,o);let u;return Be(s)?u="":Be(a)?u=`>=${s}.0.0 <${+s+1}.0.0-0`:Be(i)?u=`>=${s}.${a}.0 <${s}.${+a+1}.0-0`:o?(ee("replaceTilde pr",o),u=`>=${s}.${a}.${i}-${o} <${s}.${+a+1}.0-0`):u=`>=${s}.${a}.${i} <${s}.${+a+1}.0-0`,ee("tilde return",u),u})},Ix=(n,e)=>n.trim().split(/\s+/).map(t=>Px(t,e)).join(" "),Px=(n,e)=>{ee("caret",n,e);let t=e.loose?Ue[$e.CARETLOOSE]:Ue[$e.CARET],r=e.includePrerelease?"-0":"";return n.replace(t,(s,a,i,o,u)=>{ee("caret",n,s,a,i,o,u);let l;return Be(a)?l="":Be(i)?l=`>=${a}.0.0${r} <${+a+1}.0.0-0`:Be(o)?a==="0"?l=`>=${a}.${i}.0${r} <${a}.${+i+1}.0-0`:l=`>=${a}.${i}.0${r} <${+a+1}.0.0-0`:u?(ee("replaceCaret pr",u),a==="0"?i==="0"?l=`>=${a}.${i}.${o}-${u} <${a}.${i}.${+o+1}-0`:l=`>=${a}.${i}.${o}-${u} <${a}.${+i+1}.0-0`:l=`>=${a}.${i}.${o}-${u} <${+a+1}.0.0-0`):(ee("no pr"),a==="0"?i==="0"?l=`>=${a}.${i}.${o}${r} <${a}.${i}.${+o+1}-0`:l=`>=${a}.${i}.${o}${r} <${a}.${+i+1}.0-0`:l=`>=${a}.${i}.${o} <${+a+1}.0.0-0`),ee("caret return",l),l})},Tx=(n,e)=>(ee("replaceXRanges",n,e),n.split(/\s+/).map(t=>Sx(t,e)).join(" ")),Sx=(n,e)=>{n=n.trim();let t=e.loose?Ue[$e.XRANGELOOSE]:Ue[$e.XRANGE];return n.replace(t,(r,s,a,i,o,u)=>{ee("xRange",n,r,s,a,i,o,u);let l=Be(a),c=l||Be(i),d=c||Be(o),f=d;return s==="="&&f&&(s=""),u=e.includePrerelease?"-0":"",l?s===">"||s==="<"?r="<0.0.0-0":r="*":s&&f?(c&&(i=0),o=0,s===">"?(s=">=",c?(a=+a+1,i=0,o=0):(i=+i+1,o=0)):s==="<="&&(s="<",c?a=+a+1:i=+i+1),s==="<"&&(u="-0"),r=`${s+a}.${i}.${o}${u}`):c?r=`>=${a}.0.0${u} <${+a+1}.0.0-0`:d&&(r=`>=${a}.${i}.0${u} <${a}.${+i+1}.0-0`),ee("xRange return",r),r})},Cx=(n,e)=>(ee("replaceStars",n,e),n.trim().replace(Ue[$e.STAR],"")),Rx=(n,e)=>(ee("replaceGTE0",n,e),n.trim().replace(Ue[e.includePrerelease?$e.GTE0PRE:$e.GTE0],"")),kx=n=>(e,t,r,s,a,i,o,u,l,c,d,f)=>(Be(r)?t="":Be(s)?t=`>=${r}.0.0${n?"-0":""}`:Be(a)?t=`>=${r}.${s}.0${n?"-0":""}`:i?t=`>=${t}`:t=`>=${t}${n?"-0":""}`,Be(l)?u="":Be(c)?u=`<${+l+1}.0.0-0`:Be(d)?u=`<${l}.${+c+1}.0-0`:f?u=`<=${l}.${c}.${d}-${f}`:n?u=`<${l}.${c}.${+d+1}-0`:u=`<=${u}`,`${t} ${u}`.trim()),Nx=(n,e,t)=>{for(let r=0;r<n.length;r++)if(!n[r].test(e))return!1;if(e.prerelease.length&&!t.includePrerelease){for(let r=0;r<n.length;r++)if(ee(n[r].semver),n[r].semver!==Zc.ANY&&n[r].semver.prerelease.length>0){let s=n[r].semver;if(s.major===e.major&&s.minor===e.minor&&s.patch===e.patch)return!0}return!1}return!0}});var ti=T((LN,Sg)=>{"use strict";var ri=Symbol("SemVer ANY"),Qc=class n{static get ANY(){return ri}constructor(e,t){if(t=Eg(t),e instanceof n){if(e.loose===!!t.loose)return e;e=e.value}e=e.trim().split(/\s+/).join(" "),Xc("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===ri?this.value="":this.value=this.operator+this.semver.version,Xc("comp",this)}parse(e){let t=this.options.loose?Og[Ig.COMPARATORLOOSE]:Og[Ig.COMPARATOR],r=e.match(t);if(!r)throw new TypeError(`Invalid comparator: ${e}`);this.operator=r[1]!==void 0?r[1]:"",this.operator==="="&&(this.operator=""),r[2]?this.semver=new Pg(r[2],this.options.loose):this.semver=ri}toString(){return this.value}test(e){if(Xc("Comparator.test",e,this.options.loose),this.semver===ri||e===ri)return!0;if(typeof e=="string")try{e=new Pg(e,this.options)}catch{return!1}return Yc(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof n))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new Tg(e.value,t).test(this.value):e.operator===""?e.value===""?!0:new Tg(this.value,t).test(e.semver):(t=Eg(t),t.includePrerelease&&(this.value==="<0.0.0-0"||e.value==="<0.0.0-0")||!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&e.operator.startsWith(">")||this.operator.startsWith("<")&&e.operator.startsWith("<")||this.semver.version===e.semver.version&&this.operator.includes("=")&&e.operator.includes("=")||Yc(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<")||Yc(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))}};Sg.exports=Qc;var Eg=Jo(),{safeRe:Og,t:Ig}=Ns(),Yc=Kc(),Xc=Qa(),Pg=Ne(),Tg=pt()});var ni=T((DN,Cg)=>{"use strict";var $x=pt(),jx=(n,e,t)=>{try{e=new $x(e,t)}catch{return!1}return e.test(n)};Cg.exports=jx});var kg=T((FN,Rg)=>{"use strict";var Mx=pt(),Lx=(n,e)=>new Mx(n,e).set.map(t=>t.map(r=>r.value).join(" ").trim().split(" "));Rg.exports=Lx});var $g=T((UN,Ng)=>{"use strict";var Dx=Ne(),Fx=pt(),Ux=(n,e,t)=>{let r=null,s=null,a=null;try{a=new Fx(e,t)}catch{return null}return n.forEach(i=>{a.test(i)&&(!r||s.compare(i)===-1)&&(r=i,s=new Dx(r,t))}),r};Ng.exports=Ux});var Mg=T((BN,jg)=>{"use strict";var Bx=Ne(),zx=pt(),qx=(n,e,t)=>{let r=null,s=null,a=null;try{a=new zx(e,t)}catch{return null}return n.forEach(i=>{a.test(i)&&(!r||s.compare(i)===1)&&(r=i,s=new Bx(r,t))}),r};jg.exports=qx});var Fg=T((zN,Dg)=>{"use strict";var ed=Ne(),Vx=pt(),Lg=ei(),Hx=(n,e)=>{n=new Vx(n,e);let t=new ed("0.0.0");if(n.test(t)||(t=new ed("0.0.0-0"),n.test(t)))return t;t=null;for(let r=0;r<n.set.length;++r){let s=n.set[r],a=null;s.forEach(i=>{let o=new ed(i.semver.version);switch(i.operator){case">":o.prerelease.length===0?o.patch++:o.prerelease.push(0),o.raw=o.format();case"":case">=":(!a||Lg(o,a))&&(a=o);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${i.operator}`)}}),a&&(!t||Lg(t,a))&&(t=a)}return t&&n.test(t)?t:null};Dg.exports=Hx});var Bg=T((qN,Ug)=>{"use strict";var Gx=pt(),Kx=(n,e)=>{try{return new Gx(n,e).range||"*"}catch{return null}};Ug.exports=Kx});var au=T((VN,Hg)=>{"use strict";var Jx=Ne(),Vg=ti(),{ANY:Wx}=Vg,Zx=pt(),Yx=ni(),zg=ei(),qg=eu(),Xx=ru(),Qx=tu(),eA=(n,e,t,r)=>{n=new Jx(n,r),e=new Zx(e,r);let s,a,i,o,u;switch(t){case">":s=zg,a=Xx,i=qg,o=">",u=">=";break;case"<":s=qg,a=Qx,i=zg,o="<",u="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(Yx(n,e,r))return!1;for(let l=0;l<e.set.length;++l){let c=e.set[l],d=null,f=null;if(c.forEach(p=>{p.semver===Wx&&(p=new Vg(">=0.0.0")),d=d||p,f=f||p,s(p.semver,d.semver,r)?d=p:i(p.semver,f.semver,r)&&(f=p)}),d.operator===o||d.operator===u||(!f.operator||f.operator===o)&&a(n,f.semver))return!1;if(f.operator===u&&i(n,f.semver))return!1}return!0};Hg.exports=eA});var Kg=T((HN,Gg)=>{"use strict";var tA=au(),rA=(n,e,t)=>tA(n,e,">",t);Gg.exports=rA});var Wg=T((GN,Jg)=>{"use strict";var nA=au(),sA=(n,e,t)=>nA(n,e,"<",t);Jg.exports=sA});var Xg=T((KN,Yg)=>{"use strict";var Zg=pt(),aA=(n,e,t)=>(n=new Zg(n,t),e=new Zg(e,t),n.intersects(e,t));Yg.exports=aA});var ey=T((JN,Qg)=>{"use strict";var iA=ni(),oA=ft();Qg.exports=(n,e,t)=>{let r=[],s=null,a=null,i=n.sort((c,d)=>oA(c,d,t));for(let c of i)iA(c,e,t)?(a=c,s||(s=c)):(a&&r.push([s,a]),a=null,s=null);s&&r.push([s,null]);let o=[];for(let[c,d]of r)c===d?o.push(c):!d&&c===i[0]?o.push("*"):d?c===i[0]?o.push(`<=${d}`):o.push(`${c} - ${d}`):o.push(`>=${c}`);let u=o.join(" || "),l=typeof e.raw=="string"?e.raw:String(e);return u.length<l.length?u:e}});var iy=T((WN,ay)=>{"use strict";var ty=pt(),rd=ti(),{ANY:td}=rd,si=ni(),nd=ft(),uA=(n,e,t={})=>{if(n===e)return!0;n=new ty(n,t),e=new ty(e,t);let r=!1;e:for(let s of n.set){for(let a of e.set){let i=cA(s,a,t);if(r=r||i!==null,i)continue e}if(r)return!1}return!0},lA=[new rd(">=0.0.0-0")],ry=[new rd(">=0.0.0")],cA=(n,e,t)=>{if(n===e)return!0;if(n.length===1&&n[0].semver===td){if(e.length===1&&e[0].semver===td)return!0;t.includePrerelease?n=lA:n=ry}if(e.length===1&&e[0].semver===td){if(t.includePrerelease)return!0;e=ry}let r=new Set,s,a;for(let p of n)p.operator===">"||p.operator===">="?s=ny(s,p,t):p.operator==="<"||p.operator==="<="?a=sy(a,p,t):r.add(p.semver);if(r.size>1)return null;let i;if(s&&a){if(i=nd(s.semver,a.semver,t),i>0)return null;if(i===0&&(s.operator!==">="||a.operator!=="<="))return null}for(let p of r){if(s&&!si(p,String(s),t)||a&&!si(p,String(a),t))return null;for(let g of e)if(!si(p,String(g),t))return!1;return!0}let o,u,l,c,d=a&&!t.includePrerelease&&a.semver.prerelease.length?a.semver:!1,f=s&&!t.includePrerelease&&s.semver.prerelease.length?s.semver:!1;d&&d.prerelease.length===1&&a.operator==="<"&&d.prerelease[0]===0&&(d=!1);for(let p of e){if(c=c||p.operator===">"||p.operator===">=",l=l||p.operator==="<"||p.operator==="<=",s){if(f&&p.semver.prerelease&&p.semver.prerelease.length&&p.semver.major===f.major&&p.semver.minor===f.minor&&p.semver.patch===f.patch&&(f=!1),p.operator===">"||p.operator===">="){if(o=ny(s,p,t),o===p&&o!==s)return!1}else if(s.operator===">="&&!si(s.semver,String(p),t))return!1}if(a){if(d&&p.semver.prerelease&&p.semver.prerelease.length&&p.semver.major===d.major&&p.semver.minor===d.minor&&p.semver.patch===d.patch&&(d=!1),p.operator==="<"||p.operator==="<="){if(u=sy(a,p,t),u===p&&u!==a)return!1}else if(a.operator==="<="&&!si(a.semver,String(p),t))return!1}if(!p.operator&&(a||s)&&i!==0)return!1}return!(s&&l&&!a&&i!==0||a&&c&&!s&&i!==0||f||d)},ny=(n,e,t)=>{if(!n)return e;let r=nd(n.semver,e.semver,t);return r>0?n:r<0||e.operator===">"&&n.operator===">="?e:n},sy=(n,e,t)=>{if(!n)return e;let r=nd(n.semver,e.semver,t);return r<0?n:r>0||e.operator==="<"&&n.operator==="<="?e:n};ay.exports=uA});var cy=T((ZN,ly)=>{"use strict";var sd=Ns(),oy=Xa(),dA=Ne(),uy=zc(),fA=$n(),pA=$m(),hA=Mm(),mA=Fm(),gA=zm(),yA=Vm(),bA=Gm(),_A=Jm(),wA=Zm(),vA=ft(),xA=eg(),AA=rg(),EA=Qo(),OA=ig(),IA=ug(),PA=ei(),TA=eu(),SA=Hc(),CA=Gc(),RA=tu(),kA=ru(),NA=Kc(),$A=yg(),jA=ti(),MA=pt(),LA=ni(),DA=kg(),FA=$g(),UA=Mg(),BA=Fg(),zA=Bg(),qA=au(),VA=Kg(),HA=Wg(),GA=Xg(),KA=ey(),JA=iy();ly.exports={parse:fA,valid:pA,clean:hA,inc:mA,diff:gA,major:yA,minor:bA,patch:_A,prerelease:wA,compare:vA,rcompare:xA,compareLoose:AA,compareBuild:EA,sort:OA,rsort:IA,gt:PA,lt:TA,eq:SA,neq:CA,gte:RA,lte:kA,cmp:NA,coerce:$A,Comparator:jA,Range:MA,satisfies:LA,toComparators:DA,maxSatisfying:FA,minSatisfying:UA,minVersion:BA,validRange:zA,outside:qA,gtr:VA,ltr:HA,intersects:GA,simplifyRange:KA,subset:JA,SemVer:dA,re:sd.re,src:sd.src,tokens:sd.t,SEMVER_SPEC_VERSION:oy.SEMVER_SPEC_VERSION,RELEASE_TYPES:oy.RELEASE_TYPES,compareIdentifiers:uy.compareIdentifiers,rcompareIdentifiers:uy.rcompareIdentifiers}});function dy(n,e){let t=(0,ad.parse)(n),r=(0,ad.parse)(e);if(!t||!r)throw new Error("Invalid version format.");return t.compare(r)>=0}function gr(n){if(!n||n.split("/").length>2||n.startsWith("/")||n.endsWith("/")||n.split(":").length>2)throw new Error(`Invalid identifier format: ${n}`);let[e,t]=n.split(":"),r=t||"latest";if(e.includes("/")){let[s,a]=e.split("/",2);if(!s||!a)throw new Error(`Invalid identifier format: ${n}`);return[s,a,r]}else{if(!e)throw new Error(`Invalid identifier format: ${n}`);return["-",e,r]}}var ad,fy=h(()=>{ad=at(cy(),1)});async function q(n,e,t){let r;if(n.ok){t&&(r=await n.text());return}r=await n.text();let s=`Failed to ${e}. Received status [${n.status}]: ${n.statusText}. Server response: ${r}`;throw n.status===409?new id(s):new Error(s)}var id,py=h(()=>{id=class extends Error{constructor(e){super(e),this.name="LangSmithConflictError"}}});function ZA(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function jn(n,e,t,r){try{return JSON.stringify(n,e,t)}catch(i){if(!i.message?.includes("Converting circular structure to JSON"))return console.warn("[WARNING]: LangSmith received unserializable value."),"[Unserializable]";console.warn("[WARNING]: LangSmith received circular JSON. This will decrease tracer performance."),typeof r>"u"&&(r=ZA()),ud(n,"",0,[],void 0,0,r);var s;try{$s.length===0?s=JSON.stringify(n,e,t):s=JSON.stringify(n,YA(e),t)}catch{return JSON.stringify("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;iu.length!==0;){var a=iu.pop();a.length===4?Object.defineProperty(a[0],a[1],a[3]):a[0][a[1]]=a[2]}}return s}}function od(n,e,t,r){var s=Object.getOwnPropertyDescriptor(r,t);s.get!==void 0?s.configurable?(Object.defineProperty(r,t,{value:n}),iu.push([r,t,e,s])):$s.push([e,t,n]):(r[t]=n,iu.push([r,t,e]))}function ud(n,e,t,r,s,a,i){a+=1;var o;if(typeof n=="object"&&n!==null){for(o=0;o<r.length;o++)if(r[o]===n){od(WA,n,e,s);return}if(typeof i.depthLimit<"u"&&a>i.depthLimit){od(hy,n,e,s);return}if(typeof i.edgesLimit<"u"&&t+1>i.edgesLimit){od(hy,n,e,s);return}if(r.push(n),Array.isArray(n))for(o=0;o<n.length;o++)ud(n[o],o,o,r,n,a,i);else{var u=Object.keys(n);for(o=0;o<u.length;o++){var l=u[o];ud(n[l],l,o,r,n,a,i)}}r.pop()}}function YA(n){return n=typeof n<"u"?n:function(e,t){return t},function(e,t){if($s.length>0)for(var r=0;r<$s.length;r++){var s=$s[r];if(s[1]===e&&s[0]===t){t=s[2],$s.splice(r,1);break}}return n.call(this,e,t)}}var hy,WA,iu,$s,my=h(()=>{hy="[...]",WA={result:"[Circular]"},iu=[],$s=[]});function gy(n){let e=lu(),t=yy(),r=n.extra??{},s=r.metadata;return n.extra={...r,runtime:{...e,...r?.runtime},metadata:{...t,...t.revision_id||n.revision_id?{revision_id:n.revision_id??t.revision_id}:{},...s}},n}async function eE(n){let e=[];for await(let t of n)e.push(t);return e}function ld(n){if(n!==void 0)return n.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}var XA,QA,tE,cd,rE,nE,Mn,dd=h(()=>{Fo();bm();_m();cu();uu();wm();Fc();fy();py();Ho();my();XA=()=>{let n=yr("TRACING_SAMPLING_RATE");if(n===void 0)return;let e=parseFloat(n);if(e<0||e>1)throw new Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${e}`);return e},QA=n=>{let t=n.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return t==="localhost"||t==="127.0.0.1"||t==="::1"};tE=async n=>{if(n?.status===429){let e=parseInt(n.headers.get("retry-after")??"30",10)*1e3;if(e>0)return await new Promise(t=>setTimeout(t,e)),!0}return!1},cd=class{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0})}peek(){return this.items[0]}push(e){let t,r=new Promise(a=>{t=a}),s=jn(e.item).length;return this.items.push({action:e.action,payload:e.item,itemPromiseResolve:t,itemPromise:r,size:s}),this.sizeBytes+=s,r}pop(e){if(e<1)throw new Error("Number of bytes to pop off may not be less than 1.");let t=[],r=0;for(;r+(this.peek()?.size??0)<e&&this.items.length>0;){let s=this.items.shift();s&&(t.push(s),r+=s.size,this.sizeBytes-=s.size)}if(t.length===0&&this.items.length>0){let s=this.items.shift();t.push(s),r+=s.size,this.sizeBytes-=s.size}return[t.map(s=>({action:s.action,item:s.payload})),()=>t.forEach(s=>s.itemPromiseResolve())]}},rE=20971520,nE=1e3,Mn=class n{constructor(e={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new cd}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchInitialDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:50}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let t=n.getDefaultClientConfig();this.tracingSampleRate=XA(),this.apiUrl=ld(e.apiUrl??t.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=ld(e.apiKey??t.apiKey),this.webUrl=ld(e.webUrl??t.webUrl),this.webUrl?.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.timeout_ms=e.timeout_ms??12e3,this.caller=new Ya(e.callerOptions??{}),this.batchIngestCaller=new Ya({...e.callerOptions??{},onFailedResponseHook:tE}),this.hideInputs=e.hideInputs??e.anonymizer??t.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??t.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.blockOnRootRunFinalization=e.blockOnRootRunFinalization??this.blockOnRootRunFinalization,this.batchSizeBytesLimit=e.batchSizeBytesLimit,this.fetchOptions=e.fetchOptions||{}}static getDefaultClientConfig(){let e=yr("API_KEY"),t=yr("ENDPOINT")??"https://api.smith.langchain.com",r=yr("HIDE_INPUTS")==="true",s=yr("HIDE_OUTPUTS")==="true";return{apiUrl:t,apiKey:e,webUrl:void 0,hideInputs:r,hideOutputs:s}}getHostUrl(){return this.webUrl?this.webUrl:QA(this.apiUrl)?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("eu")?(this.webUrl="https://eu.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){let e={"User-Agent":`langsmith-js/${ou}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}processInputs(e){return this.hideInputs===!1?e:this.hideInputs===!0?{}:typeof this.hideInputs=="function"?this.hideInputs(e):e}processOutputs(e){return this.hideOutputs===!1?e:this.hideOutputs===!0?{}:typeof this.hideOutputs=="function"?this.hideOutputs(e):e}prepareRunCreateOrUpdateInputs(e){let t={...e};return t.inputs!==void 0&&(t.inputs=this.processInputs(t.inputs)),t.outputs!==void 0&&(t.outputs=this.processOutputs(t.outputs)),t}async _getResponse(e,t){let r=t?.toString()??"",s=`${this.apiUrl}${e}?${r}`,a=await this.caller.call($(),s,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(a,`Failed to fetch ${e}`),a}async _get(e,t){return(await this._getResponse(e,t)).json()}async*_getPaginated(e,t=new URLSearchParams,r){let s=Number(t.get("offset"))||0,a=Number(t.get("limit"))||100;for(;;){t.set("offset",String(s)),t.set("limit",String(a));let i=`${this.apiUrl}${e}?${t}`,o=await this.caller.call($(),i,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await q(o,`Failed to fetch ${e}`);let u=r?r(await o.json()):await o.json();if(u.length===0||(yield u,u.length<a))break;s+=u.length}}async*_getCursorPaginatedList(e,t=null,r="POST",s="runs"){let a=t?{...t}:{};for(;;){let o=await(await this.caller.call($(),`${this.apiUrl}${e}`,{method:r,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:JSON.stringify(a)})).json();if(!o||!o[s])break;yield o[s];let u=o.cursors;if(!u||!u.next)break;a.cursor=u.next}}_filterForSampling(e,t=!1){if(this.tracingSampleRate===void 0)return e;if(t){let r=[];for(let s of e)this.filteredPostUuids.has(s.id)?this.filteredPostUuids.delete(s.id):r.push(s);return r}else{let r=[];for(let s of e)s.id!==s.trace_id&&!this.filteredPostUuids.has(s.trace_id)||Math.random()<this.tracingSampleRate?r.push(s):this.filteredPostUuids.add(s.id);return r}}async _getBatchSizeLimitBytes(){let e=await this._ensureServerInfo();return this.batchSizeBytesLimit??e.batch_ingest_config?.size_limit_bytes??rE}async drainAutoBatchQueue(){for(;this.autoBatchQueue.items.length>=0;){let[e,t]=this.autoBatchQueue.pop(await this._getBatchSizeLimitBytes());if(!e.length){t();return}try{let r={runCreates:e.filter(a=>a.action==="create").map(a=>a.item),runUpdates:e.filter(a=>a.action==="update").map(a=>a.item)};(await this._ensureServerInfo())?.batch_ingest_config?.use_multipart_endpoint?await this.multipartIngestRuns(r):await this.batchIngestRuns(r)}finally{t()}}}async processRunOperation(e,t){let r=this.autoBatchTimeout;clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,e.action==="create"&&(e.item=gy(e.item));let s=this.autoBatchQueue.push(e),a=await this._getBatchSizeLimitBytes();return(t||this.autoBatchQueue.sizeBytes>a)&&await this.drainAutoBatchQueue().catch(console.error),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue().catch(console.error)},r?this.autoBatchAggregationDelayMs:this.autoBatchInitialDelayMs)),s}async _getServerInfo(){let e=await $()(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(nE),...this.fetchOptions});return await q(e,"get server info"),e.json()}async _ensureServerInfo(){return this._getServerInfoPromise===void 0&&(this._getServerInfoPromise=(async()=>{if(this._serverInfo===void 0)try{this._serverInfo=await this._getServerInfo()}catch{console.warn("[WARNING]: LangSmith failed to fetch info on supported operations. Falling back to single calls and default limits.")}return this._serverInfo??{}})()),this._getServerInfoPromise.then(e=>(this._serverInfo===void 0&&(this._getServerInfoPromise=void 0),e))}async _getSettings(){return this.settings||(this.settings=this._get("/settings")),await this.settings}async createRun(e){if(!this._filterForSampling([e]).length)return;let t={...this.headers,"Content-Type":"application/json"},r=e.project_name;delete e.project_name;let s=this.prepareRunCreateOrUpdateInputs({session_name:r,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&s.trace_id!==void 0&&s.dotted_order!==void 0){this.processRunOperation({action:"create",item:s}).catch(console.error);return}let a=gy(s),i=await this.caller.call($(),`${this.apiUrl}/runs`,{method:"POST",headers:t,body:jn(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await q(i,"create run",!0)}async batchIngestRuns({runCreates:e,runUpdates:t}){if(e===void 0&&t===void 0)return;let r=e?.map(u=>this.prepareRunCreateOrUpdateInputs(u))??[],s=t?.map(u=>this.prepareRunCreateOrUpdateInputs(u))??[];if(r.length>0&&s.length>0){let u=r.reduce((c,d)=>(d.id&&(c[d.id]=d),c),{}),l=[];for(let c of s)c.id!==void 0&&u[c.id]?u[c.id]={...u[c.id],...c}:l.push(c);r=Object.values(u),s=l}let a={post:this._filterForSampling(r),patch:this._filterForSampling(s,!0)};if(!a.post.length&&!a.patch.length)return;if((await this._ensureServerInfo()).version===void 0){this.autoBatchTracing=!1;for(let u of a.post)await this.createRun(u);for(let u of a.patch)u.id!==void 0&&await this.updateRun(u.id,u);return}let o={post:[],patch:[]};for(let u of["post","patch"]){let l=u,c=a[l].reverse(),d=c.pop();for(;d!==void 0;)o[l].push(d),d=c.pop()}(o.post.length>0||o.patch.length>0)&&await this._postBatchIngestRuns(jn(o))}async _postBatchIngestRuns(e){let t={...this.headers,"Content-Type":"application/json",Accept:"application/json"},r=await this.batchIngestCaller.call($(),`${this.apiUrl}/runs/batch`,{method:"POST",headers:t,body:e,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await q(r,"batch create run",!0)}async multipartIngestRuns({runCreates:e,runUpdates:t}){if(e===void 0&&t===void 0)return;let r={},s=[];for(let c of e??[]){let d=this.prepareRunCreateOrUpdateInputs(c);d.id!==void 0&&d.attachments!==void 0&&(r[d.id]=d.attachments),delete d.attachments,s.push(d)}let a=[];for(let c of t??[])a.push(this.prepareRunCreateOrUpdateInputs(c));if(s.find(c=>c.trace_id===void 0||c.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(a.find(c=>c.trace_id===void 0||c.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(s.length>0&&a.length>0){let c=s.reduce((f,p)=>(p.id&&(f[p.id]=p),f),{}),d=[];for(let f of a)f.id!==void 0&&c[f.id]?c[f.id]={...c[f.id],...f}:d.push(f);s=Object.values(c),a=d}if(s.length===0&&a.length===0)return;let u=[],l=[];for(let[c,d]of[["post",s],["patch",a]])for(let f of d){let{inputs:p,outputs:g,events:m,...y}=f,x={inputs:p,outputs:g,events:m},w=jn(y);l.push({name:`${c}.${y.id}`,payload:new Blob([w],{type:`application/json; length=${w.length}`})});for(let[A,k]of Object.entries(x)){if(k===void 0)continue;let R=jn(k);l.push({name:`${c}.${y.id}.${A}`,payload:new Blob([R],{type:`application/json; length=${R.length}`})})}if(y.id!==void 0){let A=r[y.id];if(A){delete r[y.id];for(let[k,[R,W]]of Object.entries(A))l.push({name:`attachment.${y.id}.${k}`,payload:new Blob([W],{type:`${R}; length=${W.length}`})})}}u.push(`trace=${y.trace_id},id=${y.id}`)}await this._sendMultipartRequest(l,u.join("; "))}async _sendMultipartRequest(e,t){try{let r=new FormData;for(let s of e)r.append(s.name,s.payload);await this.batchIngestCaller.call($(),`${this.apiUrl}/runs/multipart`,{method:"POST",headers:{...this.headers},body:r,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})}catch(r){let s="Failed to multipart ingest runs";r instanceof Error?s+=`: ${r.stack||r.message}`:s+=`: ${String(r)}`,console.warn(`${s.trim()}

Context: ${t}`)}}async updateRun(e,t){G(e),t.inputs&&(t.inputs=this.processInputs(t.inputs)),t.outputs&&(t.outputs=this.processOutputs(t.outputs));let r={...t,id:e};if(!this._filterForSampling([r],!0).length)return;if(this.autoBatchTracing&&r.trace_id!==void 0&&r.dotted_order!==void 0){if(t.end_time!==void 0&&r.parent_run_id===void 0&&this.blockOnRootRunFinalization){await this.processRunOperation({action:"update",item:r},!0);return}else this.processRunOperation({action:"update",item:r}).catch(console.error);return}let s={...this.headers,"Content-Type":"application/json"},a=await this.caller.call($(),`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:s,body:jn(t),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await q(a,"update run",!0)}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){G(e);let r=await this._get(`/runs/${e}`);return t&&r.child_run_ids&&(r=await this._loadChildRuns(r)),r}async getRunUrl({runId:e,run:t,projectOpts:r}){if(t!==void 0){let s;t.session_id?s=t.session_id:r?.projectName?s=(await this.readProject({projectName:r?.projectName})).id:r?.projectId?s=r?.projectId:s=(await this.readProject({projectName:yr("PROJECT")||"default"})).id;let a=await this._getTenantId();return`${this.getHostUrl()}/o/${a}/projects/p/${s}/r/${t.id}?poll=true`}else if(e!==void 0){let s=await this.readRun(e);if(!s.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${s.app_path}`}else throw new Error("Must provide either runId or run")}async _loadChildRuns(e){let t=await eE(this.listRuns({id:e.child_run_ids})),r={},s={};t.sort((a,i)=>(a?.dotted_order??"").localeCompare(i?.dotted_order??""));for(let a of t){if(a.parent_run_id===null||a.parent_run_id===void 0)throw new Error(`Child run ${a.id} has no parent`);a.parent_run_id in r||(r[a.parent_run_id]=[]),r[a.parent_run_id].push(a),s[a.id]=a}e.child_runs=r[e.id]||[];for(let a in r)a!==e.id&&(s[a].child_runs=r[a]);return e}async*listRuns(e){let{projectId:t,projectName:r,parentRunId:s,traceId:a,referenceExampleId:i,startTime:o,executionOrder:u,isRoot:l,runType:c,error:d,id:f,query:p,filter:g,traceFilter:m,treeFilter:y,limit:x,select:w}=e,A=[];if(t&&(A=Array.isArray(t)?t:[t]),r){let Y=Array.isArray(r)?r:[r],Z=await Promise.all(Y.map(oe=>this.readProject({projectName:oe}).then(ne=>ne.id)));A.push(...Z)}let k=["app_path","child_run_ids","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],R={session:A.length?A:null,run_type:c,reference_example:i,query:p,filter:g,trace_filter:m,tree_filter:y,execution_order:u,parent_run:s,start_time:o?o.toISOString():null,error:d,id:f,limit:x,trace:a,select:w||k,is_root:l},W=0;for await(let Y of this._getCursorPaginatedList("/runs/query",R))if(x){if(W>=x)break;if(Y.length+W>x){yield*Y.slice(0,x-W);break}W+=Y.length,yield*Y}else yield*Y}async getRunStats({id:e,trace:t,parentRun:r,runType:s,projectNames:a,projectIds:i,referenceExampleIds:o,startTime:u,endTime:l,error:c,query:d,filter:f,traceFilter:p,treeFilter:g,isRoot:m,dataSourceType:y}){let x=i||[];a&&(x=[...i||[],...await Promise.all(a.map(W=>this.readProject({projectName:W}).then(Y=>Y.id)))]);let A=Object.fromEntries(Object.entries({id:e,trace:t,parent_run:r,run_type:s,session:x,reference_example:o,start_time:u,end_time:l,error:c,query:d,filter:f,trace_filter:p,tree_filter:g,is_root:m,data_source_type:y}).filter(([W,Y])=>Y!==void 0));return await(await this.caller.call($(),`${this.apiUrl}/runs/stats`,{method:"POST",headers:this.headers,body:JSON.stringify(A),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async shareRun(e,{shareId:t}={}){let r={run_id:e,share_token:t||Nn()};G(e);let a=await(await this.caller.call($(),`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(a===null||!("share_token"in a))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${a.share_token}/r`}async unshareRun(e){G(e);let t=await this.caller.call($(),`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await q(t,"unshare run",!0)}async readRunSharedLink(e){G(e);let r=await(await this.caller.call($(),`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(!(r===null||!("share_token"in r)))return`${this.getHostUrl()}/public/${r.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){let r=new URLSearchParams({share_token:e});if(t!==void 0)for(let i of t)r.append("id",i);return G(e),await(await this.caller.call($(),`${this.apiUrl}/public/${e}/runs${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),G(e);let s=await(await this.caller.call($(),`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return s.url=`${this.getHostUrl()}/public/${s.share_token}/d`,s}async shareDataset(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);let r={dataset_id:e};G(e);let a=await(await this.caller.call($(),`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return a.url=`${this.getHostUrl()}/public/${a.share_token}/d`,a}async unshareDataset(e){G(e);let t=await this.caller.call($(),`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await q(t,"unshare dataset",!0)}async readSharedDataset(e){return G(e),await(await this.caller.call($(),`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async listSharedExamples(e,t){let r={};t?.exampleIds&&(r.id=t.exampleIds);let s=new URLSearchParams;Object.entries(r).forEach(([o,u])=>{Array.isArray(u)?u.forEach(l=>s.append(o,l)):s.append(o,u)});let a=await this.caller.call($(),`${this.apiUrl}/public/${e}/examples?${s.toString()}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),i=await a.json();if(!a.ok)throw"detail"in i?new Error(`Failed to list shared examples.
Status: ${a.status}
Message: ${i.detail.join(`
`)}`):new Error(`Failed to list shared examples: ${a.status} ${a.statusText}`);return i.map(o=>({...o,_hostUrl:this.getHostUrl()}))}async createProject({projectName:e,description:t=null,metadata:r=null,upsert:s=!1,projectExtra:a=null,referenceDatasetId:i=null}){let o=s?"?upsert=true":"",u=`${this.apiUrl}/sessions${o}`,l=a||{};r&&(l.metadata=r);let c={name:e,extra:l,description:t};i!==null&&(c.reference_dataset_id=i);let d=await this.caller.call($(),u,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(d,"create project"),await d.json()}async updateProject(e,{name:t=null,description:r=null,metadata:s=null,projectExtra:a=null,endTime:i=null}){let o=`${this.apiUrl}/sessions/${e}`,u=a;s&&(u={...u||{},metadata:s});let l={name:t,extra:u,description:r,end_time:i?new Date(i).toISOString():null},c=await this.caller.call($(),o,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(c,"update project"),await c.json()}async hasProject({projectId:e,projectName:t}){let r="/sessions",s=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)G(e),r+=`/${e}`;else if(t!==void 0)s.append("name",t);else throw new Error("Must provide projectName or projectId");let a=await this.caller.call($(),`${this.apiUrl}${r}?${s}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});try{let i=await a.json();return a.ok?Array.isArray(i)?i.length>0:!0:!1}catch{return!1}}async readProject({projectId:e,projectName:t,includeStats:r}){let s="/sessions",a=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)G(e),s+=`/${e}`;else if(t!==void 0)a.append("name",t);else throw new Error("Must provide projectName or projectId");r!==void 0&&a.append("include_stats",r.toString());let i=await this._get(s,a),o;if(Array.isArray(i)){if(i.length===0)throw new Error(`Project[id=${e}, name=${t}] not found`);o=i[0]}else o=i;return o}async getProjectUrl({projectId:e,projectName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either projectName or projectId");let r=await this.readProject({projectId:e,projectName:t}),s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/projects/p/${r.id}`}async getDatasetUrl({datasetId:e,datasetName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");let r=await this.readDataset({datasetId:e,datasetName:t}),s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/datasets/${r.id}`}async _getTenantId(){if(this._tenantId!==null)return this._tenantId;let e=new URLSearchParams({limit:"1"});for await(let t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:t,nameContains:r,referenceDatasetId:s,referenceDatasetName:a,referenceFree:i,metadata:o}={}){let u=new URLSearchParams;if(e!==void 0)for(let l of e)u.append("id",l);if(t!==void 0&&u.append("name",t),r!==void 0&&u.append("name_contains",r),s!==void 0)u.append("reference_dataset",s);else if(a!==void 0){let l=await this.readDataset({datasetName:a});u.append("reference_dataset",l.id)}i!==void 0&&u.append("reference_free",i.toString()),o!==void 0&&u.append("metadata",JSON.stringify(o));for await(let l of this._getPaginated("/sessions",u))yield*l}async deleteProject({projectId:e,projectName:t}){let r;if(e===void 0&&t===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?r=(await this.readProject({projectName:t})).id:r=e,G(r);let s=await this.caller.call($(),`${this.apiUrl}/sessions/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await q(s,`delete session ${r} (${t})`,!0)}async uploadCsv({csvFile:e,fileName:t,inputKeys:r,outputKeys:s,description:a,dataType:i,name:o}){let u=`${this.apiUrl}/datasets/upload`,l=new FormData;l.append("file",e,t),r.forEach(f=>{l.append("input_keys",f)}),s.forEach(f=>{l.append("output_keys",f)}),a&&l.append("description",a),i&&l.append("data_type",i),o&&l.append("name",o);let c=await this.caller.call($(),u,{method:"POST",headers:this.headers,body:l,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(c,"upload CSV"),await c.json()}async createDataset(e,{description:t,dataType:r,inputsSchema:s,outputsSchema:a,metadata:i}={}){let o={name:e,description:t,extra:i?{metadata:i}:void 0};r&&(o.data_type=r),s&&(o.inputs_schema_definition=s),a&&(o.outputs_schema_definition=a);let u=await this.caller.call($(),`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(u,"create dataset"),await u.json()}async readDataset({datasetId:e,datasetName:t}){let r="/datasets",s=new URLSearchParams({limit:"1"});if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)G(e),r+=`/${e}`;else if(t!==void 0)s.append("name",t);else throw new Error("Must provide datasetName or datasetId");let a=await this._get(r,s),i;if(Array.isArray(a)){if(a.length===0)throw new Error(`Dataset[id=${e}, name=${t}] not found`);i=a[0]}else i=a;return i}async hasDataset({datasetId:e,datasetName:t}){try{return await this.readDataset({datasetId:e,datasetName:t}),!0}catch(r){if(r instanceof Error&&r.message.toLocaleLowerCase().includes("not found"))return!1;throw r}}async diffDatasetVersions({datasetId:e,datasetName:t,fromVersion:r,toVersion:s}){let a=e;if(a===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");if(a!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");a===void 0&&(a=(await this.readDataset({datasetName:t})).id);let i=new URLSearchParams({from_version:typeof r=="string"?r:r.toISOString(),to_version:typeof s=="string"?s:s.toISOString()});return await this._get(`/datasets/${a}/versions/diff`,i)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){let r="/datasets";if(e===void 0)if(t!==void 0)e=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide datasetName or datasetId");return(await(await this._getResponse(`${r}/${e}/openai_ft`)).text()).trim().split(`
`).map(o=>JSON.parse(o))}async*listDatasets({limit:e=100,offset:t=0,datasetIds:r,datasetName:s,datasetNameContains:a,metadata:i}={}){let o="/datasets",u=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(r!==void 0)for(let l of r)u.append("id",l);s!==void 0&&u.append("name",s),a!==void 0&&u.append("name_contains",a),i!==void 0&&u.append("metadata",JSON.stringify(i));for await(let l of this._getPaginated(o,u))yield*l}async updateDataset(e){let{datasetId:t,datasetName:r,...s}=e;if(!t&&!r)throw new Error("Must provide either datasetName or datasetId");let a=t??(await this.readDataset({datasetName:r})).id;G(a);let i=await this.caller.call($(),`${this.apiUrl}/datasets/${a}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(i,"update dataset"),await i.json()}async deleteDataset({datasetId:e,datasetName:t}){let r="/datasets",s=e;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(t!==void 0&&(s=(await this.readDataset({datasetName:t})).id),s!==void 0)G(s),r+=`/${s}`;else throw new Error("Must provide datasetName or datasetId");let a=await this.caller.call($(),this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await q(a,`delete ${r}`),await a.json()}async indexDataset({datasetId:e,datasetName:t,tag:r}){let s=e;if(!s&&!t)throw new Error("Must provide either datasetName or datasetId");if(s&&t)throw new Error("Must provide either datasetName or datasetId, not both");s||(s=(await this.readDataset({datasetName:t})).id),G(s);let a={tag:r},i=await this.caller.call($(),`${this.apiUrl}/datasets/${s}/index`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await q(i,"index dataset"),await i.json()}async similarExamples(e,t,r,{filter:s}={}){let a={limit:r,inputs:e};s!==void 0&&(a.filter=s),G(t);let i=await this.caller.call($(),`${this.apiUrl}/datasets/${t}/search`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(i,"fetch similar examples"),(await i.json()).examples}async createExample(e,t,{datasetId:r,datasetName:s,createdAt:a,exampleId:i,metadata:o,split:u,sourceRunId:l}){let c=r;if(c===void 0&&s===void 0)throw new Error("Must provide either datasetName or datasetId");if(c!==void 0&&s!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");c===void 0&&(c=(await this.readDataset({datasetName:s})).id);let f={dataset_id:c,inputs:e,outputs:t,created_at:(a||new Date)?.toISOString(),id:i,metadata:o,split:u,source_run_id:l},p=await this.caller.call($(),`${this.apiUrl}/examples`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(f),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(p,"create example"),await p.json()}async createExamples(e){let{inputs:t,outputs:r,metadata:s,sourceRunIds:a,exampleIds:i,datasetId:o,datasetName:u}=e,l=o;if(l===void 0&&u===void 0)throw new Error("Must provide either datasetName or datasetId");if(l!==void 0&&u!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");l===void 0&&(l=(await this.readDataset({datasetName:u})).id);let c=t.map((p,g)=>({dataset_id:l,inputs:p,outputs:r?r[g]:void 0,metadata:s?s[g]:void 0,split:e.splits?e.splits[g]:void 0,id:i?i[g]:void 0,source_run_id:a?a[g]:void 0})),d=await this.caller.call($(),`${this.apiUrl}/examples/bulk`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(d,"create examples"),await d.json()}async createLLMExample(e,t,r){return this.createExample({input:e},{output:t},r)}async createChatExample(e,t,r){let s=e.map(i=>Lc(i)?Dc(i):i),a=Lc(t)?Dc(t):t;return this.createExample({input:s},{output:a},r)}async readExample(e){G(e);let t=`/examples/${e}`;return await this._get(t)}async*listExamples({datasetId:e,datasetName:t,exampleIds:r,asOf:s,splits:a,inlineS3Urls:i,metadata:o,limit:u,offset:l,filter:c}={}){let d;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)d=e;else if(t!==void 0)d=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide a datasetName or datasetId");let f=new URLSearchParams({dataset:d}),p=s?typeof s=="string"?s:s?.toISOString():void 0;p&&f.append("as_of",p);let g=i??!0;if(f.append("inline_s3_urls",g.toString()),r!==void 0)for(let y of r)f.append("id",y);if(a!==void 0)for(let y of a)f.append("splits",y);if(o!==void 0){let y=JSON.stringify(o);f.append("metadata",y)}u!==void 0&&f.append("limit",u.toString()),l!==void 0&&f.append("offset",l.toString()),c!==void 0&&f.append("filter",c);let m=0;for await(let y of this._getPaginated("/examples",f)){for(let x of y)yield x,m++;if(u!==void 0&&m>=u)break}}async deleteExample(e){G(e);let t=`/examples/${e}`,r=await this.caller.call($(),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await q(r,`delete ${t}`),await r.json()}async updateExample(e,t){G(e);let r=await this.caller.call($(),`${this.apiUrl}/examples/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(r,"update example"),await r.json()}async updateExamples(e){let t=await this.caller.call($(),`${this.apiUrl}/examples/bulk`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(e),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(t,"update examples"),await t.json()}async listDatasetSplits({datasetId:e,datasetName:t,asOf:r}){let s;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?s=(await this.readDataset({datasetName:t})).id:s=e,G(s);let a=new URLSearchParams,i=r?typeof r=="string"?r:r?.toISOString():void 0;return i&&a.append("as_of",i),await this._get(`/datasets/${s}/splits`,a)}async updateDatasetSplits({datasetId:e,datasetName:t,splitName:r,exampleIds:s,remove:a=!1}){let i;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?i=(await this.readDataset({datasetName:t})).id:i=e,G(i);let o={split_name:r,examples:s.map(l=>(G(l),l)),remove:a},u=await this.caller.call($(),`${this.apiUrl}/datasets/${i}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await q(u,"update dataset splits",!0)}async evaluateRun(e,t,{sourceInfo:r,loadChildRuns:s,referenceExample:a}={loadChildRuns:!1}){Ko("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead.");let i;if(typeof e=="string")i=await this.readRun(e,{loadChildRuns:s});else if(typeof e=="object"&&"id"in e)i=e;else throw new Error(`Invalid run type: ${typeof e}`);i.reference_example_id!==null&&i.reference_example_id!==void 0&&(a=await this.readExample(i.reference_example_id));let o=await t.evaluateRun(i,a),[u,l]=await this._logEvaluationFeedback(o,i,r);return l[0]}async createFeedback(e,t,{score:r,value:s,correction:a,comment:i,sourceInfo:o,feedbackSourceType:u="api",sourceRunId:l,feedbackId:c,feedbackConfig:d,projectId:f,comparativeExperimentId:p}){if(!e&&!f)throw new Error("One of runId or projectId must be provided");if(e&&f)throw new Error("Only one of runId or projectId can be provided");let g={type:u??"api",metadata:o??{}};l!==void 0&&g?.metadata!==void 0&&!g.metadata.__run&&(g.metadata.__run={run_id:l}),g?.metadata!==void 0&&g.metadata.__run?.run_id!==void 0&&G(g.metadata.__run.run_id);let m={id:c??Nn(),run_id:e,key:t,score:r,value:s,correction:a,comment:i,feedback_source:g,comparative_experiment_id:p,feedbackConfig:d,session_id:f},y=`${this.apiUrl}/feedback`,x=await this.caller.call($(),y,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(m),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(x,"create feedback",!0),m}async updateFeedback(e,{score:t,value:r,correction:s,comment:a}){let i={};t!=null&&(i.score=t),r!=null&&(i.value=r),s!=null&&(i.correction=s),a!=null&&(i.comment=a),G(e);let o=await this.caller.call($(),`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await q(o,"update feedback",!0)}async readFeedback(e){G(e);let t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){G(e);let t=`/feedback/${e}`,r=await this.caller.call($(),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await q(r,`delete ${t}`),await r.json()}async*listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:r}={}){let s=new URLSearchParams;if(e&&s.append("run",e.join(",")),t)for(let a of t)s.append("key",a);if(r)for(let a of r)s.append("source",a);for await(let a of this._getPaginated("/feedback",s))yield*a}async createPresignedFeedbackToken(e,t,{expiration:r,feedbackConfig:s}={}){let a={run_id:e,feedback_key:t,feedback_config:s};return r?typeof r=="string"?a.expires_at=r:(r?.hours||r?.minutes||r?.days)&&(a.expires_in=r):a.expires_in={hours:3},await(await this.caller.call($(),`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async createComparativeExperiment({name:e,experimentIds:t,referenceDatasetId:r,createdAt:s,description:a,metadata:i,id:o}){if(t.length===0)throw new Error("At least one experiment is required");if(r||(r=(await this.readProject({projectId:t[0]})).reference_dataset_id),!r==null)throw new Error("A reference dataset is required");let u={id:o,name:e,experiment_ids:t,reference_dataset_id:r,description:a,created_at:(s??new Date)?.toISOString(),extra:{}};return i&&(u.extra.metadata=i),await(await this.caller.call($(),`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async*listPresignedFeedbackTokens(e){G(e);let t=new URLSearchParams({run_id:e});for await(let r of this._getPaginated("/feedback/tokens",t))yield*r}_selectEvalResults(e){let t;return"results"in e?t=e.results:t=[e],t}async _logEvaluationFeedback(e,t,r){let s=this._selectEvalResults(e),a=[];for(let i of s){let o=r||{};i.evaluatorInfo&&(o={...i.evaluatorInfo,...o});let u=null;i.targetRunId?u=i.targetRunId:t&&(u=t.id),a.push(await this.createFeedback(u,i.key,{score:i.score,value:i.value,comment:i.comment,correction:i.correction,sourceInfo:o,sourceRunId:i.sourceRunId,feedbackConfig:i.feedbackConfig,feedbackSourceType:"model"}))}return[s,a]}async logEvaluationFeedback(e,t,r){let[s]=await this._logEvaluationFeedback(e,t,r);return s}async*listAnnotationQueues(e={}){let{queueIds:t,name:r,nameContains:s,limit:a}=e,i=new URLSearchParams;t&&t.forEach((u,l)=>{G(u,`queueIds[${l}]`),i.append("ids",u)}),r&&i.append("name",r),s&&i.append("name_contains",s),i.append("limit",(a!==void 0?Math.min(a,100):100).toString());let o=0;for await(let u of this._getPaginated("/annotation-queues",i))if(yield*u,o++,a!==void 0&&o>=a)break}async createAnnotationQueue(e){let{name:t,description:r,queueId:s}=e,a={name:t,description:r,id:s||Nn()},i=await this.caller.call($(),`${this.apiUrl}/annotation-queues`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(Object.fromEntries(Object.entries(a).filter(([u,l])=>l!==void 0))),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(i,"create annotation queue"),await i.json()}async readAnnotationQueue(e){let t=await this.listAnnotationQueues({queueIds:[e]}).next();if(t.done)throw new Error(`Annotation queue with ID ${e} not found`);return t.value}async updateAnnotationQueue(e,t){let{name:r,description:s}=t,a=await this.caller.call($(),`${this.apiUrl}/annotation-queues/${G(e,"queueId")}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({name:r,description:s}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await q(a,"update annotation queue")}async deleteAnnotationQueue(e){let t=await this.caller.call($(),`${this.apiUrl}/annotation-queues/${G(e,"queueId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await q(t,"delete annotation queue")}async addRunsToAnnotationQueue(e,t){let r=await this.caller.call($(),`${this.apiUrl}/annotation-queues/${G(e,"queueId")}/runs`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t.map((s,a)=>G(s,`runIds[${a}]`).toString())),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await q(r,"add runs to annotation queue")}async getRunFromAnnotationQueue(e,t){let r=`/annotation-queues/${G(e,"queueId")}/run`,s=await this.caller.call($(),`${this.apiUrl}${r}/${t}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(s,"get run from annotation queue"),await s.json()}async _currentTenantIsOwner(e){let t=await this._getSettings();return e=="-"||t.tenant_handle===e}async _ownerConflictError(e,t){let r=await this._getSettings();return new Error(`Cannot ${e} for another tenant.

      Current tenant: ${r.tenant_handle}

      Requested tenant: ${t}`)}async _getLatestCommitHash(e){let t=await this.caller.call($(),`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),r=await t.json();if(!t.ok){let s=typeof r.detail=="string"?r.detail:JSON.stringify(r.detail),a=new Error(`Error ${t.status}: ${t.statusText}
${s}`);throw a.statusCode=t.status,a}if(r.commits.length!==0)return r.commits[0].commit_hash}async _likeOrUnlikePrompt(e,t){let[r,s,a]=gr(e),i=await this.caller.call($(),`${this.apiUrl}/likes/${r}/${s}`,{method:"POST",body:JSON.stringify({like:t}),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(i,`${t?"like":"unlike"} prompt`),await i.json()}async _getPromptUrl(e){let[t,r,s]=gr(e);if(await this._currentTenantIsOwner(t)){let a=await this._getSettings();return s!=="latest"?`${this.getHostUrl()}/prompts/${r}/${s.substring(0,8)}?organizationId=${a.id}`:`${this.getHostUrl()}/prompts/${r}?organizationId=${a.id}`}else return s!=="latest"?`${this.getHostUrl()}/hub/${t}/${r}/${s.substring(0,8)}`:`${this.getHostUrl()}/hub/${t}/${r}`}async promptExists(e){return!!await this.getPrompt(e)}async likePrompt(e){return this._likeOrUnlikePrompt(e,!0)}async unlikePrompt(e){return this._likeOrUnlikePrompt(e,!1)}async*listCommits(e){for await(let t of this._getPaginated(`/commits/${e}/`,new URLSearchParams,r=>r.commits))yield*t}async*listPrompts(e){let t=new URLSearchParams;t.append("sort_field",e?.sortField??"updated_at"),t.append("sort_direction","desc"),t.append("is_archived",(!!e?.isArchived).toString()),e?.isPublic!==void 0&&t.append("is_public",e.isPublic.toString()),e?.query&&t.append("query",e.query);for await(let r of this._getPaginated("/repos",t,s=>s.repos))yield*r}async getPrompt(e){let[t,r,s]=gr(e),a=await this.caller.call($(),`${this.apiUrl}/repos/${t}/${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(a.status===404)return null;await q(a,"get prompt");let i=await a.json();return i.repo?i.repo:null}async createPrompt(e,t){let r=await this._getSettings();if(t?.isPublic&&!r.tenant_handle)throw new Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle.
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);let[s,a,i]=gr(e);if(!await this._currentTenantIsOwner(s))throw await this._ownerConflictError("create a prompt",s);let o={repo_handle:a,...t?.description&&{description:t.description},...t?.readme&&{readme:t.readme},...t?.tags&&{tags:t.tags},is_public:!!t?.isPublic},u=await this.caller.call($(),`${this.apiUrl}/repos/`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await q(u,"create prompt");let{repo:l}=await u.json();return l}async createCommit(e,t,r){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");let[s,a,i]=gr(e),o=r?.parentCommitHash==="latest"||!r?.parentCommitHash?await this._getLatestCommitHash(`${s}/${a}`):r?.parentCommitHash,u={manifest:JSON.parse(JSON.stringify(t)),parent_commit:o},l=await this.caller.call($(),`${this.apiUrl}/commits/${s}/${a}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await q(l,"create commit");let c=await l.json();return this._getPromptUrl(`${s}/${a}${c.commit_hash?`:${c.commit_hash}`:""}`)}async updatePrompt(e,t){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");let[r,s]=gr(e);if(!await this._currentTenantIsOwner(r))throw await this._ownerConflictError("update a prompt",r);let a={};if(t?.description!==void 0&&(a.description=t.description),t?.readme!==void 0&&(a.readme=t.readme),t?.tags!==void 0&&(a.tags=t.tags),t?.isPublic!==void 0&&(a.is_public=t.isPublic),t?.isArchived!==void 0&&(a.is_archived=t.isArchived),Object.keys(a).length===0)throw new Error("No valid update options provided");let i=await this.caller.call($(),`${this.apiUrl}/repos/${r}/${s}`,{method:"PATCH",body:JSON.stringify(a),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(i,"update prompt"),i.json()}async deletePrompt(e){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");let[t,r,s]=gr(e);if(!await this._currentTenantIsOwner(t))throw await this._ownerConflictError("delete a prompt",t);return await(await this.caller.call($(),`${this.apiUrl}/repos/${t}/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async pullPromptCommit(e,t){let[r,s,a]=gr(e),i=await this._getServerInfo(),o=dy(i.version,"0.5.23"),u=a;if(!o&&a==="latest"){let d=await this._getLatestCommitHash(`${r}/${s}`);if(d)u=d;else throw new Error("No commits found")}let l=await this.caller.call($(),`${this.apiUrl}/commits/${r}/${s}/${u}${t?.includeModel?"?include_model=true":""}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await q(l,"pull prompt commit");let c=await l.json();return{owner:r,repo:s,commit_hash:c.commit_hash,manifest:c.manifest,examples:c.examples}}async _pullPrompt(e,t){let r=await this.pullPromptCommit(e,{includeModel:t?.includeModel});return JSON.stringify(r.manifest)}async pushPrompt(e,t){return await this.promptExists(e)?t&&Object.keys(t).some(s=>s!=="object")&&await this.updatePrompt(e,{description:t?.description,readme:t?.readme,tags:t?.tags,isPublic:t?.isPublic}):await this.createPrompt(e,{description:t?.description,readme:t?.readme,tags:t?.tags,isPublic:t?.isPublic}),t?.object?await this.createCommit(e,t?.object,{parentCommitHash:t?.parentCommitHash}):await this._getPromptUrl(e)}async clonePublicDataset(e,t={}){let{sourceApiUrl:r=this.apiUrl,datasetName:s}=t,[a,i]=this.parseTokenOrUrl(e,r),o=new n({apiUrl:a,apiKey:"placeholder"}),u=await o.readSharedDataset(i),l=s||u.name;try{if(await this.hasDataset({datasetId:l})){console.log(`Dataset ${l} already exists in your tenant. Skipping.`);return}}catch{}let c=await o.listSharedExamples(i),d=await this.createDataset(l,{description:u.description,dataType:u.data_type||"kv",inputsSchema:u.inputs_schema_definition??void 0,outputsSchema:u.outputs_schema_definition??void 0});try{await this.createExamples({inputs:c.map(f=>f.inputs),outputs:c.flatMap(f=>f.outputs?[f.outputs]:[]),datasetId:d.id})}catch(f){throw console.error(`An error occurred while creating dataset ${l}. You should delete it manually.`),f}}parseTokenOrUrl(e,t,r=2,s="dataset"){try{return G(e),[t,e]}catch{}try{let i=new URL(e).pathname.split("/").filter(o=>o!=="");if(i.length>=r){let o=i[i.length-r];return[t,o]}else throw new Error(`Invalid public ${s} URL: ${e}`)}catch{throw new Error(`Invalid public ${s} URL or token: ${e}`)}}awaitPendingTraceBatches(){return Promise.all(this.autoBatchQueue.items.map(({itemPromise:e})=>e))}}});var ou,uu=h(()=>{dd();du();Ho();ou="0.1.68"});function lu(){if(fd===void 0){let n=uE(),e=cE();fd={library:"langsmith",runtime:n,sdk:"langsmith-js",sdk_version:ou,...e}}return fd}function yy(){let n=lE()||{},e={},t=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION"];for(let[r,s]of Object.entries(n))r.startsWith("LANGCHAIN_")&&typeof s=="string"&&!t.includes(r)&&!r.toLowerCase().includes("key")&&!r.toLowerCase().includes("secret")&&!r.toLowerCase().includes("token")&&(r==="LANGCHAIN_REVISION_ID"?e.revision_id=s:e[r]=s);return e}function lE(){try{return typeof process<"u"&&process.env?Object.entries(process.env).reduce((n,[e,t])=>(n[e]=String(t),n),{}):void 0}catch{return}}function Ur(n){try{return typeof process<"u"?process.env?.[n]:void 0}catch{return}}function yr(n){return Ur(`LANGSMITH_${n}`)||Ur(`LANGCHAIN_${n}`)}function cE(){if(pd!==void 0)return pd;let n=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],e={};for(let t of n){let r=Ur(t);r!==void 0&&(e[t]=r)}return pd=e,e}var br,sE,aE,iE,by,oE,uE,fd,pd,cu=h(()=>{uu();sE=()=>typeof window<"u"&&typeof window.document<"u",aE=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",iE=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),by=()=>typeof Deno<"u",oE=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!by(),uE=()=>br||(sE()?br="browser":oE()?br="node":aE()?br="webworker":iE()?br="jsdom":by()?br="deno":br="other",br)});var _y,wy=h(()=>{cu();_y=n=>n!==void 0?n:!!["TRACING_V2","TRACING"].find(t=>yr(t)==="true")});var fu,vy=h(()=>{fu=Symbol.for("lc:context_variables")});function dE(n){return n.replace(/[-:.]/g,"")}function fE(n,e,t=1){let r=t.toFixed(0).slice(0,3).padStart(3,"0");return dE(`${new Date(n).toISOString().slice(0,-1)}${r}Z`)+e}function hd(n){return n!==void 0&&typeof n.createChild=="function"&&typeof n.postRun=="function"}function Ay(n){return typeof n=="object"&&n!=null&&typeof n.name=="string"&&n.name==="langchain_tracer"}function xy(n){return Array.isArray(n)&&n.some(e=>Ay(e))}function pE(n){return typeof n=="object"&&n!=null&&Array.isArray(n.handlers)}function hE(n){return n!==void 0&&typeof n.callbacks=="object"&&(xy(n.callbacks?.handlers)||xy(n.callbacks))}var pu,Fr,du=h(()=>{Fo();cu();dd();wy();Fc();vy();pu=class n{constructor(e,t){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=t}static fromHeader(e){let t=e.split(","),r={},s=[];for(let a of t){let[i,o]=a.split("="),u=decodeURIComponent(o);i==="langsmith-metadata"?r=JSON.parse(u):i==="langsmith-tags"&&(s=u.split(","))}return new n(r,s)}toHeader(){let e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),e.join(",")}},Fr=class n{constructor(e){if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),hd(e)){Object.assign(this,{...e});return}let t=n.getDefaultConfig(),{metadata:r,...s}=e,a=s.client??n.getSharedClient(),i={...r,...s?.extra?.metadata};if(s.extra={...s.extra,metadata:i},Object.assign(this,{...t,...s,client:a}),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.execution_order??=1,this.child_execution_order??=1,!this.dotted_order){let o=fE(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+o:this.dotted_order=o}}static getDefaultConfig(){return{id:Nn(),run_type:"chain",project_name:Ur("LANGCHAIN_PROJECT")??Ur("LANGCHAIN_SESSION")??"default",child_runs:[],api_url:Ur("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:Ur("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{}}}static getSharedClient(){return n.sharedClient||(n.sharedClient=new Mn),n.sharedClient}createChild(e){let t=this.child_execution_order+1,r=new n({...e,parent_run:this,project_name:this.project_name,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:t,child_execution_order:t});fu in this&&(r[fu]=this[fu]);let s=Symbol.for("lc:child_config"),a=e.extra?.[s]??this.extra[s];if(hE(a)){let u={...a},l=pE(u.callbacks)?u.callbacks.copy?.():void 0;l&&(Object.assign(l,{_parentRunId:r.id}),l.handlers?.find(Ay)?.updateFromRunTree?.(r),u.callbacks=l),r.extra[s]=u}let i=new Set,o=this;for(;o!=null&&!i.has(o.id);)i.add(o.id),o.child_execution_order=Math.max(o.child_execution_order,t),o=o.parent_run;return this.child_runs.push(r),r}async end(e,t,r=Date.now(),s){this.outputs=this.outputs??e,this.error=this.error??t,this.end_time=this.end_time??r,s&&Object.keys(s).length>0&&(this.extra=this.extra?{...this.extra,metadata:{...this.extra.metadata,...s}}:{metadata:s})}_convertToCreate(e,t,r=!0){let s=e.extra??{};if(s.runtime||(s.runtime={}),t)for(let[u,l]of Object.entries(t))s.runtime[u]||(s.runtime[u]=l);let a,i;return r?(i=e.parent_run?.id,a=[]):(a=e.child_runs.map(u=>this._convertToCreate(u,t,r)),i=void 0),{id:e.id,name:e.name,start_time:e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:s,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:a,parent_run_id:i,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags}}async postRun(e=!0){try{let t=lu(),r=await this._convertToCreate(this,t,!0);if(await this.client.createRun(r),!e){Ko("Posting with excludeChildRuns=false is deprecated and will be removed in a future version.");for(let s of this.child_runs)await s.postRun(!1)}}catch(t){console.error(`Error in postRun for run ${this.id}:`,t)}}async patchRun(){try{let e={end_time:this.end_time,error:this.error,inputs:this.inputs,outputs:this.outputs,parent_run_id:this.parent_run?.id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags};await this.client.updateRun(this.id,e)}catch(e){console.error(`Error in patchRun for run ${this.id}`,e)}}toJSON(){return this._convertToCreate(this,void 0,!1)}static fromRunnableConfig(e,t){let r=e?.callbacks,s,a,i,o=_y();if(r){let l=r?.getParentRunId?.()??"",c=r?.handlers?.find(d=>d?.name=="langchain_tracer");s=c?.getRun?.(l),a=c?.projectName,i=c?.client,o=o||!!c}return s?new n({name:s.name,id:s.id,trace_id:s.trace_id,dotted_order:s.dotted_order,client:i,tracingEnabled:o,project_name:a,tags:[...new Set((s?.tags??[]).concat(e?.tags??[]))],extra:{metadata:{...s?.extra?.metadata,...e?.metadata}}}).createChild(t):new n({...t,client:i,tracingEnabled:o,project_name:a})}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,t){let r="get"in e&&typeof e.get=="function"?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,s=r["langsmith-trace"];if(!s||typeof s!="string")return;let a=s.trim(),i=a.split(".").map(l=>{let[c,d]=l.split("Z");return{strTime:c,time:Date.parse(c+"Z"),uuid:d}}),o=i[0].uuid,u={...t,name:t?.name??"parent",run_type:t?.run_type??"chain",start_time:t?.start_time??Date.now(),id:i.at(-1)?.uuid,trace_id:o,dotted_order:a};if(r.baggage&&typeof r.baggage=="string"){let l=pu.fromHeader(r.baggage);u.metadata=l.metadata,u.tags=l.tags}return new n(u)}toHeaders(e){let t={"langsmith-trace":this.dotted_order,baggage:new pu(this.extra?.metadata,this.tags).toHeader()};if(e)for(let[r,s]of Object.entries(t))e.set(r,s);return t}};Object.defineProperty(Fr,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null})});function hu(n){return typeof n=="function"&&"langsmith:traceable"in n}var gd,md,mE,yd,gE,Ey,T$,Oy=h(()=>{du();gd=class{getStore(){}run(e,t){return t()}},md=Symbol.for("ls:tracing_async_local_storage"),mE=new gd,yd=class{getInstance(){return globalThis[md]??mE}initializeGlobalInstance(e){globalThis[md]===void 0&&(globalThis[md]=e)}},gE=new yd,Ey=()=>{let n=gE.getInstance().getStore();if(!hd(n))throw new Error(["Could not get the current run tree.","","Please make sure you are calling this method within a traceable function or the tracing is enabled."].join(`
`));return n},T$=Symbol.for("langsmith:traceable:root")});var bd=h(()=>{Oy()});function Py(n,e){return yE.call(n,e)}function Ty(n){if(Array.isArray(n)){let t=new Array(n.length);for(let r=0;r<t.length;r++)t[r]=""+r;return t}if(Object.keys)return Object.keys(n);let e=[];for(let t in n)Py(n,t)&&e.push(t);return e}function ht(n){switch(typeof n){case"object":return JSON.parse(JSON.stringify(n));case"undefined":return null;default:return n}}function gu(n){let e=0,t=n.length,r;for(;e<t;){if(r=n.charCodeAt(e),r>=48&&r<=57){e++;continue}return!1}return!0}function yu(n){return n.indexOf("/")===-1&&n.indexOf("~")===-1?n:n.replace(/~/g,"~0").replace(/\//g,"~1")}function ai(n){return n.replace(/~1/g,"/").replace(/~0/g,"~")}function mu(n){if(n===void 0)return!0;if(n){if(Array.isArray(n)){for(let t=0,r=n.length;t<r;t++)if(mu(n[t]))return!0}else if(typeof n=="object"){let t=Ty(n),r=t.length;for(var e=0;e<r;e++)if(mu(n[t[e]]))return!0}}return!1}function Iy(n,e){let t=[n];for(let r in e){let s=typeof e[r]=="object"?JSON.stringify(e[r],null,2):e[r];typeof s<"u"&&t.push(`${r}: ${s}`)}return t.join(`
`)}var yE,Ln,ii=h(()=>{yE=Object.prototype.hasOwnProperty;Ln=class extends Error{constructor(e,t,r,s,a){super(Iy(e,{name:t,index:r,operation:s,tree:a})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.setPrototypeOf(this,new.target.prototype),this.message=Iy(e,{name:t,index:r,operation:s,tree:a})}}});var _d={};io(_d,{JsonPatchError:()=>se,_areEquals:()=>oi,applyOperation:()=>Dn,applyPatch:()=>Br,applyReducer:()=>wE,deepClone:()=>bE,getValueByPointer:()=>bu,validate:()=>Sy,validator:()=>_u});function bu(n,e){if(e=="")return n;var t={op:"_get",path:e};return Dn(n,t),t.value}function Dn(n,e,t=!1,r=!0,s=!0,a=0){if(t&&(typeof t=="function"?t(e,0,n,e.path):_u(e,0)),e.path===""){let i={newDocument:n};if(e.op==="add")return i.newDocument=e.value,i;if(e.op==="replace")return i.newDocument=e.value,i.removed=n,i;if(e.op==="move"||e.op==="copy")return i.newDocument=bu(n,e.from),e.op==="move"&&(i.removed=n),i;if(e.op==="test"){if(i.test=oi(n,e.value),i.test===!1)throw new se("Test operation failed","TEST_OPERATION_FAILED",a,e,n);return i.newDocument=n,i}else{if(e.op==="remove")return i.removed=n,i.newDocument=null,i;if(e.op==="_get")return e.value=n,i;if(t)throw new se("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",a,e,n);return i}}else{r||(n=ht(n));let o=(e.path||"").split("/"),u=n,l=1,c=o.length,d,f,p;for(typeof t=="function"?p=t:p=_u;;){if(f=o[l],f&&f.indexOf("~")!=-1&&(f=ai(f)),s&&(f=="__proto__"||f=="prototype"&&l>0&&o[l-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(t&&d===void 0&&(u[f]===void 0?d=o.slice(0,l).join("/"):l==c-1&&(d=e.path),d!==void 0&&p(e,0,n,d)),l++,Array.isArray(u)){if(f==="-")f=u.length;else{if(t&&!gu(f))throw new se("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",a,e,n);gu(f)&&(f=~~f)}if(l>=c){if(t&&e.op==="add"&&f>u.length)throw new se("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",a,e,n);let g=_E[e.op].call(e,u,f,n);if(g.test===!1)throw new se("Test operation failed","TEST_OPERATION_FAILED",a,e,n);return g}}else if(l>=c){let g=js[e.op].call(e,u,f,n);if(g.test===!1)throw new se("Test operation failed","TEST_OPERATION_FAILED",a,e,n);return g}if(u=u[f],t&&l<c&&(!u||typeof u!="object"))throw new se("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",a,e,n)}}}function Br(n,e,t,r=!0,s=!0){if(t&&!Array.isArray(e))throw new se("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(n=ht(n));let a=new Array(e.length);for(let i=0,o=e.length;i<o;i++)a[i]=Dn(n,e[i],t,!0,s,i),n=a[i].newDocument;return a.newDocument=n,a}function wE(n,e,t){let r=Dn(n,e);if(r.test===!1)throw new se("Test operation failed","TEST_OPERATION_FAILED",t,e,n);return r.newDocument}function _u(n,e,t,r){if(typeof n!="object"||n===null||Array.isArray(n))throw new se("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,n,t);if(js[n.op]){if(typeof n.path!="string")throw new se("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,n,t);if(n.path.indexOf("/")!==0&&n.path.length>0)throw new se('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,n,t);if((n.op==="move"||n.op==="copy")&&typeof n.from!="string")throw new se("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,n,t);if((n.op==="add"||n.op==="replace"||n.op==="test")&&n.value===void 0)throw new se("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,n,t);if((n.op==="add"||n.op==="replace"||n.op==="test")&&mu(n.value))throw new se("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,n,t);if(t){if(n.op=="add"){var s=n.path.split("/").length,a=r.split("/").length;if(s!==a+1&&s!==a)throw new se("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,n,t)}else if(n.op==="replace"||n.op==="remove"||n.op==="_get"){if(n.path!==r)throw new se("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,n,t)}else if(n.op==="move"||n.op==="copy"){var i={op:"_get",path:n.from,value:void 0},o=Sy([i],t);if(o&&o.name==="OPERATION_PATH_UNRESOLVABLE")throw new se("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,n,t)}}}else throw new se("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,n,t)}function Sy(n,e,t){try{if(!Array.isArray(n))throw new se("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)Br(ht(e),ht(n),t||!0);else{t=t||_u;for(var r=0;r<n.length;r++)t(n[r],r,e,void 0)}}catch(s){if(s instanceof se)return s;throw s}}function oi(n,e){if(n===e)return!0;if(n&&e&&typeof n=="object"&&typeof e=="object"){var t=Array.isArray(n),r=Array.isArray(e),s,a,i;if(t&&r){if(a=n.length,a!=e.length)return!1;for(s=a;s--!==0;)if(!oi(n[s],e[s]))return!1;return!0}if(t!=r)return!1;var o=Object.keys(n);if(a=o.length,a!==Object.keys(e).length)return!1;for(s=a;s--!==0;)if(!e.hasOwnProperty(o[s]))return!1;for(s=a;s--!==0;)if(i=o[s],!oi(n[i],e[i]))return!1;return!0}return n!==n&&e!==e}var se,bE,js,_E,wu=h(()=>{ii();se=Ln,bE=ht,js={add:function(n,e,t){return n[e]=this.value,{newDocument:t}},remove:function(n,e,t){var r=n[e];return delete n[e],{newDocument:t,removed:r}},replace:function(n,e,t){var r=n[e];return n[e]=this.value,{newDocument:t,removed:r}},move:function(n,e,t){let r=bu(t,this.path);r&&(r=ht(r));let s=Dn(t,{op:"remove",path:this.from}).removed;return Dn(t,{op:"add",path:this.path,value:s}),{newDocument:t,removed:r}},copy:function(n,e,t){let r=bu(t,this.from);return Dn(t,{op:"add",path:this.path,value:ht(r)}),{newDocument:t}},test:function(n,e,t){return{newDocument:t,test:oi(n[e],this.value)}},_get:function(n,e,t){return this.value=n[e],{newDocument:t}}},_E={add:function(n,e,t){return gu(e)?n.splice(e,0,this.value):n[e]=this.value,{newDocument:t,index:e}},remove:function(n,e,t){var r=n.splice(e,1);return{newDocument:t,removed:r[0]}},replace:function(n,e,t){var r=n[e];return n[e]=this.value,{newDocument:t,removed:r}},move:js.move,copy:js.copy,test:js.test,_get:js._get}});var Cy=h(()=>{ii();wu();});var D$,wd=h(()=>{wu();Cy();ii();wu();ii();D$={..._d,JsonPatchError:Ln,deepClone:ht,escapePathComponent:yu,unescapePathComponent:ai}});async function ky(){return vd===void 0&&(vd={library:"langchain-js",runtime:OE()}),vd}function ie(n){try{return typeof process<"u"?process.env?.[n]:void 0}catch{return}}var vE,xE,AE,Ry,EE,OE,vd,Ms=h(()=>{vE=()=>typeof window<"u"&&typeof window.document<"u",xE=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",AE=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),Ry=()=>typeof Deno<"u",EE=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!Ry(),OE=()=>{let n;return vE()?n="browser":EE()?n="node":xE()?n="webworker":AE()?n="jsdom":Ry()?n="deno":n="other",n}});var xd,Fn,Ad=h(()=>{Wa();Ss();Ms();xd=class{},Fn=class n extends xd{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,wc(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreCustomEvent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"raiseError",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:ie("LANGCHAIN_CALLBACKS_BACKGROUND")!=="true"}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.ignoreCustomEvent=e.ignoreCustomEvent??this.ignoreCustomEvent,this.raiseError=e.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(e._awaitHandler??this.awaitHandlers))}copy(){return new this.constructor(this)}toJSON(){return Qe.prototype.toJSON.call(this)}toJSONNotImplemented(){return Qe.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class t extends n{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:Ke()}),Object.assign(this,e)}}return new t}}});function Ed(n,e){return n&&!Array.isArray(n)&&typeof n=="object"?n:{[e]:n}}function IE(n){return n.replace(/[-:.]/g,"")}function PE(n,e,t){let r=t.toFixed(0).slice(0,3).padStart(3,"0");return IE(`${new Date(n).toISOString().slice(0,-1)}${r}Z`)+e}function Ls(n){return typeof n._addRunToRunMap=="function"}var mt,Un=h(()=>{Ad();mt=class extends Fn{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}stringifyError(e){return e instanceof Error?e.message+(e?.stack?`

${e.stack}`:""):typeof e=="string"?e:`${e}`}_addChildRun(e,t){e.child_runs.push(t)}_addRunToRunMap(e){let t=PE(e.start_time,e.id,e.execution_order),r={...e};if(r.parent_run_id!==void 0){let s=this.runMap.get(r.parent_run_id);s&&(this._addChildRun(s,r),s.child_execution_order=Math.max(s.child_execution_order,r.child_execution_order),r.trace_id=s.trace_id,s.dotted_order!==void 0&&(r.dotted_order=[s.dotted_order,t].join(".")))}else r.trace_id=r.id,r.dotted_order=t;return this.runMap.set(r.id,r),r}async _endTrace(e){let t=e.parent_run_id!==void 0&&this.runMap.get(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),this.runMap.delete(e.id),await this.onRunUpdate?.(e)}_getExecutionOrder(e){let t=e!==void 0&&this.runMap.get(e);return t?t.child_execution_order+1:1}_createRunForLLMStart(e,t,r,s,a,i,o,u){let l=this._getExecutionOrder(s),c=Date.now(),d=o?{...a,metadata:o}:a,f={id:r,name:u??e.id[e.id.length-1],parent_run_id:s,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{prompts:t},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:d??{},tags:i||[]};return this._addRunToRunMap(f)}async handleLLMStart(e,t,r,s,a,i,o,u){let l=this.runMap.get(r)??this._createRunForLLMStart(e,t,r,s,a,i,o,u);return await this.onRunCreate?.(l),await this.onLLMStart?.(l),l}_createRunForChatModelStart(e,t,r,s,a,i,o,u){let l=this._getExecutionOrder(s),c=Date.now(),d=o?{...a,metadata:o}:a,f={id:r,name:u??e.id[e.id.length-1],parent_run_id:s,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{messages:t},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:d??{},tags:i||[]};return this._addRunToRunMap(f)}async handleChatModelStart(e,t,r,s,a,i,o,u){let l=this.runMap.get(r)??this._createRunForChatModelStart(e,t,r,s,a,i,o,u);return await this.onRunCreate?.(l),await this.onLLMStart?.(l),l}async handleLLMEnd(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="llm")throw new Error("No LLM run to end.");return r.end_time=Date.now(),r.outputs=e,r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await this.onLLMEnd?.(r),await this._endTrace(r),r}async handleLLMError(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="llm")throw new Error("No LLM run to end.");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await this.onLLMError?.(r),await this._endTrace(r),r}_createRunForChainStart(e,t,r,s,a,i,o,u){let l=this._getExecutionOrder(s),c=Date.now(),d={id:r,name:u??e.id[e.id.length-1],parent_run_id:s,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:t,execution_order:l,child_execution_order:l,run_type:o??"chain",child_runs:[],extra:i?{metadata:i}:{},tags:a||[]};return this._addRunToRunMap(d)}async handleChainStart(e,t,r,s,a,i,o,u){let l=this.runMap.get(r)??this._createRunForChainStart(e,t,r,s,a,i,o,u);return await this.onRunCreate?.(l),await this.onChainStart?.(l),l}async handleChainEnd(e,t,r,s,a){let i=this.runMap.get(t);if(!i)throw new Error("No chain run to end.");return i.end_time=Date.now(),i.outputs=Ed(e,"output"),i.events.push({name:"end",time:new Date(i.end_time).toISOString()}),a?.inputs!==void 0&&(i.inputs=Ed(a.inputs,"input")),await this.onChainEnd?.(i),await this._endTrace(i),i}async handleChainError(e,t,r,s,a){let i=this.runMap.get(t);if(!i)throw new Error("No chain run to end.");return i.end_time=Date.now(),i.error=this.stringifyError(e),i.events.push({name:"error",time:new Date(i.end_time).toISOString()}),a?.inputs!==void 0&&(i.inputs=Ed(a.inputs,"input")),await this.onChainError?.(i),await this._endTrace(i),i}_createRunForToolStart(e,t,r,s,a,i,o){let u=this._getExecutionOrder(s),l=Date.now(),c={id:r,name:o??e.id[e.id.length-1],parent_run_id:s,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{input:t},execution_order:u,child_execution_order:u,run_type:"tool",child_runs:[],extra:i?{metadata:i}:{},tags:a||[]};return this._addRunToRunMap(c)}async handleToolStart(e,t,r,s,a,i,o){let u=this.runMap.get(r)??this._createRunForToolStart(e,t,r,s,a,i,o);return await this.onRunCreate?.(u),await this.onToolStart?.(u),u}async handleToolEnd(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="tool")throw new Error("No tool run to end");return r.end_time=Date.now(),r.outputs={output:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await this.onToolEnd?.(r),await this._endTrace(r),r}async handleToolError(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="tool")throw new Error("No tool run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await this.onToolError?.(r),await this._endTrace(r),r}async handleAgentAction(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="chain")return;let s=r;s.actions=s.actions||[],s.actions.push(e),s.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await this.onAgentAction?.(r)}async handleAgentEnd(e,t){let r=this.runMap.get(t);!r||r?.run_type!=="chain"||(r.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await this.onAgentEnd?.(r))}_createRunForRetrieverStart(e,t,r,s,a,i,o){let u=this._getExecutionOrder(s),l=Date.now(),c={id:r,name:o??e.id[e.id.length-1],parent_run_id:s,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{query:t},execution_order:u,child_execution_order:u,run_type:"retriever",child_runs:[],extra:i?{metadata:i}:{},tags:a||[]};return this._addRunToRunMap(c)}async handleRetrieverStart(e,t,r,s,a,i,o){let u=this.runMap.get(r)??this._createRunForRetrieverStart(e,t,r,s,a,i,o);return await this.onRunCreate?.(u),await this.onRetrieverStart?.(u),u}async handleRetrieverEnd(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="retriever")throw new Error("No retriever run to end");return r.end_time=Date.now(),r.outputs={documents:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await this.onRetrieverEnd?.(r),await this._endTrace(r),r}async handleRetrieverError(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="retriever")throw new Error("No retriever run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await this.onRetrieverError?.(r),await this._endTrace(r),r}async handleText(e,t){let r=this.runMap.get(t);!r||r?.run_type!=="chain"||(r.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await this.onText?.(r))}async handleLLMNewToken(e,t,r,s,a,i){let o=this.runMap.get(r);if(!o||o?.run_type!=="llm")throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return o.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:t,chunk:i?.chunk}}),await this.onLLMNewToken?.(o,e,{chunk:i?.chunk}),o}}});var Od=h(()=>{uu()});var My=T((Y$,jy)=>{"use strict";var Ny=(n=0)=>e=>`\x1B[${38+n};5;${e}m`,$y=(n=0)=>(e,t,r)=>`\x1B[${38+n};2;${e};${t};${r}m`;function TE(){let n=new Map,e={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};e.color.gray=e.color.blackBright,e.bgColor.bgGray=e.bgColor.bgBlackBright,e.color.grey=e.color.blackBright,e.bgColor.bgGrey=e.bgColor.bgBlackBright;for(let[t,r]of Object.entries(e)){for(let[s,a]of Object.entries(r))e[s]={open:`\x1B[${a[0]}m`,close:`\x1B[${a[1]}m`},r[s]=e[s],n.set(a[0],a[1]);Object.defineProperty(e,t,{value:r,enumerable:!1})}return Object.defineProperty(e,"codes",{value:n,enumerable:!1}),e.color.close="\x1B[39m",e.bgColor.close="\x1B[49m",e.color.ansi256=Ny(),e.color.ansi16m=$y(),e.bgColor.ansi256=Ny(10),e.bgColor.ansi16m=$y(10),Object.defineProperties(e,{rgbToAnsi256:{value:(t,r,s)=>t===r&&r===s?t<8?16:t>248?231:Math.round((t-8)/247*24)+232:16+36*Math.round(t/255*5)+6*Math.round(r/255*5)+Math.round(s/255*5),enumerable:!1},hexToRgb:{value:t=>{let r=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(t.toString(16));if(!r)return[0,0,0];let{colorString:s}=r.groups;s.length===3&&(s=s.split("").map(i=>i+i).join(""));let a=Number.parseInt(s,16);return[a>>16&255,a>>8&255,a&255]},enumerable:!1},hexToAnsi256:{value:t=>e.rgbToAnsi256(...e.hexToRgb(t)),enumerable:!1}}),e}Object.defineProperty(jy,"exports",{enumerable:!0,get:TE})});function ze(n,e){return`${n.open}${e}${n.close}`}function gt(n,e){try{return JSON.stringify(n,null,2)}catch{return e}}function Ly(n){return typeof n=="string"?n.trim():n==null?n:gt(n,n.toString())}function zr(n){if(!n.end_time)return"";let e=n.end_time-n.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}var Id,Je,ui,Dy=h(()=>{Id=at(My(),1);Un();({color:Je}=Id.default),ui=class extends mt{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){let t=[],r=e;for(;r.parent_run_id;){let s=this.runMap.get(r.parent_run_id);if(s)t.push(s),r=s;else break}return t}getBreadcrumbs(e){let r=[...this.getParents(e).reverse(),e].map((s,a,i)=>{let o=`${s.execution_order}:${s.run_type}:${s.name}`;return a===i.length-1?ze(Id.default.bold,o):o}).join(" > ");return ze(Je.grey,r)}onChainStart(e){let t=this.getBreadcrumbs(e);console.log(`${ze(Je.green,"[chain/start]")} [${t}] Entering Chain run with input: ${gt(e.inputs,"[inputs]")}`)}onChainEnd(e){let t=this.getBreadcrumbs(e);console.log(`${ze(Je.cyan,"[chain/end]")} [${t}] [${zr(e)}] Exiting Chain run with output: ${gt(e.outputs,"[outputs]")}`)}onChainError(e){let t=this.getBreadcrumbs(e);console.log(`${ze(Je.red,"[chain/error]")} [${t}] [${zr(e)}] Chain run errored with error: ${gt(e.error,"[error]")}`)}onLLMStart(e){let t=this.getBreadcrumbs(e),r="prompts"in e.inputs?{prompts:e.inputs.prompts.map(s=>s.trim())}:e.inputs;console.log(`${ze(Je.green,"[llm/start]")} [${t}] Entering LLM run with input: ${gt(r,"[inputs]")}`)}onLLMEnd(e){let t=this.getBreadcrumbs(e);console.log(`${ze(Je.cyan,"[llm/end]")} [${t}] [${zr(e)}] Exiting LLM run with output: ${gt(e.outputs,"[response]")}`)}onLLMError(e){let t=this.getBreadcrumbs(e);console.log(`${ze(Je.red,"[llm/error]")} [${t}] [${zr(e)}] LLM run errored with error: ${gt(e.error,"[error]")}`)}onToolStart(e){let t=this.getBreadcrumbs(e);console.log(`${ze(Je.green,"[tool/start]")} [${t}] Entering Tool run with input: "${Ly(e.inputs.input)}"`)}onToolEnd(e){let t=this.getBreadcrumbs(e);console.log(`${ze(Je.cyan,"[tool/end]")} [${t}] [${zr(e)}] Exiting Tool run with output: "${Ly(e.outputs?.output)}"`)}onToolError(e){let t=this.getBreadcrumbs(e);console.log(`${ze(Je.red,"[tool/error]")} [${t}] [${zr(e)}] Tool run errored with error: ${gt(e.error,"[error]")}`)}onRetrieverStart(e){let t=this.getBreadcrumbs(e);console.log(`${ze(Je.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${gt(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){let t=this.getBreadcrumbs(e);console.log(`${ze(Je.cyan,"[retriever/end]")} [${t}] [${zr(e)}] Exiting Retriever run with output: ${gt(e.outputs,"[outputs]")}`)}onRetrieverError(e){let t=this.getBreadcrumbs(e);console.log(`${ze(Je.red,"[retriever/error]")} [${t}] [${zr(e)}] Retriever run errored with error: ${gt(e.error,"[error]")}`)}onAgentAction(e){let t=e,r=this.getBreadcrumbs(e);console.log(`${ze(Je.blue,"[agent/action]")} [${r}] Agent selected action: ${gt(t.actions[t.actions.length-1],"[action]")}`)}}});var Fy=h(()=>{du()});var Ds,Uy=h(()=>{Od();Fy();bd();Ms();Un();Ds=class n extends mt{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let{exampleId:t,projectName:r,client:s}=e;this.projectName=r??ie("LANGCHAIN_PROJECT")??ie("LANGCHAIN_SESSION"),this.exampleId=t,this.client=s??new Mn({});let a=n.getTraceableRunTree();a&&this.updateFromRunTree(a)}async _convertToCreate(e,t=void 0){return{...e,extra:{...e.extra,runtime:await ky()},child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:t}}async persistRun(e){}async onRunCreate(e){let t=await this._convertToCreate(e,this.exampleId);await this.client.createRun(t)}async onRunUpdate(e){let t={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events,inputs:e.inputs,trace_id:e.trace_id,dotted_order:e.dotted_order,parent_run_id:e.parent_run_id};await this.client.updateRun(e.id,t)}getRun(e){return this.runMap.get(e)}updateFromRunTree(e){let t=e,r=new Set;for(;t.parent_run&&!(r.has(t.id)||(r.add(t.id),!t.parent_run));)t=t.parent_run;r.clear();let s=[t];for(;s.length>0;){let a=s.shift();!a||r.has(a.id)||(r.add(a.id),this.runMap.set(a.id,a),a.child_runs&&s.push(...a.child_runs))}this.client=e.client??this.client,this.projectName=e.project_name??this.projectName,this.exampleId=e.reference_example_id??this.exampleId}convertToRunTree(e){let t={},r=[];for(let[s,a]of this.runMap){let i=new Fr({...a,child_runs:[],parent_run:void 0,client:this.client,project_name:this.projectName,reference_example_id:this.exampleId,tracingEnabled:!0});t[s]=i,r.push([s,a.dotted_order])}r.sort((s,a)=>!s[1]||!a[1]?0:s[1].localeCompare(a[1]));for(let[s]of r){let a=this.runMap.get(s),i=t[s];if(!(!a||!i)&&a.parent_run_id){let o=t[a.parent_run_id];o&&(o.child_runs.push(i),i.parent_run=o)}}return t[e]}static getTraceableRunTree(){try{return Ey()}catch{return}}}});function SE(){let n="default"in vu.default?vu.default.default:vu.default;return new n({autoStart:!0,concurrency:1})}async function le(n,e){e===!0?await n():(typeof Pd>"u"&&(Pd=SE()),Pd.add(n))}var vu,Pd,By=h(()=>{vu=at(Vo(),1)});var Td,zy=h(()=>{Ms();Td=n=>n!==void 0?n:!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find(t=>ie(t)==="true")});function Nd(n){return n?Array.isArray(n)||"name"in n?{callbacks:n}:n:{}}function li(n){return"name"in n?n:Fn.fromMethods(n)}var Sd,Fs,Cd,xu,Rd,kd,Ie,Us=h(()=>{Wa();Ad();Dy();Dr();Ms();Uy();By();zy();Un();Td()&&ie("LANGCHAIN_CALLBACKS_BACKGROUND")!=="true"&&["[WARN]: You have enabled LangSmith tracing without backgrounding callbacks.","[WARN]: If you are not using a serverless environment where you must wait for tracing calls to finish,",'[WARN]: we suggest setting "process.env.LANGCHAIN_CALLBACKS_BACKGROUND=true" to avoid additional latency.'].join(`
`);Sd=class{setHandler(e){return this.setHandlers([e])}},Fs=class{constructor(e,t,r,s,a,i,o,u){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:u})}get parentRunId(){return this._parentRunId}async handleText(e){await Promise.all(this.handlers.map(t=>le(async()=>{try{await t.handleText?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleText: ${r}`),t.raiseError)throw r}},t.awaitHandlers)))}async handleCustomEvent(e,t,r,s,a){await Promise.all(this.handlers.map(i=>le(async()=>{try{await i.handleCustomEvent?.(e,t,this.runId,this.tags,this.metadata)}catch(o){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleCustomEvent: ${o}`),i.raiseError)throw o}},i.awaitHandlers)))}},Cd=class extends Fs{getChild(e){let t=new Ie(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(t=>le(async()=>{if(!t.ignoreRetriever)try{await t.handleRetrieverEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetriever`),t.raiseError)throw r}},t.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(t=>le(async()=>{if(!t.ignoreRetriever)try{await t.handleRetrieverError?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetrieverError: ${r}`),t.raiseError)throw e}},t.awaitHandlers)))}},xu=class extends Fs{async handleLLMNewToken(e,t,r,s,a,i){await Promise.all(this.handlers.map(o=>le(async()=>{if(!o.ignoreLLM)try{await o.handleLLMNewToken?.(e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,i)}catch(u){if((o.raiseError?console.error:console.warn)(`Error in handler ${o.constructor.name}, handleLLMNewToken: ${u}`),o.raiseError)throw u}},o.awaitHandlers)))}async handleLLMError(e){await Promise.all(this.handlers.map(t=>le(async()=>{if(!t.ignoreLLM)try{await t.handleLLMError?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleLLMError: ${r}`),t.raiseError)throw r}},t.awaitHandlers)))}async handleLLMEnd(e){await Promise.all(this.handlers.map(t=>le(async()=>{if(!t.ignoreLLM)try{await t.handleLLMEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleLLMEnd: ${r}`),t.raiseError)throw r}},t.awaitHandlers)))}},Rd=class extends Fs{getChild(e){let t=new Ie(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,r,s,a){await Promise.all(this.handlers.map(i=>le(async()=>{if(!i.ignoreChain)try{await i.handleChainError?.(e,this.runId,this._parentRunId,this.tags,a)}catch(o){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleChainError: ${o}`),i.raiseError)throw o}},i.awaitHandlers)))}async handleChainEnd(e,t,r,s,a){await Promise.all(this.handlers.map(i=>le(async()=>{if(!i.ignoreChain)try{await i.handleChainEnd?.(e,this.runId,this._parentRunId,this.tags,a)}catch(o){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleChainEnd: ${o}`),i.raiseError)throw o}},i.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(t=>le(async()=>{if(!t.ignoreAgent)try{await t.handleAgentAction?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentAction: ${r}`),t.raiseError)throw r}},t.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(t=>le(async()=>{if(!t.ignoreAgent)try{await t.handleAgentEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentEnd: ${r}`),t.raiseError)throw r}},t.awaitHandlers)))}},kd=class extends Fs{getChild(e){let t=new Ie(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map(t=>le(async()=>{if(!t.ignoreAgent)try{await t.handleToolError?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolError: ${r}`),t.raiseError)throw r}},t.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(t=>le(async()=>{if(!t.ignoreAgent)try{await t.handleToolEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolEnd: ${r}`),t.raiseError)throw r}},t.awaitHandlers)))}},Ie=class n extends Sd{constructor(e,t){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=t?.handlers??this.handlers,this.inheritableHandlers=t?.inheritableHandlers??this.inheritableHandlers,this.tags=t?.tags??this.tags,this.inheritableTags=t?.inheritableTags??this.inheritableTags,this.metadata=t?.metadata??this.metadata,this.inheritableMetadata=t?.inheritableMetadata??this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}async handleLLMStart(e,t,r=void 0,s=void 0,a=void 0,i=void 0,o=void 0,u=void 0){return Promise.all(t.map(async(l,c)=>{let d=c===0&&r?r:Ke();return await Promise.all(this.handlers.map(f=>{if(!f.ignoreLLM)return Ls(f)&&f._createRunForLLMStart(e,[l],d,this._parentRunId,a,this.tags,this.metadata,u),le(async()=>{try{await f.handleLLMStart?.(e,[l],d,this._parentRunId,a,this.tags,this.metadata,u)}catch(p){if((f.raiseError?console.error:console.warn)(`Error in handler ${f.constructor.name}, handleLLMStart: ${p}`),f.raiseError)throw p}},f.awaitHandlers)})),new xu(d,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,t,r=void 0,s=void 0,a=void 0,i=void 0,o=void 0,u=void 0){return Promise.all(t.map(async(l,c)=>{let d=c===0&&r?r:Ke();return await Promise.all(this.handlers.map(f=>{if(!f.ignoreLLM)return Ls(f)&&f._createRunForChatModelStart(e,[l],d,this._parentRunId,a,this.tags,this.metadata,u),le(async()=>{try{if(f.handleChatModelStart)await f.handleChatModelStart?.(e,[l],d,this._parentRunId,a,this.tags,this.metadata,u);else if(f.handleLLMStart){let p=Ka(l);await f.handleLLMStart?.(e,[p],d,this._parentRunId,a,this.tags,this.metadata,u)}}catch(p){if((f.raiseError?console.error:console.warn)(`Error in handler ${f.constructor.name}, handleLLMStart: ${p}`),f.raiseError)throw p}},f.awaitHandlers)})),new xu(d,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,t,r=Ke(),s=void 0,a=void 0,i=void 0,o=void 0){return await Promise.all(this.handlers.map(u=>{if(!u.ignoreChain)return Ls(u)&&u._createRunForChainStart(e,t,r,this._parentRunId,this.tags,this.metadata,s,o),le(async()=>{try{await u.handleChainStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,s,o)}catch(l){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleChainStart: ${l}`),u.raiseError)throw l}},u.awaitHandlers)})),new Rd(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,r=Ke(),s=void 0,a=void 0,i=void 0,o=void 0){return await Promise.all(this.handlers.map(u=>{if(!u.ignoreAgent)return Ls(u)&&u._createRunForToolStart(e,t,r,this._parentRunId,this.tags,this.metadata,o),le(async()=>{try{await u.handleToolStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,o)}catch(l){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleToolStart: ${l}`),u.raiseError)throw l}},u.awaitHandlers)})),new kd(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,r=Ke(),s=void 0,a=void 0,i=void 0,o=void 0){return await Promise.all(this.handlers.map(u=>{if(!u.ignoreRetriever)return Ls(u)&&u._createRunForRetrieverStart(e,t,r,this._parentRunId,this.tags,this.metadata,o),le(async()=>{try{await u.handleRetrieverStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,o)}catch(l){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleRetrieverStart: ${l}`),u.raiseError)throw l}},u.awaitHandlers)})),new Cd(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleCustomEvent(e,t,r,s,a){await Promise.all(this.handlers.map(i=>le(async()=>{if(!i.ignoreCustomEvent)try{await i.handleCustomEvent?.(e,t,r,this.tags,this.metadata)}catch(o){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleCustomEvent: ${o}`),i.raiseError)throw o}},i.awaitHandlers)))}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e),this.inheritableHandlers=this.inheritableHandlers.filter(t=>t!==e)}setHandlers(e,t=!0){this.handlers=[],this.inheritableHandlers=[];for(let r of e)this.addHandler(r,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(t=>!e.includes(t)),this.inheritableTags=this.inheritableTags.filter(t=>!e.includes(t))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(let t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){let r=new n(this._parentRunId);for(let s of this.handlers){let a=this.inheritableHandlers.includes(s);r.addHandler(s,a)}for(let s of this.tags){let a=this.inheritableTags.includes(s);r.addTags([s],a)}for(let s of Object.keys(this.metadata)){let a=Object.keys(this.inheritableMetadata).includes(s);r.addMetadata({[s]:this.metadata[s]},a)}for(let s of e)r.handlers.filter(a=>a.name==="console_callback_handler").some(a=>a.name===s.name)||r.addHandler(s,t);return r}static fromHandlers(e){class t extends Fn{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:Ke()}),Object.assign(this,e)}}let r=new this;return r.addHandler(new t),r}static async configure(e,t,r,s,a,i,o){return this._configureSync(e,t,r,s,a,i,o)}static _configureSync(e,t,r,s,a,i,o){let u;(e||t)&&(Array.isArray(e)||!e?(u=new n,u.setHandlers(e?.map(li)??[],!0)):u=e,u=u.copy(Array.isArray(t)?t.map(li):t?.handlers,!1));let l=ie("LANGCHAIN_VERBOSE")==="true"||o?.verbose,c=Ds.getTraceableRunTree()?.tracingEnabled||Td(),d=c||(ie("LANGCHAIN_TRACING")??!1);if(l||d){if(u||(u=new n),l&&!u.handlers.some(f=>f.name===ui.prototype.name)){let f=new ui;u.addHandler(f,!0)}if(d&&!u.handlers.some(f=>f.name==="langchain_tracer")&&c){let f=new Ds;u.addHandler(f,!0),u._parentRunId=Ds.getTraceableRunTree()?.id??u._parentRunId}}return(r||s)&&u&&(u.addTags(r??[]),u.addTags(s??[],!1)),(a||i)&&u&&(u.addMetadata(a??{}),u.addMetadata(i??{},!1)),u}}});var jd,CE,$d,qy,Md,yt,Bs=h(()=>{Od();Us();jd=class{getStore(){}run(e,t){return t()}},CE=new jd,$d=Symbol.for("ls:tracing_async_local_storage"),qy=Symbol.for("lc:child_config"),Md=class{getInstance(){return globalThis[$d]??CE}getRunnableConfig(){return this.getInstance().getStore()?.extra?.[qy]}runWithConfig(e,t,r){let s=Ie._configureSync(e?.callbacks,void 0,e?.tags,void 0,e?.metadata),a=this.getInstance(),i=s?.getParentRunId(),o=s?.handlers?.find(l=>l?.name==="langchain_tracer"),u;return o&&i?u=o.convertToRunTree(i):r||(u=new Fr({name:"<runnable_lambda>",tracingEnabled:!1})),u&&(u.extra={...u.extra,[qy]:e}),a.run(u,t)}initializeGlobalInstance(e){globalThis[$d]===void 0&&(globalThis[$d]=e)}},yt=new Md});async function Vt(n,e){if(e===void 0)return n;let t;return Promise.race([n.catch(r=>{if(!e?.aborted)throw r}),new Promise((r,s)=>{t=()=>{s(new Error("Aborted"))},e.addEventListener("abort",t),e.aborted&&s(new Error("Aborted"))})]).finally(()=>e.removeEventListener("abort",t))}var Ld=h(()=>{});function Dd(n,e=2){let t=Array.from({length:e},()=>[]);return t.map(async function*(s){for(;;)if(s.length===0){let a=await n.next();for(let i of t)i.push(a)}else{if(s[0].done)return;yield s.shift().value}})}function je(n,e){if(Array.isArray(n)&&Array.isArray(e))return n.concat(e);if(typeof n=="string"&&typeof e=="string")return n+e;if(typeof n=="number"&&typeof e=="number")return n+e;if("concat"in n&&typeof n.concat=="function")return n.concat(e);if(typeof n=="object"&&typeof e=="object"){let t={...n};for(let[r,s]of Object.entries(e))r in t&&!Array.isArray(t[r])?t[r]=je(t[r],s):t[r]=s;return t}else throw new Error(`Cannot concat ${typeof n} and ${typeof e}`)}async function Vy(n,e,t,r,...s){let a=new _r({generator:e,startSetup:t,signal:r}),i=await a.setup;return{output:n(a,i,...s),setup:i}}var we,_r,Ht=h(()=>{Bs();Ld();we=class n extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{let e=await this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){let e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){let t=this.reader.cancel();this.reader.releaseLock(),await t}throw e}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}static fromReadableStream(e){let t=e.getReader();return new n({start(r){return s();function s(){return t.read().then(({done:a,value:i})=>{if(a){r.close();return}return r.enqueue(i),s()})}},cancel(){t.releaseLock()}})}static fromAsyncGenerator(e){return new n({async pull(t){let{value:r,done:s}=await e.next();s&&t.close(),t.enqueue(r)},async cancel(t){await e.return(t)}})}};_r=class{constructor(e){Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"signal",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e.generator,this.config=e.config,this.signal=e.signal??this.config?.signal,this.setup=new Promise((t,r)=>{yt.runWithConfig(e.config,async()=>{this.firstResult=e.generator.next(),e.startSetup?this.firstResult.then(e.startSetup).then(t,r):this.firstResult.then(s=>t(void 0),r)},!0)})}async next(...e){return this.signal?.throwIfAborted(),this.firstResultUsed?yt.runWithConfig(this.config,this.signal?async()=>Vt(this.generator.next(...e),this.signal):async()=>this.generator.next(...e),!0):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}}});async function Hy(n,e){if(e==="original")throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");let{inputs:t}=n;if(["retriever","llm","prompt"].includes(n.run_type))return t;if(!(Object.keys(t).length===1&&t?.input===""))return t.input}async function Gy(n,e){let{outputs:t}=n;return e==="original"||["retriever","llm","prompt"].includes(n.run_type)?t:t!==void 0&&Object.keys(t).length===1&&t?.output!==void 0?t.output:t}function RE(n){return n!==void 0&&n.message!==void 0}var St,ci,fi,di,Au=h(()=>{wd();Un();Ht();Cn();St=class{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops??[]}concat(e){let t=this.ops.concat(e.ops),r=Br({},t);return new ci({ops:t,state:r[r.length-1].newDocument})}},ci=class n extends St{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){let t=this.ops.concat(e.ops),r=Br(this.state,e.ops);return new n({ops:t,state:r[r.length-1].newDocument})}static fromRunLogPatch(e){let t=Br({},e.ops);return new n({ops:e.ops,state:t[t.length-1].newDocument})}},fi=n=>n.name==="log_stream_tracer";di=class extends mt{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this._schemaFormat=e?._schemaFormat??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=we.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;let t=e.tags??[],r=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(e.run_type)),this.includeTags!==void 0&&(r=r||t.find(s=>this.includeTags?.includes(s))!==void 0),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(e.run_type)),this.excludeTags!==void 0&&(r=r&&t.every(s=>!this.excludeTags?.includes(s))),r}async*tapOutputIterable(e,t){for await(let r of t){if(e!==this.rootId){let s=this.keyMapByRunId[e];s&&await this.writer.write(new St({ops:[{op:"add",path:`/logs/${s}/streamed_output/-`,value:r}]}))}yield r}}async onRunCreate(e){if(this.rootId===void 0&&(this.rootId=e.id,await this.writer.write(new St({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;this.counterMapByRunName[e.name]===void 0&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;let t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=t===1?e.name:`${e.name}:${t}`;let r={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:e.extra?.metadata??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};this._schemaFormat==="streaming_events"&&(r.inputs=await Hy(e,this._schemaFormat)),await this.writer.write(new St({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:r}]}))}async onRunUpdate(e){try{let t=this.keyMapByRunId[e.id];if(t===void 0)return;let r=[];this._schemaFormat==="streaming_events"&&r.push({op:"replace",path:`/logs/${t}/inputs`,value:await Hy(e,this._schemaFormat)}),r.push({op:"add",path:`/logs/${t}/final_output`,value:await Gy(e,this._schemaFormat)}),e.end_time!==void 0&&r.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});let s=new St({ops:r});await this.writer.write(s)}finally{if(e.id===this.rootId){let t=new St({ops:[{op:"replace",path:"/final_output",value:await Gy(e,this._schemaFormat)}]});await this.writer.write(t),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,t,r){let s=this.keyMapByRunId[e.id];if(s===void 0)return;let a=e.inputs.messages!==void 0,i;a?RE(r?.chunk)?i=r?.chunk:i=new Re({id:`run-${e.id}`,content:t}):i=t;let o=new St({ops:[{op:"add",path:`/logs/${s}/streamed_output_str/-`,value:t},{op:"add",path:`/logs/${s}/streamed_output/-`,value:i}]});await this.writer.write(o)}}});var Eu,Gt,Ct,zs=h(()=>{Eu="__run",Gt=class n{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new n({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}},Ct=class n extends Gt{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new n({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo},message:this.message.concat(e.message)})}}});function Ou({name:n,serialized:e}){return n!==void 0?n:e?.name!==void 0?e.name:e?.id!==void 0&&Array.isArray(e?.id)?e.id[e.id.length-1]:"Unnamed"}var pi,Iu,Pu=h(()=>{Un();Ht();Cn();zs();pi=n=>n.name==="event_stream_tracer",Iu=class extends mt{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runInfoMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"tappedPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"event_stream_tracer"}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=we.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){let t=e.tags??[],r=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(e.runType)),this.includeTags!==void 0&&(r=r||t.find(s=>this.includeTags?.includes(s))!==void 0),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(e.runType)),this.excludeTags!==void 0&&(r=r&&t.every(s=>!this.excludeTags?.includes(s))),r}async*tapOutputIterable(e,t){let r=await t.next();if(r.done)return;let s=this.runInfoMap.get(e);if(s===void 0){yield r.value;return}function a(o,u){return o==="llm"&&typeof u=="string"?new Gt({text:u}):u}let i=this.tappedPromises.get(e);if(i===void 0){let o;i=new Promise(u=>{o=u}),this.tappedPromises.set(e,i);try{let u={event:`on_${s.runType}_stream`,run_id:e,name:s.name,tags:s.tags,metadata:s.metadata,data:{}};await this.send({...u,data:{chunk:a(s.runType,r.value)}},s),yield r.value;for await(let l of t)s.runType!=="tool"&&s.runType!=="retriever"&&await this.send({...u,data:{chunk:a(s.runType,l)}},s),yield l}finally{o()}}else{yield r.value;for await(let o of t)yield o}}async send(e,t){this._includeRun(t)&&await this.writer.write(e)}async sendEndEvent(e,t){let r=this.tappedPromises.get(e.run_id);r!==void 0?r.then(()=>{this.send(e,t)}):await this.send(e,t)}async onLLMStart(e){let t=Ou(e),r=e.inputs.messages!==void 0?"chat_model":"llm",s={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:r,inputs:e.inputs};this.runInfoMap.set(e.id,s);let a=`on_${r}_start`;await this.send({event:a,data:{input:e.inputs},name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},s)}async onLLMNewToken(e,t,r){let s=this.runInfoMap.get(e.id),a,i;if(s===void 0)throw new Error(`onLLMNewToken: Run ID ${e.id} not found in run map.`);if(this.runInfoMap.size!==1){if(s.runType==="chat_model")i="on_chat_model_stream",r?.chunk===void 0?a=new Re({content:t,id:`run-${e.id}`}):a=r.chunk.message;else if(s.runType==="llm")i="on_llm_stream",r?.chunk===void 0?a=new Gt({text:t}):a=r.chunk;else throw new Error(`Unexpected run type ${s.runType}`);await this.send({event:i,data:{chunk:a},run_id:e.id,name:s.name,tags:s.tags,metadata:s.metadata},s)}}async onLLMEnd(e){let t=this.runInfoMap.get(e.id);this.runInfoMap.delete(e.id);let r;if(t===void 0)throw new Error(`onLLMEnd: Run ID ${e.id} not found in run map.`);let s=e.outputs?.generations,a;if(t.runType==="chat_model"){for(let i of s??[]){if(a!==void 0)break;a=i[0]?.message}r="on_chat_model_end"}else if(t.runType==="llm")a={generations:s?.map(i=>i.map(o=>({text:o.text,generationInfo:o.generationInfo}))),llmOutput:e.outputs?.llmOutput??{}},r="on_llm_end";else throw new Error(`onLLMEnd: Unexpected run type: ${t.runType}`);await this.sendEndEvent({event:r,data:{output:a,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onChainStart(e){let t=Ou(e),r=e.run_type??"chain",s={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:e.run_type},a={};e.inputs.input===""&&Object.keys(e.inputs).length===1?(a={},s.inputs={}):e.inputs.input!==void 0?(a.input=e.inputs.input,s.inputs=e.inputs.input):(a.input=e.inputs,s.inputs=e.inputs),this.runInfoMap.set(e.id,s),await this.send({event:`on_${r}_start`,data:a,name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},s)}async onChainEnd(e){let t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onChainEnd: Run ID ${e.id} not found in run map.`);let r=`on_${e.run_type}_end`,s=e.inputs??t.inputs??{},i={output:e.outputs?.output??e.outputs,input:s};s.input&&Object.keys(s).length===1&&(i.input=s.input,t.inputs=s.input),await this.sendEndEvent({event:r,data:i,run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata??{}},t)}async onToolStart(e){let t=Ou(e),r={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:"tool",inputs:e.inputs??{}};this.runInfoMap.set(e.id,r),await this.send({event:"on_tool_start",data:{input:e.inputs??{}},name:t,run_id:e.id,tags:e.tags??[],metadata:e.extra?.metadata??{}},r)}async onToolEnd(e){let t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(t.inputs===void 0)throw new Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);let r=e.outputs?.output===void 0?e.outputs:e.outputs.output;await this.sendEndEvent({event:"on_tool_end",data:{output:r,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onRetrieverStart(e){let t=Ou(e),s={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:"retriever",inputs:{query:e.inputs.query}};this.runInfoMap.set(e.id,s),await this.send({event:"on_retriever_start",data:{input:{query:e.inputs.query}},name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},s)}async onRetrieverEnd(e){let t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onRetrieverEnd: Run ID ${e.id} not found in run map.`);await this.sendEndEvent({event:"on_retriever_end",data:{output:e.outputs?.documents??e.outputs,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async handleCustomEvent(e,t,r){let s=this.runInfoMap.get(r);if(s===void 0)throw new Error(`handleCustomEvent: Run ID ${r} not found in run map.`);await this.send({event:"on_custom_event",run_id:r,name:e,tags:s.tags,metadata:s.metadata,data:t},s)}async finish(){let e=[...this.tappedPromises.values()];Promise.all(e).finally(()=>{this.writer.close()})}}});async function We(n){return Ie._configureSync(n?.callbacks,void 0,n?.tags,void 0,n?.metadata)}function Su(...n){let e={};for(let t of n.filter(r=>!!r))for(let r of Object.keys(t))if(r==="metadata")e[r]={...e[r],...t[r]};else if(r==="tags"){let s=e[r]??[];e[r]=[...new Set(s.concat(t[r]??[]))]}else if(r==="configurable")e[r]={...e[r],...t[r]};else if(r==="timeout")e.timeout===void 0?e.timeout=t.timeout:t.timeout!==void 0&&(e.timeout=Math.min(e.timeout,t.timeout));else if(r==="signal")e.signal===void 0?e.signal=t.signal:t.signal!==void 0&&("any"in AbortSignal?e.signal=AbortSignal.any([e.signal,t.signal]):e.signal=t.signal);else if(r==="callbacks"){let s=e.callbacks,a=t.callbacks;if(Array.isArray(a))if(!s)e.callbacks=a;else if(Array.isArray(s))e.callbacks=s.concat(a);else{let i=s.copy();for(let o of a)i.addHandler(li(o),!0);e.callbacks=i}else if(a)if(!s)e.callbacks=a;else if(Array.isArray(s)){let i=a.copy();for(let o of s)i.addHandler(li(o),!0);e.callbacks=i}else e.callbacks=new Ie(a._parentRunId,{handlers:s.handlers.concat(a.handlers),inheritableHandlers:s.inheritableHandlers.concat(a.inheritableHandlers),tags:Array.from(new Set(s.tags.concat(a.tags))),inheritableTags:Array.from(new Set(s.inheritableTags.concat(a.inheritableTags))),metadata:{...s.metadata,...a.metadata}})}else{let s=r;e[s]=t[s]??e[s]}return e}function K(n){let e=yt.getRunnableConfig(),t={tags:[],metadata:{},recursionLimit:25,runId:void 0};if(e){let{runId:r,runName:s,...a}=e;t=Object.entries(a).reduce((i,[o,u])=>(u!==void 0&&(i[o]=u),i),t)}if(n&&(t=Object.entries(n).reduce((r,[s,a])=>(a!==void 0&&(r[s]=a),r),t)),t?.configurable)for(let r of Object.keys(t.configurable))kE.has(typeof t.configurable[r])&&!t.metadata?.[r]&&(t.metadata||(t.metadata={}),t.metadata[r]=t.configurable[r]);if(t.timeout!==void 0){if(t.timeout<=0)throw new Error("Timeout must be a positive number");let r=AbortSignal.timeout(t.timeout);t.signal!==void 0?"any"in AbortSignal&&(t.signal=AbortSignal.any([t.signal,r])):t.signal=r,delete t.timeout}return t}function ce(n={},{callbacks:e,maxConcurrency:t,recursionLimit:r,runName:s,configurable:a,runId:i}={}){let o=K(n);return e!==void 0&&(delete o.runName,o.callbacks=e),r!==void 0&&(o.recursionLimit=r),t!==void 0&&(o.maxConcurrency=t),s!==void 0&&(o.runName=s),a!==void 0&&(o.configurable={...o.configurable,...a}),i!==void 0&&delete o.runId,o}var Tu,kE,Bn=h(()=>{Us();Bs();Tu=25;kE=new Set(["string","number","boolean"])});var Ky,Cu,NE,$E,wr,hi=h(()=>{Ky=at($o(),1),Cu=at(Vo(),1),NE=[400,401,402,403,404,405,406,407,409],$E=n=>{if(n.message.startsWith("Cancel")||n.message.startsWith("AbortError")||n.name==="AbortError"||n?.code==="ECONNABORTED")throw n;let e=n?.response?.status??n?.status;if(e&&NE.includes(+e))throw n;if(n?.error?.code==="insufficient_quota"){let t=new Error(n?.message);throw t.name="InsufficientQuotaError",t}},wr=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??$E;let t="default"in Cu.default?Cu.default.default:Cu.default;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>(0,Ky.default)(()=>e(...t).catch(r=>{throw r instanceof Error?r:new Error(r)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((s,a)=>{e.signal?.addEventListener("abort",()=>{a(new Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>fetch(...e).then(t=>t.ok?t:Promise.reject(t)))}}});var mi,Jy=h(()=>{Un();mi=class extends mt{constructor({config:e,onStart:t,onEnd:r,onError:s}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=t,this.argOnEnd=r,this.argOnError=s}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&(this.argOnStart.length===1?await this.argOnStart(e):this.argOnStart.length===2&&await this.argOnStart(e,this.config)))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&(this.argOnError.length===1?await this.argOnError(e):this.argOnError.length===2&&await this.argOnError(e,this.config)):this.argOnEnd&&(this.argOnEnd.length===1?await this.argOnEnd(e):this.argOnEnd.length===2&&await this.argOnEnd(e,this.config)))}}});function gi(n){return n?n.lc_runnable:!1}var Ru,Fd=h(()=>{Ru=class{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,t){let r=this.includeNames===void 0&&this.includeTypes===void 0&&this.includeTags===void 0,s=e.tags??[];return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(t)),this.includeTags!==void 0&&(r=r||s.some(a=>this.includeTags?.includes(a))),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(t)),this.excludeTags!==void 0&&(r=r&&s.every(a=>!this.excludeTags?.includes(a))),r}}});function Ud(n){return n.replace(/[^a-zA-Z-_0-9]/g,"_")}function jE(n,e){let t=e[n.source]??n.source,r=e[n.target]??n.target;return[t,r]}function ME(n){let e="";for(let[t,r]of Object.entries(n))e+=`	classDef ${t}class fill:${r};
`;return e}function Wy(n,e,t){let{firstNodeLabel:r,lastNodeLabel:s,nodeColors:a,withStyles:i=!0,curveStyle:o="linear",wrapLabelNWords:u=9}=t??{},l=i?`%%{init: {'flowchart': {'curve': '${o}'}}}%%
graph TD;
`:`graph TD;
`;if(i){let d="default",f={[d]:"{0}([{1}]):::otherclass"};r!==void 0&&(f[r]="{0}[{0}]:::startclass"),s!==void 0&&(f[s]="{0}[{0}]:::endclass");for(let p of Object.values(n)){let g=f[p]??f[d],m=Ud(p),y=p.split(":"),x=y[y.length-1];l+=`	${g.replace(/\{0\}/g,m).replace(/\{1\}/g,x)};
`}}let c="";for(let d of e){let f=d.source.includes(":")?d.source.split(":")[0]:void 0,p=d.target.includes(":")?d.target.split(":")[0]:void 0;c!==""&&(c!==f||c!==p)&&(l+=`	end
`,c=""),c===""&&f!==void 0&&f===p&&(l=`	subgraph ${f}
`,c=f);let[g,m]=jE(d,n),y="";if(d.data!==void 0){let x=d.data,w=x.split(" ");w.length>u&&(x=w.reduce((A,k,R)=>(R%u===0&&A.push(""),A[A.length-1]+=` ${k}`,A),[]).join("<br>")),d.conditional?y=` -. ${x} .-> `:y=` -- ${x} --> `}else d.conditional?y=" -.-> ":y=" --> ";l+=`	${Ud(g)}${y}${Ud(m)};
`}return c!==""&&(l+=`end
`),i&&a!==void 0&&(l+=ME(a)),l}async function Zy(n,e){let{backgroundColor:t="white"}=e??{},r=btoa(n);t!==void 0&&(/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(t)||(t=`!${t}`));let s=`https://mermaid.ink/img/${r}?bgColor=${t}`,a=await fetch(s);if(!a.ok)throw new Error(["Failed to render the graph using the Mermaid.INK API.",`Status code: ${a.status}`,`Status text: ${a.statusText}`].join(`
`));return await a.blob()}var Yy=h(()=>{});function Bd(n){if(Ja(n.id))if(gi(n.data))try{let e=n.data.getName();return e=e.startsWith("Runnable")?e.slice(8):e,e.length>Xy&&(e=`${e.substring(0,Xy)}...`),e}catch{return n.data.getName()}else return n.data.name??"UnknownSchema";else return n.id}function LE(n){return gi(n.data)?{type:"runnable",data:{id:n.data.lc_id,name:n.data.getName()}}:{type:"schema",data:{...Ot(n.data.schema),title:n.data.name}}}var Xy,yi,Qy=h(()=>{pr();Wa();Fd();Yy();Xy=42;yi=class{constructor(){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]})}toJSON(){let e={};return Object.values(this.nodes).forEach((t,r)=>{e[t.id]=Ja(t.id)?r:t.id}),{nodes:Object.values(this.nodes).map(t=>({id:e[t.id],...LE(t)})),edges:this.edges.map(t=>{let r={source:e[t.source],target:e[t.target]};return typeof t.data<"u"&&(r.data=t.data),typeof t.conditional<"u"&&(r.conditional=t.conditional),r})}}addNode(e,t){if(t!==void 0&&this.nodes[t]!==void 0)throw new Error(`Node with id ${t} already exists`);let r=t||Ke(),s={id:r,data:e};return this.nodes[r]=s,s}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(t=>t.source!==e.id&&t.target!==e.id)}addEdge(e,t,r,s){if(this.nodes[e.id]===void 0)throw new Error(`Source node ${e.id} not in graph`);if(this.nodes[t.id]===void 0)throw new Error(`Target node ${t.id} not in graph`);let a={source:e.id,target:t.id,data:r,conditional:s};return this.edges.push(a),a}firstNode(){let e=new Set(this.edges.map(r=>r.target)),t=[];return Object.values(this.nodes).forEach(r=>{e.has(r.id)||t.push(r)}),t[0]}lastNode(){let e=new Set(this.edges.map(r=>r.source)),t=[];return Object.values(this.nodes).forEach(r=>{e.has(r.id)||t.push(r)}),t[0]}extend(e,t=""){let r=t;Object.values(e.nodes).map(l=>l.id).every(Ja)&&(r="");let a=l=>r?`${r}:${l}`:l;Object.entries(e.nodes).forEach(([l,c])=>{this.nodes[a(l)]={...c,id:a(l)}});let i=e.edges.map(l=>({...l,source:a(l.source),target:a(l.target)}));this.edges=[...this.edges,...i];let o=e.firstNode(),u=e.lastNode();return[o?{id:a(o.id),data:o.data}:void 0,u?{id:a(u.id),data:u.data}:void 0]}trimFirstNode(){let e=this.firstNode();if(e){let t=this.edges.filter(r=>r.source===e.id);(Object.keys(this.nodes).length===1||t.length===1)&&this.removeNode(e)}}trimLastNode(){let e=this.lastNode();if(e){let t=this.edges.filter(r=>r.target===e.id);(Object.keys(this.nodes).length===1||t.length===1)&&this.removeNode(e)}}drawMermaid(e){let{withStyles:t,curveStyle:r,nodeColors:s={start:"#ffdfba",end:"#baffc9",other:"#fad7de"},wrapLabelNWords:a}=e??{},i={};for(let d of Object.values(this.nodes))i[d.id]=Bd(d);let o=this.firstNode(),u=o?Bd(o):void 0,l=this.lastNode(),c=l?Bd(l):void 0;return Wy(i,this.edges,{firstNodeLabel:u,lastNodeLabel:c,withStyles:t,curveStyle:r,nodeColors:s,wrapLabelNWords:a})}async drawMermaidPng(e){let t=this.drawMermaid(e);return Zy(t,{backgroundColor:e?.backgroundColor})}}});function eb(n){let e=new TextEncoder,t=new ReadableStream({async start(r){for await(let s of n)r.enqueue(e.encode(`event: data
data: ${JSON.stringify(s)}

`));r.enqueue(e.encode(`event: end

`)),r.close()}});return we.fromReadableStream(t)}var tb=h(()=>{Ht()});function zd(n){return typeof n=="object"&&n!==null&&typeof n[Symbol.iterator]=="function"&&typeof n.next=="function"}function ku(n){return typeof n=="object"&&n!==null&&typeof n[Symbol.asyncIterator]=="function"}function*qd(n,e){for(;;){let{value:t,done:r}=yt.runWithConfig(n,e.next.bind(e),!0);if(r)break;yield t}}async function*Vd(n,e){let t=e[Symbol.asyncIterator]();for(;;){let{value:r,done:s}=await yt.runWithConfig(n,t.next.bind(e),!0);if(s)break;yield r}}var rb,nb=h(()=>{Bs();rb=n=>n!=null&&typeof n=="object"&&"next"in n&&typeof n.next=="function"});function me(n,e){return n&&!Array.isArray(n)&&!(n instanceof Date)&&typeof n=="object"?n:{[e]:n}}function DE(n){if(hu(n))throw new Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.")}function vr(n){if(typeof n=="function")return new Wt({func:n});if(X.isRunnable(n))return n;if(!Array.isArray(n)&&typeof n=="object"){let e={};for(let[t,r]of Object.entries(n))e[t]=vr(r);return new qr({steps:e})}else throw new Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`)}function FE(n,e){let t=e.name??n.getName(),r=e.description??e.schema?.description;return e.schema.constructor===xt.ZodString?new bi({name:t,description:r,schema:xt.object({input:xt.string()}).transform(s=>s.input),bound:n}):new bi({name:t,description:r,schema:e.schema,bound:n})}var Hd,X,Kt,Nu,$u,Jt,qr,Gd,Wt,ju,qs,Mu,bi,bt=h(()=>{Ts();Hd=at($o(),1);Wa();bd();Au();Pu();Ss();Ht();Ld();Bn();hi();Jy();Fd();Bs();Qy();tb();nb();Ro();X=class extends Qe{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){let t=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${t}${e}`:t}bind(e){return new Kt({bound:this,kwargs:e,config:{}})}map(){return new Nu({bound:this})}withRetry(e){return new $u({bound:this,kwargs:{},config:{},maxAttemptNumber:e?.stopAfterAttempt,...e})}withConfig(e){return new Kt({bound:this,config:e,kwargs:{}})}withFallbacks(e){let t=Array.isArray(e)?e:e.fallbacks;return new ju({runnable:this,fallbacks:t})}_getOptionsList(e,t=0){if(Array.isArray(e)&&e.length!==t)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);if(Array.isArray(e))return e.map(K);if(t>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");let r=Object.fromEntries(Object.entries(e).filter(([s])=>s!=="runId"));return Array.from({length:t},(s,a)=>K(a===0?e:r))}return Array.from({length:t},()=>K(e))}async batch(e,t,r){let s=this._getOptionsList(t??{},e.length),a=s[0]?.maxConcurrency??r?.maxConcurrency,i=new wr({maxConcurrency:a,onFailedAttempt:u=>{throw u}}),o=e.map((u,l)=>i.call(async()=>{try{return await this.invoke(u,s[l])}catch(c){if(r?.returnExceptions)return c;throw c}}));return Promise.all(o)}async*_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){let r=K(t),s=new _r({generator:this._streamIterator(e,r),config:r});return await s.setup,we.fromAsyncGenerator(s)}_separateRunnableConfigFromCallOptions(e){let t;e===void 0?t=K(e):t=K({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId,timeout:e.timeout,signal:e.signal});let r={...e};return delete r.callbacks,delete r.tags,delete r.metadata,delete r.runName,delete r.configurable,delete r.recursionLimit,delete r.maxConcurrency,delete r.runId,delete r.timeout,delete r.signal,[t,r]}async _callWithConfig(e,t,r){let s=K(r),i=await(await We(s))?.handleChainStart(this.toJSON(),me(t,"input"),s.runId,s?.runType,void 0,void 0,s?.runName??this.getName());delete s.runId;let o;try{let u=e.call(this,t,s,i);o=await Vt(u,r?.signal)}catch(u){throw await i?.handleChainError(u),u}return await i?.handleChainEnd(me(o,"output")),o}async _batchWithConfig(e,t,r,s){let a=this._getOptionsList(r??{},t.length),i=await Promise.all(a.map(We)),o=await Promise.all(i.map(async(l,c)=>{let d=await l?.handleChainStart(this.toJSON(),me(t[c],"input"),a[c].runId,a[c].runType,void 0,void 0,a[c].runName??this.getName());return delete a[c].runId,d})),u;try{let l=e.call(this,t,a,o,s);u=await Vt(l,a?.[0]?.signal)}catch(l){throw await Promise.all(o.map(c=>c?.handleChainError(l))),l}return await Promise.all(o.map(l=>l?.handleChainEnd(me(u,"output")))),u}async*_transformStreamWithConfig(e,t,r){let s,a=!0,i,o=!0,u=K(r),l=await We(u);async function*c(){for await(let f of e){if(a)if(s===void 0)s=f;else try{s=je(s,f)}catch{s=void 0,a=!1}yield f}}let d;try{let f=await Vy(t.bind(this),c(),async()=>l?.handleChainStart(this.toJSON(),{input:""},u.runId,u.runType,void 0,void 0,u.runName??this.getName()),r?.signal,u);delete u.runId,d=f.setup;let p=d?.handlers.find(pi),g=f.output;p!==void 0&&d!==void 0&&(g=p.tapOutputIterable(d.runId,g));let m=d?.handlers.find(fi);m!==void 0&&d!==void 0&&(g=m.tapOutputIterable(d.runId,g));for await(let y of g)if(yield y,o)if(i===void 0)i=y;else try{i=je(i,y)}catch{i=void 0,o=!1}}catch(f){throw await d?.handleChainError(f,void 0,void 0,void 0,{inputs:me(s,"input")}),f}await d?.handleChainEnd(i??{},void 0,void 0,void 0,{inputs:me(s,"input")})}getGraph(e){let t=new yi,r=t.addNode({name:`${this.getName()}Input`,schema:xt.any()}),s=t.addNode(this),a=t.addNode({name:`${this.getName()}Output`,schema:xt.any()});return t.addEdge(r,s),t.addEdge(s,a),t}pipe(e){return new Jt({first:this,last:vr(e)})}pick(e){return this.pipe(new Mu(e))}assign(e){return this.pipe(new qs(new qr({steps:e})))}async*transform(e,t){let r;for await(let s of e)r===void 0?r=s:r=je(r,s);yield*this._streamIterator(r,K(t))}async*streamLog(e,t,r){let s=new di({...r,autoClose:!1,_schemaFormat:"original"}),a=K(t);yield*this._streamLog(e,s,a)}async*_streamLog(e,t,r){let{callbacks:s}=r;if(s===void 0)r.callbacks=[t];else if(Array.isArray(s))r.callbacks=s.concat([t]);else{let u=s.copy();u.addHandler(t,!0),r.callbacks=u}let a=this.stream(e,r);async function i(){try{let u=await a;for await(let l of u){let c=new St({ops:[{op:"add",path:"/streamed_output/-",value:l}]});await t.writer.write(c)}}finally{await t.writer.close()}}let o=i();try{for await(let u of t)yield u}finally{await o}}streamEvents(e,t,r){let s;if(t.version==="v1")s=this._streamEventsV1(e,t,r);else if(t.version==="v2")s=this._streamEventsV2(e,t,r);else throw new Error('Only versions "v1" and "v2" of the schema are currently supported.');return t.encoding==="text/event-stream"?eb(s):we.fromAsyncGenerator(s)}async*_streamEventsV2(e,t,r){let s=new Iu({...r,autoClose:!1}),a=K(t),i=a.runId??Ke();a.runId=i;let o=a.callbacks;if(o===void 0)a.callbacks=[s];else if(Array.isArray(o))a.callbacks=o.concat(s);else{let p=o.copy();p.addHandler(s,!0),a.callbacks=p}let u=this;async function l(){try{let p=await u.stream(e,a),g=s.tapOutputIterable(i,p);for await(let m of g);}finally{await s.finish()}}let c=l(),d=!1,f;try{for await(let p of s){if(!d){p.data.input=e,d=!0,f=p.run_id,yield p;continue}p.run_id===f&&p.event.endsWith("_end")&&p.data?.input&&delete p.data.input,yield p}}finally{await c}}async*_streamEventsV1(e,t,r){let s,a=!1,i=K(t),o=i.tags??[],u=i.metadata??{},l=i.runName??this.getName(),c=new di({...r,autoClose:!1,_schemaFormat:"streaming_events"}),d=new Ru({...r}),f=this._streamLog(e,c,i);for await(let g of f){if(s?s=s.concat(g):s=ci.fromRunLogPatch(g),s.state===void 0)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!a){a=!0;let w={...s.state},A={run_id:w.id,event:`on_${w.type}_start`,name:l,tags:o,metadata:u,data:{input:e}};d.includeEvent(A,w.type)&&(yield A)}let m=g.ops.filter(w=>w.path.startsWith("/logs/")).map(w=>w.path.split("/")[2]),y=[...new Set(m)];for(let w of y){let A,k={},R=s.state.logs[w];if(R.end_time===void 0?R.streamed_output.length>0?A="stream":A="start":A="end",A==="start")R.inputs!==void 0&&(k.input=R.inputs);else if(A==="end")R.inputs!==void 0&&(k.input=R.inputs),k.output=R.final_output;else if(A==="stream"){let W=R.streamed_output.length;if(W!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${W} instead. Encountered in: "${R.name}"`);k={chunk:R.streamed_output[0]},R.streamed_output=[]}yield{event:`on_${R.type}_${A}`,name:R.name,run_id:R.id,tags:R.tags,metadata:R.metadata,data:k}}let{state:x}=s;if(x.streamed_output.length>0){let w=x.streamed_output.length;if(w!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${w} instead. Encountered in: "${x.name}"`);let A={chunk:x.streamed_output[0]};x.streamed_output=[];let k={event:`on_${x.type}_stream`,run_id:x.id,tags:o,metadata:u,name:l,data:A};d.includeEvent(k,x.type)&&(yield k)}}let p=s?.state;if(p!==void 0){let g={event:`on_${p.type}_end`,name:l,run_id:p.id,tags:o,metadata:u,data:{output:p.final_output}};d.includeEvent(g,p.type)&&(yield g)}}static isRunnable(e){return gi(e)}withListeners({onStart:e,onEnd:t,onError:r}){return new Kt({bound:this,config:{},configFactories:[s=>({callbacks:[new mi({config:s,onStart:e,onEnd:t,onError:r})]})]})}asTool(e){return FE(this,e)}},Kt=class n extends X{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){let t=Su(this.config,...e);return Su(t,...this.configFactories?await Promise.all(this.configFactories.map(async r=>await r(t))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new this.constructor({bound:this.bound.withRetry(e),kwargs:this.kwargs,config:this.config})}async invoke(e,t){return this.bound.invoke(e,await this._mergeConfig(K(t),this.kwargs))}async batch(e,t,r){let s=Array.isArray(t)?await Promise.all(t.map(async a=>this._mergeConfig(K(a),this.kwargs))):await this._mergeConfig(K(t),this.kwargs);return this.bound.batch(e,s,r)}async*_streamIterator(e,t){yield*this.bound._streamIterator(e,await this._mergeConfig(K(t),this.kwargs))}async stream(e,t){return this.bound.stream(e,await this._mergeConfig(K(t),this.kwargs))}async*transform(e,t){yield*this.bound.transform(e,await this._mergeConfig(K(t),this.kwargs))}streamEvents(e,t,r){let s=this,a=async function*(){yield*s.bound.streamEvents(e,{...await s._mergeConfig(K(t),s.kwargs),version:t.version},r)};return we.fromAsyncGenerator(a())}static isRunnableBinding(e){return e.bound&&X.isRunnable(e.bound)}withListeners({onStart:e,onEnd:t,onError:r}){return new n({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[s=>({callbacks:[new mi({config:s,onStart:e,onEnd:t,onError:r})]})]})}},Nu=class n extends X{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new n({bound:this.bound.bind(e)})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async _invoke(e,t,r){return this.bound.batch(e,ce(t,{callbacks:r?.getChild()}))}withListeners({onStart:e,onEnd:t,onError:r}){return new n({bound:this.bound.withListeners({onStart:e,onEnd:t,onError:r})})}},$u=class extends Kt{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,r){let s=e>1?`retry:attempt:${e}`:void 0;return ce(t,{callbacks:r?.getChild(s)})}async _invoke(e,t,r){return(0,Hd.default)(s=>super.invoke(e,this._patchConfigForRetry(s,t,r)),{onFailedAttempt:s=>this.onFailedAttempt(s,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async _batch(e,t,r,s){let a={};try{await(0,Hd.default)(async i=>{let o=e.map((f,p)=>p).filter(f=>a[f.toString()]===void 0||a[f.toString()]instanceof Error),u=o.map(f=>e[f]),l=o.map(f=>this._patchConfigForRetry(i,t?.[f],r?.[f])),c=await super.batch(u,l,{...s,returnExceptions:!0}),d;for(let f=0;f<c.length;f+=1){let p=c[f],g=o[f];p instanceof Error&&d===void 0&&(d=p,d.input=u[f]),a[g.toString()]=p}if(d)throw d;return c},{onFailedAttempt:i=>this.onFailedAttempt(i,i.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(i){if(s?.returnExceptions!==!0)throw i}return Object.keys(a).sort((i,o)=>parseInt(i,10)-parseInt(o,10)).map(i=>a[parseInt(i,10)])}async batch(e,t,r){return this._batchWithConfig(this._batch.bind(this),e,t,r)}},Jt=class n extends X{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){let r=K(t),a=await(await We(r))?.handleChainStart(this.toJSON(),me(e,"input"),r.runId,void 0,void 0,void 0,r?.runName);delete r.runId;let i=e,o;try{let u=[this.first,...this.middle];for(let l=0;l<u.length;l+=1){let d=u[l].invoke(i,ce(r,{callbacks:a?.getChild(`seq:step:${l+1}`)}));i=await Vt(d,t?.signal)}if(t?.signal?.aborted)throw new Error("Aborted");o=await this.last.invoke(i,ce(r,{callbacks:a?.getChild(`seq:step:${this.steps.length}`)}))}catch(u){throw await a?.handleChainError(u),u}return await a?.handleChainEnd(me(o,"output")),o}async batch(e,t,r){let s=this._getOptionsList(t??{},e.length),a=await Promise.all(s.map(We)),i=await Promise.all(a.map(async(u,l)=>{let c=await u?.handleChainStart(this.toJSON(),me(e[l],"input"),s[l].runId,void 0,void 0,void 0,s[l].runName);return delete s[l].runId,c})),o=e;try{for(let u=0;u<this.steps.length;u+=1){let c=this.steps[u].batch(o,i.map((d,f)=>{let p=d?.getChild(`seq:step:${u+1}`);return ce(s[f],{callbacks:p})}),r);o=await Vt(c,s[0]?.signal)}}catch(u){throw await Promise.all(i.map(l=>l?.handleChainError(u))),u}return await Promise.all(i.map(u=>u?.handleChainEnd(me(o,"output")))),o}async*_streamIterator(e,t){let r=await We(t),{runId:s,...a}=t??{},i=await r?.handleChainStart(this.toJSON(),me(e,"input"),s,void 0,void 0,void 0,a?.runName),o=[this.first,...this.middle,this.last],u=!0,l;async function*c(){yield e}try{let d=o[0].transform(c(),ce(a,{callbacks:i?.getChild("seq:step:1")}));for(let f=1;f<o.length;f+=1)d=await o[f].transform(d,ce(a,{callbacks:i?.getChild(`seq:step:${f+1}`)}));for await(let f of d)if(t?.signal?.throwIfAborted(),yield f,u)if(l===void 0)l=f;else try{l=je(l,f)}catch{l=void 0,u=!1}}catch(d){throw await i?.handleChainError(d),d}await i?.handleChainEnd(me(l,"output"))}getGraph(e){let t=new yi,r=null;return this.steps.forEach((s,a)=>{let i=s.getGraph(e);a!==0&&i.trimFirstNode(),a!==this.steps.length-1&&i.trimLastNode(),t.extend(i);let o=i.firstNode();if(!o)throw new Error(`Runnable ${s} has no first node`);r&&t.addEdge(r,o),r=i.lastNode()}),t}pipe(e){return n.isRunnableSequence(e)?new n({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:this.name??e.name}):new n({first:this.first,middle:[...this.middle,this.last],last:vr(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&X.isRunnable(e)}static from([e,...t],r){return new n({first:vr(e),middle:t.slice(0,-1).map(vr),last:vr(t[t.length-1]),name:r})}},qr=class n extends X{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(let[t,r]of Object.entries(e.steps))this.steps[t]=vr(r)}static from(e){return new n({steps:e})}async invoke(e,t){let r=K(t),a=await(await We(r))?.handleChainStart(this.toJSON(),{input:e},r.runId,void 0,void 0,void 0,r?.runName);delete r.runId;let i={};try{let o=Object.entries(this.steps).map(async([u,l])=>{i[u]=await l.invoke(e,ce(r,{callbacks:a?.getChild(`map:key:${u}`)}))});await Vt(Promise.all(o),t?.signal)}catch(o){throw await a?.handleChainError(o),o}return await a?.handleChainEnd(i),i}async*_transform(e,t,r){let s={...this.steps},a=Dd(e,Object.keys(s).length),i=new Map(Object.entries(s).map(([o,u],l)=>{let c=u.transform(a[l],ce(r,{callbacks:t?.getChild(`map:key:${o}`)}));return[o,c.next().then(d=>({key:o,gen:c,result:d}))]}));for(;i.size;){let o=Promise.race(i.values()),{key:u,result:l,gen:c}=await Vt(o,r?.signal);i.delete(u),l.done||(yield{[u]:l.value},i.set(u,c.next().then(d=>({key:u,gen:c,result:d}))))}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}let s=K(t),a=new _r({generator:this.transform(r(),s),config:s});return await a.setup,we.fromAsyncGenerator(a)}},Gd=class n extends X{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!hu(e.func))throw new Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=e.func}async invoke(e,t){let[r]=this._getOptionsList(t??{},1),s=await We(r),a=this.func(ce(r,{callbacks:s}),e);return Vt(a,r?.signal)}async*_streamIterator(e,t){let[r]=this._getOptionsList(t??{},1),s=await this.invoke(e,t);if(ku(s)){for await(let a of s)r?.signal?.throwIfAborted(),yield a;return}if(rb(s)){for(;;){r?.signal?.throwIfAborted();let a=s.next();if(a.done)break;yield a.value}return}yield s}static from(e){return new n({func:e})}};Wt=class n extends X{static lc_name(){return"RunnableLambda"}constructor(e){if(hu(e.func))return Gd.from(e.func);super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),DE(e.func),this.func=e.func}static from(e){return new n({func:e})}async _invoke(e,t,r){return new Promise((s,a)=>{let i=ce(t,{callbacks:r?.getChild(),recursionLimit:(t?.recursionLimit??Tu)-1});yt.runWithConfig(i,async()=>{try{let o=await this.func(e,{...i,config:i});if(o&&X.isRunnable(o)){if(t?.recursionLimit===0)throw new Error("Recursion limit reached.");o=await o.invoke(e,{...i,recursionLimit:(i.recursionLimit??Tu)-1})}else if(ku(o)){let u;for await(let l of Vd(i,o))if(t?.signal?.throwIfAborted(),u===void 0)u=l;else try{u=je(u,l)}catch{u=l}o=u}else if(zd(o)){let u;for(let l of qd(i,o))if(t?.signal?.throwIfAborted(),u===void 0)u=l;else try{u=je(u,l)}catch{u=l}o=u}s(o)}catch(o){a(o)}})})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async*_transform(e,t,r){let s;for await(let o of e)if(s===void 0)s=o;else try{s=je(s,o)}catch{s=o}let a=ce(r,{callbacks:t?.getChild(),recursionLimit:(r?.recursionLimit??Tu)-1}),i=await new Promise((o,u)=>{yt.runWithConfig(a,async()=>{try{let l=await this.func(s,{...a,config:a});o(l)}catch(l){u(l)}})});if(i&&X.isRunnable(i)){if(r?.recursionLimit===0)throw new Error("Recursion limit reached.");let o=await i.stream(s,a);for await(let u of o)yield u}else if(ku(i))for await(let o of Vd(a,i))r?.signal?.throwIfAborted(),yield o;else if(zd(i))for(let o of qd(a,i))r?.signal?.throwIfAborted(),yield o;else yield i}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}let s=K(t),a=new _r({generator:this.transform(r(),s),config:s});return await a.setup,we.fromAsyncGenerator(a)}},ju=class extends X{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(let e of this.fallbacks)yield e}async invoke(e,t){let r=K(t),s=await We(t),{runId:a,...i}=r,o=await s?.handleChainStart(this.toJSON(),me(e,"input"),a,void 0,void 0,void 0,i?.runName),u;for(let l of this.runnables()){r?.signal?.throwIfAborted();try{let c=await l.invoke(e,ce(i,{callbacks:o?.getChild()}));return await o?.handleChainEnd(me(c,"output")),c}catch(c){u===void 0&&(u=c)}}throw u===void 0?new Error("No error stored at end of fallback."):(await o?.handleChainError(u),u)}async*_streamIterator(e,t){let r=K(t),s=await We(t),{runId:a,...i}=r,o=await s?.handleChainStart(this.toJSON(),me(e,"input"),a,void 0,void 0,void 0,i?.runName),u,l;for(let d of this.runnables()){r?.signal?.throwIfAborted();let f=ce(i,{callbacks:o?.getChild()});try{l=await d.stream(e,f);break}catch(p){u===void 0&&(u=p)}}if(l===void 0){let d=u??new Error("No error stored at end of fallback.");throw await o?.handleChainError(d),d}let c;try{for await(let d of l){yield d;try{c=c===void 0?c:je(c,d)}catch{c=void 0}}}catch(d){throw await o?.handleChainError(d),d}await o?.handleChainEnd(me(c,"output"))}async batch(e,t,r){if(r?.returnExceptions)throw new Error("Not implemented.");let s=this._getOptionsList(t??{},e.length),a=await Promise.all(s.map(u=>We(u))),i=await Promise.all(a.map(async(u,l)=>{let c=await u?.handleChainStart(this.toJSON(),me(e[l],"input"),s[l].runId,void 0,void 0,void 0,s[l].runName);return delete s[l].runId,c})),o;for(let u of this.runnables()){s[0].signal?.throwIfAborted();try{let l=await u.batch(e,i.map((c,d)=>ce(s[d],{callbacks:c?.getChild()})),r);return await Promise.all(i.map((c,d)=>c?.handleChainEnd(me(l[d],"output")))),l}catch(l){o===void 0&&(o=l)}}throw o?(await Promise.all(i.map(u=>u?.handleChainError(o))),o):new Error("No error stored at end of fallbacks.")}};qs=class extends X{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof qr&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}async invoke(e,t){let r=await this.mapper.invoke(e,t);return{...e,...r}}async*_transform(e,t,r){let s=this.mapper.getStepsKeys(),[a,i]=Dd(e),o=this.mapper.transform(i,ce(r,{callbacks:t?.getChild()})),u=o.next();for await(let l of a){if(typeof l!="object"||Array.isArray(l))throw new Error(`RunnableAssign can only be used with objects as input, got ${typeof l}`);let c=Object.fromEntries(Object.entries(l).filter(([d])=>!s.includes(d)));Object.keys(c).length>0&&(yield c)}yield(await u).value;for await(let l of o)yield l}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}let s=K(t),a=new _r({generator:this.transform(r(),s),config:s});return await a.setup,we.fromAsyncGenerator(a)}},Mu=class extends X{static lc_name(){return"RunnablePick"}constructor(e){(typeof e=="string"||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if(typeof this.keys=="string")return e[this.keys];{let t=this.keys.map(r=>[r,e[r]]).filter(r=>r[1]!==void 0);return t.length===0?void 0:Object.fromEntries(t)}}async invoke(e,t){return this._callWithConfig(this._pick.bind(this),e,t)}async*_transform(e){for await(let t of e){let r=await this._pick(t);r!==void 0&&(yield r)}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}let s=K(t),a=new _r({generator:this.transform(r(),s),config:s});return await a.setup,we.fromAsyncGenerator(a)}},bi=class extends Kt{constructor(e){let t=Jt.from([Wt.from(async r=>{let s;if(ks(r))try{s=await this.schema.parseAsync(r.args)}catch{throw new Rs("Received tool input did not match expected schema",JSON.stringify(r.args))}else s=r;return s}).withConfig({runName:`${e.name}:parse_input`}),e.bound]).withConfig({runName:e.name});super({bound:t,config:e.config??{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.schema=e.schema}static lc_name(){return"RunnableToolLike"}}});var Kd=h(()=>{Pt()});var ab=h(()=>{bt();Cn();To();So();Ga();Kd();Co();Cs();Dr()});var zn=h(()=>{Cn();Pt();To();So();Ga();Co();Dr();ab();Kd();Cs()});var _i,Vs,Hs,Du,wi=h(()=>{Ss();Ga();Dr();_i=class extends Qe{},Vs=class extends _i{static lc_name(){return"StringPromptValue"}constructor(e){super({value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new he(this.value)]}},Hs=class extends _i{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return Ka(this.messages)}toChatMessages(){return this.messages}},Du=class extends _i{static lc_name(){return"ImagePromptValue"}constructor(e){"imageUrl"in e||(e={imageUrl:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"imageUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.imageUrl=e.imageUrl}toString(){return this.imageUrl.url}toChatMessages(){return[new he({content:[{type:"image_url",image_url:{detail:this.imageUrl.detail,url:this.imageUrl.url}}]})]}}});var lb=T(Fu=>{"use strict";Fu.byteLength=HE;Fu.toByteArray=KE;Fu.fromByteArray=ZE;var Zt=[],_t=[],VE=typeof Uint8Array<"u"?Uint8Array:Array,Zd="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(qn=0,ob=Zd.length;qn<ob;++qn)Zt[qn]=Zd[qn],_t[Zd.charCodeAt(qn)]=qn;var qn,ob;_t[45]=62;_t[95]=63;function ub(n){var e=n.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=n.indexOf("=");t===-1&&(t=e);var r=t===e?0:4-t%4;return[t,r]}function HE(n){var e=ub(n),t=e[0],r=e[1];return(t+r)*3/4-r}function GE(n,e,t){return(e+t)*3/4-t}function KE(n){var e,t=ub(n),r=t[0],s=t[1],a=new VE(GE(n,r,s)),i=0,o=s>0?r-4:r,u;for(u=0;u<o;u+=4)e=_t[n.charCodeAt(u)]<<18|_t[n.charCodeAt(u+1)]<<12|_t[n.charCodeAt(u+2)]<<6|_t[n.charCodeAt(u+3)],a[i++]=e>>16&255,a[i++]=e>>8&255,a[i++]=e&255;return s===2&&(e=_t[n.charCodeAt(u)]<<2|_t[n.charCodeAt(u+1)]>>4,a[i++]=e&255),s===1&&(e=_t[n.charCodeAt(u)]<<10|_t[n.charCodeAt(u+1)]<<4|_t[n.charCodeAt(u+2)]>>2,a[i++]=e>>8&255,a[i++]=e&255),a}function JE(n){return Zt[n>>18&63]+Zt[n>>12&63]+Zt[n>>6&63]+Zt[n&63]}function WE(n,e,t){for(var r,s=[],a=e;a<t;a+=3)r=(n[a]<<16&16711680)+(n[a+1]<<8&65280)+(n[a+2]&255),s.push(JE(r));return s.join("")}function ZE(n){for(var e,t=n.length,r=t%3,s=[],a=16383,i=0,o=t-r;i<o;i+=a)s.push(WE(n,i,i+a>o?o:i+a));return r===1?(e=n[t-1],s.push(Zt[e>>2]+Zt[e<<4&63]+"==")):r===2&&(e=(n[t-2]<<8)+n[t-1],s.push(Zt[e>>10]+Zt[e>>4&63]+Zt[e<<2&63]+"=")),s.join("")}});var xr,Ii=h(()=>{wi();Ws();xr=class extends Ar{async formatPromptValue(e){let t=await this.format(e);return new Vs(t)}}});function rf(n){return typeof n=="function"}function UO(n){return Ys(n)?"array":typeof n}function tf(n){return n.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function _b(n,e){return n!=null&&typeof n=="object"&&e in n}function BO(n,e){return n!=null&&typeof n!="object"&&n.hasOwnProperty&&n.hasOwnProperty(e)}function qO(n,e){return zO.call(n,e)}function HO(n){return!qO(VO,n)}function KO(n){return String(n).replace(/[&<>"'`=\/]/g,function(t){return GO[t]})}function XO(n,e){if(!n)return[];var t=!1,r=[],s=[],a=[],i=!1,o=!1,u="",l=0;function c(){if(i&&!o)for(;a.length;)delete s[a.pop()];else a=[];i=!1,o=!1}var d,f,p;function g(Z){if(typeof Z=="string"&&(Z=Z.split(WO,2)),!Ys(Z)||Z.length!==2)throw new Error("Invalid tags: "+Z);d=new RegExp(tf(Z[0])+"\\s*"),f=new RegExp("\\s*"+tf(Z[1])),p=new RegExp("\\s*"+tf("}"+Z[1]))}g(e||wt.tags);for(var m=new Ti(n),y,x,w,A,k,R;!m.eos();){if(y=m.pos,w=m.scanUntil(d),w)for(var W=0,Y=w.length;W<Y;++W)A=w.charAt(W),HO(A)?(a.push(s.length),u+=A):(o=!0,t=!0,u+=" "),s.push(["text",A,y,y+1]),y+=1,A===`
`&&(c(),u="",l=0,t=!1);if(!m.scan(d))break;if(i=!0,x=m.scan(YO)||"name",m.scan(JO),x==="="?(w=m.scanUntil(wb),m.scan(wb),m.scanUntil(f)):x==="{"?(w=m.scanUntil(p),m.scan(ZO),m.scanUntil(f),x="&"):w=m.scanUntil(f),!m.scan(f))throw new Error("Unclosed tag at "+m.pos);if(x==">"?k=[x,w,y,m.pos,u,l,t]:k=[x,w,y,m.pos],l++,s.push(k),x==="#"||x==="^")r.push(k);else if(x==="/"){if(R=r.pop(),!R)throw new Error('Unopened section "'+w+'" at '+y);if(R[1]!==w)throw new Error('Unclosed section "'+R[1]+'" at '+y)}else x==="name"||x==="{"||x==="&"?o=!0:x==="="&&g(w)}if(c(),R=r.pop(),R)throw new Error('Unclosed section "'+R[1]+'" at '+m.pos);return eI(QO(s))}function QO(n){for(var e=[],t,r,s=0,a=n.length;s<a;++s)t=n[s],t&&(t[0]==="text"&&r&&r[0]==="text"?(r[1]+=t[1],r[3]=t[3]):(e.push(t),r=t));return e}function eI(n){for(var e=[],t=e,r=[],s,a,i=0,o=n.length;i<o;++i)switch(s=n[i],s[0]){case"#":case"^":t.push(s),r.push(s),t=s[4]=[];break;case"/":a=r.pop(),a[5]=s[2],t=r.length>0?r[r.length-1][4]:e;break;default:t.push(s)}return e}function Ti(n){this.string=n,this.tail=n,this.pos=0}function Zs(n,e){this.view=n,this.cache={".":this.view},this.parent=e}function qe(){this.templateCache={_cache:{},set:function(e,t){this._cache[e]=t},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}var FO,Ys,zO,VO,GO,JO,WO,wb,ZO,YO,wt,Pi,Gu,vb=h(()=>{FO=Object.prototype.toString,Ys=Array.isArray||function(e){return FO.call(e)==="[object Array]"};zO=RegExp.prototype.test;VO=/\S/;GO={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};JO=/\s*/,WO=/\s+/,wb=/\s*=/,ZO=/\s*\}/,YO=/#|\^|\/|>|\{|&|=|!/;Ti.prototype.eos=function(){return this.tail===""};Ti.prototype.scan=function(e){var t=this.tail.match(e);if(!t||t.index!==0)return"";var r=t[0];return this.tail=this.tail.substring(r.length),this.pos+=r.length,r};Ti.prototype.scanUntil=function(e){var t=this.tail.search(e),r;switch(t){case-1:r=this.tail,this.tail="";break;case 0:r="";break;default:r=this.tail.substring(0,t),this.tail=this.tail.substring(t)}return this.pos+=r.length,r};Zs.prototype.push=function(e){return new Zs(e,this)};Zs.prototype.lookup=function(e){var t=this.cache,r;if(t.hasOwnProperty(e))r=t[e];else{for(var s=this,a,i,o,u=!1;s;){if(e.indexOf(".")>0)for(a=s.view,i=e.split("."),o=0;a!=null&&o<i.length;)o===i.length-1&&(u=_b(a,i[o])||BO(a,i[o])),a=a[i[o++]];else a=s.view[e],u=_b(s.view,e);if(u){r=a;break}s=s.parent}t[e]=r}return rf(r)&&(r=r.call(this.view)),r};qe.prototype.clearCache=function(){typeof this.templateCache<"u"&&this.templateCache.clear()};qe.prototype.parse=function(e,t){var r=this.templateCache,s=e+":"+(t||wt.tags).join(":"),a=typeof r<"u",i=a?r.get(s):void 0;return i==null&&(i=XO(e,t),a&&r.set(s,i)),i};qe.prototype.render=function(e,t,r,s){var a=this.getConfigTags(s),i=this.parse(e,a),o=t instanceof Zs?t:new Zs(t,void 0);return this.renderTokens(i,o,r,e,s)};qe.prototype.renderTokens=function(e,t,r,s,a){for(var i="",o,u,l,c=0,d=e.length;c<d;++c)l=void 0,o=e[c],u=o[0],u==="#"?l=this.renderSection(o,t,r,s,a):u==="^"?l=this.renderInverted(o,t,r,s,a):u===">"?l=this.renderPartial(o,t,r,a):u==="&"?l=this.unescapedValue(o,t):u==="name"?l=this.escapedValue(o,t,a):u==="text"&&(l=this.rawValue(o)),l!==void 0&&(i+=l);return i};qe.prototype.renderSection=function(e,t,r,s,a){var i=this,o="",u=t.lookup(e[1]);function l(f){return i.render(f,t,r,a)}if(u){if(Ys(u))for(var c=0,d=u.length;c<d;++c)o+=this.renderTokens(e[4],t.push(u[c]),r,s,a);else if(typeof u=="object"||typeof u=="string"||typeof u=="number")o+=this.renderTokens(e[4],t.push(u),r,s,a);else if(rf(u)){if(typeof s!="string")throw new Error("Cannot use higher-order sections without the original template");u=u.call(t.view,s.slice(e[3],e[5]),l),u!=null&&(o+=u)}else o+=this.renderTokens(e[4],t,r,s,a);return o}};qe.prototype.renderInverted=function(e,t,r,s,a){var i=t.lookup(e[1]);if(!i||Ys(i)&&i.length===0)return this.renderTokens(e[4],t,r,s,a)};qe.prototype.indentPartial=function(e,t,r){for(var s=t.replace(/[^ \t]/g,""),a=e.split(`
`),i=0;i<a.length;i++)a[i].length&&(i>0||!r)&&(a[i]=s+a[i]);return a.join(`
`)};qe.prototype.renderPartial=function(e,t,r,s){if(r){var a=this.getConfigTags(s),i=rf(r)?r(e[1]):r[e[1]];if(i!=null){var o=e[6],u=e[5],l=e[4],c=i;u==0&&l&&(c=this.indentPartial(i,l,o));var d=this.parse(c,a);return this.renderTokens(d,t,r,c,s)}}};qe.prototype.unescapedValue=function(e,t){var r=t.lookup(e[1]);if(r!=null)return r};qe.prototype.escapedValue=function(e,t,r){var s=this.getConfigEscape(r)||wt.escape,a=t.lookup(e[1]);if(a!=null)return typeof a=="number"&&s===wt.escape?String(a):s(a)};qe.prototype.rawValue=function(e){return e[1]};qe.prototype.getConfigTags=function(e){return Ys(e)?e:e&&typeof e=="object"?e.tags:void 0};qe.prototype.getConfigEscape=function(e){if(e&&typeof e=="object"&&!Ys(e))return e.escape};wt={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(n){Pi.templateCache=n},get templateCache(){return Pi.templateCache}},Pi=new qe;wt.clearCache=function(){return Pi.clearCache()};wt.parse=function(e,t){return Pi.parse(e,t)};wt.render=function(e,t,r,s){if(typeof e!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+UO(e)+'" was given as the first argument for mustache#render(template, view, partials)');return Pi.render(e,t,r,s)};wt.escape=KO;wt.Scanner=Ti;wt.Context=Zs;wt.Writer=qe;Gu=wt});function xb(){Gu.escape=n=>n}var Si,tI,Ku,rI,nI,nf,sI,$t,Ab,Vn,Xs=h(()=>{vb();Si=n=>{let e=n.split(""),t=[],r=(a,i)=>{for(let o=i;o<e.length;o+=1)if(a.includes(e[o]))return o;return-1},s=0;for(;s<e.length;)if(e[s]==="{"&&s+1<e.length&&e[s+1]==="{")t.push({type:"literal",text:"{"}),s+=2;else if(e[s]==="}"&&s+1<e.length&&e[s+1]==="}")t.push({type:"literal",text:"}"}),s+=2;else if(e[s]==="{"){let a=r("}",s);if(a<0)throw new Error("Unclosed '{' in template.");t.push({type:"variable",name:e.slice(s+1,a).join("")}),s=a+1}else{if(e[s]==="}")throw new Error("Single '}' in template.");{let a=r("{}",s),i=(a<0?e.slice(s):e.slice(s,a)).join("");t.push({type:"literal",text:i}),s=a<0?e.length:a}}return t},tI=n=>n.map(e=>e[0]==="name"?{type:"variable",name:e[1].includes(".")?e[1].split(".")[0]:e[1]}:["#","&","^",">"].includes(e[0])?{type:"variable",name:e[1]}:{type:"literal",text:e[1]}),Ku=n=>{xb();let e=Gu.parse(n);return tI(e)},rI=(n,e)=>Si(n).reduce((t,r)=>{if(r.type==="variable"){if(r.name in e)return t+e[r.name];throw new Error(`(f-string) Missing value for input ${r.name}`)}return t+r.text},""),nI=(n,e)=>(xb(),Gu.render(n,e)),nf={"f-string":rI,mustache:nI},sI={"f-string":Si,mustache:Ku},$t=(n,e,t)=>nf[e](n,t),Ab=(n,e)=>sI[e](n),Vn=(n,e,t)=>{if(!(e in nf)){let r=Object.keys(nf);throw new Error(`Invalid template format. Got \`${e}\`;
                         should be one of ${r}`)}try{let r=t.reduce((s,a)=>(s[a]="foo",s),{});Array.isArray(n)?n.forEach(s=>{if(s.type==="text")$t(s.text,e,r);else if(s.type==="image_url")if(typeof s.image_url=="string")$t(s.image_url,e,r);else{let a=s.image_url.url;$t(a,e,r)}else throw new Error(`Invalid message template received. ${JSON.stringify(s,null,2)}`)}):$t(n,e,r)}catch(r){throw new Error(`Invalid prompt schema: ${r.message}`)}}});var sf={};io(sf,{PromptTemplate:()=>jt});var jt,Qs=h(()=>{Ii();Xs();jt=class n extends xr{static lc_name(){return"PromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"additionalContentFields",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e.templateFormat==="mustache"&&e.validateTemplate===void 0&&(this.validateTemplate=!1),Object.assign(this,e),this.validateTemplate){if(this.templateFormat==="mustache")throw new Error("Mustache templates cannot be validated.");let t=this.inputVariables;this.partialVariables&&(t=t.concat(Object.keys(this.partialVariables))),Vn(this.template,this.templateFormat,t)}}_getPromptType(){return"prompt"}async format(e){let t=await this.mergePartialAndUserVariables(e);return $t(this.template,this.templateFormat,t)}static fromExamples(e,t,r,s=`

`,a=""){let i=[a,...e,t].join(s);return new n({inputVariables:r,template:i})}static fromTemplate(e,t){let{templateFormat:r="f-string",...s}=t??{},a=new Set;return Ab(e,r).forEach(i=>{i.type==="variable"&&a.add(i.name)}),new n({inputVariables:[...a],templateFormat:r,template:e,...s})}async partial(e){let t=this.inputVariables.filter(a=>!(a in e)),r={...this.partialVariables??{},...e},s={...this,inputVariables:t,partialVariables:r};return new n(s)}serialize(){if(this.outputParser!==void 0)throw new Error("Cannot serialize a prompt template with an output parser");return{_type:this._getPromptType(),input_variables:this.inputVariables,template:this.template,template_format:this.templateFormat}}static async deserialize(e){if(!e.template)throw new Error("Prompt template must have a template");return new n({inputVariables:e.input_variables,template:e.template,templateFormat:e.template_format})}}});var ea,af=h(()=>{wi();Ws();Xs();ea=class n extends Ar{static lc_name(){return"ImagePromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","image"]}),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"additionalContentFields",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.template=e.template,this.templateFormat=e.templateFormat??this.templateFormat,this.validateTemplate=e.validateTemplate??this.validateTemplate,this.additionalContentFields=e.additionalContentFields,this.validateTemplate){let t=this.inputVariables;this.partialVariables&&(t=t.concat(Object.keys(this.partialVariables))),Vn([{type:"image_url",image_url:this.template}],this.templateFormat,t)}}_getPromptType(){return"prompt"}async partial(e){let t=this.inputVariables.filter(a=>!(a in e)),r={...this.partialVariables??{},...e},s={...this,inputVariables:t,partialVariables:r};return new n(s)}async format(e){let t={};for(let[i,o]of Object.entries(this.template))typeof o=="string"?t[i]=$t(o,this.templateFormat,e):t[i]=o;let r=e.url||t.url,s=e.detail||t.detail;if(!r)throw new Error("Must provide either an image URL.");if(typeof r!="string")throw new Error("url must be a string.");let a={url:r};return s&&(a.detail=s),a}async formatPromptValue(e){let t=await this.format(e);return new Du(t)}}});function aI(n){return typeof n.formatMessages=="function"}function iI(n,e){if(aI(n)||It(n))return n;if(Array.isArray(n)&&n[0]==="placeholder"){let s=n[1];if(typeof s!="string"||s[0]!=="{"||s[s.length-1]!=="}")throw new Error(`Invalid placeholder template: "${n[1]}". Expected a variable name surrounded by curly braces.`);let a=s.slice(1,-1);return new of({variableName:a,optional:!0})}let t=Tt(n),r;if(typeof t.content=="string"?r=t.content:r=t.content.map(s=>"text"in s?{...s,text:s.text}:"image_url"in s?{...s,image_url:s.image_url}:s),t._getType()==="human")return Ju.fromTemplate(r,e);if(t._getType()==="ai")return cf.fromTemplate(r,e);if(t._getType()==="system")return df.fromTemplate(r,e);if(ct.isInstance(t))return lf.fromTemplate(t.content,t.role,e);throw new Error(`Could not coerce message prompt template from input. Received message type: "${t._getType()}".`)}function oI(n){return n.constructor.lc_name()==="MessagesPlaceholder"}var Ci,of,uf,Ri,lf,ki,Ju,cf,df,ta,Ni=h(()=>{zn();wi();bt();Ii();Ws();Qs();af();Xs();Ci=class extends X{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}async invoke(e,t){return this._callWithConfig(r=>this.formatMessages(r),e,{...t,runType:"prompt"})}},of=class extends Ci{static lc_name(){return"MessagesPlaceholder"}constructor(e){typeof e=="string"&&(e={variableName:e}),super(e),Object.defineProperty(this,"variableName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"optional",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.variableName=e.variableName,this.optional=e.optional??!1}get inputVariables(){return[this.variableName]}async formatMessages(e){let t=e[this.variableName];if(this.optional&&!t)return[];if(!t){let s=new Error(`Field "${this.variableName}" in prompt uses a MessagesPlaceholder, which expects an array of BaseMessages as an input value. Received: undefined`);throw s.name="InputFormatError",s}let r;try{Array.isArray(t)?r=t.map(Tt):r=[Tt(t)]}catch(s){let a=typeof t=="string"?t:JSON.stringify(t,null,2),i=new Error([`Field "${this.variableName}" in prompt uses a MessagesPlaceholder, which expects an array of BaseMessages or coerceable values as input.`,`Received value: ${a}`,`Additional message: ${s.message}`].join(`

`));throw i.name="InputFormatError",i}return r}},uf=class extends Ci{constructor(e){"prompt"in e||(e={prompt:e}),super(e),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt}get inputVariables(){return this.prompt.inputVariables}async formatMessages(e){return[await this.format(e)]}},Ri=class extends Ar{constructor(e){super(e)}async format(e){return(await this.formatPromptValue(e)).toString()}async formatPromptValue(e){let t=await this.formatMessages(e);return new Hs(t)}},lf=class extends uf{static lc_name(){return"ChatMessagePromptTemplate"}constructor(e,t){"prompt"in e||(e={prompt:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}async format(e){return new ct(await this.prompt.format(e),this.role)}static fromTemplate(e,t,r){return new this(jt.fromTemplate(e,{templateFormat:r?.templateFormat}),t)}},ki=class extends Ci{static _messageClass(){throw new Error("Can not invoke _messageClass from inside _StringImageMessagePromptTemplate")}constructor(e,t){if("prompt"in e||(e={prompt:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"additionalOptions",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"messageClass",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"chatMessageClass",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt,Array.isArray(this.prompt)){let r=[];this.prompt.forEach(s=>{"inputVariables"in s&&(r=r.concat(s.inputVariables))}),this.inputVariables=r}else this.inputVariables=this.prompt.inputVariables;this.additionalOptions=t??this.additionalOptions}createMessage(e){let t=this.constructor;if(t._messageClass()){let r=t._messageClass();return new r({content:e})}else if(t.chatMessageClass){let r=t.chatMessageClass();return new r({content:e,role:this.getRoleFromMessageClass(r.lc_name())})}else throw new Error("No message class defined")}getRoleFromMessageClass(e){switch(e){case"HumanMessage":return"human";case"AIMessage":return"ai";case"SystemMessage":return"system";case"ChatMessage":return"chat";default:throw new Error("Invalid message class name")}}static fromTemplate(e,t){if(typeof e=="string")return new this(jt.fromTemplate(e,t));let r=[];for(let s of e)if(typeof s=="string"||typeof s=="object"&&"text"in s){let a="";typeof s=="string"?a=s:typeof s.text=="string"&&(a=s.text??"");let i={...t,...typeof s!="string"?{additionalContentFields:s}:{}};r.push(jt.fromTemplate(a,i))}else if(typeof s=="object"&&"image_url"in s){let a=s.image_url??"",i,o=[];if(typeof a=="string"){let u;t?.templateFormat==="mustache"?u=Ku(a):u=Si(a);let l=u.flatMap(c=>c.type==="variable"?[c.name]:[]);if((l?.length??0)>0){if(l.length>1)throw new Error(`Only one format variable allowed per image template.
Got: ${l}
From: ${a}`);o=[l[0]]}else o=[];a={url:a},i=new ea({template:a,inputVariables:o,templateFormat:t?.templateFormat,additionalContentFields:s})}else if(typeof a=="object"){if("url"in a){let u;t?.templateFormat==="mustache"?u=Ku(a.url):u=Si(a.url),o=u.flatMap(l=>l.type==="variable"?[l.name]:[])}else o=[];i=new ea({template:a,inputVariables:o,templateFormat:t?.templateFormat,additionalContentFields:s})}else throw new Error("Invalid image template");r.push(i)}return new this({prompt:r,additionalOptions:t})}async format(e){if(this.prompt instanceof xr){let t=await this.prompt.format(e);return this.createMessage(t)}else{let t=[];for(let r of this.prompt){let s={};if(!("inputVariables"in r))throw new Error(`Prompt ${r} does not have inputVariables defined.`);for(let a of r.inputVariables)s||(s={[a]:e[a]}),s={...s,[a]:e[a]};if(r instanceof xr){let a=await r.format(s),i;"additionalContentFields"in r&&(i=r.additionalContentFields),t.push({...i,type:"text",text:a})}else if(r instanceof ea){let a=await r.format(s),i;"additionalContentFields"in r&&(i=r.additionalContentFields),t.push({...i,type:"image_url",image_url:a})}}return this.createMessage(t)}}async formatMessages(e){return[await this.format(e)]}},Ju=class extends ki{static _messageClass(){return he}static lc_name(){return"HumanMessagePromptTemplate"}},cf=class extends ki{static _messageClass(){return ae}static lc_name(){return"AIMessagePromptTemplate"}},df=class extends ki{static _messageClass(){return Rn}static lc_name(){return"SystemMessagePromptTemplate"}};ta=class n extends Ri{static lc_name(){return"ChatPromptTemplate"}get lc_aliases(){return{promptMessages:"messages"}}constructor(e){if(super(e),Object.defineProperty(this,"promptMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),e.templateFormat==="mustache"&&e.validateTemplate===void 0&&(this.validateTemplate=!1),Object.assign(this,e),this.validateTemplate){let t=new Set;for(let o of this.promptMessages)if(!(o instanceof pe))for(let u of o.inputVariables)t.add(u);let r=this.inputVariables,s=new Set(this.partialVariables?r.concat(Object.keys(this.partialVariables)):r),a=new Set([...s].filter(o=>!t.has(o)));if(a.size>0)throw new Error(`Input variables \`${[...a]}\` are not used in any of the prompt messages.`);let i=new Set([...t].filter(o=>!s.has(o)));if(i.size>0)throw new Error(`Input variables \`${[...i]}\` are used in prompt messages but not in the prompt template.`)}}_getPromptType(){return"chat"}async _parseImagePrompts(e,t){if(typeof e.content=="string")return e;let r=await Promise.all(e.content.map(async s=>{if(s.type!=="image_url")return s;let a="";typeof s.image_url=="string"?a=s.image_url:a=s.image_url.url;let o=await jt.fromTemplate(a,{templateFormat:this.templateFormat}).format(t);return typeof s.image_url!="string"&&"url"in s.image_url?s.image_url.url=o:s.image_url=o,s}));return e.content=r,e}async formatMessages(e){let t=await this.mergePartialAndUserVariables(e),r=[];for(let s of this.promptMessages)if(s instanceof pe)r.push(await this._parseImagePrompts(s,t));else{let a=s.inputVariables.reduce((o,u)=>{if(!(u in t)&&!(oI(s)&&s.optional))throw new Error(`Missing value for input variable \`${u.toString()}\``);return o[u]=t[u],o},{}),i=await s.formatMessages(a);r=r.concat(i)}return r}async partial(e){let t=this.inputVariables.filter(a=>!(a in e)),r={...this.partialVariables??{},...e},s={...this,inputVariables:t,partialVariables:r};return new n(s)}static fromTemplate(e,t){let r=jt.fromTemplate(e,t),s=new Ju({prompt:r});return this.fromMessages([s])}static fromMessages(e,t){let r=e.reduce((i,o)=>i.concat(o instanceof n?o.promptMessages:[iI(o,t)]),[]),s=e.reduce((i,o)=>o instanceof n?Object.assign(i,o.partialVariables):i,Object.create(null)),a=new Set;for(let i of r)if(!(i instanceof pe))for(let o of i.inputVariables)o in s||a.add(o);return new this({...t,inputVariables:[...a],promptMessages:r,partialVariables:s,templateFormat:t?.templateFormat})}static fromPromptMessages(e){return this.fromMessages(e)}}});var Eb={};io(Eb,{FewShotChatMessagePromptTemplate:()=>pf,FewShotPromptTemplate:()=>ff});var ff,pf,hf=h(()=>{Ii();Xs();Qs();Ni();ff=class n extends xr{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleSelector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"suffix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"exampleSeparator",{enumerable:!0,configurable:!0,writable:!0,value:`

`}),Object.defineProperty(this,"prefix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),this.examples!==void 0&&this.exampleSelector!==void 0)throw new Error("Only one of 'examples' and 'example_selector' should be provided");if(this.examples===void 0&&this.exampleSelector===void 0)throw new Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let t=this.inputVariables;this.partialVariables&&(t=t.concat(Object.keys(this.partialVariables))),Vn(this.prefix+this.suffix,this.templateFormat,t)}}_getPromptType(){return"few_shot"}static lc_name(){return"FewShotPromptTemplate"}async getExamples(e){if(this.examples!==void 0)return this.examples;if(this.exampleSelector!==void 0)return this.exampleSelector.selectExamples(e);throw new Error("One of 'examples' and 'example_selector' should be provided")}async partial(e){let t=this.inputVariables.filter(a=>!(a in e)),r={...this.partialVariables??{},...e},s={...this,inputVariables:t,partialVariables:r};return new n(s)}async format(e){let t=await this.mergePartialAndUserVariables(e),r=await this.getExamples(t),s=await Promise.all(r.map(i=>this.examplePrompt.format(i))),a=[this.prefix,...s,this.suffix].join(this.exampleSeparator);return $t(a,this.templateFormat,t)}serialize(){if(this.exampleSelector||!this.examples)throw new Error("Serializing an example selector is not currently supported");if(this.outputParser!==void 0)throw new Error("Serializing an output parser is not currently supported");return{_type:this._getPromptType(),input_variables:this.inputVariables,example_prompt:this.examplePrompt.serialize(),example_separator:this.exampleSeparator,suffix:this.suffix,prefix:this.prefix,template_format:this.templateFormat,examples:this.examples}}static async deserialize(e){let{example_prompt:t}=e;if(!t)throw new Error("Missing example prompt");let r=await jt.deserialize(t),s;if(Array.isArray(e.examples))s=e.examples;else throw new Error("Invalid examples format. Only list or string are supported.");return new n({inputVariables:e.input_variables,examplePrompt:r,examples:s,exampleSeparator:e.example_separator,prefix:e.prefix,suffix:e.suffix,templateFormat:e.template_format})}},pf=class n extends Ri{_getPromptType(){return"few_shot_chat"}static lc_name(){return"FewShotChatMessagePromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleSelector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"suffix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"exampleSeparator",{enumerable:!0,configurable:!0,writable:!0,value:`

`}),Object.defineProperty(this,"prefix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.examples=e.examples,this.examplePrompt=e.examplePrompt,this.exampleSeparator=e.exampleSeparator??`

`,this.exampleSelector=e.exampleSelector,this.prefix=e.prefix??"",this.suffix=e.suffix??"",this.templateFormat=e.templateFormat??"f-string",this.validateTemplate=e.validateTemplate??!0,this.examples!==void 0&&this.exampleSelector!==void 0)throw new Error("Only one of 'examples' and 'example_selector' should be provided");if(this.examples===void 0&&this.exampleSelector===void 0)throw new Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let t=this.inputVariables;this.partialVariables&&(t=t.concat(Object.keys(this.partialVariables))),Vn(this.prefix+this.suffix,this.templateFormat,t)}}async getExamples(e){if(this.examples!==void 0)return this.examples;if(this.exampleSelector!==void 0)return this.exampleSelector.selectExamples(e);throw new Error("One of 'examples' and 'example_selector' should be provided")}async formatMessages(e){let t=await this.mergePartialAndUserVariables(e),r=await this.getExamples(t);r=r.map(a=>{let i={};return this.examplePrompt.inputVariables.forEach(o=>{i[o]=a[o]}),i});let s=[];for(let a of r){let i=await this.examplePrompt.formatMessages(a);s.push(...i)}return s}async format(e){let t=await this.mergePartialAndUserVariables(e),r=await this.getExamples(t),a=(await Promise.all(r.map(o=>this.examplePrompt.formatMessages(o)))).flat().map(o=>o.content),i=[this.prefix,...a,this.suffix].join(this.exampleSeparator);return $t(i,this.templateFormat,t)}async partial(e){let t=this.inputVariables.filter(a=>!(a in e)),r={...this.partialVariables??{},...e},s={...this,inputVariables:t,partialVariables:r};return new n(s)}}});var Ar,Ws=h(()=>{bt();Ar=class extends X{get lc_attributes(){return{partialVariables:void 0}}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts",this._getPromptType()]}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partialVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let{inputVariables:t}=e;if(t.includes("stop"))throw new Error("Cannot have an input variable named 'stop', as it is used internally, please rename.");Object.assign(this,e)}async mergePartialAndUserVariables(e){let t=this.partialVariables??{},r={};for(let[a,i]of Object.entries(t))typeof i=="string"?r[a]=i:r[a]=await i();return{...r,...e}}async invoke(e,t){return this._callWithConfig(r=>this.formatPromptValue(r),e,{...t,runType:"prompt"})}serialize(){throw new Error("Use .toJSON() instead")}static async deserialize(e){switch(e._type){case"prompt":{let{PromptTemplate:t}=await Promise.resolve().then(()=>(Qs(),sf));return t.deserialize(e)}case void 0:{let{PromptTemplate:t}=await Promise.resolve().then(()=>(Qs(),sf));return t.deserialize({...e,_type:"prompt"})}case"few_shot":{let{FewShotPromptTemplate:t}=await Promise.resolve().then(()=>(hf(),Eb));return t.deserialize(e)}default:throw new Error(`Invalid prompt type in config: ${e._type}`)}}}});var T_=T((H3,P_)=>{P_.exports=function(){var n=document.getSelection();if(!n.rangeCount)return function(){};for(var e=document.activeElement,t=[],r=0;r<n.rangeCount;r++)t.push(n.getRangeAt(r));switch(e.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":e.blur();break;default:e=null;break}return n.removeAllRanges(),function(){n.type==="Caret"&&n.removeAllRanges(),n.rangeCount||t.forEach(function(s){n.addRange(s)}),e&&e.focus()}}});var R_=T((G3,C_)=>{"use strict";var zP=T_(),S_={"text/plain":"Text","text/html":"Url",default:"Text"},qP="Copy to clipboard: #{key}, Enter";function VP(n){var e=(/mac os x/i.test(navigator.userAgent)?"\u2318":"Ctrl")+"+C";return n.replace(/#{\s*key\s*}/g,e)}function HP(n,e){var t,r,s,a,i,o,u=!1;e||(e={}),t=e.debug||!1;try{s=zP(),a=document.createRange(),i=document.getSelection(),o=document.createElement("span"),o.textContent=n,o.ariaHidden="true",o.style.all="unset",o.style.position="fixed",o.style.top=0,o.style.clip="rect(0, 0, 0, 0)",o.style.whiteSpace="pre",o.style.webkitUserSelect="text",o.style.MozUserSelect="text",o.style.msUserSelect="text",o.style.userSelect="text",o.addEventListener("copy",function(c){if(c.stopPropagation(),e.format)if(c.preventDefault(),typeof c.clipboardData>"u"){t&&console.warn("unable to use e.clipboardData"),t&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var d=S_[e.format]||S_.default;window.clipboardData.setData(d,n)}else c.clipboardData.clearData(),c.clipboardData.setData(e.format,n);e.onCopy&&(c.preventDefault(),e.onCopy(c.clipboardData))}),document.body.appendChild(o),a.selectNodeContents(o),i.addRange(a);var l=document.execCommand("copy");if(!l)throw new Error("copy command was unsuccessful");u=!0}catch(c){t&&console.error("unable to copy using execCommand: ",c),t&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(e.format||"text",n),e.onCopy&&e.onCopy(window.clipboardData),u=!0}catch(d){t&&console.error("unable to copy using clipboardData: ",d),t&&console.error("falling back to prompt"),r=VP("message"in e?e.message:qP),window.prompt(r,n)}}finally{i&&(typeof i.removeRange=="function"?i.removeRange(a):i.removeAllRanges()),o&&document.body.removeChild(o),s()}return u}C_.exports=HP});var Nl={id:"acode.plugin.chatgpt",name:"AI Assistant Beta",main:"dist/main.js",version:"2.0.0",readme:"readme.md",icon:"icon.png",minVersionCode:290,files:["assets/ai_assistant.svg","assets/user_avatar.png","assets/insert-context.svg","assets/github-dark.css","assets/highlight.min.js","assets/markdown-it.min.js"],price:0,author:{name:"Raunak",email:"bajrangcoders@gmail.com",github:"bajrangCoder"}};var vp=`body {
  background-color: #000000;
  color: #0B3B3B;
}

#acode-ai-assistant * {
  box-sizing: border-box;
}
#acode-ai-assistant .mainApp {
  position: absolute;
  left: 0;
  width: 100%;
  height: calc(100% - 80px);
  background: #000000;
}
#acode-ai-assistant .title-container {
  text-align: center;
  padding: 10px 0;
}
#acode-ai-assistant .main-title {
  font-family: "Verdana", sans-serif;
  font-size: 2.8em;
  font-weight: bold;
  color: #0B3B3B;
  text-shadow: 2px 2px 4px #000000;
}
#acode-ai-assistant .sub-title {
  font-family: "Georgia", serif;
  font-size: 1.5em;
  font-style: italic;
  color: #008080;
  text-shadow: 1px 1px 2px #000000;
}
#acode-ai-assistant .chatBox {
  height: 100%;
  width: 100%;
  white-space: pre-wrap;
  overflow-y: auto;
  background-color: #000000;
  border: 1px solid #0B3B3B;
  border-radius: 10px;
  color: #008080;
}
#acode-ai-assistant .wrapper, #acode-ai-assistant .ai_wrapper {
  padding-block: 12px;
  padding-inline: 10px;
}
#acode-ai-assistant .chat, #acode-ai-assistant .ai_chat {
  display: flex;
  align-items: flex-start;
  gap: 10px;
}
#acode-ai-assistant .profile, #acode-ai-assistant .ai_profile {
  height: 35px;
  width: 35px;
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
}
#acode-ai-assistant .profile {
  background: #0B3B3B;
}
#acode-ai-assistant .ai_profile {
  background: #008080;
}
#acode-ai-assistant .profile img, #acode-ai-assistant .ai_profile img {
  width: 60%;
}
#acode-ai-assistant .message, #acode-ai-assistant .ai_message {
  flex: 1;
  font-size: 16px;
  line-height: 1.5;
  user-select: text;
  padding: 10px;
  border-radius: 10px;
  word-wrap: break-word;
  border: 1px solid #0B3B3B;
}
#acode-ai-assistant .message {
  color: #008080;
}
#acode-ai-assistant .ai_message {
  color: #008080;
}
#acode-ai-assistant .codeBlock {
  border: 2px solid #0B3B3B;
  width: 100%;
  border-radius: 5px;
  overflow-x: auto;
  position: relative;
  background-color: #000000;
}
#acode-ai-assistant .copy-button {
  position: absolute;
  top: 4px;
  right: 8px;
  border: none;
  outline: none;
  border-radius: 8px;
  height: 24px;
  width: 28px;
  color: #0B3B3B;
  display: flex;
  justify-content: center;
  align-items: center;
  font-weight: bold;
  background: #000000;
  box-shadow: 0 4px 0 #0B3B3B;
  transition: all 0.3s ease-in-out;
}
#acode-ai-assistant .copy-button:active {
  box-shadow: 0;
  color: #008080;
}
#acode-ai-assistant .codesArea {
  box-sizing: border-box;
  padding: 12px;
  margin-bottom: 0;
  background-color: #000000;
  color: #008080;
}
#acode-ai-assistant .codesArea::-webkit-scrollbar {
  height: 10px;
}
#acode-ai-assistant .codesArea::-webkit-scrollbar-thumb {
  background: #0B3B3B;
  border-radius: 4px;
}
#acode-ai-assistant .error-box {
  border: 1px solid #FF0000;
  color: #FF0000;
  font-weight: 700;
  padding: 8px;
  white-space: pre-wrap;
  word-break: break-word;
  border-radius: 10px;
}
#acode-ai-assistant .inputBox {
  position: fixed;
  bottom: 0;
  width: 100%;
  height: 80px;
  padding: 8px;
  display: flex;
  background-color: #000000;
  border-top: 1px solid #0B3B3B;
  z-index: 1;
}
#acode-ai-assistant .chatTextarea {
  flex: 1;
  height: 100%;
  resize: none;
  border: none;
  outline: none;
  background: none;
  font: initial;
  font-size: 1.1rem;
  color: #0B3B3B;
  padding-inline-end: 8px;
}
#acode-ai-assistant .sendBtn, #acode-ai-assistant .stopGenerationBtn {
  height: 40px;
  width: 40px;
  border-radius: 8px;
  border: none;
  outline: none;
  background-color: rgba(11, 59, 59, 0.2);
  color: #0B3B3B;
  display: grid;
  place-items: center;
}
#acode-ai-assistant .sendBtn:active, #acode-ai-assistant .stopGenerationBtn:active {
  background-color: #0B3B3B;
  color: #000000;
}
#acode-ai-assistant .hide {
  display: none;
}`;var xp;(function(n){n.STRING="STRING",n.NUMBER="NUMBER",n.INTEGER="INTEGER",n.BOOLEAN="BOOLEAN",n.ARRAY="ARRAY",n.OBJECT="OBJECT"})(xp||(xp={}));var Ap;(function(n){n.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",n.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",n.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",n.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",n.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT"})(Ap||(Ap={}));var Ep;(function(n){n.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE"})(Ep||(Ep={}));var Op;(function(n){n.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",n.NEGLIGIBLE="NEGLIGIBLE",n.LOW="LOW",n.MEDIUM="MEDIUM",n.HIGH="HIGH"})(Op||(Op={}));var Ip;(function(n){n.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",n.SAFETY="SAFETY",n.OTHER="OTHER"})(Ip||(Ip={}));var oo;(function(n){n.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",n.STOP="STOP",n.MAX_TOKENS="MAX_TOKENS",n.SAFETY="SAFETY",n.RECITATION="RECITATION",n.OTHER="OTHER"})(oo||(oo={}));var Pp;(function(n){n.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",n.RETRIEVAL_QUERY="RETRIEVAL_QUERY",n.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",n.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",n.CLASSIFICATION="CLASSIFICATION",n.CLUSTERING="CLUSTERING"})(Pp||(Pp={}));var Tp;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.AUTO="AUTO",n.ANY="ANY",n.NONE="NONE"})(Tp||(Tp={}));var Sp;(function(n){n.GENERATE_CONTENT="generateContent",n.STREAM_GENERATE_CONTENT="streamGenerateContent",n.COUNT_TOKENS="countTokens",n.EMBED_CONTENT="embedContent",n.BATCH_EMBED_CONTENTS="batchEmbedContents"})(Sp||(Sp={}));var xT=[oo.RECITATION,oo.SAFETY];pr();zn();zs();var BE=typeof window=="object"?window:{},z="0123456789abcdef".split(""),zE=[-2147483648,8388608,32768,128],Rt=[24,16,8,0];var ve=[];function kt(n){n?(ve[0]=ve[16]=ve[1]=ve[2]=ve[3]=ve[4]=ve[5]=ve[6]=ve[7]=ve[8]=ve[9]=ve[10]=ve[11]=ve[12]=ve[13]=ve[14]=ve[15]=0,this.blocks=ve):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}kt.prototype.update=function(n){if(!this.finalized){var e=typeof n!="string";e&&n.constructor===BE.ArrayBuffer&&(n=new Uint8Array(n));for(var t,r=0,s,a=n.length||0,i=this.blocks;r<a;){if(this.hashed&&(this.hashed=!1,i[0]=this.block,i[16]=i[1]=i[2]=i[3]=i[4]=i[5]=i[6]=i[7]=i[8]=i[9]=i[10]=i[11]=i[12]=i[13]=i[14]=i[15]=0),e)for(s=this.start;r<a&&s<64;++r)i[s>>2]|=n[r]<<Rt[s++&3];else for(s=this.start;r<a&&s<64;++r)t=n.charCodeAt(r),t<128?i[s>>2]|=t<<Rt[s++&3]:t<2048?(i[s>>2]|=(192|t>>6)<<Rt[s++&3],i[s>>2]|=(128|t&63)<<Rt[s++&3]):t<55296||t>=57344?(i[s>>2]|=(224|t>>12)<<Rt[s++&3],i[s>>2]|=(128|t>>6&63)<<Rt[s++&3],i[s>>2]|=(128|t&63)<<Rt[s++&3]):(t=65536+((t&1023)<<10|n.charCodeAt(++r)&1023),i[s>>2]|=(240|t>>18)<<Rt[s++&3],i[s>>2]|=(128|t>>12&63)<<Rt[s++&3],i[s>>2]|=(128|t>>6&63)<<Rt[s++&3],i[s>>2]|=(128|t&63)<<Rt[s++&3]);this.lastByteIndex=s,this.bytes+=s-this.start,s>=64?(this.block=i[16],this.start=s-64,this.hash(),this.hashed=!0):this.start=s}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}};kt.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var n=this.blocks,e=this.lastByteIndex;n[16]=this.block,n[e>>2]|=zE[e&3],this.block=n[16],e>=56&&(this.hashed||this.hash(),n[0]=this.block,n[16]=n[1]=n[2]=n[3]=n[4]=n[5]=n[6]=n[7]=n[8]=n[9]=n[10]=n[11]=n[12]=n[13]=n[14]=n[15]=0),n[14]=this.hBytes<<3|this.bytes>>>29,n[15]=this.bytes<<3,this.hash()}};kt.prototype.hash=function(){var n=this.h0,e=this.h1,t=this.h2,r=this.h3,s=this.h4,a,i,o,u=this.blocks;for(i=16;i<80;++i)o=u[i-3]^u[i-8]^u[i-14]^u[i-16],u[i]=o<<1|o>>>31;for(i=0;i<20;i+=5)a=e&t|~e&r,o=n<<5|n>>>27,s=o+a+s+1518500249+u[i]<<0,e=e<<30|e>>>2,a=n&e|~n&t,o=s<<5|s>>>27,r=o+a+r+1518500249+u[i+1]<<0,n=n<<30|n>>>2,a=s&n|~s&e,o=r<<5|r>>>27,t=o+a+t+1518500249+u[i+2]<<0,s=s<<30|s>>>2,a=r&s|~r&n,o=t<<5|t>>>27,e=o+a+e+1518500249+u[i+3]<<0,r=r<<30|r>>>2,a=t&r|~t&s,o=e<<5|e>>>27,n=o+a+n+1518500249+u[i+4]<<0,t=t<<30|t>>>2;for(;i<40;i+=5)a=e^t^r,o=n<<5|n>>>27,s=o+a+s+1859775393+u[i]<<0,e=e<<30|e>>>2,a=n^e^t,o=s<<5|s>>>27,r=o+a+r+1859775393+u[i+1]<<0,n=n<<30|n>>>2,a=s^n^e,o=r<<5|r>>>27,t=o+a+t+1859775393+u[i+2]<<0,s=s<<30|s>>>2,a=r^s^n,o=t<<5|t>>>27,e=o+a+e+1859775393+u[i+3]<<0,r=r<<30|r>>>2,a=t^r^s,o=e<<5|e>>>27,n=o+a+n+1859775393+u[i+4]<<0,t=t<<30|t>>>2;for(;i<60;i+=5)a=e&t|e&r|t&r,o=n<<5|n>>>27,s=o+a+s-1894007588+u[i]<<0,e=e<<30|e>>>2,a=n&e|n&t|e&t,o=s<<5|s>>>27,r=o+a+r-1894007588+u[i+1]<<0,n=n<<30|n>>>2,a=s&n|s&e|n&e,o=r<<5|r>>>27,t=o+a+t-1894007588+u[i+2]<<0,s=s<<30|s>>>2,a=r&s|r&n|s&n,o=t<<5|t>>>27,e=o+a+e-1894007588+u[i+3]<<0,r=r<<30|r>>>2,a=t&r|t&s|r&s,o=e<<5|e>>>27,n=o+a+n-1894007588+u[i+4]<<0,t=t<<30|t>>>2;for(;i<80;i+=5)a=e^t^r,o=n<<5|n>>>27,s=o+a+s-899497514+u[i]<<0,e=e<<30|e>>>2,a=n^e^t,o=s<<5|s>>>27,r=o+a+r-899497514+u[i+1]<<0,n=n<<30|n>>>2,a=s^n^e,o=r<<5|r>>>27,t=o+a+t-899497514+u[i+2]<<0,s=s<<30|s>>>2,a=r^s^n,o=t<<5|t>>>27,e=o+a+e-899497514+u[i+3]<<0,r=r<<30|r>>>2,a=t^r^s,o=e<<5|e>>>27,n=o+a+n-899497514+u[i+4]<<0,t=t<<30|t>>>2;this.h0=this.h0+n<<0,this.h1=this.h1+e<<0,this.h2=this.h2+t<<0,this.h3=this.h3+r<<0,this.h4=this.h4+s<<0};kt.prototype.hex=function(){this.finalize();var n=this.h0,e=this.h1,t=this.h2,r=this.h3,s=this.h4;return z[n>>28&15]+z[n>>24&15]+z[n>>20&15]+z[n>>16&15]+z[n>>12&15]+z[n>>8&15]+z[n>>4&15]+z[n&15]+z[e>>28&15]+z[e>>24&15]+z[e>>20&15]+z[e>>16&15]+z[e>>12&15]+z[e>>8&15]+z[e>>4&15]+z[e&15]+z[t>>28&15]+z[t>>24&15]+z[t>>20&15]+z[t>>16&15]+z[t>>12&15]+z[t>>8&15]+z[t>>4&15]+z[t&15]+z[r>>28&15]+z[r>>24&15]+z[r>>20&15]+z[r>>16&15]+z[r>>12&15]+z[r>>8&15]+z[r>>4&15]+z[r&15]+z[s>>28&15]+z[s>>24&15]+z[s>>20&15]+z[s>>16&15]+z[s>>12&15]+z[s>>8&15]+z[s>>4&15]+z[s&15]};kt.prototype.toString=kt.prototype.hex;kt.prototype.digest=function(){this.finalize();var n=this.h0,e=this.h1,t=this.h2,r=this.h3,s=this.h4;return[n>>24&255,n>>16&255,n>>8&255,n&255,e>>24&255,e>>16&255,e>>8&255,e&255,t>>24&255,t>>16&255,t>>8&255,t&255,r>>24&255,r>>16&255,r>>8&255,r&255,s>>24&255,s>>16&255,s>>8&255,s&255]};kt.prototype.array=kt.prototype.digest;kt.prototype.arrayBuffer=function(){this.finalize();var n=new ArrayBuffer(20),e=new DataView(n);return e.setUint32(0,this.h0),e.setUint32(4,this.h1),e.setUint32(8,this.h2),e.setUint32(12,this.h3),e.setUint32(16,this.h4),n};var Jd=n=>new kt(!0).update(n).hex();Dr();var ib=(...n)=>Jd(n.join("_"));var Wd=class{},qE=new Map,Lu=class n extends Wd{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=e??new Map}lookup(e,t){return Promise.resolve(this.cache.get(ib(e,t))??null)}async update(e,t,r){this.cache.set(ib(e,t),r)}static global(){return new n(qE)}};wi();Dr();hi();var cb=at(lb(),1),YE=Object.defineProperty,XE=(n,e,t)=>e in n?YE(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,QE=(n,e,t)=>(XE(n,typeof e!="symbol"?e+"":e,t),t);function eO(n,e){let t=Array.from({length:n.length},(r,s)=>({start:s,end:s+1}));for(;t.length>1;){let r=null;for(let s=0;s<t.length-1;s++){let a=n.slice(t[s].start,t[s+1].end),i=e.get(a.join(","));i!=null&&(r==null||i<r[0])&&(r=[i,s])}if(r!=null){let s=r[1];t[s]={start:t[s].start,end:t[s+1].end},t.splice(s+1,1)}else break}return t}function tO(n,e){return n.length===1?[e.get(n.join(","))]:eO(n,e).map(t=>e.get(n.slice(t.start,t.end).join(","))).filter(t=>t!=null)}function rO(n){return n.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var Yd=class{specialTokens;inverseSpecialTokens;patStr;textEncoder=new TextEncoder;textDecoder=new TextDecoder("utf-8");rankMap=new Map;textMap=new Map;constructor(n,e){this.patStr=n.pat_str;let t=n.bpe_ranks.split(`
`).filter(Boolean).reduce((r,s)=>{let[a,i,...o]=s.split(" "),u=Number.parseInt(i,10);return o.forEach((l,c)=>r[l]=u+c),r},{});for(let[r,s]of Object.entries(t)){let a=cb.default.toByteArray(r);this.rankMap.set(a.join(","),s),this.textMap.set(s,a)}this.specialTokens={...n.special_tokens,...e},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((r,[s,a])=>(r[a]=this.textEncoder.encode(s),r),{})}encode(n,e=[],t="all"){let r=new RegExp(this.patStr,"ug"),s=Yd.specialTokenRegex(Object.keys(this.specialTokens)),a=[],i=new Set(e==="all"?Object.keys(this.specialTokens):e),o=new Set(t==="all"?Object.keys(this.specialTokens).filter(l=>!i.has(l)):t);if(o.size>0){let l=Yd.specialTokenRegex([...o]),c=n.match(l);if(c!=null)throw new Error(`The text contains a special token that is not allowed: ${c[0]}`)}let u=0;for(;;){let l=null,c=u;for(;s.lastIndex=c,l=s.exec(n),!(l==null||i.has(l[0]));)c=l.index+1;let d=l?.index??n.length;for(let p of n.substring(u,d).matchAll(r)){let g=this.textEncoder.encode(p[0]),m=this.rankMap.get(g.join(","));if(m!=null){a.push(m);continue}a.push(...tO(g,this.rankMap))}if(l==null)break;let f=this.specialTokens[l[0]];a.push(f),u=l.index+l[0].length}return a}decode(n){let e=[],t=0;for(let a=0;a<n.length;++a){let i=n[a],o=this.textMap.get(i)??this.inverseSpecialTokens[i];o!=null&&(e.push(o),t+=o.length)}let r=new Uint8Array(t),s=0;for(let a of e)r.set(a,s),s+=a.length;return this.textDecoder.decode(r)}},Uu=Yd;QE(Uu,"specialTokenRegex",n=>new RegExp(n.map(e=>rO(e)).join("|"),"g"));function Xd(n){switch(n){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":case"text-embedding-3-small":case"text-embedding-3-large":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4o-2024-11-20":case"gpt-4o-mini-2024-07-18":case"gpt-4o-mini":case"gpt-4o-search-preview":case"gpt-4o-search-preview-2025-03-11":case"gpt-4o-mini-search-preview":case"gpt-4o-mini-search-preview-2025-03-11":case"gpt-4o-audio-preview":case"gpt-4o-audio-preview-2024-12-17":case"gpt-4o-audio-preview-2024-10-01":case"gpt-4o-mini-audio-preview":case"gpt-4o-mini-audio-preview-2024-12-17":case"o1":case"o1-2024-12-17":case"o1-mini":case"o1-mini-2024-09-12":case"o1-preview":case"o1-preview-2024-09-12":case"o1-pro":case"o1-pro-2025-03-19":case"o3":case"o3-2025-04-16":case"o3-mini":case"o3-mini-2025-01-31":case"o4-mini":case"o4-mini-2025-04-16":case"chatgpt-4o-latest":case"gpt-4o-realtime":case"gpt-4o-realtime-preview-2024-10-01":case"gpt-4o-realtime-preview-2024-12-17":case"gpt-4o-mini-realtime-preview":case"gpt-4o-mini-realtime-preview-2024-12-17":case"gpt-4.1":case"gpt-4.1-2025-04-14":case"gpt-4.1-mini":case"gpt-4.1-mini-2025-04-14":case"gpt-4.1-nano":case"gpt-4.1-nano-2025-04-14":case"gpt-4.5-preview":case"gpt-4.5-preview-2025-02-27":case"gpt-5":case"gpt-5-2025-08-07":case"gpt-5-nano":case"gpt-5-nano-2025-08-07":case"gpt-5-mini":case"gpt-5-mini-2025-08-07":case"gpt-5-chat-latest":return"o200k_base";default:throw new Error("Unknown model")}}hi();var Bu={},nO=new wr({});async function sO(n){return n in Bu||(Bu[n]=nO.fetch(`https://tiktoken.pages.dev/js/${n}.json`).then(e=>e.json()).then(e=>new Uu(e)).catch(e=>{throw delete Bu[n],e})),await Bu[n]}async function db(n){return sO(Xd(n))}bt();var aO=n=>n.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":n.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":n.startsWith("gpt-4-32k")?"gpt-4-32k":n.startsWith("gpt-4-")?"gpt-4":n.startsWith("gpt-4o")?"gpt-4o":n;var iO=()=>!1,vi=class extends X{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??iO(),this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}},xi=class extends vi{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:t,...r}){super({callbacks:e??t,...r}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof r.cache=="object"?this.cache=r.cache:r.cache?this.cache=Lu.global():this.cache=void 0,this.caller=new wr(r??{})}async getNumTokens(e){if(typeof e!="string")return 0;let t=Math.ceil(e.length/4);if(!this._encoding)try{this._encoding=await db("modelName"in this?aO(this.modelName):"gpt2")}catch(r){console.warn("Failed to calculate number of tokens, falling back to approximate count",r)}if(this._encoding)try{t=this._encoding.encode(e).length}catch(r){console.warn("Failed to calculate number of tokens, falling back to approximate count",r)}return t}static _convertInputToPromptValue(e){return typeof e=="string"?new Vs(e):Array.isArray(e)?new Hs(e.map(Tt)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall({config:e,...t}){let r={...this._identifyingParams(),...t,_type:this._llmType(),_model:this._modelType()};return Object.entries(r).filter(([i,o])=>o!==void 0).map(([i,o])=>`${i}:${JSON.stringify(o)}`).sort().join(",")}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw new Error("Use .toJSON() instead")}};Us();bt();Pu();Au();Ht();Ht();bt();Bn();var Nt=class extends X{static lc_name(){return"RunnablePassthrough"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e&&(this.func=e.func)}async invoke(e,t){let r=K(t);return this.func&&await this.func(e,r),this._callWithConfig(s=>Promise.resolve(s),e,r)}async*transform(e,t){let r=K(t),s,a=!0;for await(let i of this._transformStreamWithConfig(e,o=>o,r))if(yield i,a)if(s===void 0)s=i;else try{s=je(s,i)}catch{s=void 0,a=!1}this.func&&s!==void 0&&await this.func(s,r)}static assign(e){return new qs(new qr({steps:e}))}};function Gs(n){return typeof n?.parse=="function"}var Ks=class n extends xi{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models",this._llmType()]})}_separateRunnableConfigFromCallOptionsCompat(e){let[t,r]=super._separateRunnableConfigFromCallOptions(e);return r.signal=t.signal,[t,r]}async invoke(e,t){let r=n._convertInputToPromptValue(e);return(await this.generatePrompt([r],t,t?.callbacks)).generations[0][0].message}async*_streamResponseChunks(e,t,r){throw new Error("Not implemented.")}async*_streamIterator(e,t){if(this._streamResponseChunks===n.prototype._streamResponseChunks)yield this.invoke(e,t);else{let s=n._convertInputToPromptValue(e).toChatMessages(),[a,i]=this._separateRunnableConfigFromCallOptionsCompat(t),o={...a.metadata,...this.getLsParams(i)},u=await Ie.configure(a.callbacks,this.callbacks,a.tags,this.tags,o,this.metadata,{verbose:this.verbose}),l={options:i,invocation_params:this?.invocationParams(i),batch_size:1},c=await u?.handleChatModelStart(this.toJSON(),[s],a.runId,void 0,l,void 0,void 0,a.runName),d;try{for await(let f of this._streamResponseChunks(s,i,c?.[0])){if(f.message.id==null){let p=c?.at(0)?.runId;p!=null&&f.message._updateId(`run-${p}`)}f.message.response_metadata={...f.generationInfo,...f.message.response_metadata},yield f.message,d?d=d.concat(f):d=f}}catch(f){throw await Promise.all((c??[]).map(p=>p?.handleLLMError(f))),f}await Promise.all((c??[]).map(f=>f?.handleLLMEnd({generations:[[d]]})))}}getLsParams(e){return{ls_model_type:"chat",ls_stop:e.stop}}async _generateUncached(e,t,r){let s=e.map(p=>p.map(Tt)),a={...r.metadata,...this.getLsParams(t)},i=await Ie.configure(r.callbacks,this.callbacks,r.tags,this.tags,a,this.metadata,{verbose:this.verbose}),o={options:t,invocation_params:this?.invocationParams(t),batch_size:1},u=await i?.handleChatModelStart(this.toJSON(),s,r.runId,void 0,o,void 0,void 0,r.runName),l=[],c=[];if(!!u?.[0].handlers.find(p=>pi(p)||fi(p))&&s.length===1&&this._streamResponseChunks!==n.prototype._streamResponseChunks)try{let p=await this._streamResponseChunks(s[0],t,u?.[0]),g;for await(let m of p){if(m.message.id==null){let y=u?.at(0)?.runId;y!=null&&m.message._updateId(`run-${y}`)}g===void 0?g=m:g=je(g,m)}if(g===void 0)throw new Error("Received empty response from chat model call.");l.push([g]),await u?.[0].handleLLMEnd({generations:l,llmOutput:{}})}catch(p){throw await u?.[0].handleLLMError(p),p}else{let p=await Promise.allSettled(s.map((g,m)=>this._generate(g,{...t,promptIndex:m},u?.[m])));await Promise.all(p.map(async(g,m)=>{if(g.status==="fulfilled"){let y=g.value;for(let x of y.generations){if(x.message.id==null){let w=u?.at(0)?.runId;w!=null&&x.message._updateId(`run-${w}`)}x.message.response_metadata={...x.generationInfo,...x.message.response_metadata}}return y.generations.length===1&&(y.generations[0].message.response_metadata={...y.llmOutput,...y.generations[0].message.response_metadata}),l[m]=y.generations,c[m]=y.llmOutput,u?.[m]?.handleLLMEnd({generations:[y.generations],llmOutput:y.llmOutput})}else return await u?.[m]?.handleLLMError(g.reason),Promise.reject(g.reason)}))}let f={generations:l,llmOutput:c.length?this._combineLLMOutput?.(...c):void 0};return Object.defineProperty(f,Eu,{value:u?{runIds:u?.map(p=>p.runId)}:void 0,configurable:!0}),f}async _generateCached({messages:e,cache:t,llmStringKey:r,parsedOptions:s,handledOptions:a}){let i=e.map(y=>y.map(Tt)),o={...a.metadata,...this.getLsParams(s)},u=await Ie.configure(a.callbacks,this.callbacks,a.tags,this.tags,o,this.metadata,{verbose:this.verbose}),l={options:s,invocation_params:this?.invocationParams(s),batch_size:1,cached:!0},c=await u?.handleChatModelStart(this.toJSON(),i,a.runId,void 0,l,void 0,void 0,a.runName),d=[],p=(await Promise.allSettled(i.map(async(y,x)=>{let w=n._convertInputToPromptValue(y).toString(),A=await t.lookup(w,r);return A==null&&d.push(x),A}))).map((y,x)=>({result:y,runManager:c?.[x]})).filter(({result:y})=>y.status==="fulfilled"&&y.value!=null||y.status==="rejected"),g=[];await Promise.all(p.map(async({result:y,runManager:x},w)=>{if(y.status==="fulfilled"){let A=y.value;return g[w]=A,A.length&&await x?.handleLLMNewToken(A[0].text),x?.handleLLMEnd({generations:[A]})}else return await x?.handleLLMError(y.reason),Promise.reject(y.reason)}));let m={generations:g,missingPromptIndices:d};return Object.defineProperty(m,Eu,{value:c?{runIds:c?.map(y=>y.runId)}:void 0,configurable:!0}),m}async generate(e,t,r){let s;Array.isArray(t)?s={stop:t}:s=t;let a=e.map(p=>p.map(Tt)),[i,o]=this._separateRunnableConfigFromCallOptionsCompat(s);if(i.callbacks=i.callbacks??r,!this.cache)return this._generateUncached(a,o,i);let{cache:u}=this,l=this._getSerializedCacheKeyParametersForCall(o),{generations:c,missingPromptIndices:d}=await this._generateCached({messages:a,cache:u,llmStringKey:l,parsedOptions:o,handledOptions:i}),f={};if(d.length>0){let p=await this._generateUncached(d.map(g=>a[g]),o,i);await Promise.all(p.generations.map(async(g,m)=>{let y=d[m];c[y]=g;let x=n._convertInputToPromptValue(a[y]).toString();return u.update(x,l,g)})),f=p.llmOutput??{}}return{generations:c,llmOutput:f}}invocationParams(e){return{}}_modelType(){return"base_chat_model"}serialize(){return{...this.invocationParams(),_type:this._llmType(),_model:this._modelType()}}async generatePrompt(e,t,r){let s=e.map(a=>a.toChatMessages());return this.generate(s,t,r)}async call(e,t,r){return(await this.generate([e.map(Tt)],t,r)).generations[0][0].message}async callPrompt(e,t,r){let s=e.toChatMessages();return this.call(s,t,r)}async predictMessages(e,t,r){return this.call(e,t,r)}async predict(e,t,r){let s=new he(e),a=await this.call([s],t,r);if(typeof a.content!="string")throw new Error("Cannot use predict when output is not a string.");return a.content}withStructuredOutput(e,t){if(typeof this.bindTools!="function")throw new Error('Chat model must implement ".bindTools()" to use withStructuredOutput.');let r=e,s=t?.name,a=r.description??"A function available to call.",i=t?.method,o=t?.includeRaw;if(i==="jsonMode")throw new Error('Base withStructuredOutput implementation only supports "functionCalling" as a method.');let u=s??"extract",l;Gs(r)?l=[{type:"function",function:{name:u,description:a,parameters:Ot(r)}}]:("name"in r&&(u=r.name),l=[{type:"function",function:{name:u,description:a,parameters:r}}]);let c=this.bindTools(l),d=Wt.from(m=>{if(!m.tool_calls||m.tool_calls.length===0)throw new Error("No tool calls found in the response.");let y=m.tool_calls.find(x=>x.name===u);if(!y)throw new Error(`No tool call found with name ${u}.`);return y.args});if(!o)return c.pipe(d).withConfig({runName:"StructuredOutput"});let f=Nt.assign({parsed:(m,y)=>d.invoke(m.raw,y)}),p=Nt.assign({parsed:()=>null}),g=f.withFallbacks({fallbacks:[p]});return Jt.from([{raw:c},g]).withConfig({runName:"StructuredOutputRunnable"})}},zu=class extends Ks{async _generate(e,t,r){let s=await this._call(e,t,r),a=new ae(s);if(typeof a.content!="string")throw new Error("Cannot generate with a simple chat model when output is not a string.");return{generations:[{text:a.content,message:a}]}}};zn();zs();Ht();async function*fb(n,e,t){let r=n;r.startsWith("http://localhost:")&&(r=r.replace("http://localhost:","http://127.0.0.1:"));let s=await fetch(r,{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json",...t.headers},signal:t.signal});if(!s.ok){let u,l=await s.text();try{let c=JSON.parse(l);u=new Error(`Ollama call failed with status code ${s.status}: ${c.error}`)}catch{u=new Error(`Ollama call failed with status code ${s.status}: ${l}`)}throw u.response=s,u}if(!s.body)throw new Error("Could not begin Ollama stream. Please check the given URL and try again.");let a=we.fromReadableStream(s.body),i=new TextDecoder,o="";for await(let u of a){let c=(o+i.decode(u)).split(`
`);o=c.pop()||"";for(let d of c)try{yield JSON.parse(d)}catch{console.warn(`Received a non-JSON parseable chunk: ${d}`)}}}async function*pb(n,e,t){yield*fb(`${n}/api/generate`,e,t)}async function*hb(n,e,t){yield*fb(`${n}/api/chat`,e,t)}var qu=class extends zu{static lc_name(){return"ChatOllama"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"llama2"}),Object.defineProperty(this,"baseUrl",{enumerable:!0,configurable:!0,writable:!0,value:"http://localhost:11434"}),Object.defineProperty(this,"keepAlive",{enumerable:!0,configurable:!0,writable:!0,value:"5m"}),Object.defineProperty(this,"embeddingOnly",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"f16KV",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"headers",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logitsAll",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lowVram",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"mainGpu",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"mirostat",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"mirostatEta",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"mirostatTau",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numBatch",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numCtx",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numGpu",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numGqa",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numKeep",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numPredict",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numThread",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"penalizeNewline",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"repeatLastN",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"repeatPenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ropeFrequencyBase",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ropeFrequencyScale",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tfsZ",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topK",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"typicalP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"useMLock",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"useMMap",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"vocabOnly",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"format",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.model=e.model??this.model,this.baseUrl=e.baseUrl?.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl??this.baseUrl,this.keepAlive=e.keepAlive??this.keepAlive,this.embeddingOnly=e.embeddingOnly,this.f16KV=e.f16KV,this.frequencyPenalty=e.frequencyPenalty,this.headers=e.headers,this.logitsAll=e.logitsAll,this.lowVram=e.lowVram,this.mainGpu=e.mainGpu,this.mirostat=e.mirostat,this.mirostatEta=e.mirostatEta,this.mirostatTau=e.mirostatTau,this.numBatch=e.numBatch,this.numCtx=e.numCtx,this.numGpu=e.numGpu,this.numGqa=e.numGqa,this.numKeep=e.numKeep,this.numPredict=e.numPredict,this.numThread=e.numThread,this.penalizeNewline=e.penalizeNewline,this.presencePenalty=e.presencePenalty,this.repeatLastN=e.repeatLastN,this.repeatPenalty=e.repeatPenalty,this.ropeFrequencyBase=e.ropeFrequencyBase,this.ropeFrequencyScale=e.ropeFrequencyScale,this.temperature=e.temperature,this.stop=e.stop,this.tfsZ=e.tfsZ,this.topK=e.topK,this.topP=e.topP,this.typicalP=e.typicalP,this.useMLock=e.useMLock,this.useMMap=e.useMMap,this.vocabOnly=e.vocabOnly,this.format=e.format}getLsParams(e){let t=this.invocationParams(e);return{ls_provider:"ollama",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:this.temperature??void 0,ls_stop:this.stop,ls_max_tokens:t.options.num_predict}}_llmType(){return"ollama"}invocationParams(e){return{model:this.model,format:this.format,keep_alive:this.keepAlive,options:{embedding_only:this.embeddingOnly,f16_kv:this.f16KV,frequency_penalty:this.frequencyPenalty,logits_all:this.logitsAll,low_vram:this.lowVram,main_gpu:this.mainGpu,mirostat:this.mirostat,mirostat_eta:this.mirostatEta,mirostat_tau:this.mirostatTau,num_batch:this.numBatch,num_ctx:this.numCtx,num_gpu:this.numGpu,num_gqa:this.numGqa,num_keep:this.numKeep,num_predict:this.numPredict,num_thread:this.numThread,penalize_newline:this.penalizeNewline,presence_penalty:this.presencePenalty,repeat_last_n:this.repeatLastN,repeat_penalty:this.repeatPenalty,rope_frequency_base:this.ropeFrequencyBase,rope_frequency_scale:this.ropeFrequencyScale,temperature:this.temperature,stop:e?.stop??this.stop,tfs_z:this.tfsZ,top_k:this.topK,top_p:this.topP,typical_p:this.typicalP,use_mlock:this.useMLock,use_mmap:this.useMMap,vocab_only:this.vocabOnly}}}_combineLLMOutput(){return{}}async*_streamResponseChunksLegacy(e,t,r){let s=pb(this.baseUrl,{...this.invocationParams(t),prompt:this._formatMessagesAsPrompt(e)},{...t,headers:this.headers});for await(let a of s)a.done?yield new Ct({text:"",message:new Re({content:""}),generationInfo:{model:a.model,total_duration:a.total_duration,load_duration:a.load_duration,prompt_eval_count:a.prompt_eval_count,prompt_eval_duration:a.prompt_eval_duration,eval_count:a.eval_count,eval_duration:a.eval_duration}}):(yield new Ct({text:a.response,message:new Re({content:a.response})}),await r?.handleLLMNewToken(a.response??""))}async*_streamResponseChunks(e,t,r){try{let s=await this.caller.call(async()=>hb(this.baseUrl,{...this.invocationParams(t),messages:this._convertMessagesToOllamaMessages(e)},{...t,headers:this.headers}));for await(let a of s)a.done?yield new Ct({text:"",message:new Re({content:""}),generationInfo:{model:a.model,total_duration:a.total_duration,load_duration:a.load_duration,prompt_eval_count:a.prompt_eval_count,prompt_eval_duration:a.prompt_eval_duration,eval_count:a.eval_count,eval_duration:a.eval_duration}}):(yield new Ct({text:a.message.content,message:new Re({content:a.message.content})}),await r?.handleLLMNewToken(a.message.content??""))}catch(s){if(s.response?.status===404)console.warn("[WARNING]: It seems you are using a legacy version of Ollama. Please upgrade to a newer version for better chat support."),yield*this._streamResponseChunksLegacy(e,t,r);else throw s}}_convertMessagesToOllamaMessages(e){return e.map(t=>{let r;if(t._getType()==="human")r="user";else if(t._getType()==="ai")r="assistant";else if(t._getType()==="system")r="system";else throw new Error(`Unsupported message type for Ollama: ${t._getType()}`);let s="",a=[];if(typeof t.content=="string")s=t.content;else for(let i of t.content)if(i.type==="text")s=`${s}
${i.text}`;else if(i.type==="image_url"&&typeof i.image_url=="string"){let o=i.image_url.split(",");a.push(o[1]??o[0])}else throw new Error('Unsupported message content type. Must either have type "text" or type "image_url" with a string "image_url" field.');return{role:r,content:s,images:a}})}_formatMessagesAsPrompt(e){return e.map(r=>{let s;return r._getType()==="human"?s=`[INST] ${r.content} [/INST]`:r._getType()==="ai"?s=r.content:r._getType()==="system"?s=`<<SYS>> ${r.content} <</SYS>>`:ct.isInstance(r)?s=`

${r.role[0].toUpperCase()}${r.role.slice(1)}: ${r.content}`:(console.warn(`Unsupported message type passed to Ollama: "${r._getType()}"`),s=""),s}).join(`
`)}async _call(e,t,r){let s=[];for await(let a of this._streamResponseChunks(e,t,r))s.push(a.message.content);return s.join("")}};Ss();zn();var Qd=class extends Qe{addUserMessage(e){return this.addMessage(new he(e))}addAIChatMessage(e){return this.addMessage(new ae(e))}addAIMessage(e){return this.addMessage(new ae(e))}async addMessages(e){for(let t of e)await this.addMessage(t)}clear(){throw new Error("Not implemented.")}},Ai=class extends Qd{constructor(e){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","stores","message","in_memory"]}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.messages=e??[]}async getMessages(){return this.messages}async addMessage(e){this.messages.push(e)}async clear(){this.messages=[]}};bt();Bn();bt();Bn();bt();Bn();Ht();zn();bt();var Ei=class extends Kt{constructor(e){let t=Wt.from((i,o)=>this._enterHistory(i,o??{})).withConfig({runName:"loadHistory"}),r=e.historyMessagesKey??e.inputMessagesKey;r&&(t=Nt.assign({[r]:t}).withConfig({runName:"insertHistory"}));let s=t.pipe(e.runnable.withListeners({onEnd:(i,o)=>this._exitHistory(i,o??{})})).withConfig({runName:"RunnableWithMessageHistory"}),a=e.config??{};super({...e,config:a,bound:s}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputMessagesKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputMessagesKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"historyMessagesKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"getMessageHistory",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.getMessageHistory=e.getMessageHistory,this.inputMessagesKey=e.inputMessagesKey,this.outputMessagesKey=e.outputMessagesKey,this.historyMessagesKey=e.historyMessagesKey}_getInputMessages(e){let t;if(typeof e=="object"&&!Array.isArray(e)&&!It(e)){let r;this.inputMessagesKey?r=this.inputMessagesKey:Object.keys(e).length===1?r=Object.keys(e)[0]:r="input",Array.isArray(e[r])&&Array.isArray(e[r][0])?t=e[r][0]:t=e[r]}else t=e;if(typeof t=="string")return[new he(t)];if(Array.isArray(t))return t;if(It(t))return[t];throw new Error(`Expected a string, BaseMessage, or array of BaseMessages.
Got ${JSON.stringify(t,null,2)}`)}_getOutputMessages(e){let t;if(!Array.isArray(e)&&!It(e)&&typeof e!="string"){let r;this.outputMessagesKey!==void 0?r=this.outputMessagesKey:Object.keys(e).length===1?r=Object.keys(e)[0]:r="output",e.generations!==void 0?t=e.generations[0][0].message:t=e[r]}else t=e;if(typeof t=="string")return[new ae(t)];if(Array.isArray(t))return t;if(It(t))return[t];throw new Error(`Expected a string, BaseMessage, or array of BaseMessages. Received: ${JSON.stringify(t,null,2)}`)}async _enterHistory(e,t){let s=await(t?.configurable?.messageHistory).getMessages();return this.historyMessagesKey===void 0?s.concat(this._getInputMessages(e)):s}async _exitHistory(e,t){let r=t.configurable?.messageHistory,s;Array.isArray(e.inputs)&&Array.isArray(e.inputs[0])?s=e.inputs[0]:s=e.inputs;let a=this._getInputMessages(s);if(this.historyMessagesKey===void 0){let u=await r.getMessages();a=a.slice(u.length)}let i=e.outputs;if(!i)throw new Error(`Output values from 'Run' undefined. Run: ${JSON.stringify(e,null,2)}`);let o=this._getOutputMessages(i);await r.addMessages([...a,...o])}async _mergeConfig(...e){let t=await super._mergeConfig(...e);if(!t.configurable||!t.configurable.sessionId){let s={[this.inputMessagesKey??"input"]:"foo"},a={configurable:{sessionId:"123"}};throw new Error(`sessionId is required. Pass it in as part of the config argument to .invoke() or .stream()
eg. chain.invoke(${JSON.stringify(s)}, ${JSON.stringify(a)})`)}let{sessionId:r}=t.configurable;return t.configurable.messageHistory=await this.getMessageHistory(r),t}};var Vu=class extends X{parseResultWithPrompt(e,t,r){return this.parseResult(e,r)}_baseMessageToString(e){return typeof e.content=="string"?e.content:this._baseMessageContentToString(e.content)}_baseMessageContentToString(e){return JSON.stringify(e)}async invoke(e,t){return typeof e=="string"?this._callWithConfig(async(r,s)=>this.parseResult([{text:r}],s?.callbacks),e,{...t,runType:"parser"}):this._callWithConfig(async(r,s)=>this.parseResult([{message:r,text:this._baseMessageToString(r)}],s?.callbacks),e,{...t,runType:"parser"})}},Oi=class extends Vu{parseResult(e,t){return this.parse(e[0].text,t)}async parseWithPrompt(e,t,r){return this.parse(e,r)}_type(){throw new Error("_type not implemented")}};Pt();Dr();zs();var PL=typeof self<"u"&&self.location&&self.location.origin!=="null"?new URL(self.location.origin+self.location.pathname+location.search):new URL("https://github.com/cfworker");var uO=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,lO=[0,31,28,31,30,31,30,31,31,30,31,30,31],cO=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i,dO=/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,fO=/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,pO=/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,hO=/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)(?:\.(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,mO=/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,gO=/^(?:\/(?:[^~/]|~0|~1)*)*$/,yO=/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,bO=/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,_O=/^\d\d\d\d-[0-1]\d-[0-3]\d$/,wO=/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,vO=/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,xO=/^(?:(?:[a-z][a-z0-9+-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,AO=n=>{if(n[0]==='"')return!1;let[e,t,...r]=n.split("@");return!e||!t||r.length!==0||e.length>64||t.length>253||e[0]==="."||e.endsWith(".")||e.includes("..")||!/^[a-z0-9.-]+$/i.test(t)||!/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+$/i.test(e)?!1:t.split(".").every(s=>/^[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?$/i.test(s))},EO=/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,OO=/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,IO=n=>n.length>1&&n.length<80&&(/^P\d+([.,]\d+)?W$/.test(n)||/^P[\dYMDTHS]*(\d[.,]\d+)?[YMDHS]$/.test(n)&&/^P([.,\d]+Y)?([.,\d]+M)?([.,\d]+D)?(T([.,\d]+H)?([.,\d]+M)?([.,\d]+S)?)?$/.test(n));function Ze(n){return n.test.bind(n)}var PO={date:mb,time:gb.bind(void 0,!1),"date-time":RO,duration:IO,uri:$O,"uri-reference":Ze(fO),"uri-template":Ze(pO),url:Ze(hO),email:AO,hostname:Ze(dO),ipv4:Ze(EO),ipv6:Ze(OO),regex:MO,uuid:Ze(mO),"json-pointer":Ze(gO),"json-pointer-uri-fragment":Ze(yO),"relative-json-pointer":Ze(bO)},TO={...PO,date:Ze(_O),time:Ze(wO),"date-time":Ze(vO),"uri-reference":Ze(xO)};function SO(n){return n%4===0&&(n%100!==0||n%400===0)}function mb(n){let e=n.match(uO);if(!e)return!1;let t=+e[1],r=+e[2],s=+e[3];return r>=1&&r<=12&&s>=1&&s<=(r==2&&SO(t)?29:lO[r])}function gb(n,e){let t=e.match(cO);if(!t)return!1;let r=+t[1],s=+t[2],a=+t[3],i=!!t[5];return(r<=23&&s<=59&&a<=59||r==23&&s==59&&a==60)&&(!n||i)}var CO=/t|\s/i;function RO(n){let e=n.split(CO);return e.length==2&&mb(e[0])&&gb(!0,e[1])}var kO=/\/|:/,NO=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function $O(n){return kO.test(n)&&NO.test(n)}var jO=/[^\\]\\Z/;function MO(n){if(jO.test(n))return!1;try{return new RegExp(n),!0}catch{return!1}}var Js=class extends Oi{async*_transform(e){for await(let t of e)typeof t=="string"?yield this.parseResult([{text:t}]):yield this.parseResult([{message:t,text:this._baseMessageToString(t)}])}async*transform(e,t){yield*this._transformStreamWithConfig(e,this._transform.bind(this),{...t,runType:"parser"})}};var Hu=class extends Js{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers","string"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"StrOutputParser"}parse(e){return Promise.resolve(e)}getFormatInstructions(){return""}_textContentToString(e){return e.text}_imageUrlContentToString(e){throw new Error('Cannot coerce a multimodal "image_url" message part into a string.')}_messageContentComplexToString(e){switch(e.type){case"text":case"text_delta":if("text"in e)return this._textContentToString(e);break;case"image_url":if("image_url"in e)return this._imageUrlContentToString(e);break;default:throw new Error(`Cannot coerce "${e.type}" message part into a string.`)}throw new Error(`Invalid content type: ${e.type}`)}_baseMessageContentToString(e){return e.reduce((t,r)=>t+this._messageContentComplexToString(r),"")}};pr();wd();bc();Ws();Ni();hf();Ws();Ni();Qs();Ii();Xs();af();Ni();Ts();Us();Bn();Cs();Bs();Ro();var mf=class extends vi{get lc_namespace(){return["langchain","tools"]}constructor(e){super(e??{}),Object.defineProperty(this,"returnDirect",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"verboseParsingErrors",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"responseFormat",{enumerable:!0,configurable:!0,writable:!0,value:"content"}),this.verboseParsingErrors=e?.verboseParsingErrors??this.verboseParsingErrors,this.responseFormat=e?.responseFormat??this.responseFormat}async invoke(e,t){let r,s;ks(e)?(r=e.id,s=e.args):s=e;let a=K(t);return this.call(s,{...a,configurable:{...a.configurable,tool_call_id:r}})}async call(e,t,r){let s;try{s=await this.schema.parseAsync(e)}catch(p){let g="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(g=`${g}
Details: ${p.message}`),new Rs(g,JSON.stringify(e))}let a=Nd(t),o=await(await Ie.configure(a.callbacks,this.callbacks,a.tags||r,this.tags,a.metadata,this.metadata,{verbose:this.verbose}))?.handleToolStart(this.toJSON(),typeof s=="string"?s:JSON.stringify(s),a.runId,void 0,void 0,void 0,a.runName);delete a.runId;let u;try{u=await this._call(s,o,a)}catch(p){throw await o?.handleToolError(p),p}let l,c;if(this.responseFormat==="content_and_artifact")if(Array.isArray(u)&&u.length===2)[l,c]=u;else throw new Error(`Tool response format is "content_and_artifact" but the output was not a two-tuple.
Result: ${JSON.stringify(u)}`);else l=u;let d;a&&"configurable"in a&&(d=a.configurable.tool_call_id);let f=uI({content:l,artifact:c,toolCallId:d,name:this.name});return await o?.handleToolEnd(f),f}},$i=class extends mf{constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:xt.object({input:xt.string().optional()}).transform(t=>t.input)})}call(e,t){return super.call(typeof e=="string"||!e?{input:e}:e,t)}},Wu=class extends $i{static lc_name(){return"DynamicTool"}constructor(e){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.func=e.func,this.returnDirect=e.returnDirect??this.returnDirect}async call(e,t){let r=Nd(t);return r.runName===void 0&&(r.runName=this.name),super.call(e,r)}async _call(e,t,r){return this.func(e,t,r)}};function uI(n){let{content:e,artifact:t,toolCallId:r}=n;return r?typeof e=="string"||Array.isArray(e)&&e.every(s=>typeof s=="object")?new mr({content:e,artifact:t,tool_call_id:r,name:n.name}):new mr({content:lI(e),artifact:t,tool_call_id:r,name:n.name}):e}function lI(n){try{return JSON.stringify(n,null,2)}catch{return`${n}`}}var Ob;(function(n){n.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",n.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",n.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",n.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",n.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT"})(Ob||(Ob={}));var Ib;(function(n){n.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE"})(Ib||(Ib={}));var Pb;(function(n){n.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",n.NEGLIGIBLE="NEGLIGIBLE",n.LOW="LOW",n.MEDIUM="MEDIUM",n.HIGH="HIGH"})(Pb||(Pb={}));var Tb;(function(n){n.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",n.SAFETY="SAFETY",n.OTHER="OTHER"})(Tb||(Tb={}));var Zu;(function(n){n.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",n.STOP="STOP",n.MAX_TOKENS="MAX_TOKENS",n.SAFETY="SAFETY",n.RECITATION="RECITATION",n.OTHER="OTHER"})(Zu||(Zu={}));var Sb;(function(n){n.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",n.RETRIEVAL_QUERY="RETRIEVAL_QUERY",n.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",n.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",n.CLASSIFICATION="CLASSIFICATION",n.CLUSTERING="CLUSTERING"})(Sb||(Sb={}));var Cb;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.AUTO="AUTO",n.ANY="ANY",n.NONE="NONE"})(Cb||(Cb={}));var Rb;(function(n){n.STRING="STRING",n.NUMBER="NUMBER",n.INTEGER="INTEGER",n.BOOLEAN="BOOLEAN",n.ARRAY="ARRAY",n.OBJECT="OBJECT"})(Rb||(Rb={}));var kb;(function(n){n.GENERATE_CONTENT="generateContent",n.STREAM_GENERATE_CONTENT="streamGenerateContent",n.COUNT_TOKENS="countTokens",n.EMBED_CONTENT="embedContent",n.BATCH_EMBED_CONTENTS="batchEmbedContents"})(kb||(kb={}));var VF=[Zu.RECITATION,Zu.SAFETY];Ms();pr();pr();bt();hi();pr();Cn();var Yu="RFC3986",Xu={RFC1738:n=>String(n).replace(/%20/g,"+"),RFC3986:n=>String(n)},Mb="RFC1738";var _I=Array.isArray,Yt=(()=>{let n=[];for(let e=0;e<256;++e)n.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return n})();var gf=1024,Lb=(n,e,t,r,s)=>{if(n.length===0)return n;let a=n;if(typeof n=="symbol"?a=Symbol.prototype.toString.call(n):typeof n!="string"&&(a=String(n)),t==="iso-8859-1")return escape(a).replace(/%u[0-9a-f]{4}/gi,function(o){return"%26%23"+parseInt(o.slice(2),16)+"%3B"});let i="";for(let o=0;o<a.length;o+=gf){let u=a.length>=gf?a.slice(o,o+gf):a,l=[];for(let c=0;c<u.length;++c){let d=u.charCodeAt(c);if(d===45||d===46||d===95||d===126||d>=48&&d<=57||d>=65&&d<=90||d>=97&&d<=122||s===Mb&&(d===40||d===41)){l[l.length]=u.charAt(c);continue}if(d<128){l[l.length]=Yt[d];continue}if(d<2048){l[l.length]=Yt[192|d>>6]+Yt[128|d&63];continue}if(d<55296||d>=57344){l[l.length]=Yt[224|d>>12]+Yt[128|d>>6&63]+Yt[128|d&63];continue}c+=1,d=65536+((d&1023)<<10|u.charCodeAt(c)&1023),l[l.length]=Yt[240|d>>18]+Yt[128|d>>12&63]+Yt[128|d>>6&63]+Yt[128|d&63]}i+=l.join("")}return i};function Db(n){return!n||typeof n!="object"?!1:!!(n.constructor&&n.constructor.isBuffer&&n.constructor.isBuffer(n))}function yf(n,e){if(_I(n)){let t=[];for(let r=0;r<n.length;r+=1)t.push(e(n[r]));return t}return e(n)}var wI=Object.prototype.hasOwnProperty,Fb={brackets(n){return String(n)+"[]"},comma:"comma",indices(n,e){return String(n)+"["+e+"]"},repeat(n){return String(n)}},Xt=Array.isArray,vI=Array.prototype.push,Ub=function(n,e){vI.apply(n,Xt(e)?e:[e])},xI=Date.prototype.toISOString,ge={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:Lb,encodeValuesOnly:!1,format:Yu,formatter:Xu[Yu],indices:!1,serializeDate(n){return xI.call(n)},skipNulls:!1,strictNullHandling:!1};function AI(n){return typeof n=="string"||typeof n=="number"||typeof n=="boolean"||typeof n=="symbol"||typeof n=="bigint"}var bf={};function Bb(n,e,t,r,s,a,i,o,u,l,c,d,f,p,g,m,y,x){let w=n,A=x,k=0,R=!1;for(;(A=A.get(bf))!==void 0&&!R;){let ne=A.get(n);if(k+=1,typeof ne<"u"){if(ne===k)throw new RangeError("Cyclic object value");R=!0}typeof A.get(bf)>"u"&&(k=0)}if(typeof l=="function"?w=l(e,w):w instanceof Date?w=f?.(w):t==="comma"&&Xt(w)&&(w=yf(w,function(ne){return ne instanceof Date?f?.(ne):ne})),w===null){if(a)return u&&!m?u(e,ge.encoder,y,"key",p):e;w=""}if(AI(w)||Db(w)){if(u){let ne=m?e:u(e,ge.encoder,y,"key",p);return[g?.(ne)+"="+g?.(u(w,ge.encoder,y,"value",p))]}return[g?.(e)+"="+g?.(String(w))]}let W=[];if(typeof w>"u")return W;let Y;if(t==="comma"&&Xt(w))m&&u&&(w=yf(w,u)),Y=[{value:w.length>0?w.join(",")||null:void 0}];else if(Xt(l))Y=l;else{let ne=Object.keys(w);Y=c?ne.sort(c):ne}let Z=o?String(e).replace(/\./g,"%2E"):String(e),oe=r&&Xt(w)&&w.length===1?Z+"[]":Z;if(s&&Xt(w)&&w.length===0)return oe+"[]";for(let ne=0;ne<Y.length;++ne){let fe=Y[ne],_p=typeof fe=="object"&&typeof fe.value<"u"?fe.value:w[fe];if(i&&_p===null)continue;let Rl=d&&o?fe.replace(/\./g,"%2E"):fe,H_=Xt(w)?typeof t=="function"?t(oe,Rl):oe:oe+(d?"."+Rl:"["+Rl+"]");x.set(n,k);let wp=new WeakMap;wp.set(bf,x),Ub(W,Bb(_p,H_,t,r,s,a,i,o,t==="comma"&&m&&Xt(w)?null:u,l,c,d,f,p,g,m,y,wp))}return W}function EI(n=ge){if(typeof n.allowEmptyArrays<"u"&&typeof n.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof n.encodeDotInKeys<"u"&&typeof n.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(n.encoder!==null&&typeof n.encoder<"u"&&typeof n.encoder!="function")throw new TypeError("Encoder has to be a function.");let e=n.charset||ge.charset;if(typeof n.charset<"u"&&n.charset!=="utf-8"&&n.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=Yu;if(typeof n.format<"u"){if(!wI.call(Xu,n.format))throw new TypeError("Unknown format option provided.");t=n.format}let r=Xu[t],s=ge.filter;(typeof n.filter=="function"||Xt(n.filter))&&(s=n.filter);let a;if(n.arrayFormat&&n.arrayFormat in Fb?a=n.arrayFormat:"indices"in n?a=n.indices?"indices":"repeat":a=ge.arrayFormat,"commaRoundTrip"in n&&typeof n.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");let i=typeof n.allowDots>"u"?n.encodeDotInKeys?!0:ge.allowDots:!!n.allowDots;return{addQueryPrefix:typeof n.addQueryPrefix=="boolean"?n.addQueryPrefix:ge.addQueryPrefix,allowDots:i,allowEmptyArrays:typeof n.allowEmptyArrays=="boolean"?!!n.allowEmptyArrays:ge.allowEmptyArrays,arrayFormat:a,charset:e,charsetSentinel:typeof n.charsetSentinel=="boolean"?n.charsetSentinel:ge.charsetSentinel,commaRoundTrip:!!n.commaRoundTrip,delimiter:typeof n.delimiter>"u"?ge.delimiter:n.delimiter,encode:typeof n.encode=="boolean"?n.encode:ge.encode,encodeDotInKeys:typeof n.encodeDotInKeys=="boolean"?n.encodeDotInKeys:ge.encodeDotInKeys,encoder:typeof n.encoder=="function"?n.encoder:ge.encoder,encodeValuesOnly:typeof n.encodeValuesOnly=="boolean"?n.encodeValuesOnly:ge.encodeValuesOnly,filter:s,format:t,formatter:r,serializeDate:typeof n.serializeDate=="function"?n.serializeDate:ge.serializeDate,skipNulls:typeof n.skipNulls=="boolean"?n.skipNulls:ge.skipNulls,sort:typeof n.sort=="function"?n.sort:null,strictNullHandling:typeof n.strictNullHandling=="boolean"?n.strictNullHandling:ge.strictNullHandling}}function _f(n,e={}){let t=n,r=EI(e),s,a;typeof r.filter=="function"?(a=r.filter,t=a("",t)):Xt(r.filter)&&(a=r.filter,s=a);let i=[];if(typeof t!="object"||t===null)return"";let o=Fb[r.arrayFormat],u=o==="comma"&&r.commaRoundTrip;s||(s=Object.keys(t)),r.sort&&s.sort(r.sort);let l=new WeakMap;for(let f=0;f<s.length;++f){let p=s[f];r.skipNulls&&t[p]===null||Ub(i,Bb(t[p],p,o,u,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,l))}let c=i.join(r.delimiter),d=r.addQueryPrefix===!0?"?":"";return r.charsetSentinel&&(r.charset==="iso-8859-1"?d+="utf8=%26%2310003%3B&":d+="utf8=%E2%9C%93&"),c.length>0?d+c:""}var Hn="4.104.0";var zb=!1,Gn,wf,II,PI,TI,vf,SI,Qu,xf,Af,Ef,el,Of;function qb(n,e={auto:!1}){if(zb)throw new Error(`you must \`import 'openai/shims/${n.kind}'\` before importing anything else from openai`);if(Gn)throw new Error(`can't \`import 'openai/shims/${n.kind}'\` after \`import 'openai/shims/${Gn}'\``);zb=e.auto,Gn=n.kind,wf=n.fetch,II=n.Request,PI=n.Response,TI=n.Headers,vf=n.FormData,SI=n.Blob,Qu=n.File,xf=n.ReadableStream,Af=n.getMultipartRequestOptions,Ef=n.getDefaultAgent,el=n.fileFromPath,Of=n.isFsReadStream}var tl=class{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}};function Vb({manuallyImported:n}={}){let e=n?"You may need to use polyfills":"Add one of these imports before your first `import \u2026 from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n",t,r,s,a;try{t=fetch,r=Request,s=Response,a=Headers}catch(i){throw new Error(`this environment is missing the following Web Fetch API type: ${i.message}. ${e}`)}return{kind:"web",fetch:t,Request:r,Response:s,Headers:a,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(i,o)=>({...o,body:new tl(i)}),getDefaultAgent:i=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:i=>!1}}var If=()=>{Gn||qb(Vb(),{auto:!0})};If();var C=class extends Error{},ye=class n extends C{constructor(e,t,r,s){super(`${n.makeMessage(e,t,r)}`),this.status=e,this.headers=s,this.request_id=s?.["x-request-id"],this.error=t;let a=t;this.code=a?.code,this.param=a?.param,this.type=a?.type}static makeMessage(e,t,r){let s=t?.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,r,s){if(!e||!s)return new Vr({message:r,cause:rl(t)});let a=t?.error;return e===400?new ji(e,a,r,s):e===401?new Mi(e,a,r,s):e===403?new Li(e,a,r,s):e===404?new Di(e,a,r,s):e===409?new Fi(e,a,r,s):e===422?new Ui(e,a,r,s):e===429?new Bi(e,a,r,s):e>=500?new zi(e,a,r,s):new n(e,a,r,s)}},de=class extends ye{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},Vr=class extends ye{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}},Hr=class extends Vr{constructor({message:e}={}){super({message:e??"Request timed out."})}},ji=class extends ye{},Mi=class extends ye{},Li=class extends ye{},Di=class extends ye{},Fi=class extends ye{},Ui=class extends ye{},Bi=class extends ye{},zi=class extends ye{},ra=class extends C{constructor(){super("Could not parse response content as the length limit was reached")}},na=class extends C{constructor(){super("Could not parse response content as the request was rejected by the content filter")}};var nl=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},Kn=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},et,Jn=class{constructor(){et.set(this,void 0),this.buffer=new Uint8Array,nl(this,et,null,"f")}decode(e){if(e==null)return[];let t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?new TextEncoder().encode(e):e,r=new Uint8Array(this.buffer.length+t.length);r.set(this.buffer),r.set(t,this.buffer.length),this.buffer=r;let s=[],a;for(;(a=kI(this.buffer,Kn(this,et,"f")))!=null;){if(a.carriage&&Kn(this,et,"f")==null){nl(this,et,a.index,"f");continue}if(Kn(this,et,"f")!=null&&(a.index!==Kn(this,et,"f")+1||a.carriage)){s.push(this.decodeText(this.buffer.slice(0,Kn(this,et,"f")-1))),this.buffer=this.buffer.slice(Kn(this,et,"f")),nl(this,et,null,"f");continue}let i=Kn(this,et,"f")!==null?a.preceding-1:a.preceding,o=this.decodeText(this.buffer.slice(0,i));s.push(o),this.buffer=this.buffer.slice(a.index),nl(this,et,null,"f")}return s}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new C(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new C(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new C("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){return this.buffer.length?this.decode(`
`):[]}};et=new WeakMap;Jn.NEWLINE_CHARS=new Set([`
`,"\r"]);Jn.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function kI(n,e){for(let s=e??0;s<n.length;s++){if(n[s]===10)return{preceding:s,index:s+1,carriage:!1};if(n[s]===13)return{preceding:s,index:s+1,carriage:!0}}return null}function Hb(n){for(let r=0;r<n.length-1;r++){if(n[r]===10&&n[r+1]===10||n[r]===13&&n[r+1]===13)return r+2;if(n[r]===13&&n[r+1]===10&&r+3<n.length&&n[r+2]===13&&n[r+3]===10)return r+4}return-1}function Pf(n){if(n[Symbol.asyncIterator])return n;let e=n.getReader();return{async next(){try{let t=await e.read();return t?.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){let t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}var Qt=class n{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let r=!1;async function*s(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let a=!1;try{for await(let i of NI(e,t))if(!a){if(i.data.startsWith("[DONE]")){a=!0;continue}if(i.event===null||i.event.startsWith("response.")||i.event.startsWith("transcript.")){let o;try{o=JSON.parse(i.data)}catch(u){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),u}if(o&&o.error)throw new ye(void 0,o.error,void 0,Sf(e.headers));yield o}else{let o;try{o=JSON.parse(i.data)}catch(u){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),u}if(i.event=="error")throw new ye(void 0,o.error,o.message,void 0);yield{event:i.event,data:o}}}a=!0}catch(i){if(i instanceof Error&&i.name==="AbortError")return;throw i}finally{a||t.abort()}}return new n(s,t)}static fromReadableStream(e,t){let r=!1;async function*s(){let i=new Jn,o=Pf(e);for await(let u of o)for(let l of i.decode(u))yield l;for(let u of i.flush())yield u}async function*a(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let i=!1;try{for await(let o of s())i||o&&(yield JSON.parse(o));i=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{i||t.abort()}}return new n(a,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){let e=[],t=[],r=this.iterator(),s=a=>({next:()=>{if(a.length===0){let i=r.next();e.push(i),t.push(i)}return a.shift()}});return[new n(()=>s(e),this.controller),new n(()=>s(t),this.controller)]}toReadableStream(){let e=this,t,r=new TextEncoder;return new xf({async start(){t=e[Symbol.asyncIterator]()},async pull(s){try{let{value:a,done:i}=await t.next();if(i)return s.close();let o=r.encode(JSON.stringify(a)+`
`);s.enqueue(o)}catch(a){s.error(a)}},async cancel(){await t.return?.()}})}};async function*NI(n,e){if(!n.body)throw e.abort(),new C("Attempted to iterate over a response with no body");let t=new Tf,r=new Jn,s=Pf(n.body);for await(let a of $I(s))for(let i of r.decode(a)){let o=t.decode(i);o&&(yield o)}for(let a of r.flush()){let i=t.decode(a);i&&(yield i)}}async function*$I(n){let e=new Uint8Array;for await(let t of n){if(t==null)continue;let r=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t,s=new Uint8Array(e.length+r.length);s.set(e),s.set(r,e.length),e=s;let a;for(;(a=Hb(e))!==-1;)yield e.slice(0,a),e=e.slice(a)}e.length>0&&(yield e)}var Tf=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let a={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],a}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,s]=jI(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}};function jI(n,e){let t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}var Gb=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function",Kb=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&qi(n),qi=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function",MI=n=>Kb(n)||Gb(n)||Of(n);async function kf(n,e,t){if(n=await n,Kb(n))return n;if(Gb(n)){let s=await n.blob();e||(e=new URL(n.url).pathname.split(/[\\/]/).pop()??"unknown_file");let a=qi(s)?[await s.arrayBuffer()]:[s];return new Qu(a,e,t)}let r=await LI(n);if(e||(e=FI(n)??"unknown_file"),!t?.type){let s=r[0]?.type;typeof s=="string"&&(t={...t,type:s})}return new Qu(r,e,t)}async function LI(n){let e=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)e.push(n);else if(qi(n))e.push(await n.arrayBuffer());else if(UI(n))for await(let t of n)e.push(t);else throw new Error(`Unexpected data type: ${typeof n}; constructor: ${n?.constructor?.name}; props: ${DI(n)}`);return e}function DI(n){return`[${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}function FI(n){return Cf(n.name)||Cf(n.filename)||Cf(n.path)?.split(/[\\/]/).pop()}var Cf=n=>{if(typeof n=="string")return n;if(typeof Buffer<"u"&&n instanceof Buffer)return String(n)},UI=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function",Nf=n=>n&&typeof n=="object"&&n.body&&n[Symbol.toStringTag]==="MultipartBody";var Ye=async n=>{let e=await Jb(n.body);return Af(e,n)},Jb=async n=>{let e=new vf;return await Promise.all(Object.entries(n||{}).map(([t,r])=>Rf(e,t,r))),e};var Rf=async(n,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")n.append(e,String(t));else if(MI(t)){let r=await kf(t);n.append(e,r)}else if(Array.isArray(t))await Promise.all(t.map(r=>Rf(n,e+"[]",r)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([r,s])=>Rf(n,`${e}[${r}]`,s)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var zI=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},qI=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},sl;If();async function e_(n){let{response:e}=n;if(n.options.stream)return Er("response",e.status,e.url,e.headers,e.body),n.options.__streamClass?n.options.__streamClass.fromSSEResponse(e,n.controller):Qt.fromSSEResponse(e,n.controller);if(e.status===204)return null;if(n.options.__binaryResponse)return e;let r=e.headers.get("content-type")?.split(";")[0]?.trim();if(r?.includes("application/json")||r?.endsWith("+json")){let i=await e.json();return Er("response",e.status,e.url,e.headers,i),t_(i,e)}let a=await e.text();return Er("response",e.status,e.url,e.headers,a),a}function t_(n,e){return!n||typeof n!="object"||Array.isArray(n)?n:Object.defineProperty(n,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}var il=class n extends Promise{constructor(e,t=e_){super(r=>{r(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new n(this.responsePromise,async t=>t_(e(await this.parseResponse(t),t),t.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}},ol=class{constructor({baseURL:e,maxRetries:t=2,timeout:r=6e5,httpAgent:s,fetch:a}){this.baseURL=e,this.maxRetries=$f("maxRetries",t),this.timeout=$f("timeout",r),this.httpAgent=s,this.fetch=a??wf}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...KI(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${YI()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(async s=>{let a=s&&qi(s?.body)?new DataView(await s.body.arrayBuffer()):s?.body instanceof DataView?s.body:s?.body instanceof ArrayBuffer?new DataView(s.body):s&&ArrayBuffer.isView(s?.body)?new DataView(s.body.buffer):s?.body;return{method:e,path:t,...s,body:a}}))}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){let r={...e},{method:s,path:a,query:i,headers:o={}}=r,u=ArrayBuffer.isView(r.body)||r.__binaryRequest&&typeof r.body=="string"?r.body:Nf(r.body)?r.body.body:r.body?JSON.stringify(r.body,null,2):null,l=this.calculateContentLength(u),c=this.buildURL(a,i);"timeout"in r&&$f("timeout",r.timeout),r.timeout=r.timeout??this.timeout;let d=r.httpAgent??this.httpAgent??Ef(c),f=r.timeout+1e3;typeof d?.options?.timeout=="number"&&f>(d.options.timeout??0)&&(d.options.timeout=f),this.idempotencyHeader&&s!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),o[this.idempotencyHeader]=e.idempotencyKey);let p=this.buildHeaders({options:r,headers:o,contentLength:l,retryCount:t});return{req:{method:s,...u&&{body:u},headers:p,...d&&{agent:d},signal:r.signal??null},url:c,timeout:r.timeout}}buildHeaders({options:e,headers:t,contentLength:r,retryCount:s}){let a={};r&&(a["content-length"]=r);let i=this.defaultHeaders(e);return Xb(a,i),Xb(a,t),Nf(e.body)&&Gn!=="node"&&delete a["content-type"],al(i,"x-stainless-retry-count")===void 0&&al(t,"x-stainless-retry-count")===void 0&&(a["x-stainless-retry-count"]=String(s)),al(i,"x-stainless-timeout")===void 0&&al(t,"x-stainless-timeout")===void 0&&e.timeout&&(a["x-stainless-timeout"]=String(Math.trunc(e.timeout/1e3))),this.validateHeaders(a,t),a}async prepareOptions(e){}async prepareRequest(e,{url:t,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,r,s){return ye.generate(e,t,r,s)}request(e,t=null){return new il(this.makeRequest(e,t))}async makeRequest(e,t){let r=await e,s=r.maxRetries??this.maxRetries;t==null&&(t=s),await this.prepareOptions(r);let{req:a,url:i,timeout:o}=this.buildRequest(r,{retryCount:s-t});if(await this.prepareRequest(a,{url:i,options:r}),Er("request",i,r,a.headers),r.signal?.aborted)throw new de;let u=new AbortController,l=await this.fetchWithTimeout(i,a,o,u).catch(rl);if(l instanceof Error){if(r.signal?.aborted)throw new de;if(t)return this.retryRequest(r,t);throw l.name==="AbortError"?new Hr:new Vr({cause:l})}let c=Sf(l.headers);if(!l.ok){if(t&&this.shouldRetry(l)){let y=`retrying, ${t} attempts remaining`;return Er(`response (error; ${y})`,l.status,i,c),this.retryRequest(r,t,c)}let d=await l.text().catch(y=>rl(y).message),f=JI(d),p=f?void 0:d;throw Er(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,l.status,i,c,p),this.makeStatusError(l.status,f,p,c)}return{response:l,options:r,controller:u}}requestAPIList(e,t){let r=this.makeRequest(t,null);return new jf(this,r,e)}buildURL(e,t){let r=ZI(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return r_(s)||(t={...s,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,r])=>typeof r<"u").map(([t,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(t)}=`;throw new C(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,r,s){let{signal:a,...i}=t||{};a&&a.addEventListener("abort",()=>s.abort());let o=setTimeout(()=>s.abort(),r),u={signal:s.signal,...i};return u.method&&(u.method=u.method.toUpperCase()),this.fetch.call(void 0,e,u).finally(()=>{clearTimeout(o)})}shouldRetry(e){let t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,r){let s,a=r?.["retry-after-ms"];if(a){let o=parseFloat(a);Number.isNaN(o)||(s=o)}let i=r?.["retry-after"];if(i&&!s){let o=parseFloat(i);Number.isNaN(o)?s=Date.parse(i)-Date.now():s=o*1e3}if(!(s&&0<=s&&s<60*1e3)){let o=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(t,o)}return await Or(s),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){let a=t-e,i=Math.min(.5*Math.pow(2,a),8),o=1-Math.random()*.25;return i*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${Hn}`}},Vi=class{constructor(e,t,r,s){sl.set(this,void 0),zI(this,sl,e,"f"),this.options=s,this.response=t,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){let e=this.nextPageInfo();if(!e)throw new C("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");let t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){let r=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(let[s,a]of r)e.url.searchParams.set(s,a);t.query=void 0,t.path=e.url.toString()}return await qI(this,sl,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(sl=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}},jf=class extends il{constructor(e,t,r){super(t,async s=>new r(e,s.response,await e_(s),s.options))}async*[Symbol.asyncIterator](){let e=await this;for await(let t of e)yield t}},Sf=n=>new Proxy(Object.fromEntries(n.entries()),{get(e,t){let r=t.toString();return e[r.toLowerCase()]||e[r]}}),VI={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__metadata:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},D=n=>typeof n=="object"&&n!==null&&!r_(n)&&Object.keys(n).every(e=>n_(VI,e)),HI=()=>{if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Hn,"X-Stainless-OS":Zb(Deno.build.os),"X-Stainless-Arch":Wb(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:Deno.version?.deno??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Hn,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Hn,"X-Stainless-OS":Zb(process.platform),"X-Stainless-Arch":Wb(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};let n=GI();return n?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Hn,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${n.browser}`,"X-Stainless-Runtime-Version":n.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Hn,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function GI(){if(typeof navigator>"u"||!navigator)return null;let n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:e,pattern:t}of n){let r=t.exec(navigator.userAgent);if(r){let s=r[1]||0,a=r[2]||0,i=r[3]||0;return{browser:e,version:`${s}.${a}.${i}`}}}return null}var Wb=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",Zb=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown"),Yb,KI=()=>Yb??(Yb=HI()),JI=n=>{try{return JSON.parse(n)}catch{return}},WI=/^[a-z][a-z0-9+.-]*:/i,ZI=n=>WI.test(n),Or=n=>new Promise(e=>setTimeout(e,n)),$f=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new C(`${n} must be an integer`);if(e<0)throw new C(`${n} must be a positive integer`);return e},rl=n=>{if(n instanceof Error)return n;if(typeof n=="object"&&n!==null)try{return new Error(JSON.stringify(n))}catch{}return new Error(n)};var Hi=n=>{if(typeof process<"u")return process.env?.[n]?.trim()??void 0;if(typeof Deno<"u")return Deno.env?.get?.(n)?.trim()};function r_(n){if(!n)return!0;for(let e in n)return!1;return!0}function n_(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Xb(n,e){for(let t in e){if(!n_(e,t))continue;let r=t.toLowerCase();if(!r)continue;let s=e[t];s===null?delete n[r]:s!==void 0&&(n[r]=s)}}var Qb=new Set(["authorization","api-key"]);function Er(n,...e){if(typeof process<"u"&&process?.env?.DEBUG==="true"){let t=e.map(r=>{if(!r)return r;if(r.headers){let a={...r,headers:{...r.headers}};for(let i in r.headers)Qb.has(i.toLowerCase())&&(a.headers[i]="REDACTED");return a}let s=null;for(let a in r)Qb.has(a.toLowerCase())&&(s??(s={...r}),s[a]="REDACTED");return s??r});console.log(`OpenAI:DEBUG:${n}`,...t)}}var YI=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{let e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)}),s_=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",XI=n=>typeof n?.get=="function";var al=(n,e)=>{let t=e.toLowerCase();if(XI(n)){let r=e[0]?.toUpperCase()+e.substring(1).replace(/([^\w])(\w)/g,(s,a,i)=>a+i.toUpperCase());for(let s of[e,t,e.toUpperCase(),r]){let a=n.get(s);if(a)return a}}for(let[r,s]of Object.entries(n))if(r.toLowerCase()===t)return Array.isArray(s)?(s.length<=1||console.warn(`Received ${s.length} entries for the ${e} header, using the first entry.`),s[0]):s};var a_=n=>{if(typeof Buffer<"u"){let e=Buffer.from(n,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{let e=atob(n),t=e.length,r=new Uint8Array(t);for(let s=0;s<t;s++)r[s]=e.charCodeAt(s);return Array.from(new Float32Array(r.buffer))}};function Gi(n){return n!=null&&typeof n=="object"&&!Array.isArray(n)}var er=class extends Vi{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[],this.object=r.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}},V=class extends Vi{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[],this.has_more=r.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageParams(){let e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;let t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){let e=this.getPaginatedItems();if(!e.length)return null;let t=e[e.length-1]?.id;return t?{params:{after:t}}:null}};var b=class{constructor(e){this._client=e}};var sa=class extends b{list(e,t={},r){return D(t)?this.list(e,{},t):this._client.getAPIList(`/chat/completions/${e}/messages`,ul,{query:t,...r})}};var Gr=class extends b{constructor(){super(...arguments),this.messages=new sa(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(`/chat/completions/${e}`,t)}update(e,t,r){return this._client.post(`/chat/completions/${e}`,{body:t,...r})}list(e={},t){return D(e)?this.list({},e):this._client.getAPIList("/chat/completions",Kr,{query:e,...t})}del(e,t){return this._client.delete(`/chat/completions/${e}`,t)}},Kr=class extends V{},ul=class extends V{};Gr.ChatCompletionsPage=Kr;Gr.Messages=sa;var Pr=class extends b{constructor(){super(...arguments),this.completions=new Gr(this._client)}};Pr.Completions=Gr;Pr.ChatCompletionsPage=Kr;var aa=class extends b{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:{Accept:"application/octet-stream",...t?.headers},__binaryResponse:!0})}};var ia=class extends b{create(e,t){return this._client.post("/audio/transcriptions",Ye({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}}))}};var oa=class extends b{create(e,t){return this._client.post("/audio/translations",Ye({body:e,...t,__metadata:{model:e.model}}))}};var tr=class extends b{constructor(){super(...arguments),this.transcriptions=new ia(this._client),this.translations=new oa(this._client),this.speech=new aa(this._client)}};tr.Transcriptions=ia;tr.Translations=oa;tr.Speech=aa;var Jr=class extends b{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return D(e)?this.list({},e):this._client.getAPIList("/batches",Wn,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}},Wn=class extends V{};Jr.BatchesPage=Wn;var Mt=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},re=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},Mf,ll,cl,Ki,Ji,dl,Wi,Tr,Zi,fl,pl,ua,i_,Wr=class{constructor(){Mf.add(this),this.controller=new AbortController,ll.set(this,void 0),cl.set(this,()=>{}),Ki.set(this,()=>{}),Ji.set(this,void 0),dl.set(this,()=>{}),Wi.set(this,()=>{}),Tr.set(this,{}),Zi.set(this,!1),fl.set(this,!1),pl.set(this,!1),ua.set(this,!1),Mt(this,ll,new Promise((e,t)=>{Mt(this,cl,e,"f"),Mt(this,Ki,t,"f")}),"f"),Mt(this,Ji,new Promise((e,t)=>{Mt(this,dl,e,"f"),Mt(this,Wi,t,"f")}),"f"),re(this,ll,"f").catch(()=>{}),re(this,Ji,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},re(this,Mf,"m",i_).bind(this))},0)}_connected(){this.ended||(re(this,cl,"f").call(this),this._emit("connect"))}get ended(){return re(this,Zi,"f")}get errored(){return re(this,fl,"f")}get aborted(){return re(this,pl,"f")}abort(){this.controller.abort()}on(e,t){return(re(this,Tr,"f")[e]||(re(this,Tr,"f")[e]=[])).push({listener:t}),this}off(e,t){let r=re(this,Tr,"f")[e];if(!r)return this;let s=r.findIndex(a=>a.listener===t);return s>=0&&r.splice(s,1),this}once(e,t){return(re(this,Tr,"f")[e]||(re(this,Tr,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{Mt(this,ua,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,t)})}async done(){Mt(this,ua,!0,"f"),await re(this,Ji,"f")}_emit(e,...t){if(re(this,Zi,"f"))return;e==="end"&&(Mt(this,Zi,!0,"f"),re(this,dl,"f").call(this));let r=re(this,Tr,"f")[e];if(r&&(re(this,Tr,"f")[e]=r.filter(s=>!s.once),r.forEach(({listener:s})=>s(...t))),e==="abort"){let s=t[0];!re(this,ua,"f")&&!r?.length&&Promise.reject(s),re(this,Ki,"f").call(this,s),re(this,Wi,"f").call(this,s),this._emit("end");return}if(e==="error"){let s=t[0];!re(this,ua,"f")&&!r?.length&&Promise.reject(s),re(this,Ki,"f").call(this,s),re(this,Wi,"f").call(this,s),this._emit("end")}}_emitFinal(){}};ll=new WeakMap,cl=new WeakMap,Ki=new WeakMap,Ji=new WeakMap,dl=new WeakMap,Wi=new WeakMap,Tr=new WeakMap,Zi=new WeakMap,fl=new WeakMap,pl=new WeakMap,ua=new WeakMap,Mf=new WeakSet,i_=function(e){if(Mt(this,fl,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new de),e instanceof de)return Mt(this,pl,!0,"f"),this._emit("abort",e);if(e instanceof C)return this._emit("error",e);if(e instanceof Error){let t=new C(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new C(String(e)))};var N=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},tt=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},Pe,Lf,rr,hl,Lt,Yn,la,Zn,yl,rt,ml,gl,Qi,Yi,Xi,o_,u_,l_,c_,d_,f_,p_,nr=class n extends Wr{constructor(){super(...arguments),Pe.add(this),Lf.set(this,[]),rr.set(this,{}),hl.set(this,{}),Lt.set(this,void 0),Yn.set(this,void 0),la.set(this,void 0),Zn.set(this,void 0),yl.set(this,void 0),rt.set(this,void 0),ml.set(this,void 0),gl.set(this,void 0),Qi.set(this,void 0)}[(Lf=new WeakMap,rr=new WeakMap,hl=new WeakMap,Lt=new WeakMap,Yn=new WeakMap,la=new WeakMap,Zn=new WeakMap,yl=new WeakMap,rt=new WeakMap,ml=new WeakMap,gl=new WeakMap,Qi=new WeakMap,Pe=new WeakSet,Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("event",s=>{let a=t.shift();a?a.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(let s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(let a of t)a.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(let a of t)a.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let t=new n;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){let r=t?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),this._connected();let s=Qt.fromReadableStream(e,this.controller);for await(let a of s)N(this,Pe,"m",Yi).call(this,a);if(s.controller.signal?.aborted)throw new de;return this._addRun(N(this,Pe,"m",Xi).call(this))}toReadableStream(){return new Qt(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,r,s,a){let i=new n;return i._run(()=>i._runToolAssistantStream(e,t,r,s,{...a,headers:{...a?.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createToolAssistantStream(e,t,r,s,a){let i=a?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));let o={...s,stream:!0},u=await e.submitToolOutputs(t,r,o,{...a,signal:this.controller.signal});this._connected();for await(let l of u)N(this,Pe,"m",Yi).call(this,l);if(u.controller.signal?.aborted)throw new de;return this._addRun(N(this,Pe,"m",Xi).call(this))}static createThreadAssistantStream(e,t,r){let s=new n;return s._run(()=>s._threadAssistantStream(e,t,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),s}static createAssistantStream(e,t,r,s){let a=new n;return a._run(()=>a._runAssistantStream(e,t,r,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),a}currentEvent(){return N(this,ml,"f")}currentRun(){return N(this,gl,"f")}currentMessageSnapshot(){return N(this,Lt,"f")}currentRunStepSnapshot(){return N(this,Qi,"f")}async finalRunSteps(){return await this.done(),Object.values(N(this,rr,"f"))}async finalMessages(){return await this.done(),Object.values(N(this,hl,"f"))}async finalRun(){if(await this.done(),!N(this,Yn,"f"))throw Error("Final run was not received.");return N(this,Yn,"f")}async _createThreadAssistantStream(e,t,r){let s=r?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));let a={...t,stream:!0},i=await e.createAndRun(a,{...r,signal:this.controller.signal});this._connected();for await(let o of i)N(this,Pe,"m",Yi).call(this,o);if(i.controller.signal?.aborted)throw new de;return this._addRun(N(this,Pe,"m",Xi).call(this))}async _createAssistantStream(e,t,r,s){let a=s?.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));let i={...r,stream:!0},o=await e.create(t,i,{...s,signal:this.controller.signal});this._connected();for await(let u of o)N(this,Pe,"m",Yi).call(this,u);if(o.controller.signal?.aborted)throw new de;return this._addRun(N(this,Pe,"m",Xi).call(this))}static accumulateDelta(e,t){for(let[r,s]of Object.entries(t)){if(!e.hasOwnProperty(r)){e[r]=s;continue}let a=e[r];if(a==null){e[r]=s;continue}if(r==="index"||r==="type"){e[r]=s;continue}if(typeof a=="string"&&typeof s=="string")a+=s;else if(typeof a=="number"&&typeof s=="number")a+=s;else if(Gi(a)&&Gi(s))a=this.accumulateDelta(a,s);else if(Array.isArray(a)&&Array.isArray(s)){if(a.every(i=>typeof i=="string"||typeof i=="number")){a.push(...s);continue}for(let i of s){if(!Gi(i))throw new Error(`Expected array delta entry to be an object but got: ${i}`);let o=i.index;if(o==null)throw console.error(i),new Error("Expected array delta entry to have an `index` property");if(typeof o!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${o}`);let u=a[o];u==null?a.push(i):a[o]=this.accumulateDelta(u,i)}continue}else throw Error(`Unhandled record type: ${r}, deltaValue: ${s}, accValue: ${a}`);e[r]=a}return e}_addRun(e){return e}async _threadAssistantStream(e,t,r){return await this._createThreadAssistantStream(t,e,r)}async _runAssistantStream(e,t,r,s){return await this._createAssistantStream(t,e,r,s)}async _runToolAssistantStream(e,t,r,s,a){return await this._createToolAssistantStream(r,e,t,s,a)}};Yi=function(e){if(!this.ended)switch(tt(this,ml,e,"f"),N(this,Pe,"m",l_).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":N(this,Pe,"m",p_).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":N(this,Pe,"m",u_).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":N(this,Pe,"m",o_).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier");default:}},Xi=function(){if(this.ended)throw new C("stream has ended, this shouldn't happen");if(!N(this,Yn,"f"))throw Error("Final run has not been received");return N(this,Yn,"f")},o_=function(e){let[t,r]=N(this,Pe,"m",d_).call(this,e,N(this,Lt,"f"));tt(this,Lt,t,"f"),N(this,hl,"f")[t.id]=t;for(let s of r){let a=t.content[s.index];a?.type=="text"&&this._emit("textCreated",a.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(let s of e.data.delta.content){if(s.type=="text"&&s.text){let a=s.text,i=t.content[s.index];if(i&&i.type=="text")this._emit("textDelta",a,i.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=N(this,la,"f")){if(N(this,Zn,"f"))switch(N(this,Zn,"f").type){case"text":this._emit("textDone",N(this,Zn,"f").text,N(this,Lt,"f"));break;case"image_file":this._emit("imageFileDone",N(this,Zn,"f").image_file,N(this,Lt,"f"));break}tt(this,la,s.index,"f")}tt(this,Zn,t.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(N(this,la,"f")!==void 0){let s=e.data.content[N(this,la,"f")];if(s)switch(s.type){case"image_file":this._emit("imageFileDone",s.image_file,N(this,Lt,"f"));break;case"text":this._emit("textDone",s.text,N(this,Lt,"f"));break}}N(this,Lt,"f")&&this._emit("messageDone",e.data),tt(this,Lt,void 0,"f")}},u_=function(e){let t=N(this,Pe,"m",c_).call(this,e);switch(tt(this,Qi,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let r=e.data.delta;if(r.step_details&&r.step_details.type=="tool_calls"&&r.step_details.tool_calls&&t.step_details.type=="tool_calls")for(let a of r.step_details.tool_calls)a.index==N(this,yl,"f")?this._emit("toolCallDelta",a,t.step_details.tool_calls[a.index]):(N(this,rt,"f")&&this._emit("toolCallDone",N(this,rt,"f")),tt(this,yl,a.index,"f"),tt(this,rt,t.step_details.tool_calls[a.index],"f"),N(this,rt,"f")&&this._emit("toolCallCreated",N(this,rt,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":tt(this,Qi,void 0,"f"),e.data.step_details.type=="tool_calls"&&N(this,rt,"f")&&(this._emit("toolCallDone",N(this,rt,"f")),tt(this,rt,void 0,"f")),this._emit("runStepDone",e.data,t);break;case"thread.run.step.in_progress":break}},l_=function(e){N(this,Lf,"f").push(e),this._emit("event",e)},c_=function(e){switch(e.event){case"thread.run.step.created":return N(this,rr,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=N(this,rr,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let r=e.data;if(r.delta){let s=nr.accumulateDelta(t,r.delta);N(this,rr,"f")[e.data.id]=s}return N(this,rr,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":N(this,rr,"f")[e.data.id]=e.data;break}if(N(this,rr,"f")[e.data.id])return N(this,rr,"f")[e.data.id];throw new Error("No snapshot available")},d_=function(e,t){let r=[];switch(e.event){case"thread.message.created":return[e.data,r];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let s=e.data;if(s.delta.content)for(let a of s.delta.content)if(a.index in t.content){let i=t.content[a.index];t.content[a.index]=N(this,Pe,"m",f_).call(this,a,i)}else t.content[a.index]=a,r.push(a);return[t,r];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,r];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},f_=function(e,t){return nr.accumulateDelta(t,e)},p_=function(e){switch(tt(this,gl,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":tt(this,Yn,e.data,"f"),N(this,rt,"f")&&(this._emit("toolCallDone",N(this,rt,"f")),tt(this,rt,void 0,"f"));break;case"thread.run.cancelling":break}};var Xn=class extends b{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,r){return this._client.post(`/assistants/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}list(e={},t){return D(e)?this.list({},e):this._client.getAPIList("/assistants",ca,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}},ca=class extends V{};Xn.AssistantsPage=ca;function Df(n){return typeof n.parse=="function"}var Zr=n=>n?.role==="assistant",Ff=n=>n?.role==="function",Uf=n=>n?.role==="tool";function eo(n){return n?.$brand==="auto-parseable-response-format"}function Qn(n){return n?.$brand==="auto-parseable-tool"}function h_(n,e){return!e||!Bf(e)?{...n,choices:n.choices.map(t=>({...t,message:{...t.message,parsed:null,...t.message.tool_calls?{tool_calls:t.message.tool_calls}:void 0}}))}:to(n,e)}function to(n,e){let t=n.choices.map(r=>{if(r.finish_reason==="length")throw new ra;if(r.finish_reason==="content_filter")throw new na;return{...r,message:{...r.message,...r.message.tool_calls?{tool_calls:r.message.tool_calls?.map(s=>iP(e,s))??void 0}:void 0,parsed:r.message.content&&!r.message.refusal?aP(e,r.message.content):null}}});return{...n,choices:t}}function aP(n,e){return n.response_format?.type!=="json_schema"?null:n.response_format?.type==="json_schema"?"$parseRaw"in n.response_format?n.response_format.$parseRaw(e):JSON.parse(e):null}function iP(n,e){let t=n.tools?.find(r=>r.function?.name===e.function.name);return{...e,function:{...e.function,parsed_arguments:Qn(t)?t.$parseRaw(e.function.arguments):t?.function.strict?JSON.parse(e.function.arguments):null}}}function m_(n,e){if(!n)return!1;let t=n.tools?.find(r=>r.function?.name===e.function.name);return Qn(t)||t?.function.strict||!1}function Bf(n){return eo(n.response_format)?!0:n.tools?.some(e=>Qn(e)||e.type==="function"&&e.function.strict===!0)??!1}function g_(n){for(let e of n??[]){if(e.type!=="function")throw new C(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new C(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var Xe=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},Me,zf,bl,qf,Vf,Hf,b_,Gf,y_=10,da=class extends Wr{constructor(){super(...arguments),Me.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);let t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),(Ff(e)||Uf(e))&&e.content)this._emit("functionCallResult",e.content);else if(Zr(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(Zr(e)&&e.tool_calls)for(let r of e.tool_calls)r.type==="function"&&this._emit("functionCall",r.function)}}async finalChatCompletion(){await this.done();let e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new C("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),Xe(this,Me,"m",zf).call(this)}async finalMessage(){return await this.done(),Xe(this,Me,"m",bl).call(this)}async finalFunctionCall(){return await this.done(),Xe(this,Me,"m",qf).call(this)}async finalFunctionCallResult(){return await this.done(),Xe(this,Me,"m",Vf).call(this)}async totalUsage(){return await this.done(),Xe(this,Me,"m",Hf).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);let t=Xe(this,Me,"m",bl).call(this);t&&this._emit("finalMessage",t);let r=Xe(this,Me,"m",zf).call(this);r&&this._emit("finalContent",r);let s=Xe(this,Me,"m",qf).call(this);s&&this._emit("finalFunctionCall",s);let a=Xe(this,Me,"m",Vf).call(this);a!=null&&this._emit("finalFunctionCallResult",a),this._chatCompletions.some(i=>i.usage)&&this._emit("totalUsage",Xe(this,Me,"m",Hf).call(this))}async _createChatCompletion(e,t,r){let s=r?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),Xe(this,Me,"m",b_).call(this,t);let a=await e.chat.completions.create({...t,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addChatCompletion(to(a,t))}async _runChatCompletion(e,t,r){for(let s of t.messages)this._addMessage(s,!1);return await this._createChatCompletion(e,t,r)}async _runFunctions(e,t,r){let s="function",{function_call:a="auto",stream:i,...o}=t,u=typeof a!="string"&&a?.name,{maxChatCompletions:l=y_}=r||{},c={};for(let f of t.functions)c[f.name||f.function.name]=f;let d=t.functions.map(f=>({name:f.name||f.function.name,parameters:f.parameters,description:f.description}));for(let f of t.messages)this._addMessage(f,!1);for(let f=0;f<l;++f){let g=(await this._createChatCompletion(e,{...o,function_call:a,functions:d,messages:[...this.messages]},r)).choices[0]?.message;if(!g)throw new C("missing message in ChatCompletion response");if(!g.function_call)return;let{name:m,arguments:y}=g.function_call,x=c[m];if(x){if(u&&u!==m){let R=`Invalid function_call: ${JSON.stringify(m)}. ${JSON.stringify(u)} requested. Please try again`;this._addMessage({role:s,name:m,content:R});continue}}else{let R=`Invalid function_call: ${JSON.stringify(m)}. Available options are: ${d.map(W=>JSON.stringify(W.name)).join(", ")}. Please try again`;this._addMessage({role:s,name:m,content:R});continue}let w;try{w=Df(x)?await x.parse(y):y}catch(R){this._addMessage({role:s,name:m,content:R instanceof Error?R.message:String(R)});continue}let A=await x.function(w,this),k=Xe(this,Me,"m",Gf).call(this,A);if(this._addMessage({role:s,name:m,content:k}),u)return}}async _runTools(e,t,r){let s="tool",{tool_choice:a="auto",stream:i,...o}=t,u=typeof a!="string"&&a?.function?.name,{maxChatCompletions:l=y_}=r||{},c=t.tools.map(p=>{if(Qn(p)){if(!p.$callback)throw new C("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:p.$callback,name:p.function.name,description:p.function.description||"",parameters:p.function.parameters,parse:p.$parseRaw,strict:!0}}}return p}),d={};for(let p of c)p.type==="function"&&(d[p.function.name||p.function.function.name]=p.function);let f="tools"in t?c.map(p=>p.type==="function"?{type:"function",function:{name:p.function.name||p.function.function.name,parameters:p.function.parameters,description:p.function.description,strict:p.function.strict}}:p):void 0;for(let p of t.messages)this._addMessage(p,!1);for(let p=0;p<l;++p){let m=(await this._createChatCompletion(e,{...o,tool_choice:a,tools:f,messages:[...this.messages]},r)).choices[0]?.message;if(!m)throw new C("missing message in ChatCompletion response");if(!m.tool_calls?.length)return;for(let y of m.tool_calls){if(y.type!=="function")continue;let x=y.id,{name:w,arguments:A}=y.function,k=d[w];if(k){if(u&&u!==w){let Z=`Invalid tool_call: ${JSON.stringify(w)}. ${JSON.stringify(u)} requested. Please try again`;this._addMessage({role:s,tool_call_id:x,content:Z});continue}}else{let Z=`Invalid tool_call: ${JSON.stringify(w)}. Available options are: ${Object.keys(d).map(oe=>JSON.stringify(oe)).join(", ")}. Please try again`;this._addMessage({role:s,tool_call_id:x,content:Z});continue}let R;try{R=Df(k)?await k.parse(A):A}catch(Z){let oe=Z instanceof Error?Z.message:String(Z);this._addMessage({role:s,tool_call_id:x,content:oe});continue}let W=await k.function(R,this),Y=Xe(this,Me,"m",Gf).call(this,W);if(this._addMessage({role:s,tool_call_id:x,content:Y}),u)return}}}};Me=new WeakSet,zf=function(){return Xe(this,Me,"m",bl).call(this).content??null},bl=function(){let e=this.messages.length;for(;e-- >0;){let t=this.messages[e];if(Zr(t)){let{function_call:r,...s}=t,a={...s,content:t.content??null,refusal:t.refusal??null};return r&&(a.function_call=r),a}}throw new C("stream ended without producing a ChatCompletionMessage with role=assistant")},qf=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(Zr(t)&&t?.function_call)return t.function_call;if(Zr(t)&&t?.tool_calls?.length)return t.tool_calls.at(-1)?.function}},Vf=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(Ff(t)&&t.content!=null||Uf(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(r=>r.role==="assistant"&&r.tool_calls?.some(s=>s.type==="function"&&s.id===t.tool_call_id)))return t.content}},Hf=function(){let e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},b_=function(e){if(e.n!=null&&e.n>1)throw new C("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},Gf=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};var ro=class n extends da{static runFunctions(e,t,r){let s=new n,a={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,a)),s}static runTools(e,t,r){let s=new n,a={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,a)),s}_addMessage(e,t=!0){super._addMessage(e,t),Zr(e)&&e.content&&this._emit("content",e.content)}};var xe={STR:1,NUM:2,ARR:4,OBJ:8,NULL:16,BOOL:32,NAN:64,INFINITY:128,MINUS_INFINITY:256,INF:384,SPECIAL:496,ATOM:499,COLLECTION:12,ALL:511},Kf=class extends Error{},Jf=class extends Error{};function oP(n,e=xe.ALL){if(typeof n!="string")throw new TypeError(`expecting str, got ${typeof n}`);if(!n.trim())throw new Error(`${n} is empty`);return uP(n.trim(),e)}var uP=(n,e)=>{let t=n.length,r=0,s=f=>{throw new Kf(`${f} at position ${r}`)},a=f=>{throw new Jf(`${f} at position ${r}`)},i=()=>(d(),r>=t&&s("Unexpected end of input"),n[r]==='"'?o():n[r]==="{"?u():n[r]==="["?l():n.substring(r,r+4)==="null"||xe.NULL&e&&t-r<4&&"null".startsWith(n.substring(r))?(r+=4,null):n.substring(r,r+4)==="true"||xe.BOOL&e&&t-r<4&&"true".startsWith(n.substring(r))?(r+=4,!0):n.substring(r,r+5)==="false"||xe.BOOL&e&&t-r<5&&"false".startsWith(n.substring(r))?(r+=5,!1):n.substring(r,r+8)==="Infinity"||xe.INFINITY&e&&t-r<8&&"Infinity".startsWith(n.substring(r))?(r+=8,1/0):n.substring(r,r+9)==="-Infinity"||xe.MINUS_INFINITY&e&&1<t-r&&t-r<9&&"-Infinity".startsWith(n.substring(r))?(r+=9,-1/0):n.substring(r,r+3)==="NaN"||xe.NAN&e&&t-r<3&&"NaN".startsWith(n.substring(r))?(r+=3,NaN):c()),o=()=>{let f=r,p=!1;for(r++;r<t&&(n[r]!=='"'||p&&n[r-1]==="\\");)p=n[r]==="\\"?!p:!1,r++;if(n.charAt(r)=='"')try{return JSON.parse(n.substring(f,++r-Number(p)))}catch(g){a(String(g))}else if(xe.STR&e)try{return JSON.parse(n.substring(f,r-Number(p))+'"')}catch{return JSON.parse(n.substring(f,n.lastIndexOf("\\"))+'"')}s("Unterminated string literal")},u=()=>{r++,d();let f={};try{for(;n[r]!=="}";){if(d(),r>=t&&xe.OBJ&e)return f;let p=o();d(),r++;try{let g=i();Object.defineProperty(f,p,{value:g,writable:!0,enumerable:!0,configurable:!0})}catch(g){if(xe.OBJ&e)return f;throw g}d(),n[r]===","&&r++}}catch{if(xe.OBJ&e)return f;s("Expected '}' at end of object")}return r++,f},l=()=>{r++;let f=[];try{for(;n[r]!=="]";)f.push(i()),d(),n[r]===","&&r++}catch{if(xe.ARR&e)return f;s("Expected ']' at end of array")}return r++,f},c=()=>{if(r===0){n==="-"&&xe.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(n)}catch(p){if(xe.NUM&e)try{return n[n.length-1]==="."?JSON.parse(n.substring(0,n.lastIndexOf("."))):JSON.parse(n.substring(0,n.lastIndexOf("e")))}catch{}a(String(p))}}let f=r;for(n[r]==="-"&&r++;n[r]&&!",]}".includes(n[r]);)r++;r==t&&!(xe.NUM&e)&&s("Unterminated number literal");try{return JSON.parse(n.substring(f,r))}catch{n.substring(f,r)==="-"&&xe.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(n.substring(f,n.lastIndexOf("e")))}catch(g){a(String(g))}}},d=()=>{for(;r<t&&`
\r	`.includes(n[r]);)r++};return i()},Wf=n=>oP(n,xe.ALL^xe.NUM);var fa=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},Q=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},be,Sr,pa,Yr,Zf,_l,Yf,Xf,Qf,wl,ep,__,ha=class n extends da{constructor(e){super(),be.add(this),Sr.set(this,void 0),pa.set(this,void 0),Yr.set(this,void 0),fa(this,Sr,e,"f"),fa(this,pa,[],"f")}get currentChatCompletionSnapshot(){return Q(this,Yr,"f")}static fromReadableStream(e){let t=new n(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,r){let s=new n(t);return s._run(()=>s._runChatCompletion(e,{...t,stream:!0},{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createChatCompletion(e,t,r){super._createChatCompletion;let s=r?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),Q(this,be,"m",Zf).call(this);let a=await e.chat.completions.create({...t,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(let i of a)Q(this,be,"m",Yf).call(this,i);if(a.controller.signal?.aborted)throw new de;return this._addChatCompletion(Q(this,be,"m",wl).call(this))}async _fromReadableStream(e,t){let r=t?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),Q(this,be,"m",Zf).call(this),this._connected();let s=Qt.fromReadableStream(e,this.controller),a;for await(let i of s)a&&a!==i.id&&this._addChatCompletion(Q(this,be,"m",wl).call(this)),Q(this,be,"m",Yf).call(this,i),a=i.id;if(s.controller.signal?.aborted)throw new de;return this._addChatCompletion(Q(this,be,"m",wl).call(this))}[(Sr=new WeakMap,pa=new WeakMap,Yr=new WeakMap,be=new WeakSet,Zf=function(){this.ended||fa(this,Yr,void 0,"f")},_l=function(t){let r=Q(this,pa,"f")[t.index];return r||(r={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},Q(this,pa,"f")[t.index]=r,r)},Yf=function(t){if(this.ended)return;let r=Q(this,be,"m",__).call(this,t);this._emit("chunk",t,r);for(let s of t.choices){let a=r.choices[s.index];s.delta.content!=null&&a.message?.role==="assistant"&&a.message?.content&&(this._emit("content",s.delta.content,a.message.content),this._emit("content.delta",{delta:s.delta.content,snapshot:a.message.content,parsed:a.message.parsed})),s.delta.refusal!=null&&a.message?.role==="assistant"&&a.message?.refusal&&this._emit("refusal.delta",{delta:s.delta.refusal,snapshot:a.message.refusal}),s.logprobs?.content!=null&&a.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:s.logprobs?.content,snapshot:a.logprobs?.content??[]}),s.logprobs?.refusal!=null&&a.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:s.logprobs?.refusal,snapshot:a.logprobs?.refusal??[]});let i=Q(this,be,"m",_l).call(this,a);a.finish_reason&&(Q(this,be,"m",Qf).call(this,a),i.current_tool_call_index!=null&&Q(this,be,"m",Xf).call(this,a,i.current_tool_call_index));for(let o of s.delta.tool_calls??[])i.current_tool_call_index!==o.index&&(Q(this,be,"m",Qf).call(this,a),i.current_tool_call_index!=null&&Q(this,be,"m",Xf).call(this,a,i.current_tool_call_index)),i.current_tool_call_index=o.index;for(let o of s.delta.tool_calls??[]){let u=a.message.tool_calls?.[o.index];u?.type&&(u?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:u.function?.name,index:o.index,arguments:u.function.arguments,parsed_arguments:u.function.parsed_arguments,arguments_delta:o.function?.arguments??""}):(u?.type,void 0))}}},Xf=function(t,r){if(Q(this,be,"m",_l).call(this,t).done_tool_calls.has(r))return;let a=t.message.tool_calls?.[r];if(!a)throw new Error("no tool call snapshot");if(!a.type)throw new Error("tool call snapshot missing `type`");if(a.type==="function"){let i=Q(this,Sr,"f")?.tools?.find(o=>o.type==="function"&&o.function.name===a.function.name);this._emit("tool_calls.function.arguments.done",{name:a.function.name,index:r,arguments:a.function.arguments,parsed_arguments:Qn(i)?i.$parseRaw(a.function.arguments):i?.function.strict?JSON.parse(a.function.arguments):null})}else a.type},Qf=function(t){let r=Q(this,be,"m",_l).call(this,t);if(t.message.content&&!r.content_done){r.content_done=!0;let s=Q(this,be,"m",ep).call(this);this._emit("content.done",{content:t.message.content,parsed:s?s.$parseRaw(t.message.content):null})}t.message.refusal&&!r.refusal_done&&(r.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),t.logprobs?.content&&!r.logprobs_content_done&&(r.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),t.logprobs?.refusal&&!r.logprobs_refusal_done&&(r.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},wl=function(){if(this.ended)throw new C("stream has ended, this shouldn't happen");let t=Q(this,Yr,"f");if(!t)throw new C("request ended without sending any chunks");return fa(this,Yr,void 0,"f"),fa(this,pa,[],"f"),lP(t,Q(this,Sr,"f"))},ep=function(){let t=Q(this,Sr,"f")?.response_format;return eo(t)?t:null},__=function(t){var r,s,a,i;let o=Q(this,Yr,"f"),{choices:u,...l}=t;o?Object.assign(o,l):o=fa(this,Yr,{...l,choices:[]},"f");for(let{delta:c,finish_reason:d,index:f,logprobs:p=null,...g}of t.choices){let m=o.choices[f];if(m||(m=o.choices[f]={finish_reason:d,index:f,message:{},logprobs:p,...g}),p)if(!m.logprobs)m.logprobs=Object.assign({},p);else{let{content:W,refusal:Y,...Z}=p;Object.assign(m.logprobs,Z),W&&((r=m.logprobs).content??(r.content=[]),m.logprobs.content.push(...W)),Y&&((s=m.logprobs).refusal??(s.refusal=[]),m.logprobs.refusal.push(...Y))}if(d&&(m.finish_reason=d,Q(this,Sr,"f")&&Bf(Q(this,Sr,"f")))){if(d==="length")throw new ra;if(d==="content_filter")throw new na}if(Object.assign(m,g),!c)continue;let{content:y,refusal:x,function_call:w,role:A,tool_calls:k,...R}=c;if(Object.assign(m.message,R),x&&(m.message.refusal=(m.message.refusal||"")+x),A&&(m.message.role=A),w&&(m.message.function_call?(w.name&&(m.message.function_call.name=w.name),w.arguments&&((a=m.message.function_call).arguments??(a.arguments=""),m.message.function_call.arguments+=w.arguments)):m.message.function_call=w),y&&(m.message.content=(m.message.content||"")+y,!m.message.refusal&&Q(this,be,"m",ep).call(this)&&(m.message.parsed=Wf(m.message.content))),k){m.message.tool_calls||(m.message.tool_calls=[]);for(let{index:W,id:Y,type:Z,function:oe,...ne}of k){let fe=(i=m.message.tool_calls)[W]??(i[W]={});Object.assign(fe,ne),Y&&(fe.id=Y),Z&&(fe.type=Z),oe&&(fe.function??(fe.function={name:oe.name??"",arguments:""})),oe?.name&&(fe.function.name=oe.name),oe?.arguments&&(fe.function.arguments+=oe.arguments,m_(Q(this,Sr,"f"),fe)&&(fe.function.parsed_arguments=Wf(fe.function.arguments)))}}}return o},Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("chunk",s=>{let a=t.shift();a?a.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(let s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(let a of t)a.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(let a of t)a.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Qt(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}};function lP(n,e){let{id:t,choices:r,created:s,model:a,system_fingerprint:i,...o}=n,u={...o,id:t,choices:r.map(({message:l,finish_reason:c,index:d,logprobs:f,...p})=>{if(!c)throw new C(`missing finish_reason for choice ${d}`);let{content:g=null,function_call:m,tool_calls:y,...x}=l,w=l.role;if(!w)throw new C(`missing role for choice ${d}`);if(m){let{arguments:A,name:k}=m;if(A==null)throw new C(`missing function_call.arguments for choice ${d}`);if(!k)throw new C(`missing function_call.name for choice ${d}`);return{...p,message:{content:g,function_call:{arguments:A,name:k},role:w,refusal:l.refusal??null},finish_reason:c,index:d,logprobs:f}}return y?{...p,index:d,finish_reason:c,logprobs:f,message:{...x,role:w,content:g,refusal:l.refusal??null,tool_calls:y.map((A,k)=>{let{function:R,type:W,id:Y,...Z}=A,{arguments:oe,name:ne,...fe}=R||{};if(Y==null)throw new C(`missing choices[${d}].tool_calls[${k}].id
${vl(n)}`);if(W==null)throw new C(`missing choices[${d}].tool_calls[${k}].type
${vl(n)}`);if(ne==null)throw new C(`missing choices[${d}].tool_calls[${k}].function.name
${vl(n)}`);if(oe==null)throw new C(`missing choices[${d}].tool_calls[${k}].function.arguments
${vl(n)}`);return{...Z,id:Y,type:W,function:{...fe,name:ne,arguments:oe}}})}}:{...p,message:{...x,content:g,role:w,refusal:l.refusal??null},finish_reason:c,index:d,logprobs:f}}),created:s,model:a,object:"chat.completion",...i?{system_fingerprint:i}:{}};return h_(u,e)}function vl(n){return JSON.stringify(n)}var no=class n extends ha{static fromReadableStream(e){let t=new n(null);return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,r){let s=new n(null),a={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,a)),s}static runTools(e,t,r){let s=new n(t),a={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,a)),s}};var so=class extends b{parse(e,t){return g_(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(r=>to(r,e))}runFunctions(e,t){return e.stream?no.runFunctions(this._client,e,t):ro.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?no.runTools(this._client,e,t):ro.runTools(this._client,e,t)}stream(e,t){return ha.createChatCompletion(this._client,e,t)}};var ma=class extends b{constructor(){super(...arguments),this.completions=new so(this._client)}};(function(n){n.Completions=so})(ma||(ma={}));var ga=class extends b{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}};var ya=class extends b{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}};var Xr=class extends b{constructor(){super(...arguments),this.sessions=new ga(this._client),this.transcriptionSessions=new ya(this._client)}};Xr.Sessions=ga;Xr.TranscriptionSessions=ya;var es=class extends b{create(e,t,r){return this._client.post(`/threads/${e}/messages`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}retrieve(e,t,r){return this._client.get(`/threads/${e}/messages/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}update(e,t,r,s){return this._client.post(`/threads/${e}/messages/${t}`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}list(e,t={},r){return D(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,ba,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}del(e,t,r){return this._client.delete(`/threads/${e}/messages/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}},ba=class extends V{};es.MessagesPage=ba;var ts=class extends b{retrieve(e,t,r,s={},a){return D(s)?this.retrieve(e,t,r,{},s):this._client.get(`/threads/${e}/runs/${t}/steps/${r}`,{query:s,...a,headers:{"OpenAI-Beta":"assistants=v2",...a?.headers}})}list(e,t,r={},s){return D(r)?this.list(e,t,{},r):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,_a,{query:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}},_a=class extends V{};ts.RunStepsPage=_a;var Cr=class extends b{constructor(){super(...arguments),this.steps=new ts(this._client)}create(e,t,r){let{include:s,...a}=t;return this._client.post(`/threads/${e}/runs`,{query:{include:s},body:a,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers},stream:t.stream??!1})}retrieve(e,t,r){return this._client.get(`/threads/${e}/runs/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}update(e,t,r,s){return this._client.post(`/threads/${e}/runs/${t}`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}list(e,t={},r){return D(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,wa,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}cancel(e,t,r){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}async createAndPoll(e,t,r){let s=await this.create(e,t,r);return await this.poll(e,s.id,r)}createAndStream(e,t,r){return nr.createAssistantStream(e,this._client.beta.threads.runs,t,r)}async poll(e,t,r){let s={...r?.headers,"X-Stainless-Poll-Helper":"true"};for(r?.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){let{data:a,response:i}=await this.retrieve(e,t,{...r,headers:{...r?.headers,...s}}).withResponse();switch(a.status){case"queued":case"in_progress":case"cancelling":let o=5e3;if(r?.pollIntervalMs)o=r.pollIntervalMs;else{let u=i.headers.get("openai-poll-after-ms");if(u){let l=parseInt(u);isNaN(l)||(o=l)}}await Or(o);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return a}}}stream(e,t,r){return nr.createAssistantStream(e,this._client.beta.threads.runs,t,r)}submitToolOutputs(e,t,r,s){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers},stream:r.stream??!1})}async submitToolOutputsAndPoll(e,t,r,s){let a=await this.submitToolOutputs(e,t,r,s);return await this.poll(e,a.id,s)}submitToolOutputsStream(e,t,r,s){return nr.createToolAssistantStream(e,t,this._client.beta.threads.runs,r,s)}},wa=class extends V{};Cr.RunsPage=wa;Cr.Steps=ts;Cr.RunStepsPage=_a;var sr=class extends b{constructor(){super(...arguments),this.runs=new Cr(this._client),this.messages=new es(this._client)}create(e={},t){return D(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,r){return this._client.post(`/threads/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){let r=await this.createAndRun(e,t);return await this.runs.poll(r.thread_id,r.id,t)}createAndRunStream(e,t){return nr.createThreadAssistantStream(e,this._client.beta.threads,t)}};sr.Runs=Cr;sr.RunsPage=wa;sr.Messages=es;sr.MessagesPage=ba;var Dt=class extends b{constructor(){super(...arguments),this.realtime=new Xr(this._client),this.chat=new ma(this._client),this.assistants=new Xn(this._client),this.threads=new sr(this._client)}};Dt.Realtime=Xr;Dt.Assistants=Xn;Dt.AssistantsPage=ca;Dt.Threads=sr;var rs=class extends b{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}};var va=class extends b{retrieve(e,t,r){return this._client.get(`/containers/${e}/files/${t}/content`,{...r,headers:{Accept:"application/binary",...r?.headers},__binaryResponse:!0})}};var Qr=class extends b{constructor(){super(...arguments),this.content=new va(this._client)}create(e,t,r){return this._client.post(`/containers/${e}/files`,Ye({body:t,...r}))}retrieve(e,t,r){return this._client.get(`/containers/${e}/files/${t}`,r)}list(e,t={},r){return D(t)?this.list(e,{},t):this._client.getAPIList(`/containers/${e}/files`,xa,{query:t,...r})}del(e,t,r){return this._client.delete(`/containers/${e}/files/${t}`,{...r,headers:{Accept:"*/*",...r?.headers}})}},xa=class extends V{};Qr.FileListResponsesPage=xa;Qr.Content=va;var ar=class extends b{constructor(){super(...arguments),this.files=new Qr(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(`/containers/${e}`,t)}list(e={},t){return D(e)?this.list({},e):this._client.getAPIList("/containers",ns,{query:e,...t})}del(e,t){return this._client.delete(`/containers/${e}`,{...t,headers:{Accept:"*/*",...t?.headers}})}},ns=class extends V{};ar.ContainerListResponsesPage=ns;ar.Files=Qr;ar.FileListResponsesPage=xa;var ss=class extends b{create(e,t){let r=!!e.encoding_format,s=r?e.encoding_format:"base64";r&&Er("Request","User defined encoding_format:",e.encoding_format);let a=this._client.post("/embeddings",{body:{...e,encoding_format:s},...t});return r?a:(Er("response","Decoding base64 embeddings to float32 array"),a._thenUnwrap(i=>(i&&i.data&&i.data.forEach(o=>{let u=o.embedding;o.embedding=a_(u)}),i)))}};var as=class extends b{retrieve(e,t,r,s){return this._client.get(`/evals/${e}/runs/${t}/output_items/${r}`,s)}list(e,t,r={},s){return D(r)?this.list(e,t,{},r):this._client.getAPIList(`/evals/${e}/runs/${t}/output_items`,Aa,{query:r,...s})}},Aa=class extends V{};as.OutputItemListResponsesPage=Aa;var Rr=class extends b{constructor(){super(...arguments),this.outputItems=new as(this._client)}create(e,t,r){return this._client.post(`/evals/${e}/runs`,{body:t,...r})}retrieve(e,t,r){return this._client.get(`/evals/${e}/runs/${t}`,r)}list(e,t={},r){return D(t)?this.list(e,{},t):this._client.getAPIList(`/evals/${e}/runs`,Ea,{query:t,...r})}del(e,t,r){return this._client.delete(`/evals/${e}/runs/${t}`,r)}cancel(e,t,r){return this._client.post(`/evals/${e}/runs/${t}`,r)}},Ea=class extends V{};Rr.RunListResponsesPage=Ea;Rr.OutputItems=as;Rr.OutputItemListResponsesPage=Aa;var ir=class extends b{constructor(){super(...arguments),this.runs=new Rr(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(`/evals/${e}`,t)}update(e,t,r){return this._client.post(`/evals/${e}`,{body:t,...r})}list(e={},t){return D(e)?this.list({},e):this._client.getAPIList("/evals",is,{query:e,...t})}del(e,t){return this._client.delete(`/evals/${e}`,t)}},is=class extends V{};ir.EvalListResponsesPage=is;ir.Runs=Rr;ir.RunListResponsesPage=Ea;var en=class extends b{create(e,t){return this._client.post("/files",Ye({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return D(e)?this.list({},e):this._client.getAPIList("/files",os,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/binary",...t?.headers},__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,t)}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:r=30*60*1e3}={}){let s=new Set(["processed","error","deleted"]),a=Date.now(),i=await this.retrieve(e);for(;!i.status||!s.has(i.status);)if(await Or(t),i=await this.retrieve(e),Date.now()-a>r)throw new Hr({message:`Giving up on waiting for file ${e} to finish processing after ${r} milliseconds.`});return i}},os=class extends V{};en.FileObjectsPage=os;var Oa=class extends b{};var Ia=class extends b{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}};var us=class extends b{constructor(){super(...arguments),this.graders=new Ia(this._client)}};us.Graders=Ia;var ls=class extends b{create(e,t,r){return this._client.getAPIList(`/fine_tuning/checkpoints/${e}/permissions`,Pa,{body:t,method:"post",...r})}retrieve(e,t={},r){return D(t)?this.retrieve(e,{},t):this._client.get(`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...r})}del(e,t,r){return this._client.delete(`/fine_tuning/checkpoints/${e}/permissions/${t}`,r)}},Pa=class extends er{};ls.PermissionCreateResponsesPage=Pa;var tn=class extends b{constructor(){super(...arguments),this.permissions=new ls(this._client)}};tn.Permissions=ls;tn.PermissionCreateResponsesPage=Pa;var cs=class extends b{list(e,t={},r){return D(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,Ta,{query:t,...r})}},Ta=class extends V{};cs.FineTuningJobCheckpointsPage=Ta;var or=class extends b{constructor(){super(...arguments),this.checkpoints=new cs(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return D(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",Sa,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},r){return D(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,Ca,{query:t,...r})}pause(e,t){return this._client.post(`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(`/fine_tuning/jobs/${e}/resume`,t)}},Sa=class extends V{},Ca=class extends V{};or.FineTuningJobsPage=Sa;or.FineTuningJobEventsPage=Ca;or.Checkpoints=cs;or.FineTuningJobCheckpointsPage=Ta;var nt=class extends b{constructor(){super(...arguments),this.methods=new Oa(this._client),this.jobs=new or(this._client),this.checkpoints=new tn(this._client),this.alpha=new us(this._client)}};nt.Methods=Oa;nt.Jobs=or;nt.FineTuningJobsPage=Sa;nt.FineTuningJobEventsPage=Ca;nt.Checkpoints=tn;nt.Alpha=us;var Ra=class extends b{};var rn=class extends b{constructor(){super(...arguments),this.graderModels=new Ra(this._client)}};rn.GraderModels=Ra;var ds=class extends b{createVariation(e,t){return this._client.post("/images/variations",Ye({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",Ye({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}};var nn=class extends b{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",fs,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}},fs=class extends er{};nn.ModelsPage=fs;var ps=class extends b{create(e,t){return this._client.post("/moderations",{body:e,...t})}};function w_(n,e){return!e||!kP(e)?{...n,output_parsed:null,output:n.output.map(t=>t.type==="function_call"?{...t,parsed_arguments:null}:t.type==="message"?{...t,content:t.content.map(r=>({...r,parsed:null}))}:t)}:tp(n,e)}function tp(n,e){let t=n.output.map(s=>{if(s.type==="function_call")return{...s,parsed_arguments:jP(e,s)};if(s.type==="message"){let a=s.content.map(i=>i.type==="output_text"?{...i,parsed:RP(e,i.text)}:i);return{...s,content:a}}return s}),r=Object.assign({},n,{output:t});return Object.getOwnPropertyDescriptor(n,"output_text")||rp(r),Object.defineProperty(r,"output_parsed",{enumerable:!0,get(){for(let s of r.output)if(s.type==="message"){for(let a of s.content)if(a.type==="output_text"&&a.parsed!==null)return a.parsed}return null}}),r}function RP(n,e){return n.text?.format?.type!=="json_schema"?null:"$parseRaw"in n.text?.format?(n.text?.format).$parseRaw(e):JSON.parse(e)}function kP(n){return!!eo(n.text?.format)}function NP(n){return n?.$brand==="auto-parseable-tool"}function $P(n,e){return n.find(t=>t.type==="function"&&t.name===e)}function jP(n,e){let t=$P(n.tools??[],e.name);return{...e,...e,parsed_arguments:NP(t)?t.$parseRaw(e.arguments):t?.strict?JSON.parse(e.arguments):null}}function rp(n){let e=[];for(let t of n.output)if(t.type==="message")for(let r of t.content)r.type==="output_text"&&e.push(r.text);n.output_text=e.join("")}var ka=class extends b{list(e,t={},r){return D(t)?this.list(e,{},t):this._client.getAPIList(`/responses/${e}/input_items`,xl,{query:t,...r})}};var Na=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},sn=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},$a,Al,an,El,v_,x_,A_,E_,Ol=class n extends Wr{constructor(e){super(),$a.add(this),Al.set(this,void 0),an.set(this,void 0),El.set(this,void 0),Na(this,Al,e,"f")}static createResponse(e,t,r){let s=new n(t);return s._run(()=>s._createOrRetrieveResponse(e,t,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createOrRetrieveResponse(e,t,r){let s=r?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),sn(this,$a,"m",v_).call(this);let a,i=null;"response_id"in t?(a=await e.responses.retrieve(t.response_id,{stream:!0},{...r,signal:this.controller.signal,stream:!0}),i=t.starting_after??null):a=await e.responses.create({...t,stream:!0},{...r,signal:this.controller.signal}),this._connected();for await(let o of a)sn(this,$a,"m",x_).call(this,o,i);if(a.controller.signal?.aborted)throw new de;return sn(this,$a,"m",A_).call(this)}[(Al=new WeakMap,an=new WeakMap,El=new WeakMap,$a=new WeakSet,v_=function(){this.ended||Na(this,an,void 0,"f")},x_=function(t,r){if(this.ended)return;let s=(i,o)=>{(r==null||o.sequence_number>r)&&this._emit(i,o)},a=sn(this,$a,"m",E_).call(this,t);switch(s("event",t),t.type){case"response.output_text.delta":{let i=a.output[t.output_index];if(!i)throw new C(`missing output at index ${t.output_index}`);if(i.type==="message"){let o=i.content[t.content_index];if(!o)throw new C(`missing content at index ${t.content_index}`);if(o.type!=="output_text")throw new C(`expected content to be 'output_text', got ${o.type}`);s("response.output_text.delta",{...t,snapshot:o.text})}break}case"response.function_call_arguments.delta":{let i=a.output[t.output_index];if(!i)throw new C(`missing output at index ${t.output_index}`);i.type==="function_call"&&s("response.function_call_arguments.delta",{...t,snapshot:i.arguments});break}default:s(t.type,t);break}},A_=function(){if(this.ended)throw new C("stream has ended, this shouldn't happen");let t=sn(this,an,"f");if(!t)throw new C("request ended without sending any events");Na(this,an,void 0,"f");let r=LP(t,sn(this,Al,"f"));return Na(this,El,r,"f"),r},E_=function(t){let r=sn(this,an,"f");if(!r){if(t.type!=="response.created")throw new C(`When snapshot hasn't been set yet, expected 'response.created' event, got ${t.type}`);return r=Na(this,an,t.response,"f"),r}switch(t.type){case"response.output_item.added":{r.output.push(t.item);break}case"response.content_part.added":{let s=r.output[t.output_index];if(!s)throw new C(`missing output at index ${t.output_index}`);s.type==="message"&&s.content.push(t.part);break}case"response.output_text.delta":{let s=r.output[t.output_index];if(!s)throw new C(`missing output at index ${t.output_index}`);if(s.type==="message"){let a=s.content[t.content_index];if(!a)throw new C(`missing content at index ${t.content_index}`);if(a.type!=="output_text")throw new C(`expected content to be 'output_text', got ${a.type}`);a.text+=t.delta}break}case"response.function_call_arguments.delta":{let s=r.output[t.output_index];if(!s)throw new C(`missing output at index ${t.output_index}`);s.type==="function_call"&&(s.arguments+=t.delta);break}case"response.completed":{Na(this,an,t.response,"f");break}}return r},Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("event",s=>{let a=t.shift();a?a.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(let s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(let a of t)a.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(let a of t)a.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let e=sn(this,El,"f");if(!e)throw new C("stream ended without producing a ChatCompletion");return e}};function LP(n,e){return w_(n,e)}var on=class extends b{constructor(){super(...arguments),this.inputItems=new ka(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(r=>("object"in r&&r.object==="response"&&rp(r),r))}retrieve(e,t={},r){return this._client.get(`/responses/${e}`,{query:t,...r,stream:t?.stream??!1})}del(e,t){return this._client.delete(`/responses/${e}`,{...t,headers:{Accept:"*/*",...t?.headers}})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(r=>tp(r,e))}stream(e,t){return Ol.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(`/responses/${e}/cancel`,{...t,headers:{Accept:"*/*",...t?.headers}})}},xl=class extends V{};on.InputItems=ka;var ja=class extends b{create(e,t,r){return this._client.post(`/uploads/${e}/parts`,Ye({body:t,...r}))}};var un=class extends b{constructor(){super(...arguments),this.parts=new ja(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,r){return this._client.post(`/uploads/${e}/complete`,{body:t,...r})}};un.Parts=ja;var O_=async n=>{let e=await Promise.allSettled(n),t=e.filter(s=>s.status==="rejected");if(t.length){for(let s of t)console.error(s.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}let r=[];for(let s of e)s.status==="fulfilled"&&r.push(s.value);return r};var ln=class extends b{create(e,t,r){return this._client.post(`/vector_stores/${e}/files`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}retrieve(e,t,r){return this._client.get(`/vector_stores/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}update(e,t,r,s){return this._client.post(`/vector_stores/${e}/files/${t}`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}list(e,t={},r){return D(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,cn,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}del(e,t,r){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}async createAndPoll(e,t,r){let s=await this.create(e,t,r);return await this.poll(e,s.id,r)}async poll(e,t,r){let s={...r?.headers,"X-Stainless-Poll-Helper":"true"};for(r?.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){let a=await this.retrieve(e,t,{...r,headers:s}).withResponse(),i=a.data;switch(i.status){case"in_progress":let o=5e3;if(r?.pollIntervalMs)o=r.pollIntervalMs;else{let u=a.response.headers.get("openai-poll-after-ms");if(u){let l=parseInt(u);isNaN(l)||(o=l)}}await Or(o);break;case"failed":case"completed":return i}}}async upload(e,t,r){let s=await this._client.files.create({file:t,purpose:"assistants"},r);return this.create(e,{file_id:s.id},r)}async uploadAndPoll(e,t,r){let s=await this.upload(e,t,r);return await this.poll(e,s.id,r)}content(e,t,r){return this._client.getAPIList(`/vector_stores/${e}/files/${t}/content`,Ma,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}},cn=class extends V{},Ma=class extends er{};ln.VectorStoreFilesPage=cn;ln.FileContentResponsesPage=Ma;var La=class extends b{create(e,t,r){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}retrieve(e,t,r){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}cancel(e,t,r){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}async createAndPoll(e,t,r){let s=await this.create(e,t);return await this.poll(e,s.id,r)}listFiles(e,t,r={},s){return D(r)?this.listFiles(e,t,{},r):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,cn,{query:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}async poll(e,t,r){let s={...r?.headers,"X-Stainless-Poll-Helper":"true"};for(r?.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){let{data:a,response:i}=await this.retrieve(e,t,{...r,headers:s}).withResponse();switch(a.status){case"in_progress":let o=5e3;if(r?.pollIntervalMs)o=r.pollIntervalMs;else{let u=i.headers.get("openai-poll-after-ms");if(u){let l=parseInt(u);isNaN(l)||(o=l)}}await Or(o);break;case"failed":case"cancelled":case"completed":return a}}}async uploadAndPoll(e,{files:t,fileIds:r=[]},s){if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let a=s?.maxConcurrency??5,i=Math.min(a,t.length),o=this._client,u=t.values(),l=[...r];async function c(f){for(let p of f){let g=await o.files.create({file:p,purpose:"assistants"},s);l.push(g.id)}}let d=Array(i).fill(u).map(c);return await O_(d),await this.createAndPoll(e,{file_ids:l})}};var st=class extends b{constructor(){super(...arguments),this.files=new ln(this._client),this.fileBatches=new La(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,r){return this._client.post(`/vector_stores/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}list(e={},t){return D(e)?this.list({},e):this._client.getAPIList("/vector_stores",hs,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}search(e,t,r){return this._client.getAPIList(`/vector_stores/${e}/search`,ms,{body:t,method:"post",...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}},hs=class extends V{},ms=class extends er{};st.VectorStoresPage=hs;st.VectorStoreSearchResponsesPage=ms;st.Files=ln;st.VectorStoreFilesPage=cn;st.FileContentResponsesPage=Ma;st.FileBatches=La;var I_,L=class extends ol{constructor({baseURL:e=Hi("OPENAI_BASE_URL"),apiKey:t=Hi("OPENAI_API_KEY"),organization:r=Hi("OPENAI_ORG_ID")??null,project:s=Hi("OPENAI_PROJECT_ID")??null,...a}={}){if(t===void 0)throw new C("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");let i={apiKey:t,organization:r,project:s,...a,baseURL:e||"https://api.openai.com/v1"};if(!i.dangerouslyAllowBrowser&&s_())throw new C(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:i.baseURL,timeout:i.timeout??6e5,httpAgent:i.httpAgent,maxRetries:i.maxRetries,fetch:i.fetch}),this.completions=new rs(this),this.chat=new Pr(this),this.embeddings=new ss(this),this.files=new en(this),this.images=new ds(this),this.audio=new tr(this),this.moderations=new ps(this),this.models=new nn(this),this.fineTuning=new nt(this),this.graders=new rn(this),this.vectorStores=new st(this),this.beta=new Dt(this),this.batches=new Jr(this),this.uploads=new un(this),this.responses=new on(this),this.evals=new ir(this),this.containers=new ar(this),this._options=i,this.apiKey=t,this.organization=r,this.project=s}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return _f(e,{arrayFormat:"brackets"})}};I_=L;L.OpenAI=I_;L.DEFAULT_TIMEOUT=6e5;L.OpenAIError=C;L.APIError=ye;L.APIConnectionError=Vr;L.APIConnectionTimeoutError=Hr;L.APIUserAbortError=de;L.NotFoundError=Di;L.ConflictError=Fi;L.RateLimitError=Bi;L.BadRequestError=ji;L.AuthenticationError=Mi;L.InternalServerError=zi;L.PermissionDeniedError=Li;L.UnprocessableEntityError=Ui;L.toFile=kf;L.fileFromPath=el;L.Completions=rs;L.Chat=Pr;L.ChatCompletionsPage=Kr;L.Embeddings=ss;L.Files=en;L.FileObjectsPage=os;L.Images=ds;L.Audio=tr;L.Moderations=ps;L.Models=nn;L.ModelsPage=fs;L.FineTuning=nt;L.Graders=rn;L.VectorStores=st;L.VectorStoresPage=hs;L.VectorStoreSearchResponsesPage=ms;L.Beta=Dt;L.Batches=Jr;L.BatchesPage=Wn;L.Uploads=un;L.Responses=on;L.Evals=ir;L.EvalListResponsesPage=is;L.Containers=ar;L.ContainerListResponsesPage=ns;pr();pr();zn();zs();Us();Pu();Au();Ht();var np=class extends $i{static lc_name(){return"DallEAPIWrapper"}constructor(e){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"dalle_api_wrapper"}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:"A wrapper around OpenAI DALL-E API. Useful for when you need to generate images from a text description. Input should be an image description."}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"dall-e-3"}),Object.defineProperty(this,"style",{enumerable:!0,configurable:!0,writable:!0,value:"vivid"}),Object.defineProperty(this,"quality",{enumerable:!0,configurable:!0,writable:!0,value:"standard"}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"size",{enumerable:!0,configurable:!0,writable:!0,value:"1024x1024"}),Object.defineProperty(this,"responseFormat",{enumerable:!0,configurable:!0,writable:!0,value:"url"}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let t=e?.apiKey??e?.openAIApiKey??ie("OPENAI_API_KEY"),r=e?.organization??ie("OPENAI_ORGANIZATION"),s={apiKey:t,organization:r,dangerouslyAllowBrowser:!0};this.client=new L(s),this.model=e?.model??e?.modelName??this.model,this.style=e?.style??this.style,this.quality=e?.quality??this.quality,this.n=e?.n??this.n,this.size=e?.size??this.size,this.responseFormat=e?.responseFormat??this.responseFormat,this.user=e?.user}async _call(e){let t=await this.client.images.generate({model:this.model,prompt:e,n:this.n,size:this.size,response_format:this.responseFormat,style:this.style,quality:this.quality,user:this.user}),r="";return this.responseFormat==="url"?[r]=t.data.map(s=>s.url).filter(s=>s!=="undefined"):[r]=t.data.map(s=>s.b64_json).filter(s=>s!=="undefined"),r}};Object.defineProperty(np,"toolName",{enumerable:!0,configurable:!0,writable:!0,value:"dalle_api_wrapper"});var yp=at(R_());var Pl,GP=new Uint8Array(16);function sp(){if(!Pl&&(Pl=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Pl))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Pl(GP)}var Te=[];for(let n=0;n<256;++n)Te.push((n+256).toString(16).slice(1));function k_(n,e=0){return Te[n[e+0]]+Te[n[e+1]]+Te[n[e+2]]+Te[n[e+3]]+"-"+Te[n[e+4]]+Te[n[e+5]]+"-"+Te[n[e+6]]+Te[n[e+7]]+"-"+Te[n[e+8]]+Te[n[e+9]]+"-"+Te[n[e+10]]+Te[n[e+11]]+Te[n[e+12]]+Te[n[e+13]]+Te[n[e+14]]+Te[n[e+15]]}var KP=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ap={randomUUID:KP};function JP(n,e,t){if(ap.randomUUID&&!e&&!n)return ap.randomUUID();n=n||{};let r=n.random||(n.rng||sp)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(let s=0;s<16;++s)e[t+s]=r[s];return e}return k_(r)}var ao=JP;var Tl=class{constructor(e){this.secret=e}_encode(e){return new TextEncoder().encode(e)}_decode(e){return new TextDecoder().decode(e)}async _importKey(e){let t=await crypto.subtle.importKey("raw",this._encode(e),{name:"PBKDF2"},!1,["deriveKey"]);return await crypto.subtle.deriveKey({name:"PBKDF2",salt:this._encode("salt"),iterations:1e5,hash:"SHA-256"},t,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])}async _encrypt(e){let t=await this._importKey(this.secret),r=crypto.getRandomValues(new Uint8Array(12)),s=await crypto.subtle.encrypt({name:"AES-GCM",iv:r},t,this._encode(e));return{iv:r,encrypted:s}}async _decrypt(e,t){let r=await this._importKey(this.secret),s=await crypto.subtle.decrypt({name:"AES-GCM",iv:t},r,e);return this._decode(s)}async saveAPIKey(e,t){let{iv:r,encrypted:s}=await this._encrypt(t),a={iv:Array.from(r),encrypted:Array.from(new Uint8Array(s))};localStorage.setItem(e,JSON.stringify(a))}async getAPIKey(e){let t=localStorage.getItem(e);if(!t)return null;let{iv:r,encrypted:s}=JSON.parse(t);return await this._decrypt(new Uint8Array(s),new Uint8Array(r))}deleteAPIKey(e){localStorage.removeItem(e)}apiKeyExists(e){return localStorage.getItem(e)!==null}};var dn=["Ollama","ChatGPT","Claude","Gemini","Mistral","Llama","Bard","Perplexity","Grok","Copilot","YouChat","Phind","CodeLlama","AlphaCode","TabNine","Kite","GitHub-Copilot","IntelliCode","SourceGraph","Replit-AI","Codeium","Codex","AI21-Studio","Cohere","Hugging-Face","RunwayML","Stability-AI","DeepAI"],gs="OpenAI-Like",N_='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14L21 3m0 0l-6.5 18a.55.55 0 0 1-1 0L10 14l-7-3.5a.55.55 0 0 1 0-1L21 3"/></svg>',$_='<svg viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg" height="1.5em" width="1.5em"><path fill="currentColor" d="M15 37.95q-1.25 0-2.125-.875T12 34.95v-28q0-1.25.875-2.125T15 3.95h22q1.25 0 2.125.875T40 6.95v28q0 1.25-.875 2.125T37 37.95Zm0-3h22v-28H15v28Zm-6 9q-1.25 0-2.125-.875T6 40.95V12.3q0-.65.425-1.075Q6.85 10.8 7.5 10.8q.65 0 1.075.425Q9 11.65 9 12.3v28.65h22.2q.65 0 1.075.425.425.425.425 1.075 0 .65-.425 1.075-.425.425-1.075.425Zm6-37v28-28Z"/></svg>',j_='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-stop"><circle cx="12" cy="12" r="10"/><rect width="6" height="6" x="9" y="9"/></svg>';var Se=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof global<"u"&&global||{},Ve={searchParams:"URLSearchParams"in Se,iterable:"Symbol"in Se&&"iterator"in Symbol,blob:"FileReader"in Se&&"Blob"in Se&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in Se,arrayBuffer:"ArrayBuffer"in Se};function WP(n){return n&&DataView.prototype.isPrototypeOf(n)}Ve.arrayBuffer&&(M_=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],D_=ArrayBuffer.isView||function(n){return n&&M_.indexOf(Object.prototype.toString.call(n))>-1});var M_,D_;function Fa(n){if(typeof n!="string"&&(n=String(n)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(n)||n==="")throw new TypeError('Invalid character in header field name: "'+n+'"');return n.toLowerCase()}function op(n){return typeof n!="string"&&(n=String(n)),n}function up(n){var e={next:function(){var t=n.shift();return{done:t===void 0,value:t}}};return Ve.iterable&&(e[Symbol.iterator]=function(){return e}),e}function _e(n){this.map={},n instanceof _e?n.forEach(function(e,t){this.append(t,e)},this):Array.isArray(n)?n.forEach(function(e){if(e.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+e.length);this.append(e[0],e[1])},this):n&&Object.getOwnPropertyNames(n).forEach(function(e){this.append(e,n[e])},this)}_e.prototype.append=function(n,e){n=Fa(n),e=op(e);var t=this.map[n];this.map[n]=t?t+", "+e:e};_e.prototype.delete=function(n){delete this.map[Fa(n)]};_e.prototype.get=function(n){return n=Fa(n),this.has(n)?this.map[n]:null};_e.prototype.has=function(n){return this.map.hasOwnProperty(Fa(n))};_e.prototype.set=function(n,e){this.map[Fa(n)]=op(e)};_e.prototype.forEach=function(n,e){for(var t in this.map)this.map.hasOwnProperty(t)&&n.call(e,this.map[t],t,this)};_e.prototype.keys=function(){var n=[];return this.forEach(function(e,t){n.push(t)}),up(n)};_e.prototype.values=function(){var n=[];return this.forEach(function(e){n.push(e)}),up(n)};_e.prototype.entries=function(){var n=[];return this.forEach(function(e,t){n.push([t,e])}),up(n)};Ve.iterable&&(_e.prototype[Symbol.iterator]=_e.prototype.entries);function ip(n){if(!n._noBody){if(n.bodyUsed)return Promise.reject(new TypeError("Already read"));n.bodyUsed=!0}}function F_(n){return new Promise(function(e,t){n.onload=function(){e(n.result)},n.onerror=function(){t(n.error)}})}function ZP(n){var e=new FileReader,t=F_(e);return e.readAsArrayBuffer(n),t}function YP(n){var e=new FileReader,t=F_(e),r=/charset=([A-Za-z0-9_-]+)/.exec(n.type),s=r?r[1]:"utf-8";return e.readAsText(n,s),t}function XP(n){for(var e=new Uint8Array(n),t=new Array(e.length),r=0;r<e.length;r++)t[r]=String.fromCharCode(e[r]);return t.join("")}function L_(n){if(n.slice)return n.slice(0);var e=new Uint8Array(n.byteLength);return e.set(new Uint8Array(n)),e.buffer}function U_(){return this.bodyUsed=!1,this._initBody=function(n){this.bodyUsed=this.bodyUsed,this._bodyInit=n,n?typeof n=="string"?this._bodyText=n:Ve.blob&&Blob.prototype.isPrototypeOf(n)?this._bodyBlob=n:Ve.formData&&FormData.prototype.isPrototypeOf(n)?this._bodyFormData=n:Ve.searchParams&&URLSearchParams.prototype.isPrototypeOf(n)?this._bodyText=n.toString():Ve.arrayBuffer&&Ve.blob&&WP(n)?(this._bodyArrayBuffer=L_(n.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):Ve.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(n)||D_(n))?this._bodyArrayBuffer=L_(n):this._bodyText=n=Object.prototype.toString.call(n):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof n=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):Ve.searchParams&&URLSearchParams.prototype.isPrototypeOf(n)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},Ve.blob&&(this.blob=function(){var n=ip(this);if(n)return n;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var n=ip(this);return n||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(Ve.blob)return this.blob().then(ZP);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var n=ip(this);if(n)return n;if(this._bodyBlob)return YP(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(XP(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},Ve.formData&&(this.formData=function(){return this.text().then(tT)}),this.json=function(){return this.text().then(JSON.parse)},this}var QP=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function eT(n){var e=n.toUpperCase();return QP.indexOf(e)>-1?e:n}function bs(n,e){if(!(this instanceof bs))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');e=e||{};var t=e.body;if(n instanceof bs){if(n.bodyUsed)throw new TypeError("Already read");this.url=n.url,this.credentials=n.credentials,e.headers||(this.headers=new _e(n.headers)),this.method=n.method,this.mode=n.mode,this.signal=n.signal,!t&&n._bodyInit!=null&&(t=n._bodyInit,n.bodyUsed=!0)}else this.url=String(n);if(this.credentials=e.credentials||this.credentials||"same-origin",(e.headers||!this.headers)&&(this.headers=new _e(e.headers)),this.method=eT(e.method||this.method||"GET"),this.mode=e.mode||this.mode||null,this.signal=e.signal||this.signal||function(){if("AbortController"in Se){var a=new AbortController;return a.signal}}(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&t)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(t),(this.method==="GET"||this.method==="HEAD")&&(e.cache==="no-store"||e.cache==="no-cache")){var r=/([?&])_=[^&]*/;if(r.test(this.url))this.url=this.url.replace(r,"$1_="+new Date().getTime());else{var s=/\?/;this.url+=(s.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}bs.prototype.clone=function(){return new bs(this,{body:this._bodyInit})};function tT(n){var e=new FormData;return n.trim().split("&").forEach(function(t){if(t){var r=t.split("="),s=r.shift().replace(/\+/g," "),a=r.join("=").replace(/\+/g," ");e.append(decodeURIComponent(s),decodeURIComponent(a))}}),e}function rT(n){var e=new _e,t=n.replace(/\r?\n[\t ]+/g," ");return t.split("\r").map(function(r){return r.indexOf(`
`)===0?r.substr(1,r.length):r}).forEach(function(r){var s=r.split(":"),a=s.shift().trim();if(a){var i=s.join(":").trim();try{e.append(a,i)}catch(o){console.warn("Response "+o.message)}}}),e}U_.call(bs.prototype);function ur(n,e){if(!(this instanceof ur))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(e||(e={}),this.type="default",this.status=e.status===void 0?200:e.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=e.statusText===void 0?"":""+e.statusText,this.headers=new _e(e.headers),this.url=e.url||"",this._initBody(n)}U_.call(ur.prototype);ur.prototype.clone=function(){return new ur(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new _e(this.headers),url:this.url})};ur.error=function(){var n=new ur(null,{status:200,statusText:""});return n.ok=!1,n.status=0,n.type="error",n};var nT=[301,302,303,307,308];ur.redirect=function(n,e){if(nT.indexOf(e)===-1)throw new RangeError("Invalid status code");return new ur(null,{status:e,headers:{location:n}})};var ys=Se.DOMException;try{new ys}catch{ys=function(e,t){this.message=e,this.name=t;var r=Error(e);this.stack=r.stack},ys.prototype=Object.create(Error.prototype),ys.prototype.constructor=ys}function B_(n,e){return new Promise(function(t,r){var s=new bs(n,e);if(s.signal&&s.signal.aborted)return r(new ys("Aborted","AbortError"));var a=new XMLHttpRequest;function i(){a.abort()}a.onload=function(){var l={statusText:a.statusText,headers:rT(a.getAllResponseHeaders()||"")};s.url.indexOf("file://")===0&&(a.status<200||a.status>599)?l.status=200:l.status=a.status,l.url="responseURL"in a?a.responseURL:l.headers.get("X-Request-URL");var c="response"in a?a.response:a.responseText;setTimeout(function(){t(new ur(c,l))},0)},a.onerror=function(){setTimeout(function(){r(new TypeError("Network request failed"))},0)},a.ontimeout=function(){setTimeout(function(){r(new TypeError("Network request timed out"))},0)},a.onabort=function(){setTimeout(function(){r(new ys("Aborted","AbortError"))},0)};function o(l){try{return l===""&&Se.location.href?Se.location.href:l}catch{return l}}if(a.open(s.method,o(s.url),!0),s.credentials==="include"?a.withCredentials=!0:s.credentials==="omit"&&(a.withCredentials=!1),"responseType"in a&&(Ve.blob?a.responseType="blob":Ve.arrayBuffer&&(a.responseType="arraybuffer")),e&&typeof e.headers=="object"&&!(e.headers instanceof _e||Se.Headers&&e.headers instanceof Se.Headers)){var u=[];Object.getOwnPropertyNames(e.headers).forEach(function(l){u.push(Fa(l)),a.setRequestHeader(l,op(e.headers[l]))}),s.headers.forEach(function(l,c){u.indexOf(c)===-1&&a.setRequestHeader(c,l)})}else s.headers.forEach(function(l,c){a.setRequestHeader(c,l)});s.signal&&(s.signal.addEventListener("abort",i),a.onreadystatechange=function(){a.readyState===4&&s.signal.removeEventListener("abort",i)}),a.send(typeof s._bodyInit>"u"?null:s._bodyInit)})}B_.polyfill=!0;Se.fetch||(Se.fetch=B_,Se.Headers=_e,Se.Request=bs,Se.Response=ur);var q_="11434",V_=`http://127.0.0.1:${q_}`,sT="0.5.18",aT=Object.defineProperty,iT=(n,e,t)=>e in n?aT(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,lp=(n,e,t)=>(iT(n,typeof e!="symbol"?e+"":e,t),t),dp=class n extends Error{constructor(e,t){super(e),this.error=e,this.status_code=t,this.name="ResponseError",Error.captureStackTrace&&Error.captureStackTrace(this,n)}},fp=class{constructor(e,t,r){lp(this,"abortController"),lp(this,"itr"),lp(this,"doneCallback"),this.abortController=e,this.itr=t,this.doneCallback=r}abort(){this.abortController.abort()}async*[Symbol.asyncIterator](){for await(let e of this.itr){if("error"in e)throw new Error(e.error);if(yield e,e.done||e.status==="success"){this.doneCallback();return}}throw new Error("Did not receive done or success response in stream.")}},pp=async n=>{if(n.ok)return;let e=`Error ${n.status}: ${n.statusText}`,t=null;if(n.headers.get("content-type")?.includes("application/json"))try{t=await n.json(),e=t.error||e}catch{console.log("Failed to parse error response as JSON")}else try{console.log("Getting text from response"),e=await n.text()||e}catch{console.log("Failed to get text from error response")}throw new dp(e,n.status)};function oT(){if(typeof window<"u"&&window.navigator){let n=navigator;return"userAgentData"in n&&n.userAgentData?.platform?`${n.userAgentData.platform.toLowerCase()} Browser/${navigator.userAgent};`:navigator.platform?`${navigator.platform.toLowerCase()} Browser/${navigator.userAgent};`:`unknown Browser/${navigator.userAgent};`}else if(typeof process<"u")return`${process.arch} ${process.platform} Node.js/${process.version}`;return""}function uT(n){if(n instanceof Headers){let e={};return n.forEach((t,r)=>{e[r]=t}),e}else return Array.isArray(n)?Object.fromEntries(n):n||{}}var hp=async(n,e,t={})=>{let r={"Content-Type":"application/json",Accept:"application/json","User-Agent":`ollama-js/${sT} (${oT()})`};t.headers=uT(t.headers);let s=Object.fromEntries(Object.entries(t.headers).filter(([a])=>!Object.keys(r).some(i=>i.toLowerCase()===a.toLowerCase())));return t.headers={...r,...s},n(e,t)},z_=async(n,e,t)=>{let r=await hp(n,e,{headers:t?.headers});return await pp(r),r},Ua=async(n,e,t,r)=>{let a=(o=>o!==null&&typeof o=="object"&&!Array.isArray(o))(t)?JSON.stringify(t):t,i=await hp(n,e,{method:"POST",body:a,signal:r?.signal,headers:r?.headers});return await pp(i),i},lT=async(n,e,t,r)=>{let s=await hp(n,e,{method:"DELETE",body:JSON.stringify(t),headers:r?.headers});return await pp(s),s},cT=async function*(n){let e=new TextDecoder("utf-8"),t="",r=n.getReader();for(;;){let{done:s,value:a}=await r.read();if(s)break;t+=e.decode(a);let i=t.split(`
`);t=i.pop()??"";for(let o of i)try{yield JSON.parse(o)}catch{console.warn("invalid json: ",o)}}for(let s of t.split(`
`).filter(a=>a!==""))try{yield JSON.parse(s)}catch{console.warn("invalid json: ",s)}},dT=n=>{if(!n)return V_;let e=n.includes("://");n.startsWith(":")&&(n=`http://127.0.0.1${n}`,e=!0),e||(n=`http://${n}`);let t=new URL(n),r=t.port;r||(e?r=t.protocol==="https:"?"443":"80":r=q_);let s="";t.username&&(s=t.username,t.password&&(s+=`:${t.password}`),s+="@");let a=`${t.protocol}//${s}${t.hostname}:${r}${t.pathname}`;return a.endsWith("/")&&(a=a.slice(0,-1)),a},fT=Object.defineProperty,pT=(n,e,t)=>e in n?fT(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,cp=(n,e,t)=>(pT(n,typeof e!="symbol"?e+"":e,t),t),mp=class{constructor(e){cp(this,"config"),cp(this,"fetch"),cp(this,"ongoingStreamedRequests",[]),this.config={host:"",headers:e?.headers},e?.proxy||(this.config.host=dT(e?.host??V_)),this.fetch=e?.fetch??fetch}abort(){for(let e of this.ongoingStreamedRequests)e.abort();this.ongoingStreamedRequests.length=0}async processStreamableRequest(e,t){t.stream=t.stream??!1;let r=`${this.config.host}/api/${e}`;if(t.stream){let a=new AbortController,i=await Ua(this.fetch,r,t,{signal:a.signal,headers:this.config.headers});if(!i.body)throw new Error("Missing body");let o=cT(i.body),u=new fp(a,o,()=>{let l=this.ongoingStreamedRequests.indexOf(u);l>-1&&this.ongoingStreamedRequests.splice(l,1)});return this.ongoingStreamedRequests.push(u),u}return await(await Ua(this.fetch,r,t,{headers:this.config.headers})).json()}async encodeImage(e){if(typeof e!="string"){let t=new Uint8Array(e),r="",s=t.byteLength;for(let a=0;a<s;a++)r+=String.fromCharCode(t[a]);return btoa(r)}return e}async generate(e){return e.images&&(e.images=await Promise.all(e.images.map(this.encodeImage.bind(this)))),this.processStreamableRequest("generate",e)}async chat(e){if(e.messages)for(let t of e.messages)t.images&&(t.images=await Promise.all(t.images.map(this.encodeImage.bind(this))));return this.processStreamableRequest("chat",e)}async create(e){return this.processStreamableRequest("create",{...e})}async pull(e){return this.processStreamableRequest("pull",{name:e.model,stream:e.stream,insecure:e.insecure})}async push(e){return this.processStreamableRequest("push",{name:e.model,stream:e.stream,insecure:e.insecure})}async delete(e){return await lT(this.fetch,`${this.config.host}/api/delete`,{name:e.model},{headers:this.config.headers}),{status:"success"}}async copy(e){return await Ua(this.fetch,`${this.config.host}/api/copy`,{...e},{headers:this.config.headers}),{status:"success"}}async list(){return await(await z_(this.fetch,`${this.config.host}/api/tags`,{headers:this.config.headers})).json()}async show(e){return await(await Ua(this.fetch,`${this.config.host}/api/show`,{...e},{headers:this.config.headers})).json()}async embed(e){return await(await Ua(this.fetch,`${this.config.host}/api/embed`,{...e},{headers:this.config.headers})).json()}async embeddings(e){return await(await Ua(this.fetch,`${this.config.host}/api/embeddings`,{...e},{headers:this.config.headers})).json()}async ps(){return await(await z_(this.fetch,`${this.config.host}/api/ps`,{headers:this.config.headers})).json()}},oV=new mp;async function gp(n,e){let t;try{switch(n){case dn[0]:let r=await fetch("https://api.openai.com/v1/models",{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!r.ok)throw acode.alert("AI Assistant",`Error fetching OpenAI models: ${r.statusText}`),new Error(`Error fetching OpenAI models: ${r.statusText}`);t=(await r.json()).data.filter(f=>/gpt/i.test(f.id)).map(f=>f.id);break;case dn[1]:let a=await fetch(`https://generativelanguage.googleapis.com/v1/models?key=${e}`,{headers:{"Content-Type":"application/json"}});if(!a.ok)throw acode.alert("AI Assistant",`Error fetching Google AI models: ${a.statusText}`),new Error(`Error fetching Google AI models: ${a.statusText}`);t=(await a.json()).models.filter(f=>/gemini/i.test(f.name)).map(f=>f.name.replace(/^models\//,""));break;case dn[2]:let o=window.localStorage.getItem("Ollama-Host")?window.localStorage.getItem("Ollama-Host"):"http://localhost:11434";t=(await new mp({host:o}).list()).models.map(f=>f.model);break;case dn[3]:let c=await fetch("https://api.groq.com/openai/v1/models",{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!c.ok)throw acode.alert("AI Assistant",`Error fetching Groq AI models: ${c.statusText}`),new Error(`Error fetching Groq AI models: ${c.statusText}`);t=(await c.json()).data.map(f=>f.id);break;case OPENAI_LIKE:return[];default:throw new Error(`Unsupported provider: ${n}`)}}catch(r){return console.error(r.message),[]}return t}var MV=acode.require("multiPrompt"),Le=acode.require("fs"),Sl=acode.require("select"),fn=acode.require("prompt"),hT=acode.require("dialogBox"),mT=acode.require("helpers"),_s=acode.require("loader"),LV=acode.require("sidebarApps"),DV=acode.require("toInternalUrl"),gT=acode.require("contextMenu"),yT=acode.require("selectionMenu"),{editor:bT}=editorManager,Cl=window.DATA_STORAGE+"chatgpt",kr=null,bp=class{async init(e){this.$githubDarkFile=tag("link",{rel:"stylesheet",href:this.baseUrl+"assets/github-dark.css"}),this.$higlightJsFile=tag("script",{src:this.baseUrl+"assets/highlight.min.js"}),this.$markdownItFile=tag("script",{src:this.baseUrl+"assets/markdown-it.min.js"}),this.$style=tag("style",{textContent:vp}),document.head.append(this.$githubDarkFile,this.$higlightJsFile,this.$markdownItFile,this.$style),bT.commands.addCommand({name:"ai_assistant",description:"AI Assistant",bindKey:{win:"Ctrl-Shift-O",mac:"Command-Shift-O"},exec:this.run.bind(this)}),console.log("AI Assistant command updated to Ctrl+Shift+O"),yT.add(async()=>{let f=await Sl("AI Actions",["Explain Code","Rewrite","Generate Code"],{onHide:()=>{window.toast("Work is in progress...",3e3)}})},"\u2728","all"),e.id="acode-ai-assistant",e.settitle("AI Assistant"),this.$page=e;let t=tag("span",{className:"icon more_vert",dataset:{action:"toggle-menu"}}),r=tag("span",{className:"icon historyrestore",dataset:{action:"history"}}),s=tag("span",{className:"icon add",dataset:{action:"new-chat"}}),a=tag("span",{className:"icon insert_invitationevent",dataset:{action:"insert-context"}});this.$page.header.append(s,a,r,t),r.onclick=this.myHistory.bind(this),s.onclick=this.newChat.bind(this);let o=gT({innerHTML:()=>`
        <li action="model-provider" provider="">Provider: ${window.localStorage.getItem("ai-assistant-provider")}</li>
        <li action="model" modelNme="">Model: ${window.localStorage.getItem("ai-assistant-model-name")}</li>
        <li action="settings">Settings</li>
        `,...{top:"35px",right:"10px",toggler:t,transformOrigin:"top right"}});o.onclick=async f=>{switch(o.hide(),f.target.getAttribute("action")){case"model-provider":let g=window.localStorage.getItem("ai-assistant-provider"),m=await Sl("Select AI Provider",dn,{default:g||""});if(g!=m)if(m===gs){let A=await fn("API Key","","text",{required:!0});if(!A)return;let k=await fn("API Base URL","https://api.openai.com/v1","text",{required:!0}),R=await fn("Model","","text",{required:!0});if(!R)return;window.localStorage.setItem("ai-assistant-provider",gs),window.localStorage.setItem("ai-assistant-model-name",R),window.localStorage.setItem("openai-like-baseurl",k),await this.apiKeyManager.saveAPIKey(gs,A),this.initiateModel(gs,A,R),this.newChat()}else if(window.localStorage.getItem(m)===null){let A=m==dn[2]?"No Need Of API Key":await fn("API key of selected provider","","text",{required:!0});if(!A)return;_s.showTitleLoader(),window.toast("Fetching available models from your account",2e3);let k=await gp(m,A);_s.removeTitleLoader();let R=await Sl("Select AI Model",k);window.localStorage.setItem("ai-assistant-provider",m),window.localStorage.setItem("ai-assistant-model-name",R),await this.apiKeyManager.saveAPIKey(m,A),this.initiateModel(m,A,R),this.newChat()}else{let A=await this.apiKeyManager.getAPIKey(m);this.initiateModel(m,A,window.localStorage.getItem("ai-assistant-model-name")),this.newChat()}break;case"model":let y=window.localStorage.getItem("ai-assistant-provider"),x=await this.apiKeyManager.getAPIKey(y);if(y===gs){let A=window.localStorage.getItem("ai-assistant-model-name")||"",k=await fn("Enter Model",A,"text",{required:!0});k&&(window.localStorage.setItem("ai-assistant-model-name",k),this.initiateModel(gs,x,k))}else{_s.showTitleLoader(),window.toast("Fetching available models from your account",2e3);let A=await gp(y,x);_s.removeTitleLoader();let k=await Sl("Select AI Model",A,{default:window.localStorage.getItem("ai-assistant-model-name")||""});window.localStorage.getItem("ai-assistant-model-name")!=k&&(window.localStorage.setItem("ai-assistant-model-name",k),this.initiateModel(y,x,k))}break;case"settings":let w=await fn("Ollama API Key",window.localStorage.getItem("ollama-api-key")||"","text",{required:!0});w&&(window.localStorage.setItem("ollama-api-key",w),window.toast("API key saved.",3e3));break}};let u=tag("div",{className:"mainApp"}),l=tag("div",{className:"title-container"}),c=tag("h1",{className:"main-title",textContent:"Loophole & Oblivion's"}),d=tag("h2",{className:"sub-title",textContent:"All Ai-Chat-Cli & Ai-Hacks"});l.append(c,d),u.append(l),this.$chatBox=tag("div",{className:"chatBox"}),this.$inputBox=tag("div",{className:"inputBox"}),this.$chatTextarea=tag("textarea",{className:"chatTextarea",placeholder:"Type your query..."}),this.$sendBtn=tag("button",{className:"sendBtn"}),this.$sendBtn.innerHTML=N_,this.$stopGenerationBtn=tag("button",{className:"stopGenerationBtn hide"}),this.$stopGenerationBtn.innerHTML=j_,this.$stopGenerationBtn.onclick=this.stopGenerating.bind(this),this.$inputBox.append(this.$chatTextarea,this.$sendBtn,this.$stopGenerationBtn),u.append(this.$inputBox,this.$chatBox),this.$page.append(u),this.messageHistories={},this.messageSessionConfig={configurable:{sessionId:ao()}}}async run(){try{let e;if(await Le(window.DATA_STORAGE+"secret.key").exists())e=await Le(window.DATA_STORAGE+"secret.key").readFile("utf-8");else{let a=await fn("Enter a secret pass pharse to save the api key","","text",{required:!0});if(!a)return;e=a}this.apiKeyManager=new Tl(e);let t,r=window.localStorage.getItem("ai-assistant-provider");if(r)t=await this.apiKeyManager.getAPIKey(r);else{r="Ollama";let a="llama3";window.localStorage.setItem("ai-assistant-provider",r),window.localStorage.setItem("ai-assistant-model-name",a),t="No Need Of API Key",await Le(window.DATA_STORAGE+"secret.key").exists()||await Le(window.DATA_STORAGE).createFile("secret.key",e),await this.apiKeyManager.saveAPIKey(r,t),window.toast("Ollama is set as the default AI provider.",3e3)}let s=window.localStorage.getItem("ai-assistant-model-name");this.initiateModel(r,t,s),this.$mdIt=window.markdownit({html:!1,xhtmlOut:!1,breaks:!1,linkify:!1,typographer:!1,quotes:"\u201C\u201D\u2018\u2019",highlight:function(a,i){let o=document.createElement("button");o.classList.add("copy-button"),o.innerHTML=$_,o.setAttribute("data-str",a);let u=`<pre class="hljs codesArea"><code>${hljs.highlightAuto(a).value}</code></pre>`;return`<div class="codeBlock">${o.outerHTML}${u}</div>`}}),this.$sendBtn.addEventListener("click",this.sendQuery.bind(this)),this.$page.show()}catch(e){console.log(e)}}async webSearch(e){let t=window.localStorage.getItem("ollama-api-key");if(!t)if(t=await fn("Ollama API Key","","text",{required:!0}),t)window.localStorage.setItem("ollama-api-key",t);else return"API key not provided.";return await new Ollama({host:"https://ollama.com",headers:{Authorization:`Bearer ${t}`}}).webSearch({query:e})}initiateModel(e,t,r){let s=window.localStorage.getItem("Ollama-Host")?window.localStorage.getItem("Ollama-Host"):"http://localhost:11434",a=new Wu({name:"web_search",description:"Searches the web for the given query.",func:this.webSearch});this.modelInstance=new qu({baseUrl:s,model:r}).bindTools([a]),console.log(`All AI providers are now routed through Ollama with model: ${r}`)}_sanitizeFileName(e){return e.replace(/[^\w\s.-]/gi,"").trim().replace(/\s+/g,"_")}transformMessages(e){return e.map((r,s)=>s%2===0&&s+1<e.length?{prompt:e[s].content,result:e[s+1].content}:null).filter(r=>r!==null)}async saveHistory(){try{let e=this.messageSessionConfig.configurable.sessionId;if(!this.messageHistories[e].messages.length)return;if(kr==null)try{let r=`${this._sanitizeFileName(this.messageHistories[e].messages[0].content.substring(0,30))}__${e}.json`;await Le(Cl).exists()||await Le(window.DATA_STORAGE).createDirectory("chatgpt");let s=await this.messageHistories[e].getMessages(),a=this.transformMessages(s);kr=await Le(Cl).createFile(r,a)}catch(t){alert(t.message)}else try{if(!await Le(kr).exists()){this.newChat(),window.toast("Some error occurred or file you trying to open has been deleted");return}let t=await this.messageHistories[e].getMessages();kr=await Le(kr).writeFile(this.transformMessages(t))}catch(t){alert(t.message)}}catch(e){window.alert(e.message)}}newChat(){this.$chatBox.innerHTML="",window.toast("New session",3e3),this.messageHistories={},this.messageSessionConfig={configurable:{sessionId:ao()}},kr=null}async getHistoryItems(){if(await Le(Cl).exists()){let e=await Le(Cl).lsDir(),t="";for(let r=0;r<e.length;r++)t+=`<li class="dialog-item" style="background: var(--secondary-color);color: var(--secondary-text-color);padding: 5px;margin-bottom: 5px;border-radius: 8px;font-size:15px;display:flex;flex-direction:row;justify-content:space-between;gap:5px;" data-path="${JSON.parse(JSON.stringify(e[r])).url}">
                  <p class="history-item">${e[r].name.split("__")[0].substring(0,25)}...</p><div><button class="delete-history-btn" style="height:25px;width:25px;border:none;padding:5px;outline:none;border-radius:50%;background:var(--error-text-color);text-align:center;">\u2717</button></div>
                </li>`;return t}else{let e="";return e='<li style="background: var(--secondary-color);color: var(--secondary-text-color);padding: 10px;border-radius: 8px;" data-path="#not-available">Not Available</li>',e}}extractUUID(e){let t=/([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})/,r=e.match(t);return r?r[0]:null}async displayHistory(e,t){this.$chatBox.innerHTML="";let r=e.slice(1,e.length-1),s=this.extractUUID(r);if(!s){this.newChat(),window.toast("Some error occurred");return}if(!await Le(r).exists()){this.newChat(),window.toast("Some error occurred or file you trying to open has been deleted");return}kr=r;try{t.hide(),_s.create("Wait","Fetching chat history....");let a=await Le(r).readFile(),i=JSON.parse(await mT.decodeText(a));this.messageHistories={},this.messageHistories[s]=new Ai;let o=i.flatMap(u=>[new he({content:u.prompt}),new ae({content:u.result})]);await this.messageHistories[s].addMessages(o),this.messageSessionConfig={configurable:{sessionId:s}},i.forEach(u=>{this.appendUserQuery(u.prompt),this.appendGptResponse(u.result)}),_s.destroy()}catch(a){_s.destroy(),console.error(a.message)}}async myHistory(){try{let t=`<ul>${await this.getHistoryItems()}</ul>`,r=hT("Conversation History",t,"Cancel");r.onclick(async s=>{let a=s.target.closest(".dialog-item"),i=a.querySelector(".delete-history-btn"),o=a.querySelector(".history-item");if(a.getAttribute("data-path")!="#not-available"&&a.getAttribute("data-path")){if(s.target===a||s.target===o){let u=JSON.stringify(a.getAttribute("data-path"));this.displayHistory(u,r)}else if(s.target===i){let u=JSON.stringify(a.getAttribute("data-path")),l=u.slice(1,u.length-1);if(await Le(a.getAttribute("data-path")).delete(),kr==l){let c=document.querySelector(".chatBox");c.innerHTML="",this.messageHistories={},this.messageSessionConfig={configurable:{sessionId:ao()}}}a.remove(),window.toast("Deleted",3e3),kr=null}}})}catch(e){window.alert(e.message)}}async sendQuery(){let e=this.$chatTextarea;e.value!=""&&(this.appendUserQuery(e.value),this.scrollToBottom(),this.appendGptResponse(""),this.loader(),this.getChatgptResponse(e.value),e.value="")}async appendUserQuery(e){try{let t=this.baseUrl+"assets/user_avatar.png",r=tag("div",{className:"wrapper"}),s=tag("div",{className:"chat"}),a=tag("div",{className:"profile",child:tag("img",{src:t,alt:"user"})}),i=tag("div",{className:"message",textContent:e});s.append(a,i),r.append(s),this.$chatBox.appendChild(r)}catch(t){window.alert(t)}}async appendGptResponse(e){let t=this.baseUrl+"assets/ai_assistant.svg",r=tag("div",{className:"ai_wrapper"}),s=tag("div",{className:"ai_chat"}),a=tag("div",{className:"ai_profile",child:tag("img",{src:t,alt:"ai"})}),i=tag("div",{className:"ai_message"});i.innerHTML=this.$mdIt.render(e);let o=i.querySelectorAll(".copy-button");if(o)for(let u of o)u.addEventListener("click",function(){(0,yp.default)(this.dataset.str),window.toast("Copied to clipboard",3e3)});s.append(a,i),r.append(s),this.$chatBox.appendChild(r)}async stopGenerating(){this.abortController.abort(),this.$stopGenerationBtn.classList.add("hide"),this.$sendBtn.classList.remove("hide")}async getChatgptResponse(e){try{let t=Array.from(document.querySelectorAll(".ai_message"));this.abortController=new AbortController;let{signal:r}=this.abortController,s=ta.fromMessages([["system","You are an AI assistant for the open source plugin AI Assistant for Acode code editor(open source vscode like code editor for Android)."],["placeholder","{chat_history}"],["human","{input}"]]),a=new Hu,i=s.pipe(this.modelInstance).pipe(a),u=await new Ei({runnable:i,getMessageHistory:async p=>{if(this.messageHistories[p]===void 0)this.messageHistories[p]=new Ai;else{let g=await this.messageHistories[p].getMessages();this.messageHistories[p].addMessages(g.slice(-6))}return this.messageHistories[p]},inputMessagesKey:"input",historyMessagesKey:"chat_history"}).stream({input:e},this.messageSessionConfig,r);clearInterval(this.$loadInterval),this.$sendBtn.classList.add("hide"),this.$stopGenerationBtn.classList.remove("hide");let l=t[t.length-1];l.innerHTML="";let c="";for await(let p of u)c+=p,l.textContent+=p,this.scrollToBottom();let d=this.$mdIt.render(c);l.innerHTML=d;let f=l.querySelectorAll(".copy-button");if(f)for(let p of f)p.addEventListener("click",function(){(0,yp.default)(this.dataset.str),window.toast("Copied to clipboard",3e3)});this.$stopGenerationBtn.classList.add("hide"),this.$sendBtn.classList.remove("hide"),await this.saveHistory()}catch(t){let r=Array.from(document.querySelectorAll(".ai_message"));clearInterval(this.$loadInterval);let s=r[r.length-1];s.innerHTML="";let a=tag("div",{className:"error-box"});console.log(t),t.response?a.innerText=`Status code: ${t.response.status}
${JSON.stringify(t.response.data)}`:a.innerText=`${t.message}`,s.appendChild(a),this.$stopGenerationBtn.classList.add("hide"),this.$sendBtn.classList.remove("hide")}}async scrollToBottom(){this.$chatBox.scrollTop=this.$chatBox.scrollHeight}async loader(){let e=Array.from(document.querySelectorAll(".ai_message"));e.length!=0&&(this.$loadInterval=setInterval(()=>{e[e.length-1].innerText+="\u2022",e[e.length-1].innerText=="\u2022\u2022\u2022\u2022\u2022\u2022"&&(e[e.length-1].innerText="\u2022")},300))}async destroy(){editorManager.editor.commands.removeCommand("ai_assistant"),window.localStorage.removeItem(window.localStorage.getItem("ai-assistant-provider")),window.localStorage.removeItem("ai-assistant-provider"),window.localStorage.removeItem("ai-assistant-model-name"),window.localStorage.removeItem("openai-like-baseurl"),await Le(window.DATA_STORAGE+"secret.key").exists()&&await Le(window.DATA_STORAGE+"secret.key").delete(),this.$githubDarkFile.remove(),this.$higlightJsFile.remove(),this.$markdownItFile.remove(),this.$style.remove()}};if(window.acode){let n=new bp;acode.setPluginInit(Nl.id,(e,t,{cacheFileUrl:r,cacheFile:s})=>{e.endsWith("/")||(e+="/"),n.baseUrl=e,n.init(t,s,r)}),acode.setPluginUnmount(Nl.id,()=>{n.destroy()})}})();
/*! Bundled license information:

@langchain/core/dist/utils/fast-json-patch/src/helpers.js:
  (*!
   * https://github.com/Starcounter-Jack/JSON-Patch
   * (c) 2017-2022 Joachim Wester
   * MIT licensed
   *)

@langchain/core/dist/utils/fast-json-patch/src/duplex.js:
  (*!
   * https://github.com/Starcounter-Jack/JSON-Patch
   * (c) 2013-2021 Joachim Wester
   * MIT license
   *)

mustache/mustache.mjs:
  (*!
   * mustache.js - Logic-less {{mustache}} templates with JavaScript
   * http://github.com/janl/mustache.js
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@langchain/core/dist/utils/js-sha1/hash.js:
  (*
   * [js-sha1]{@link https://github.com/emn178/js-sha1}
   *
   * @version 0.6.0
   * @author Chen, Yi-Cyuan [emn178@gmail.com]
   * @copyright Chen, Yi-Cyuan 2014-2017
   * @license MIT
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
*/
